(function(){var e=32768;var t=0;var r=1;var a=2;var i=9;var s=6;var o=32768;var n=64;var c;var l;var f=null;var h;var d,m;var v;var u;var p;var b;var k;var w;var g,y;var _,P;var S;var C;var x=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);var A=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0);var $=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99);var R=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577);var I=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var O=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var B=function(){this.next=null;this.list=null};var z=function(){this.e=0;this.b=0;this.n=0;this.t=null};var F=function(e,t,r,a,i,s){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;{var o;var n=new Array(this.BMAX+1);var c;var l;var f;var h;var d;var m;var v;var u=new Array(this.BMAX+1);var p;var b;var k;var w=new z;var g=new Array(this.BMAX);var y=new Array(this.N_MAX);var _;var P=new Array(this.BMAX+1);var S;var C;var x;var A;var $;$=this.root=null;for(d=0;d<n.length;d++)n[d]=0;for(d=0;d<u.length;d++)u[d]=0;for(d=0;d<g.length;d++)g[d]=null;for(d=0;d<y.length;d++)y[d]=0;for(d=0;d<P.length;d++)P[d]=0;c=t>256?e[256]:this.BMAX;p=e;b=0;d=t;do{n[p[b]]++;b++}while(--d>0);if(n[0]==t){this.root=null;this.m=0;this.status=0;return}for(m=1;m<=this.BMAX;m++)if(n[m]!=0)break;v=m;if(s<m)s=m;for(d=this.BMAX;d!=0;d--)if(n[d]!=0)break;f=d;if(s>d)s=d;for(C=1<<m;m<d;m++,C<<=1)if((C-=n[m])<0){this.status=2;this.m=s;return}if((C-=n[d])<0){this.status=2;this.m=s;return}n[d]+=C;P[1]=m=0;p=n;b=1;S=2;while(--d>0)P[S++]=m+=p[b++];p=e;b=0;d=0;do{if((m=p[b++])!=0)y[P[m]++]=d}while(++d<t);t=P[f];P[0]=d=0;p=y;b=0;h=-1;_=u[0]=0;k=null;x=0;for(;v<=f;v++){o=n[v];while(o-->0){while(v>_+u[1+h]){_+=u[1+h];h++;x=(x=f-_)>s?s:x;if((l=1<<(m=v-_))>o+1){l-=o+1;S=v;while(++m<x){if((l<<=1)<=n[++S])break;l-=n[S]}}if(_+m>c&&_<c)m=c-_;x=1<<m;u[1+h]=m;k=new Array(x);for(A=0;A<x;A++){k[A]=new z}if($==null)$=this.root=new B;else $=$.next=new B;$.next=null;$.list=k;g[h]=k;if(h>0){P[h]=d;w.b=u[h];w.e=16+m;w.t=k;m=(d&(1<<_)-1)>>_-u[h];g[h-1][m].e=w.e;g[h-1][m].b=w.b;g[h-1][m].n=w.n;g[h-1][m].t=w.t}}w.b=v-_;if(b>=t)w.e=99;else if(p[b]<r){w.e=p[b]<256?16:15;w.n=p[b++]}else{w.e=i[p[b]-r];w.n=a[p[b++]-r]}l=1<<v-_;for(m=d>>_;m<x;m+=l){k[m].e=w.e;k[m].b=w.b;k[m].n=w.n;k[m].t=w.t}for(m=1<<v-1;(d&m)!=0;m>>=1)d^=m;d^=m;while((d&(1<<_)-1)!=P[h]){_-=u[h];h--}}}this.m=u[1];this.status=C!=0&&f!=1?1:0}};var T=function(){if(S.length==C)return-1;return S.charCodeAt(C++)&255};var G=function(e){while(u<e){v|=T()<<u;u+=8}};var D=function(e){return v&x[e]};var X=function(e){v>>=e;u-=e};var W=function(t,r,a){var i;var s;var o;if(a==0)return 0;o=0;for(;;){G(_);s=g.list[D(_)];i=s.e;while(i>16){if(i==99)return-1;X(s.b);i-=16;G(i);s=s.t[D(i)];i=s.e}X(s.b);if(i==16){l&=e-1;t[r+o++]=c[l++]=s.n;if(o==a)return a;continue}if(i==15)break;G(i);k=s.n+D(i);X(i);G(P);s=y.list[D(P)];i=s.e;while(i>16){if(i==99)return-1;X(s.b);i-=16;G(i);s=s.t[D(i)];i=s.e}X(s.b);G(i);w=l-s.n-D(i);X(i);while(k>0&&o<a){k--;w&=e-1;l&=e-1;t[r+o++]=c[l++]=c[w++]}if(o==a)return a}p=-1;return o};var Y=function(t,r,a){var i;i=u&7;X(i);G(16);i=D(16);X(16);G(16);if(i!=(~v&65535))return-1;X(16);k=i;i=0;while(k>0&&i<a){k--;l&=e-1;G(8);t[r+i++]=c[l++]=D(8);X(8)}if(k==0)p=-1;return i};var E=function(e,t,r){if(f==null){var a;var i=new Array(288);var s;for(a=0;a<144;a++)i[a]=8;for(;a<256;a++)i[a]=9;for(;a<280;a++)i[a]=7;for(;a<288;a++)i[a]=8;d=7;s=new F(i,288,257,A,$,d);if(s.status!=0){alert("HufBuild error: "+s.status);return-1}f=s.root;d=s.m;for(a=0;a<30;a++)i[a]=5;zip_fixed_bd=5;s=new F(i,30,0,R,I,zip_fixed_bd);if(s.status>1){f=null;alert("HufBuild error: "+s.status);return-1}h=s.root;zip_fixed_bd=s.m}g=f;y=h;_=d;P=zip_fixed_bd;return W(e,t,r)};var L=function(e,t,r){var a;var o;var n;var c;var l;var f;var h;var d;var m=new Array(286+30);var v;for(a=0;a<m.length;a++)m[a]=0;G(5);h=257+D(5);X(5);G(5);d=1+D(5);X(5);G(4);f=4+D(4);X(4);if(h>286||d>30)return-1;for(o=0;o<f;o++){G(3);m[O[o]]=D(3);X(3)}for(;o<19;o++)m[O[o]]=0;_=7;v=new F(m,19,19,null,null,_);if(v.status!=0)return-1;g=v.root;_=v.m;c=h+d;a=n=0;while(a<c){G(_);l=g.list[D(_)];o=l.b;X(o);o=l.n;if(o<16)m[a++]=n=o;else if(o==16){G(2);o=3+D(2);X(2);if(a+o>c)return-1;while(o-->0)m[a++]=n}else if(o==17){G(3);o=3+D(3);X(3);if(a+o>c)return-1;while(o-->0)m[a++]=0;n=0}else{G(7);o=11+D(7);X(7);if(a+o>c)return-1;while(o-->0)m[a++]=0;n=0}}_=i;v=new F(m,h,257,A,$,_);if(_==0)v.status=1;if(v.status!=0){if(v.status==1);return-1}g=v.root;_=v.m;for(a=0;a<d;a++)m[a]=m[a+h];P=s;v=new F(m,d,0,R,I,P);y=v.root;P=v.m;if(P==0&&h>257){return-1}if(v.status==1){}if(v.status!=0)return-1;return W(e,t,r)};var J=function(){var t;if(c==null)c=new Array(2*e);l=0;v=0;u=0;p=-1;b=false;k=w=0;g=null};var j=function(r,a,i){var s,o;s=0;while(s<i){if(b&&p==-1)return s;if(k>0){if(p!=t){while(k>0&&s<i){k--;w&=e-1;l&=e-1;r[a+s++]=c[l++]=c[w++]}}else{while(k>0&&s<i){k--;l&=e-1;G(8);r[a+s++]=c[l++]=D(8);X(8)}if(k==0)p=-1}if(s==i)return s}if(p==-1){if(b)break;G(1);if(D(1)!=0)b=true;X(1);G(2);p=D(2);X(2);g=null;k=0}switch(p){case 0:o=Y(r,a+s,i-s);break;case 1:if(g!=null)o=W(r,a+s,i-s);else o=E(r,a+s,i-s);break;case 2:if(g!=null)o=W(r,a+s,i-s);else o=L(r,a+s,i-s);break;default:o=-1;break}if(o==-1){if(b)return 0;return-1}s+=o}return s};var M=function(e){var t,r;J();S=e;C=0;var a=new Array(1024);var i=[];while((t=j(a,0,a.length))>0){var s=new Array(t);for(r=0;r<t;r++){s[r]=String.fromCharCode(a[r])}i[i.length]=s.join("")}S=null;return i.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.inflate=M})();(function(){var e=32768;var t=0;var r=1;var a=2;var i=6;var s=true;var o=32768;var n=64;var c=1024*8;var l=2*e;var f=3;var h=258;var d=16;var m=8192;var v=13;if(m>o)alert("error: zip_INBUFSIZ is too small");if(e<<1>1<<d)alert("error: zip_WSIZE is too large");if(v>d-1)alert("error: zip_HASH_BITS is too large");if(v<8||h!=258)alert("error: Code too clever");var u=m;var p=1<<v;var b=p-1;var k=e-1;var w=0;var g=4096;var y=h+f+1;var _=e-y;var P=1;var S=15;var C=7;var x=29;var A=256;var $=256;var R=A+1+x;var I=30;var O=19;var B=16;var z=17;var F=18;var T=2*R+1;var G=parseInt((v+f-1)/f);var D;var X,W;var Y;var E=null;var L,J;var j;var M;var Z;var H;var N;var q;var U;var K;var Q;var V;var et;var tt;var rt;var at;var it;var st;var ot;var nt;var ct;var lt;var ft;var ht;var dt;var mt;var vt;var ut;var pt;var bt;var kt;var wt;var gt;var yt;var _t;var Pt;var St;var Ct;var xt;var At;var $t;var Rt;var It;var Ot;var Bt;var zt;var Ft;var Tt;var Gt;var Dt;var Xt;var Wt;var Yt=function(){this.fc=0;this.dl=0};var Et=function(){this.dyn_tree=null;this.static_tree=null;this.extra_bits=null;this.extra_base=0;this.elems=0;this.max_length=0;this.max_code=0};var Lt=function(e,t,r,a){this.good_length=e;this.max_lazy=t;this.nice_length=r;this.max_chain=a};var Jt=function(){this.next=null;this.len=0;this.ptr=new Array(c);this.off=0};var jt=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0);var Mt=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var Zt=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7);var Ht=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var Nt=new Array(new Lt(0,0,0,0),new Lt(4,4,8,4),new Lt(4,5,16,8),new Lt(4,6,32,32),new Lt(4,4,16,16),new Lt(8,16,32,32),new Lt(8,16,128,128),new Lt(8,32,128,256),new Lt(32,128,258,1024),new Lt(32,258,258,4096));var qt=function(e){var t;if(!e)e=i;else if(e<1)e=1;else if(e>9)e=9;ft=e;Y=false;ot=false;if(E!=null)return;D=X=W=null;E=new Array(c);M=new Array(l);Z=new Array(u);H=new Array(o+n);N=new Array(1<<d);mt=new Array(T);for(t=0;t<T;t++)mt[t]=new Yt;vt=new Array(2*I+1);for(t=0;t<2*I+1;t++)vt[t]=new Yt;ut=new Array(R+2);for(t=0;t<R+2;t++)ut[t]=new Yt;pt=new Array(I);for(t=0;t<I;t++)pt[t]=new Yt;bt=new Array(2*O+1);for(t=0;t<2*O+1;t++)bt[t]=new Yt;kt=new Et;wt=new Et;gt=new Et;yt=new Array(S+1);_t=new Array(2*R+1);Ct=new Array(2*R+1);xt=new Array(h-f+1);At=new Array(512);$t=new Array(x);Rt=new Array(I);It=new Array(parseInt(m/8))};var Ut=function(){D=X=W=null;E=null;M=null;Z=null;H=null;N=null;mt=null;vt=null;ut=null;pt=null;bt=null;kt=null;wt=null;gt=null;yt=null;_t=null;Ct=null;xt=null;At=null;$t=null;Rt=null;It=null};var Kt=function(e){e.next=D;D=e};var Qt=function(){var e;if(D!=null){e=D;D=D.next}else e=new Jt;e.next=null;e.len=e.off=0;return e};var Vt=function(t){return N[e+t]};var er=function(t,r){return N[e+t]=r};var tr=function(e){E[J+L++]=e;if(J+L==c)zr()};var rr=function(e){e&=65535;if(J+L<c-2){E[J+L++]=e&255;E[J+L++]=e>>>8}else{tr(e&255);tr(e>>>8)}};var ar=function(){Q=(Q<<G^M[it+f-1]&255)&b;V=Vt(Q);N[it&k]=V;er(Q,it)};var ir=function(e,t){Ir(t[e].fc,t[e].dl)};var sr=function(e){return(e<256?At[e]:At[256+(e>>7)])&255};var or=function(e,t,r){return e[t].fc<e[r].fc||e[t].fc==e[r].fc&&Ct[t]<=Ct[r]};var nr=function(e,t,r){var a;for(a=0;a<r&&Wt<Xt.length;a++)e[t+a]=Xt.charCodeAt(Wt++)&255;return a};var cr=function(){var t;for(t=0;t<p;t++)N[e+t]=0;lt=Nt[ft].max_lazy;ht=Nt[ft].good_length;if(!s)dt=Nt[ft].nice_length;ct=Nt[ft].max_chain;it=0;K=0;nt=nr(M,0,2*e);if(nt<=0){ot=true;nt=0;return}ot=false;while(nt<y&&!ot)fr();Q=0;for(t=0;t<f-1;t++){Q=(Q<<G^M[t]&255)&b}};var lr=function(e){var t=ct;var r=it;var a;var i;var o=at;var n=it>_?it-_:w;var c=it+h;var l=M[r+o-1];var f=M[r+o];if(at>=ht)t>>=2;do{a=e;if(M[a+o]!=f||M[a+o-1]!=l||M[a]!=M[r]||M[++a]!=M[r+1]){continue}r+=2;a++;do{}while(M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&r<c);i=h-(c-r);r=c-h;if(i>o){st=e;o=i;if(s){if(i>=h)break}else{if(i>=dt)break}l=M[r+o-1];f=M[r+o]}}while((e=N[e&k])>n&&--t!=0);return o};var fr=function(){var t,r;var a=l-nt-it;if(a==-1){a--}else if(it>=e+_){for(t=0;t<e;t++)M[t]=M[t+e];st-=e;it-=e;K-=e;for(t=0;t<p;t++){r=Vt(t);er(t,r>=e?r-e:w)}for(t=0;t<e;t++){r=N[t];N[t]=r>=e?r-e:w}a+=e}if(!ot){t=nr(M,it+nt,a);if(t<=0)ot=true;else nt+=t}};var hr=function(){while(nt!=0&&X==null){var e;ar();if(V!=w&&it-V<=_){rt=lr(V);if(rt>nt)rt=nt}if(rt>=f){e=Ar(it-st,rt-f);nt-=rt;if(rt<=lt){rt--;do{it++;ar()}while(--rt!=0);it++}else{it+=rt;rt=0;Q=M[it]&255;Q=(Q<<G^M[it+1]&255)&b}}else{e=Ar(0,M[it]&255);nt--;it++}if(e){xr(0);K=it}while(nt<y&&!ot)fr()}};var dr=function(){while(nt!=0&&X==null){ar();at=rt;et=st;rt=f-1;if(V!=w&&at<lt&&it-V<=_){rt=lr(V);if(rt>nt)rt=nt;if(rt==f&&it-st>g){rt--}}if(at>=f&&rt<=at){var e;e=Ar(it-1-et,at-f);nt-=at-1;at-=2;do{it++;ar()}while(--at!=0);tt=0;rt=f-1;it++;if(e){xr(0);K=it}}else if(tt!=0){if(Ar(0,M[it-1]&255)){xr(0);K=it}it++;nt--}else{tt=1;it++;nt--}while(nt<y&&!ot)fr()}};var mr=function(){if(ot)return;q=0;U=0;pr();cr();X=null;L=0;J=0;if(ft<=3){at=f-1;rt=0}else{rt=f-1;tt=0}j=false};var vr=function(e,t,r){var a;if(!Y){mr();Y=true;if(nt==0){j=true;return 0}}if((a=ur(e,t,r))==r)return r;if(j)return a;if(ft<=3)hr();else dr();if(nt==0){if(tt!=0)Ar(0,M[it-1]&255);xr(1);j=true}return a+ur(e,a+t,r-a)};var ur=function(e,t,r){var a,i,s;a=0;while(X!=null&&a<r){i=r-a;if(i>X.len)i=X.len;for(s=0;s<i;s++)e[t+a+s]=X.ptr[X.off+s];X.off+=i;X.len-=i;a+=i;if(X.len==0){var o;o=X;X=X.next;Kt(o)}}if(a==r)return a;if(J<L){i=r-a;if(i>L-J)i=L-J;for(s=0;s<i;s++)e[t+a+s]=E[J+s];J+=i;a+=i;if(L==J)L=J=0}return a};var pr=function(){var e;var t;var r;var a;var i;if(pt[0].dl!=0)return;kt.dyn_tree=mt;kt.static_tree=ut;kt.extra_bits=jt;kt.extra_base=A+1;kt.elems=R;kt.max_length=S;kt.max_code=0;wt.dyn_tree=vt;wt.static_tree=pt;wt.extra_bits=Mt;wt.extra_base=0;wt.elems=I;wt.max_length=S;wt.max_code=0;gt.dyn_tree=bt;gt.static_tree=null;gt.extra_bits=Zt;gt.extra_base=0;gt.elems=O;gt.max_length=C;gt.max_code=0;r=0;for(a=0;a<x-1;a++){$t[a]=r;for(e=0;e<1<<jt[a];e++)xt[r++]=a}xt[r-1]=a;i=0;for(a=0;a<16;a++){Rt[a]=i;for(e=0;e<1<<Mt[a];e++){At[i++]=a}}i>>=7;for(;a<I;a++){Rt[a]=i<<7;for(e=0;e<1<<Mt[a]-7;e++)At[256+i++]=a}for(t=0;t<=S;t++)yt[t]=0;e=0;while(e<=143){ut[e++].dl=8;yt[8]++}while(e<=255){ut[e++].dl=9;yt[9]++}while(e<=279){ut[e++].dl=7;yt[7]++}while(e<=287){ut[e++].dl=8;yt[8]++}gr(ut,R+1);for(e=0;e<I;e++){pt[e].dl=5;pt[e].fc=Or(e,5)}br()};var br=function(){var e;for(e=0;e<R;e++)mt[e].fc=0;for(e=0;e<I;e++)vt[e].fc=0;for(e=0;e<O;e++)bt[e].fc=0;mt[$].fc=1;Gt=Dt=0;Ot=Bt=zt=0;Ft=0;Tt=1};var kr=function(e,t){var r=_t[t];var a=t<<1;while(a<=Pt){if(a<Pt&&or(e,_t[a+1],_t[a]))a++;if(or(e,r,_t[a]))break;_t[t]=_t[a];t=a;a<<=1}_t[t]=r};var wr=function(e){var t=e.dyn_tree;var r=e.extra_bits;var a=e.extra_base;var i=e.max_code;var s=e.max_length;var o=e.static_tree;var n;var c,l;var f;var h;var d;var m=0;for(f=0;f<=S;f++)yt[f]=0;t[_t[St]].dl=0;for(n=St+1;n<T;n++){c=_t[n];f=t[t[c].dl].dl+1;if(f>s){f=s;m++}t[c].dl=f;if(c>i)continue;yt[f]++;h=0;if(c>=a)h=r[c-a];d=t[c].fc;Gt+=d*(f+h);if(o!=null)Dt+=d*(o[c].dl+h)}if(m==0)return;do{f=s-1;while(yt[f]==0)f--;yt[f]--;yt[f+1]+=2;yt[s]--;m-=2}while(m>0);for(f=s;f!=0;f--){c=yt[f];while(c!=0){l=_t[--n];if(l>i)continue;if(t[l].dl!=f){Gt+=(f-t[l].dl)*t[l].fc;t[l].fc=f}c--}}};var gr=function(e,t){var r=new Array(S+1);var a=0;var i;var s;for(i=1;i<=S;i++){a=a+yt[i-1]<<1;r[i]=a}for(s=0;s<=t;s++){var o=e[s].dl;if(o==0)continue;e[s].fc=Or(r[o]++,o)}};var yr=function(e){var t=e.dyn_tree;var r=e.static_tree;var a=e.elems;var i,s;var o=-1;var n=a;Pt=0;St=T;for(i=0;i<a;i++){if(t[i].fc!=0){_t[++Pt]=o=i;Ct[i]=0}else t[i].dl=0}while(Pt<2){var c=_t[++Pt]=o<2?++o:0;t[c].fc=1;Ct[c]=0;Gt--;if(r!=null)Dt-=r[c].dl}e.max_code=o;for(i=Pt>>1;i>=1;i--)kr(t,i);do{i=_t[P];_t[P]=_t[Pt--];kr(t,P);s=_t[P];_t[--St]=i;_t[--St]=s;t[n].fc=t[i].fc+t[s].fc;if(Ct[i]>Ct[s]+1)Ct[n]=Ct[i];else Ct[n]=Ct[s]+1;t[i].dl=t[s].dl=n;_t[P]=n++;kr(t,P)}while(Pt>=2);_t[--St]=_t[P];wr(e);gr(t,o)};var _r=function(e,t){var r;var a=-1;var i;var s=e[0].dl;var o=0;var n=7;var c=4;if(s==0){n=138;c=3}e[t+1].dl=65535;for(r=0;r<=t;r++){i=s;s=e[r+1].dl;if(++o<n&&i==s)continue;else if(o<c)bt[i].fc+=o;else if(i!=0){if(i!=a)bt[i].fc++;bt[B].fc++}else if(o<=10)bt[z].fc++;else bt[F].fc++;o=0;a=i;if(s==0){n=138;c=3}else if(i==s){n=6;c=3}else{n=7;c=4}}};var Pr=function(e,t){var r;var a=-1;var i;var s=e[0].dl;var o=0;var n=7;var c=4;if(s==0){n=138;c=3}for(r=0;r<=t;r++){i=s;s=e[r+1].dl;if(++o<n&&i==s){continue}else if(o<c){do{ir(i,bt)}while(--o!=0)}else if(i!=0){if(i!=a){ir(i,bt);o--}ir(B,bt);Ir(o-3,2)}else if(o<=10){ir(z,bt);Ir(o-3,3)}else{ir(F,bt);Ir(o-11,7)}o=0;a=i;if(s==0){n=138;c=3}else if(i==s){n=6;c=3}else{n=7;c=4}}};var Sr=function(){var e;_r(mt,kt.max_code);_r(vt,wt.max_code);yr(gt);for(e=O-1;e>=3;e--){if(bt[Ht[e]].dl!=0)break}Gt+=3*(e+1)+5+5+4;return e};var Cr=function(e,t,r){var a;Ir(e-257,5);Ir(t-1,5);Ir(r-4,4);for(a=0;a<r;a++){Ir(bt[Ht[a]].dl,3)}Pr(mt,e-1);Pr(vt,t-1)};var xr=function(e){var i,s;var o;var n;n=it-K;It[zt]=Ft;yr(kt);yr(wt);o=Sr();i=Gt+3+7>>3;s=Dt+3+7>>3;if(s<=i)i=s;if(n+4<=i&&K>=0){var c;Ir((t<<1)+e,3);Br();rr(n);rr(~n);for(c=0;c<n;c++)tr(M[K+c])}else if(s==i){Ir((r<<1)+e,3);$r(ut,pt)}else{Ir((a<<1)+e,3);Cr(kt.max_code+1,wt.max_code+1,o+1);$r(mt,vt)}br();if(e!=0)Br()};var Ar=function(e,t){H[Ot++]=t;if(e==0){mt[t].fc++}else{e--;mt[xt[t]+A+1].fc++;vt[sr(e)].fc++;Z[Bt++]=e;Ft|=Tt}Tt<<=1;if((Ot&7)==0){It[zt++]=Ft;Ft=0;Tt=1}if(ft>2&&(Ot&4095)==0){var r=Ot*8;var a=it-K;var i;for(i=0;i<I;i++){r+=vt[i].fc*(5+Mt[i])}r>>=3;if(Bt<parseInt(Ot/2)&&r<parseInt(a/2))return true}return Ot==m-1||Bt==u};var $r=function(e,t){var r;var a;var i=0;var s=0;var o=0;var n=0;var c;var l;if(Ot!=0)do{if((i&7)==0)n=It[o++];a=H[i++]&255;if((n&1)==0){ir(a,e)}else{c=xt[a];ir(c+A+1,e);l=jt[c];if(l!=0){a-=$t[c];Ir(a,l)}r=Z[s++];c=sr(r);ir(c,t);l=Mt[c];if(l!=0){r-=Rt[c];Ir(r,l)}}n>>=1}while(i<Ot);ir($,e)};var Rr=16;var Ir=function(e,t){if(U>Rr-t){q|=e<<U;rr(q);q=e>>Rr-U;U+=t-Rr}else{q|=e<<U;U+=t}};var Or=function(e,t){var r=0;do{r|=e&1;e>>=1;r<<=1}while(--t>0);return r>>1};var Br=function(){if(U>8){rr(q)}else if(U>0){tr(q)}q=0;U=0};var zr=function(){if(L!=0){var e,t;e=Qt();if(X==null)X=W=e;else W=W.next=e;e.len=L-J;for(t=0;t<e.len;t++)e.ptr[t]=E[J+t];L=J=0}};var Fr=function(e,t){var r,a;Xt=e;Wt=0;if(typeof t=="undefined")t=i;qt(t);var s=new Array(1024);var o=[];while((r=vr(s,0,s.length))>0){var n=new Array(r);for(a=0;a<r;a++){n[a]=String.fromCharCode(s[a])}o[o.length]=n.join("")}Xt=null;return o.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.deflate=Fr})();"use strict";jQuery.base64=function(e){var t="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="1.0";function i(e,t){var a=r.indexOf(e.charAt(t));if(a===-1){throw"Cannot decode base64"}return a}function s(e){var r=0,a,s,o=e.length,n=[];e=String(e);if(o===0){return e}if(o%4!==0){throw"Cannot decode base64"}if(e.charAt(o-1)===t){r=1;if(e.charAt(o-2)===t){r=2}o-=4}for(a=0;a<o;a+=4){s=i(e,a)<<18|i(e,a+1)<<12|i(e,a+2)<<6|i(e,a+3);n.push(String.fromCharCode(s>>16,s>>8&255,s&255))}switch(r){case 1:s=i(e,a)<<18|i(e,a+1)<<12|i(e,a+2)<<6;n.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=i(e,a)<<18|i(e,a+1)<<12;n.push(String.fromCharCode(s>>16));break}return n.join("")}function o(e,t){var r=e.charCodeAt(t);if(r>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return r}function n(e){if(arguments.length!==1){throw"SyntaxError: exactly one argument required"}e=String(e);var a,i,s=[],n=e.length-e.length%3;if(e.length===0){return e}for(a=0;a<n;a+=3){i=o(e,a)<<16|o(e,a+1)<<8|o(e,a+2);s.push(r.charAt(i>>18));s.push(r.charAt(i>>12&63));s.push(r.charAt(i>>6&63));s.push(r.charAt(i&63))}switch(e.length-n){case 1:i=o(e,a)<<16;s.push(r.charAt(i>>18)+r.charAt(i>>12&63)+t+t);break;case 2:i=o(e,a)<<16|o(e,a+1)<<8;s.push(r.charAt(i>>18)+r.charAt(i>>12&63)+r.charAt(i>>6&63)+t);break}return s.join("")}return{decode:s,encode:n,VERSION:a}}(jQuery);LZWEncoder=function(){var e={};var t=-1;var r;var a;var i;var s;var o;var n;var c=12;var l=5003;var f;var h=c;var d;var m=1<<c;var v=new Array;var u=new Array;var p=l;var b=0;var k=false;var w;var g;var y;var _=0;var P=0;var S=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var C;var x=[];var A=e.LZWEncoder=function D(e,t,o,n){r=e;a=t;i=o;s=Math.max(2,n)};var $=function X(e,t){x[C++]=e;if(C>=254)z(t)};var R=function W(e){I(p);b=g+2;k=true;G(g,e)};var I=function Y(e){for(var t=0;t<e;++t)v[t]=-1};var O=e.compress=function E(e,r){var a;var i;var s;var o;var n;var c;var l;w=e;k=false;f=w;d=F(f);g=1<<e-1;y=g+1;b=g+2;C=0;o=T();l=0;for(a=p;a<65536;a*=2)++l;l=8-l;c=p;I(c);G(g,r);e:while((s=T())!=t){a=(s<<h)+o;i=s<<l^o;if(v[i]==a){o=u[i];continue}else if(v[i]>=0){n=c-i;if(i==0)n=1;do{if((i-=n)<0)i+=c;if(v[i]==a){o=u[i];continue e}}while(v[i]>=0)}G(o,r);o=s;if(b<m){u[i]=b++;v[i]=a}else R(r)}G(o,r);G(y,r)};var B=e.encode=function L(e){e.writeByte(s);o=r*a;n=0;O(s+1,e);e.writeByte(0)};var z=function J(e){if(C>0){e.writeByte(C);e.writeBytes(x,0,C);C=0}};var F=function j(e){return(1<<e)-1};var T=function M(){if(o==0)return t;--o;var e=i[n++];return e&255};var G=function Z(e,t){_&=S[P];if(P>0)_|=e<<P;else _=e;P+=f;while(P>=8){$(_&255,t);_>>=8;P-=8}if(b>d||k){if(k){d=F(f=w);k=false}else{++f;if(f==h)d=m;else d=F(f)}}if(e==y){while(P>0){$(_&255,t);_>>=8;P-=8}z(t)}};A.apply(this,arguments);return e};GIFEncoder=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function r(){this.bin=[]}r.prototype.getData=function(){for(var e="",r=this.bin.length,a=0;a<r;a++)e+=t[this.bin[a]];return e};r.prototype.writeByte=function(e){this.bin.push(e)};r.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;r<t;r++)this.writeByte(e.charCodeAt(r))};r.prototype.writeBytes=function(e,t,r){for(var a=r||e.length,i=t||0;i<a;i++)this.writeByte(e[i])};var a={};var i;var s;var o=null;var n;var c=-1;var l=0;var f=false;var h;var d;var m;var v;var u;var p;var b=new Array;var k=7;var w=-1;var g=false;var y=true;var _=false;var P=10;var S=a.setDelay=function H(e){l=Math.round(e/10)};var C=a.setDispose=function N(e){if(e>=0)w=e};var x=a.setRepeat=function q(e){if(e>=0)c=e};var A=a.setTransparent=function U(e){o=e};var $=a.addFrame=function K(e,t){if(e==null||!f||h==null){throw new Error("Please call start method before calling addFrame");return false}var r=true;try{if(!t){d=e.getImageData(0,0,e.canvas.width,e.canvas.height).data;if(!_)z(e.canvas.width,e.canvas.height)}else{d=e}D();T();if(y){Y();L();if(c>=0){E()}}X();W();if(!y)L();j();y=false}catch(a){r=false}return r};var R=a.finish=function Q(){if(!f)return false;var e=true;f=false;try{h.writeByte(59)}catch(t){e=false}return e};var I=function V(){n=0;d=null;m=null;v=null;p=null;g=false;y=true};var O=a.setFrameRate=function et(e){if(e!=15)l=Math.round(100/e)};var B=a.setQuality=function tt(e){if(e<1)e=1;P=e};var z=a.setSize=function rt(e,t){if(f&&!y)return;i=e;s=t;if(i<1)i=320;if(s<1)s=240;_=true};var F=a.start=function at(){I();var e=true;g=false;h=new r;try{h.writeUTFBytes("GIF89a")}catch(t){e=false}return f=e};var T=function it(){var e=m.length;var t=e/3;v=[];var r=new NeuQuant(m,e,P);p=r.process();var a=0;for(var i=0;i<t;i++){var s=r.map(m[a++]&255,m[a++]&255,m[a++]&255);b[s]=true;v[i]=s}m=null;u=8;k=7;if(o!=null){n=G(o)}};var G=function st(e){if(p==null)return-1;var t=(e&16711680)>>16;var r=(e&65280)>>8;var a=e&255;var i=0;var s=256*256*256;var o=p.length;for(var n=0;n<o;){var c=t-(p[n++]&255);var l=r-(p[n++]&255);var f=a-(p[n]&255);var h=c*c+l*l+f*f;var d=n/3;if(b[d]&&h<s){s=h;i=d}n++}return i};var D=function ot(){var e=i;var t=s;m=[];var r=d;var a=0;for(var o=0;o<t;o++){for(var n=0;n<e;n++){var c=o*e*4+n*4;m[a++]=r[c];m[a++]=r[c+1];m[a++]=r[c+2]}}};var X=function nt(){h.writeByte(33);h.writeByte(249);h.writeByte(4);var e;var t;if(o==null){e=0;t=0}else{e=1;t=2}if(w>=0){t=w&7}t<<=2;h.writeByte(0|t|0|e);J(l);h.writeByte(n);h.writeByte(0)};var W=function ct(){h.writeByte(44);J(0);J(0);J(i);J(s);if(y){h.writeByte(0)}else{h.writeByte(128|0|0|0|k)}};var Y=function lt(){J(i);J(s);h.writeByte(128|112|0|k);h.writeByte(0);h.writeByte(0)};var E=function ft(){h.writeByte(33);h.writeByte(255);h.writeByte(11);h.writeUTFBytes("NETSCAPE"+"2.0");h.writeByte(3);h.writeByte(1);J(c);h.writeByte(0)};var L=function ht(){h.writeBytes(p);var e=3*256-p.length;for(var t=0;t<e;t++)h.writeByte(0)};var J=function dt(e){h.writeByte(e&255);h.writeByte(e>>8&255)};var j=function mt(){var e=new LZWEncoder(i,s,v,u);e.encode(h)};var M=a.stream=function vt(){return h};var Z=a.setProperties=function ut(e,t){f=e;y=t};return a};NeuQuant=function(){var e={};var t=256;var r=499;var a=491;var i=487;var s=503;var o=3*s;var n=t-1;var c=4;var l=100;var f=16;var h=1<<f;var d=10;var m=1<<d;var v=10;var u=h>>v;var p=h<<d-v;var b=t>>3;var k=6;var w=1<<k;var g=b*w;var y=30;var _=10;var P=1<<_;var S;var C=8;var x=1<<C;var A=_+C;var $=1<<A;var R;var I;var O;var B;var z=new Array;var F=new Array;var T=new Array;var G=new Array;var D=e.NeuQuant=function H(e,r,a){var i;var s;R=e;I=r;O=a;B=new Array(t);for(i=0;i<t;i++){B[i]=new Array(4);s=B[i];s[0]=s[1]=s[2]=(i<<c+8)/t;T[i]=h/t;F[i]=0}};var X=function N(){var e=[];var r=new Array(t);for(var a=0;a<t;a++)r[B[a][3]]=a;var i=0;for(var s=0;s<t;s++){var o=r[s];e[i++]=B[o][0];e[i++]=B[o][1];e[i++]=B[o][2]}return e};var W=function q(){var e;var r;var a;var i;var s;var o;var c;var l;c=0;l=0;for(e=0;e<t;e++){s=B[e];a=e;i=s[1];for(r=e+1;r<t;r++){o=B[r];if(o[1]<i){a=r;i=o[1]}}o=B[a];if(e!=a){r=o[0];o[0]=s[0];s[0]=r;r=o[1];o[1]=s[1];s[1]=r;r=o[2];o[2]=s[2];s[2]=r;r=o[3];o[3]=s[3];s[3]=r}if(i!=c){z[c]=l+e>>1;for(r=c+1;r<i;r++)z[r]=e;c=i;l=e}}z[c]=l+n>>1;for(r=c+1;r<256;r++)z[r]=n};var Y=function U(){var e;var t;var n;var f;var h;var d;var m;var v;var u;var p;var b;var w;var _;var C;if(I<o)O=1;S=30+(O-1)/3;w=R;_=0;C=I;b=I/(3*O);p=b/l|0;v=P;d=g;m=d>>k;if(m<=1)m=0;for(e=0;e<m;e++)G[e]=v*((m*m-e*e)*x/(m*m));if(I<o)u=3;else if(I%r!=0)u=3*r;else{if(I%a!=0)u=3*a;else{if(I%i!=0)u=3*i;else u=3*s}}e=0;while(e<b){n=(w[_+0]&255)<<c;f=(w[_+1]&255)<<c;h=(w[_+2]&255)<<c;t=Z(n,f,h);M(v,t,n,f,h);if(m!=0)j(m,t,n,f,h);_+=u;if(_>=C)_-=I;e++;if(p==0)p=1;if(e%p==0){v-=v/S;d-=d/y;m=d>>k;if(m<=1)m=0;for(t=0;t<m;t++)G[t]=v*((m*m-t*t)*x/(m*m))}}};var E=e.map=function K(e,r,a){var i;var s;var o;var n;var c;var l;var f;c=1e3;f=-1;i=z[r];s=i-1;while(i<t||s>=0){if(i<t){l=B[i];o=l[1]-r;if(o>=c)i=t;else{i++;if(o<0)o=-o;n=l[0]-e;if(n<0)n=-n;o+=n;if(o<c){n=l[2]-a;if(n<0)n=-n;o+=n;if(o<c){c=o;f=l[3]}}}}if(s>=0){l=B[s];o=r-l[1];if(o>=c)s=-1;else{s--;if(o<0)o=-o;n=l[0]-e;if(n<0)n=-n;o+=n;if(o<c){n=l[2]-a;if(n<0)n=-n;o+=n;if(o<c){c=o;f=l[3]}}}}}return f};var L=e.process=function Q(){Y();J();W();return X()};var J=function V(){var e;var r;for(e=0;e<t;e++){B[e][0]>>=c;B[e][1]>>=c;B[e][2]>>=c;B[e][3]=e}};var j=function et(e,r,a,i,s){var o;var n;var c;var l;var f;var h;var d;c=r-e;if(c<-1)c=-1;l=r+e;if(l>t)l=t;o=r+1;n=r-1;h=1;while(o<l||n>c){f=G[h++];if(o<l){d=B[o++];try{d[0]-=f*(d[0]-a)/$;d[1]-=f*(d[1]-i)/$;d[2]-=f*(d[2]-s)/$}catch(m){}}if(n>c){d=B[n--];try{d[0]-=f*(d[0]-a)/$;d[1]-=f*(d[1]-i)/$;d[2]-=f*(d[2]-s)/$}catch(m){}}}};var M=function tt(e,t,r,a,i){var s=B[t];s[0]-=e*(s[0]-r)/P;s[1]-=e*(s[1]-a)/P;s[2]-=e*(s[2]-i)/P};var Z=function rt(e,r,a){var i;var s;var o;var n;var l;var h;var m;var b;var k;var w;b=~(1<<31);k=b;h=-1;m=h;for(i=0;i<t;i++){w=B[i];s=w[0]-e;if(s<0)s=-s;o=w[1]-r;if(o<0)o=-o;s+=o;o=w[2]-a;if(o<0)o=-o;s+=o;if(s<b){b=s;h=i}n=s-(F[i]>>f-c);if(n<k){k=n;m=i}l=T[i]>>v;T[i]-=l;F[i]+=l<<d}T[h]+=u;F[h]-=p;return m};D.apply(this,arguments);return e};function Painter(e){this.myself=this;this.CanvasHeight=177;this.CanvasWidth=97;this.blockSize=8;this.IDString=e;this.CanvasPreview=$("#"+this.IDString+"-preview");this.ContextPreview=this.CanvasPreview[0].getContext("2d");this.CanvasDeco=$("#"+this.IDString+"-deco");this.ContextDeco=this.CanvasDeco[0].getContext("2d");this.CanvasPF=$("#"+this.IDString+"-inactive");this.ContextPF=this.CanvasPF[0].getContext("2d");this.CanvasActive=$("#"+this.IDString+"-active");this.ContextActive=this.CanvasActive[0].getContext("2d");this.CanvasWhiteborder=$("#"+this.IDString+"-whiteborder");this.ContextWhiteborder=this.CanvasWhiteborder[0].getContext("2d");this.CanvasBackground=$("#"+this.IDString+"-background");this.ContextBackground=this.CanvasBackground[0].getContext("2d");this.CanvasBorder=$("#"+this.IDString+"-border");this.ContextBorder=this.CanvasBorder[0].getContext("2d");this.CanvasDecoPin=$("#"+this.IDString+"-decoPin");this.ContextDecoPin=this.CanvasDecoPin[0].getContext("2d");this.CanvasNextHold=$("#"+this.IDString+"-nexthold");this.ContextNextHold=this.CanvasNextHold[0].getContext("2d");this.CanvasProgressbar=$("#"+this.IDString+"-progressbar");this.ContextProgressbar=this.CanvasProgressbar[0].getContext("2d");this.CanvasControl=$("#"+this.IDString+"-control");this.ContextControl=this.CanvasControl[0].getContext("2d");this.PFOriginX=1*this.blockSize;this.PFOriginY=1*this.blockSize;this.PFOriginXAbsolute=this.CanvasPF.offset().left+this.PFOriginX-1;this.PFOriginYAbsolute=this.CanvasPF.offset().top+this.PFOriginY;this.CntrlOriginX=this.CanvasControl.offset().left;this.CntrlOriginY=this.CanvasControl.offset().top;this.CanvasControlheight=this.CanvasControl.height();this.sprite="";this.spritemini="";this.spritedeco="";this.joypalette="";this.ready=false}Painter.prototype.init=function(){var e=this.myself;this.spritedeco=new Image;this.sprite=new Image;this.spritemini=new Image;this.joypalette=new Image;this.spritedeco.src="res/deco-8px.png";this.sprite.src="res/palette-8px.png";this.spritemini.src="res/palette-4px.png";this.joypalette.src="res/control-palette.png";this.sprite.onload=function(){e.ready=true};this.sprite.onerror=function(){e.ready=true};this.drawJoystick("all","rest");this.drawAllButtons("rest");this.drawBorder("master");this.drawGrid()};Painter.prototype.eraseLayer=function(e){var t;switch(e){case"decoration":Context=this.ContextDeco;break;case"inactive":Context=this.ContextPF;break;case"preview":Context=this.ContextPreview;break;case"active":Context=this.ContextActive;break;case"nexthold":Context=this.ContextNextHold;break;case"whiteborder":Context=this.ContextWhiteborder;break;case"all":Context=this.ContextPF;this.ContextDeco.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextPreview.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextActive.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextNextHold.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextWhiteborder.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);break}Context.clearRect(0,0,this.CanvasWidth,this.CanvasHeight)};Painter.prototype.eraseBlock=function(e,t){this.ContextPF.clearRect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)};Painter.prototype.eraseDeco=function(e,t){this.ContextDeco.clearRect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)};Painter.prototype.drawComment=function(e){$("#"+this.IDString+"-comment").val(e)};Painter.prototype.drawDuration=function(e){$("#"+this.IDString+"-duration").val(e)};Painter.prototype.drawOpacity=function(e){$("#"+this.IDString+"-active-opacity").val(e)};Painter.prototype.drawProgressbar=function(e,t){if(e<=t&&e>0){this.ContextProgressbar.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextProgressbar.beginPath();this.ContextProgressbar.rect(0,0,parseInt(e/t*100,10),24);this.ContextProgressbar.fillStyle="gray";this.ContextProgressbar.fill();this.ContextProgressbar.closePath()}};Painter.prototype.drawWhiteBorder=function(e){this.eraseLayer("whiteborder");for(var t=0,r=e.length;t<r;t++){for(var a=0,i=e[0].length;a<i;a++){if(e[t][a][0]){this.drawLocalWhiteBorder(e,t,a)}}}};Painter.prototype.drawLocalWhiteBorder=function(e,t,r){this.ContextWhiteborder.beginPath();if(e[t][r][0]){if(t-1>=0){if(!e[t-1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(t+1<e.length){if(!e[t+1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(t+1)*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(t+1)*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r-1>=0){if(!e[t][r-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r+1<e[0].length){if(!e[t][r+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}else{if(t-1>=0){if(e[t-1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);
this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(t+1<e.length){if(e[t+1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(t+1)*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(t+1)*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r-1>=0){if(e[t][r-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r+1<e[0].length){if(e[t][r+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}};Painter.prototype.drawGrid=function(){this.ContextBackground.beginPath();this.ContextBackground.beginPath();for(var e=1;e<=9;e++){this.ContextBackground.rect(this.PFOriginX+e*this.blockSize,this.PFOriginY,1,20*this.blockSize)}for(var e=1;e<=19;e++){this.ContextBackground.rect(this.PFOriginX,this.PFOriginY+e*this.blockSize,10*this.blockSize,1)}this.ContextBackground.fillStyle="#444";this.ContextBackground.fill();this.ContextBackground.closePath()};Painter.prototype.drawBorder=function(e){var t="#afafaf";var r="#46545f";var a=this.myself;switch(e){case"master":t="#afafaf";r="#46545f";break;case"easy":t="#afafaf";r="#475f46";break;case"death":t="#ac434a";r="#5f0004";break;default:t="#afafaf";r="#46545f";break}var i=this.ContextBorder.createRadialGradient(0,0,this.blockSize,0,0,this.CanvasWidth-2*this.blockSize),s=this.ContextBorder.createRadialGradient(this.CanvasWidth,this.CanvasHeight,this.blockSize,this.CanvasWidth,this.CanvasHeight,this.CanvasWidth-2*this.blockSize);i.addColorStop(0,t);i.addColorStop(1,r);s.addColorStop(0,t);s.addColorStop(1,r);var o=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),n=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),c=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize),l=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize);o.addColorStop(0,t);o.addColorStop(1,r);n.addColorStop(0,r);n.addColorStop(1,t);c.addColorStop(0,t);c.addColorStop(1,r);l.addColorStop(0,r);l.addColorStop(1,t);function f(e,t,r,i,s){a.ContextBorder.beginPath();a.ContextBorder.rect(e,t,r,i);a.ContextBorder.fillStyle=s;a.ContextBorder.fill();a.ContextBorder.closePath()}f(0,0,this.CanvasWidth,this.CanvasHeight,r);f(0,0,this.CanvasWidth,this.CanvasWidth,i);f(0,this.CanvasHeight-this.CanvasWidth,this.CanvasWidth,this.CanvasWidth,s);f(0,0,this.CanvasWidth,1,n);f(0,0,1,this.CanvasHeight,l);f(this.CanvasWidth-1,0,1,this.CanvasHeight,c);f(0,this.CanvasHeight-1,this.CanvasWidth,1,o);f(this.blockSize-1,this.blockSize-1,10*this.blockSize+1,1,n);f(this.blockSize+10*this.blockSize,this.blockSize-1,1,20*this.blockSize+2,c);f(this.blockSize-1,this.blockSize-1,1,20*this.blockSize+1,l);f(this.blockSize-1,this.blockSize+20*this.blockSize,10*this.blockSize+1,1,o);f(1*this.blockSize,1*this.blockSize,10*this.blockSize,20*this.blockSize,"black")};Painter.prototype.drawNextHold=function(e,t,r){matrix=getMatrix(t,"i",r);switch(e){case 0:this.ContextNextHold.clearRect(0,this.blockSize+3,4*this.blockSize,3*this.blockSize);if(!t){return}for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){this.drawBlock(parseInt(-1+i,10),parseInt(2+a,10),t,r,"nextholdmini")}}}break;case 1:this.ContextNextHold.clearRect(4*this.blockSize,this.blockSize,4*this.blockSize,3*this.blockSize+3);if(!t){return}for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){if(r=="SRS"){this.drawBlock(parseInt(3+i,10),parseInt(1+a,10),t,r,"nexthold")}else{this.drawBlock(parseInt(3+i,10),parseInt(0+a,10),t,r,"nexthold")}}}}break;case 2:this.ContextNextHold.clearRect(8*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);if(!t){return}for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){this.drawBlock(parseInt(13+i,10),parseInt(3+a,10),t,r,"nextholdmini")}}}break;case 3:if(!t){return}this.ContextNextHold.clearRect(10*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){this.drawBlock(parseInt(17+i,10),parseInt(3+a,10),t,r,"nextholdmini")}}}break}};Painter.prototype.changeActiveOpacity=function(e){if(e=="Flash"||e=="flash"){this.CanvasActive.attr("style","z-index:4; opacity: 1.0")}else{this.CanvasActive.attr("style","z-index:4; opacity: "+e)}};Painter.prototype.drawDeco=function(e,t,r,a){if(!r){return}var i=this.spritedeco;var s,o;var n;if(a=="preview"){n=this.ContextPreview}else{n=this.ContextDeco}switch(r){case"n1":s=decoration.n1.s;o=decoration.n1.e;break;case"n2":s=decoration.n2.s;o=decoration.n2.e;break;case"n3":s=decoration.n3.s;o=decoration.n3.e;break;case"n4":s=decoration.n4.s;o=decoration.n4.e;break;case"n5":s=decoration.n5.s;o=decoration.n5.e;break;case"n6":s=decoration.n6.s;o=decoration.n6.e;break;case"n7":s=decoration.n7.s;o=decoration.n7.e;break;case"n8":s=decoration.n8.s;o=decoration.n8.e;break;case"n9":s=decoration.n9.s;o=decoration.n9.e;break;case"n0":s=decoration.n0.s;o=decoration.n0.e;break;case"smallcw":s=decoration.smallcw.s;o=decoration.smallcw.e;break;case"smallccw":s=decoration.smallccw.s;o=decoration.smallccw.e;break;case"smalloktick":s=decoration.smalloktick.s;o=decoration.smalloktick.e;break;case"smallokcircle":s=decoration.smallokcircle.s;o=decoration.smallokcircle.e;break;case"smallnocross":s=decoration.smallnocross.s;o=decoration.smallnocross.e;break;case"smallquestion":s=decoration.smallquestion.s;o=decoration.smallquestion.e;break;case"smallexclamation":s=decoration.smallexclamation.s;o=decoration.smallexclamation.e;break;case"nwarrow":s=decoration.nwarrow.s;o=decoration.nwarrow.e;break;case"narrow":s=decoration.narrow.s;o=decoration.narrow.e;break;case"nearrow":s=decoration.nearrow.s;o=decoration.nearrow.e;break;case"earrow":s=decoration.earrow.s;o=decoration.earrow.e;break;case"searrow":s=decoration.searrow.s;o=decoration.searrow.e;break;case"sarrow":s=decoration.sarrow.s;o=decoration.sarrow.e;break;case"swarrow":s=decoration.swarrow.s;o=decoration.swarrow.e;break;case"warrow":s=decoration.warrow.s;o=decoration.warrow.e;break;case"bigcw":s=decoration.bigcw.s;o=decoration.bigcw.e;break;case"bigccw":s=decoration.bigccw.s;o=decoration.bigccw.e;break;case"bigquestion":s=decoration.bigquestion.s;o=decoration.bigquestion.e;break;case"bigexclamation":s=decoration.bigexclamation.s;o=decoration.bigexclamation.e;break;case"bigoktick":s=decoration.bigoktick.s;o=decoration.bigoktick.e;break;case"bigokcircle":s=decoration.bigokcircle.s;o=decoration.bigokcircle.e;break;case"bignocross":s=decoration.bignocross.s;o=decoration.bignocross.e;break;case"overlayyellow":s=decoration.overlayyellow.s;o=decoration.overlayyellow.e;break;case"overlayblue":s=decoration.overlayblue.s;o=decoration.overlayblue.e;break;case"overlaygreen":s=decoration.overlaygreen.s;o=decoration.overlaygreen.e;break;case"overlaypink":s=decoration.overlaypink.s;o=decoration.overlaypink.e;break;case"overlayorange":s=decoration.overlayorange.s;o=decoration.overlayorange.e;break;case"clear1":s=decoration.clear1.s;o=decoration.clear1.e;break;case"clear2":s=decoration.clear2.s;o=decoration.clear2.e;break;case"clear3":s=decoration.clear3.s;o=decoration.clear3.e;break;case"clear4":s=decoration.clear4.s;o=decoration.clear4.e;break;case"clear5":s=decoration.clear5.s;o=decoration.clear5.e;break;case"clear6":s=decoration.clear6.s;o=decoration.clear6.e;break;case"clear7":s=decoration.clear7.s;o=decoration.clear7.e;break}var c=s[0]*this.blockSize;var l=s[1]*this.blockSize;var f=(o[0]-s[0])*this.blockSize;var h=(o[1]-s[1])*this.blockSize;var d=this.PFOriginX+e*this.blockSize;var m=this.PFOriginY+t*this.blockSize;if(a!="eraser"){n.clearRect(d,m,f,h);n.drawImage(i,c,l,f,h,d,m,f,h)}else{n.clearRect(d,m,f,h);this.ContextDecoPin.clearRect(d-this.blockSize/2,m-this.blockSize/2,this.blockSize,this.blockSize)}if(a!="preview"&&a!="eraser"){this.ContextDecoPin.beginPath();this.ContextDecoPin.fillStyle="red";this.ContextDecoPin.strokeStyle="red";this.ContextDecoPin.arc(d,m,this.blockSize/4,2*Math.PI,false);this.ContextDecoPin.fill();this.ContextDecoPin.lineTo(d+4,m+4);this.ContextDecoPin.stroke();this.ContextDecoPin.closePath()}};Painter.prototype.drawBrowserBlock=function(e,t,r,a,i,s){var o;switch(a){case"ARS":switch(r){case"I":o=ARS.I.color;break;case"T":o=ARS.T.color;break;case"L":o=ARS.L.color;break;case"J":o=ARS.J.color;break;case"S":o=ARS.S.color;break;case"Z":o=ARS.Z.color;break;case"O":o=ARS.O.color;break;case"G":o=ARS.G.color;break}break;case"SRS":switch(r){case"I":o=SRS.I.color;break;case"T":o=SRS.T.color;break;case"L":o=SRS.L.color;break;case"J":o=SRS.J.color;break;case"S":o=SRS.S.color;break;case"Z":o=SRS.Z.color;break;case"O":o=SRS.O.color;break;case"G":o=SRS.G.color;break}break;case"GB":switch(r){case"I":o=GB.I.color;break;case"T":o=GB.T.color;break;case"L":o=GB.L.color;break;case"J":o=GB.J.color;break;case"S":o=GB.S.color;break;case"Z":o=GB.Z.color;break;case"O":o=GB.O.color;break;case"G":o=GB.G.color;break}break}if(s=="inactive"){if(r=="E"){$("#pf-"+i+"-row-"+t+"-col-"+e+" .inactive").attr("style","background-color: transparent;")}else{$("#pf-"+i+"-row-"+t+"-col-"+e+" .inactive").attr("style","background-color: "+o+";")}}if(s=="resetactive"){$("table div.active").attr("style","background-color: transparent;")}if(s=="active"){$("#pf-"+i+"-row-"+t+"-col-"+e+" .active").attr("style","background-color: "+o+";")}};Painter.prototype.drawBlock=function(e,t,r,a,i,s){if(r){var o;var n=false;switch(i){case"inactive":o=this.ContextPF;break;case"preview":o=this.ContextPreview;break;case"active":o=this.ContextActive;break;case"flash":o=this.ContextActive;break;case"nexthold":o=this.ContextNextHold;break;case"nextholdmini":o=this.ContextNextHold;n=true;break}o.beginPath();if(n){if(e>=17){o.rect(6+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*this.blockSize/2,this.blockSize/2,this.blockSize/2)}else{o.rect(5+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*this.blockSize/2,this.blockSize/2,this.blockSize/2)}}else{o.rect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)}var c;var l;var f;if(n){l=this.spritemini}else{l=this.sprite}switch(a){case"ARS":switch(r){case"I":c=ARS.I.color;f=ARS.I.offset;break;case"T":c=ARS.T.color;f=ARS.T.offset;break;case"L":c=ARS.L.color;f=ARS.L.offset;break;case"J":c=ARS.J.color;f=ARS.J.offset;break;case"S":c=ARS.S.color;f=ARS.S.offset;break;case"Z":c=ARS.Z.color;f=ARS.Z.offset;break;case"O":c=ARS.O.color;f=ARS.O.offset;break;case"G":c=ARS.G.color;f=ARS.G.offset;break}break;case"SRS":switch(r){case"I":c=SRS.I.color;f=SRS.I.offset;break;case"T":c=SRS.T.color;f=SRS.T.offset;break;case"L":c=SRS.L.color;f=SRS.L.offset;break;case"J":c=SRS.J.color;f=SRS.J.offset;break;case"S":c=SRS.S.color;f=SRS.S.offset;break;case"Z":c=SRS.Z.color;f=SRS.Z.offset;break;case"O":c=SRS.O.color;f=SRS.O.offset;break;case"G":c=SRS.G.color;f=SRS.G.offset;break}break;case"GB":switch(r){case"I":c=GB.I.color;f=GB.I.offset;break;case"T":c=GB.T.color;f=GB.T.offset;break;case"L":c=GB.L.color;f=GB.L.offset;break;case"J":c=GB.J.color;f=GB.J.offset;break;case"S":c=GB.S.color;f=GB.S.offset;break;case"Z":c=GB.Z.color;f=GB.Z.offset;break;case"O":c=GB.O.color;f=GB.O.offset;break;case"G":c=GB.G.color;f=GB.G.offset;break}break}if(i=="flash"){if(a=="ARS"){c=ARS.Flash.color;f=ARS.Flash.offset}if(a=="SRS"){c=SRS.Flash.color;f=SRS.Flash.offset}if(a=="GB"){c=GB.Flash.color;f=GB.Flash.offset}}o.fillStyle=c;o.fill();o.closePath();if(l){if(n){if(e>=17){o.drawImage(l,f[0]*(this.blockSize/2),f[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,6+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}else{o.drawImage(l,f[0]*(this.blockSize/2),f[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,5+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}}else{o.drawImage(l,f[0]*this.blockSize,f[1]*this.blockSize,this.blockSize,this.blockSize,this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)}}}};Painter.prototype.highlight=function(e,t){var r=this.PFOriginX+(e+.5)*this.blockSize;var a=this.PFOriginY+(t+.5)*this.blockSize;var i=20;function s(){setTimeout(function(){var e=window.requestAnimationFrame(s);if(i>0){this.myself.ContextPreview.beginPath();this.myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";this.myself.ContextPreview.globalCompositeOperation="destination-out";this.myself.ContextPreview.arc(r,a,i+2,2*Math.PI,false);this.myself.ContextPreview.arc(r,a,i+1,2*Math.PI,false);this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();this.myself.ContextPreview.beginPath();this.myself.ContextPreview.arc(r,a,i,2*Math.PI,false);this.myself.ContextPreview.globalCompositeOperation="source-over";this.myself.ContextPreview.strokeStyle="white";this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();i-=1}else{this.myself.ContextPreview.beginPath();this.myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";this.myself.ContextPreview.globalCompositeOperation="destination-out";this.myself.ContextPreview.arc(r,a,i+2,2*Math.PI,false);this.myself.ContextPreview.arc(r,a,i+1,2*Math.PI,false);this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();window.cancelAnimationFrame(e)}},1e3/60)}};Painter.prototype.resetJoystick=function(){var e=this.CanvasControl.height();this.ContextControl.clearRect(0,0,e,e);this.ContextControl.drawImage(this.joypalette,0,0,e,e,0,0,e,e)};Painter.prototype.drawJoystick=function(e,t){var r;switch(t){case"rest":r=0;break;case"pressed":r=35;break;case"holded":r=70;break}switch(e){case"all":this.ContextControl.drawImage(this.joypalette,0,r,37,37,0,0,37,37);break;case"u":this.ContextControl.drawImage(this.joypalette,12,r,11,12,12,0,11,12);break;case"d":this.ContextControl.drawImage(this.joypalette,12,12+r,11,24,12,12,11,24);break;case"l":this.ContextControl.drawImage(this.joypalette,0,12+r,12,11,0,12,12,11);break;case"r":this.ContextControl.drawImage(this.joypalette,12,12+r,24,11,12,12,24,11);break;case"ul":this.ContextControl.drawImage(this.joypalette,3,3+r,9,9,3,3,9,9);break;case"ur":this.ContextControl.drawImage(this.joypalette,23,3+r,9,9,23,3,9,9);break;case"dl":this.ContextControl.drawImage(this.joypalette,3,23+r,9,9,3,23,9,9);break;case"dr":this.ContextControl.drawImage(this.joypalette,23,23+r,9,9,23,23,9,9);break}};Painter.prototype.drawAllButtons=function(e,t){this.drawButton("A",e);this.drawButton("B",e);this.drawButton("C",e);this.drawButton("D",e)};Painter.prototype.drawButton=function(e,t){var r;switch(t){case"rest":r=0;break;case"pressed":r=35;break;case"holded":r=70;break}switch(e){case"A":this.ContextControl.drawImage(this.joypalette,37,1+r,14,15,37,1,14,15);break;case"B":this.ContextControl.drawImage(this.joypalette,53,1+r,14,15,53,1,14,15);break;case"C":this.ContextControl.drawImage(this.joypalette,69,1+r,14,15,69,1,14,15);break;case"D":this.ContextControl.drawImage(this.joypalette,37,16+r,14,18,37,16,14,18);break}};Painter.prototype.drawButton_old=function(e,t){var r=this.CanvasControl.height();var a=r/5;this.ContextControl.textBaseline="middle";this.ContextControl.font="bold 10px sans-serif";this.ContextControl.beginPath();switch(e){case"A":this.ContextControl.clearRect(r+r/4-a-1,r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4,r/4,a,0,2*Math.PI,false);break;case"B":this.ContextControl.clearRect(r+r/4+2*a+r/16-a-1,r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4+2*a+r/16,r/4,a,0,2*Math.PI,false);break;case"C":this.ContextControl.clearRect(r+r/4+4*a+2*r/16-a-1,r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4+4*a+2*r/16,r/4,a,0,2*Math.PI,false);break;case"D":this.ContextControl.clearRect(r+r/4-a-1,3*r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4,3*r/4,a,0,2*Math.PI,false);break}this.ContextControl.closePath();switch(t){case"pressed":this.ContextControl.fillStyle="#ff0000";break;case"holded":this.ContextControl.fillStyle="#ffa600";break;case"rest":this.ContextControl.fillStyle="#808080";break}this.ContextControl.fill();switch(e){case"A":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("A",r+r/4-r/10,r/4+1);break;case"B":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("B",r+r/4+2*a+r/16-r/10,r/4+1);break;case"C":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("C",r+r/4+4*a+2*r/16-r/10,r/4+1);break;case"D":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("H",r+r/4-r/10,3*r/4+1);break}};Painter.prototype.frameCount=function(e,t){$("#"+this.IDString+"-current-frame").attr("value",e);$("#"+this.IDString+"-total-frame").html(t)};function Diagram(e){var t=this;this.painter=e;this.frames=[];this.current_frame=0;this.playing=false}Diagram.prototype.new_frame=function(){this.current_frame++;this.painter.eraseLayer("all");var e=new Frame(this.painter);this.frames.splice(this.current_frame,0,e);this.update_framecount()};Diagram.prototype.remove_current_frame=function(){if(this.frames.length>1){if(this.current_frame-1>=0){this.current_frame--;this.frames.splice(this.current_frame+1,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}else{this.frames.splice(this.current_frame,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}}else{this.current_frame=0;this.frames[this.current_frame].clear("all")}};Diagram.prototype.init=function(){this.frames.push(new Frame(this.painter))};Diagram.prototype.new_copy_frame=function(){var e=this.frames[this.current_frame].print();this.new_frame();this.frames[this.current_frame].load(e,"blank")};Diagram.prototype.remove_following_frames=function(){console.log(this.current_frame+1);this.frames.splice(this.current_frame+1);this.frames[this.current_frame].draw()};Diagram.prototype.remove_all_playfields=function(){this.current_frame=this.frames.length;while(this.current_frame>0){this.remove_current_frame()}this.frames[0].clear("all");this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.remove_all_playfields2=function(){this.frames.splice(1);this.frames[0].clear("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.goto_frame=function(e){this.painter.eraseLayer("all");this.current_frame=e;if(e==0){this.frames[this.current_frame].draw()}else{var t={border:true};this.frames[this.current_frame].draw(t)}this.update_framecount()};Diagram.prototype.first_frame=function(){this.painter.eraseLayer("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.previous_frame=function(){if(this.current_frame>0){this.painter.eraseLayer("all");this.current_frame--,this.frames[this.current_frame].draw();this.update_framecount()}};Diagram.prototype.next_frame=function(){this.painter.eraseLayer("all");this.current_frame++,this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.last_frame=function(){this.painter.eraseLayer("all");this.current_frame=parseInt(this.frames.length-1,0);this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.update_framecount=function(){this.painter.frameCount(this.current_frame+1,this.frames.length);this.painter.drawProgressbar(this.current_frame+1,this.frames.length)};Diagram.prototype.print=function(){var e="";e+=this.frames[0].print();if(this.frames.length){for(var t=1,r=this.frames.length;t<r;t++){e+="+";e+=this.print_differences(t,t-1)}}return e};Diagram.prototype.print_differences=function(e,t){var r="";var a="";if(this.frames[e].activePieceType!=this.frames[t].activePieceType||this.frames[e].activePieceOrientation!=this.frames[t].activePieceOrientation||this.frames[e].activePiecePositionX!=this.frames[t].activePiecePositionX||this.frames[e].activePiecePositionY!=this.frames[t].activePiecePositionY){if(this.frames[e].activePieceType){r+="A~"+this.frames[e].activePieceType;a=alphanumconvert(this.frames[e].activePiecePositionX);r+=a;a=alphanumconvert(this.frames[e].activePiecePositionY);r+=a+this.frames[e].activePieceOrientation+"_";a=""}else{r+="A~E_"}}var i=[];var s=true;var o=false;var n=[];var c=true;var l=false;for(var f=0;f<10;f++){for(var h=0;h<20;h++){if(this.frames[e].playfield[f][h][0]!=this.frames[t].playfield[f][h][0]){if(s){if(this.frames[e].playfield[f][h][0]){i.push([]);i[0].val=this.frames[e].playfield[f][h][0];i[0].push(alphanumconvert(f)+alphanumconvert(h));s=false}else{i.push([]);i[0].val="";i[0].push(alphanumconvert(f)+alphanumconvert(h));s=false}}else{for(var d=0,m=i.length;d<m;d++){console.log(i);if(this.frames[e].playfield[f][h][0]==i[d].val){if(o){o=false;i[d].push(alphanumconvert(f)+alphanumconvert(h));console.log("ping")}else{i[d].push(alphanumconvert(f)+alphanumconvert(h));break}}else if(d==parseFloat(i.length-1)){i.push([]);i[parseFloat(d+1)].val=this.frames[e].playfield[f][h][0];i[parseFloat(d+1)].push(alphanumconvert(f)+alphanumconvert(h));o=true}}}}if(this.frames[e].playfield[f][h][1]!=this.frames[t].playfield[f][h][1]){if(c){if(this.frames[e].playfield[f][h][1]){n.push([]);n[0].val=this.frames[e].playfield[f][h][1];n[0].push(alphanumconvert(f)+alphanumconvert(h));c=false}else{n.push([]);n[0].val="";n[0].push(alphanumconvert(f)+alphanumconvert(h));c=false}}else{for(var d=0,m=n.length;d<m;d++){if(this.frames[e].playfield[f][h][1]==n[d].val){if(l){l=false;n[d].push(alphanumconvert(f)+alphanumconvert(h))}else{n[d].push(alphanumconvert(f)+alphanumconvert(h));break}}else if(d==parseFloat(n.length-1)){n.push([]);n[parseFloat(d+1)].val=this.frames[e].playfield[f][h][1];n[parseFloat(d+1)].push(alphanumconvert(f)+alphanumconvert(h));l=true}}}}}}if(i){r+="I";a="";for(var f=0,v=i.length;f<v;f++){a+="~";if(i[f].val){a+=i[f].val}else{a+="E"}for(var h=0,u=i[f].length;h<u;h++){a+=i[f][h]}}r+=a+"_"}if(n){r+="D";a="";for(var f=0,v=n.length;f<v;f++){a+="~";if(n[f].val){a+=n[f].val+"*"}else{a+="E*"}for(var h=0,u=n[f].length;h<u;h++){a+=n[f][h]}}r+=a+"_"}a="";if(this.frames[e].RS!=this.frames[t].RS){r+="R~"+this.frames[e].RS+"_"}if(this.frames[e].activePieceOpacity!=this.frames[t].activePieceOpacity){r+="O~"+this.frames[e].activePieceOpacity+"_"}if(this.frames[e].whiteborder!=this.frames[t].whiteborder){if(this.frames[e].whiteborder){r+="W~1_"}else{r+="W~0_"}}if(this.frames[e].border!=this.frames[t].border){r+="B~"+this.frames[e].border+"_"}if(this.frames[e].duration!=this.frames[t].duration){r+="T~"+parseInt(this.frames[e].duration,10)+"_"}if(this.frames[e].joystick_direction!=this.frames[t].joystick_direction||this.frames[e].joystick_state!=this.frames[t].joystick_state){switch(this.frames[e].joystick_state){case"rest":a+="r";break;case"pressed":a+="p";break;case"holded":a+="h";break}switch(this.frames[e].joystick_direction){case"u":a+="8";break;case"r":a+="6";break;case"d":a+="2";break;case"l":a+="4";break;case"c":a+="5";break;case"ul":a+="7";break;case"ur":a+="9";break;case"dr":a+="3";break;case"dl":a+="1";break}r+="J~"+a+"_";a=""}if(!this.frames[e].button_state.compare(this.frames[t].button_state)){for(var f=0,v=this.frames[e].button_state.length;f<v;f++){switch(this.frames[e].button_state[f]){case"rest":a+="r";break;case"pressed":a+="p";break;case"holded":a+="h";break}}r+="C~"+a+"_";a=""}if(!this.frames[e].nexthold.compare(this.frames[t].nexthold)){for(var f=0,v=this.frames[e].nexthold.length;f<v;f++){if(this.frames[e].nexthold[f]){a+=this.frames[e].nexthold[f]}else{a+=0}}r+="N~"+a+"_";a=""}if(this.frames[e].comment.localeCompare(this.frames[t].comment)!==0){r+="S~"+this.frames[e].comment}return r};Diagram.prototype.load=function(e){if(!e){return}this.remove_all_playfields();this.current_frame=0;this.update_framecount();var t=e.split("+");this.frames[0].load(t[0],"blank");for(var r=1,a=t.length;r<a;r++){this.new_copy_frame();this.frames[r].load(t[r],"differences")}this.frames[this.current_frame].draw();this.update_framecount()};var GLOBAL_FRAME_COUNTER=0;function Frame(e){GLOBAL_FRAME_COUNTER++;var t=this;this.sself=this;this.id=GLOBAL_FRAME_COUNTER;this.painter=e;this.height=20;this.width=10;this.RS="ARS";this.border="Master";this.whiteborder=false;this.playfield=[];this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.activePieceOpacity=1;this.duration=15;this.nexthold=["","","",""];this.joystick_direction="c";this.joystick_state="rest";this.button_state=["rest","rest","rest","rest","rest","rest"];this.comment="";for(var r=0,a=this.width;r<a;r++){this.playfield.push(new Array(this.height));for(var i=0,s=this.height;i<s;i++){this.playfield[r][i]=new Array(1);this.playfield[r][i][0]="";this.playfield[r][i][1]=""}}}Frame.prototype.modify=function(e,t,r){if(r=="E"){this.playfield[e][t][0]=""}else{this.playfield[e][t][0]=r}};Frame.prototype.is_in=function(e,t){if(e<0||t<0||e>=this.width||t>=this.height){return false}return true};Frame.prototype.lookup=function(e,t){return this.playfield[e][t][0]};Frame.prototype.piece_is_in=function(e,t,r,a){var i=getMatrix(r,a,this.RS);if(a=="singleton"&&this.is_in(parseInt(e,10),parseInt(t,10))){return true}else{var s=0;for(var o=0;o<4;o++){for(var n=0;n<4;n++){if(i[o][n]&&this.is_in(parseInt(e-1+n,10),parseInt(t-1+o,10))){s++}}}if(s==4){return true}return false}};Frame.prototype.draw=function(e){for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){if(this.playfield[t][a][0]){this.painter.drawBlock(t,a,this.playfield[t][a][0],this.RS,"inactive")}if(this.playfield[t][a][1]){this.painter.drawDeco(t,a,this.playfield[t][a][1],"decoration")}}}if(this.activePieceType){var s=getMatrix(this.activePieceType,this.activePieceOrientation,this.RS);for(var t=0;t<4;t++){for(var a=0;a<4;a++){if(s[t][a]){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+a,10),parseInt(this.activePiecePositionY-1+t,10),this.activePieceType,this.RS,"active");if(this.activePieceOpacity=="Flash"){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+a,10),parseInt(this.activePiecePositionY-1+t,10),this.activePieceType,this.RS,"flash")}}}}}for(var t=0,r=this.nexthold.length;t<r;t++){this.painter.drawNextHold(t,this.nexthold[t],this.RS)}if(!(e&&e["border"])){this.painter.drawBorder(this.border)}if(!(e&&e["joystick"])){this.painter.resetJoystick();this.painter.drawJoystick(this.joystick_direction,this.joystick_state)}if(!(e&&e["buttons"])){this.painter.drawButton("A",this.button_state[0]);this.painter.drawButton("B",this.button_state[1]);this.painter.drawButton("C",this.button_state[2]);this.painter.drawButton("D",this.button_state[3])}this.painter.drawComment(this.comment);this.painter.drawDuration(this.duration);this.painter.drawOpacity(this.activePieceOpacity);this.painter.changeActiveOpacity(this.activePieceOpacity);this.painter.eraseLayer("whiteborder");if(this.whiteborder){this.painter.drawWhiteBorder(this.playfield)}};Frame.prototype.print=function(){var e="";var t="";if(this.activePieceType){e+="A~"+this.activePieceType;t=alphanumconvert(this.activePiecePositionX);e+=t;t=alphanumconvert(this.activePiecePositionY);e+=t+this.activePieceOrientation+"_";t=""}if(this.RS!="ARS"){e+="R~"+this.RS+"_"}if(this.activePieceOpacity!=1){e+="O~"+this.activePieceOpacity+"_"}if(this.border!="Master"){e+="B~"+this.border+"_"}if(this.duration!=15){e+="T~"+this.duration+"_"}switch(this.joystick_state){case"rest":t+="r";break;case"pressed":t+="p";break;case"holded":t+="h";break}switch(this.joystick_direction){case"u":t+="8";break;case"r":t+="6";break;case"d":t+="2";break;case"l":t+="4";break;case"c":t+="5";break;case"ul":t+="7";break;case"ur":t+="9";break;case"dr":t+="3";break;case"dl":t+="1";break}e+="J~"+t+"_";t="";for(var r=0,a=this.button_state.length;r<a;r++){switch(this.button_state[r]){case"rest":t+="r";break;case"pressed":t+="p";break;case"holded":t+="h";break}}e+="C~"+t+"_";t="";if(this.comment){e+="S~"+this.comment+"_"}if(this.whiteborder){e+="W~1_"}if(this.nexthold.length){for(var r=0,a=this.nexthold.length;r<a;r++){if(this.nexthold[r]){t+=this.nexthold[r]}else{t+=0}}e+="N~"+t+"_";t=""}var i=[];var s=[];var o=true;var n=true;for(var r=0;r<10;r++){for(var c=0;c<20;c++){if(this.playfield[r][c][0]){if(o){i.push([]);i[0].val=this.playfield[r][c][0];i[0].push(alphanumconvert(r)+alphanumconvert(c));o=false}else{for(var l=0,f=i.length;l<f;l++){if(this.playfield[r][c][0]==i[l].val){i[l].push(alphanumconvert(r)+alphanumconvert(c));break}else if(l==parseFloat(i.length-1)){i.push([]);i[parseFloat(l+1)].val=this.playfield[r][c][0];i[parseFloat(l+1)].push(alphanumconvert(r)+alphanumconvert(c))}}}}if(this.playfield[r][c][1]){if(n){s.push([]);s[0].val=this.playfield[r][c][1];s[0].push(alphanumconvert(r)+alphanumconvert(c));n=false}else{for(var l=0,f=s.length;l<f;l++){if(this.playfield[r][c][1]==s[l].val){s[l].push(alphanumconvert(r)+alphanumconvert(c));break}else if(l==parseFloat(s.length-1)){s.push([]);s[parseFloat(l+1)].val=this.playfield[r][c][1];s[parseFloat(l+1)].push(alphanumconvert(r)+alphanumconvert(c))}}}}}}if(i.length){e+="I~";for(var r=0,a=i.length;r<a;r++){t+=i[r].val;for(var c=0,h=i[r].length;c<h;c++){t+=i[r][c]}if(r<i.length-1){t+="~"}}e+=t+"_"}t="";if(s.length){e+="D~";for(var r=0,a=s.length;r<a;r++){t+=s[r].val+"*";for(var c=0,h=s[r].length;c<h;c++){t+=s[r][c]}if(r<s.length-1){t+="~"}}e+=t+"_"}t="";return e};Frame.prototype.load=function(e,t){if(t!="differences"){this.clear("all")}if(!e){return}var r=e.split("_");for(var a=0,i=r.length;a<i;a++){var s=r[a].split("~");switch(s[0]){case"A":if(s[1].charAt(0)!=="E"){this.activePieceType=s[1].charAt(0);this.activePieceOrientation=s[1].slice(3);this.activePiecePositionX=alphanumconvert(s[1].charAt(1));this.activePiecePositionY=alphanumconvert(s[1].charAt(2))}else{this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY=""}break;case"I":for(var o=1,n=s.length;o<n;o++){var c=s[o].charAt(0);if(c=="E"){c=""}for(var l=1,f=s[o].length;l<f;l+=2){var h=s[o].charAt(l);var d=s[o].charAt(l+1);this.modify(alphanumconvert(h),alphanumconvert(d),c)}}break;case"D":for(var o=1,n=s.length;o<n;o++){var m=s[o].split("*");var c=m[0];if(c=="E"){c=""}if(s[1]!==""){for(var l=0,f=m[1].length;l<f;l+=2){var v=m[1].charAt(l);var u=m[1].charAt(l+1);this.modify_decoration(alphanumconvert(v),alphanumconvert(u),c)}}}break;case"R":this.RS=s[1];break;case"O":this.activePieceOpacity=s[1];break;case"N":for(var l=0,f=s[1].length;l<f;l++){if(s[1].charAt(l)!="0"){this.nexthold[l]=s[1].charAt(l)}else{this.nexthold[l]=""}}break;case"S":this.comment=s[1];break;case"W":this.whiteborder=s[1];break;case"T":this.duration=s[1];
break;case"B":this.border=s[1];break;case"J":var p,b;switch(s[1].charAt(0)){case"r":p="rest";break;case"p":p="pressed";break;case"h":p="holded";break}switch(s[1].charAt(1)){case"8":b="u";break;case"6":b="r";break;case"2":b="d";break;case"4":b="l";break;case"7":b="ul";break;case"5":b="c";break;case"9":b="ur";break;case"3":b="dr";break;case"1":b="dl";break}this.modify_control(b,p);break;case"C":for(var l=0,f=s[1].length;l<=f;l++){var k;switch(s[1].charAt(l)){case"r":k="rest";break;case"h":k="holded";break;case"p":k="pressed";break}switch(l){case 0:this.modify_button("A",k);break;case 1:this.modify_button("B",k);break;case 2:this.modify_button("C",k);break;case 3:this.modify_button("D",k);break}}break}}};Frame.prototype.clear=function(e){switch(e){case"inactive":this.painter.eraseLayer("inactive");for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){this.playfield[t][a][0]=""}}break;case"active":this.painter.eraseLayer("active");this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";break;case"decoration":this.painter.eraseLayer("decoration");for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){this.playfield[t][a][1]=""}}break;case"all":this.painter.eraseLayer("inactive");this.painter.eraseLayer("active");this.painter.eraseLayer("decoration");for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){this.playfield[t][a][0]="";this.playfield[t][a][1]=""}}this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.comment="";break}};Frame.prototype.is_piece_colliding=function(e,t,r,a){var i=getMatrix(r,a,this.RS);var s="",o="";for(var n=0;n<4;n++){for(var c=0;c<4;c++){if(i[n][c]){}if(i[n][c]&&!this.is_in(parseInt(e-1+c,10),parseInt(t-1+n,10))){return true}if(i[n][c]&&this.is_in(parseInt(e-1+c,10),parseInt(t-1+n,10))&&this.playfield[parseInt(e-1+c,10)][parseInt(t+n-1,10)][0]){return true}}}return false};Frame.prototype.addPiece=function(e,t,r,a,i,s){var o=getMatrix(r,a,this.RS);var n=true;var c=0;while(s&n){c=0;if(this.is_piece_colliding(parseInt(e),parseInt(t),r,a)){n=false}else{t++}}if(s){t--}if(i=="inactive"||i=="garbage"){this.painter.CanvasPreview.attr("width",this.painter.CanvasPreview.width())}if(i=="active"){this.activePieceType=r;this.activePieceOrientation=a;this.activePiecePositionX=e;this.activePiecePositionY=t;this.painter.CanvasActive.attr("width",this.painter.CanvasPreview.width())}if(i=="decoration-preview"){this.painter.drawDeco(e,t,r,"preview")}else if(i=="decoration"){this.modify_decoration(e,t,r);this.painter.drawDeco(e,t,r,"decoration");this.painter.highlight(e,t)}else{for(var l=0;l<4;l++){for(var f=0;f<4;f++){if(o[l][f]&&this.piece_is_in(e,t,r,a)){switch(i){case"inactive":this.modify(parseInt(e-1+f,10),parseInt(t-1+l,10),r);this.painter.drawBlock(parseInt(e-1+f,10),parseInt(t-1+l,10),r,this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e-1+f,t-1+l)}this.painter.highlight(e-1+f,t-1+l);break;case"garbage":this.modify(parseInt(e-1+f,10),parseInt(t-1+l,10),"G");this.painter.drawBlock(parseInt(e-1+f,10),parseInt(t-1+l,10),"G",this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e-1+f,t-1+l)}this.painter.highlight(e-1+f,t-1+l);break;case"preview":this.painter.drawBlock(parseInt(e-1+f,10),parseInt(t-1+l,10),r,this.RS,"preview");break;case"active":this.painter.drawBlock(parseInt(e-1+f,10),parseInt(t-1+l,10),r,this.RS,"active");this.painter.highlight(e-1+f,t-1+l);break;case"erase":this.removeBlock(parseInt(e-1+f,10),parseInt(t-1+l,10));this.painter.highlight(e-1+f,t-1+l);break;case"preview-eraser":this.painter.drawBlock(parseInt(e-1+f,10),parseInt(t-1+l,10),"G",this.RS,"preview");break}}}}}};Frame.prototype.modify_decoration=function(e,t,r){this.playfield[e][t][1]=r};Frame.prototype.modify_control=function(e,t){this.joystick_state=t;this.joystick_direction=e};Frame.prototype.modify_button=function(e,t){var r="";switch(e){case"A":r=0;break;case"B":r=1;break;case"C":r=2;break;case"D":r=3;break}this.button_state[r]=t};var ARS={I:{color:"red",offset:[2,1],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],ccw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"cyan",offset:[6,1],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,1],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,1],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"magenta",offset:[8,0],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"green",offset:[5,1],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,1],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var SRS={I:{color:"cyan",offset:[6,2],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,2],i:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,2],i:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],ccw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,2],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"green",offset:[5,2],i:[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"purple",offset:[8,2],i:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"red",offset:[2,2],i:[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var GB={I:{color:"yellowgreen",offset:[6,9],i:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"yellowgreen",offset:[1,9],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],u:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"yellowgreen",offset:[3,9],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellowgreen",offset:[4,9],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"yellowgreen",offset:[5,9],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"yellowgreen",offset:[8,9],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"yellowgreen",offset:[2,9],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var decoration={n1:{s:[0,0],e:[1,1]},n2:{s:[1,0],e:[2,1]},n3:{s:[2,0],e:[3,1]},n4:{s:[3,0],e:[4,1]},n5:{s:[4,0],e:[5,1]},n6:{s:[5,0],e:[6,1]},n7:{s:[6,0],e:[7,1]},n8:{s:[7,0],e:[8,1]},n9:{s:[8,0],e:[9,1]},n0:{s:[9,0],e:[10,1]},smallccw:{s:[0,1],e:[1,2]},smallcw:{s:[1,1],e:[2,2]},smalloktick:{s:[2,1],e:[3,2]},smallokcircle:{s:[3,1],e:[4,2]},smallnocross:{s:[4,1],e:[5,2]},smallquestion:{s:[5,1],e:[6,2]},smallexclamation:{s:[6,1],e:[7,2]},nwarrow:{s:[0,2],e:[1,3]},narrow:{s:[1,2],e:[2,3]},nearrow:{s:[2,2],e:[3,3]},warrow:{s:[0,3],e:[1,4]},earrow:{s:[2,3],e:[3,4]},swarrow:{s:[0,4],e:[1,5]},sarrow:{s:[1,4],e:[2,5]},searrow:{s:[2,4],e:[3,5]},bigcw:{s:[3,2],e:[5,4]},bigccw:{s:[5,2],e:[7,4]},bigquestion:{s:[7,2],e:[9,4]},bigexclamation:{s:[9,2],e:[10,4]},bigoktick:{s:[3,4],e:[5,6]},bigokcircle:{s:[5,4],e:[7,6]},bignocross:{s:[7,4],e:[9,6]},overlayyellow:{s:[1,6],e:[2,7]},overlayblue:{s:[2,6],e:[3,7]},overlaygreen:{s:[3,6],e:[4,7]},overlaypink:{s:[4,6],e:[5,7]},overlayorange:{s:[5,6],e:[6,7]},clear1:{s:[0,7],e:[10,8]},clear2:{s:[0,8],e:[10,9]},clear3:{s:[0,9],e:[10,10]},clear4:{s:[0,10],e:[10,11]},clear5:{s:[0,11],e:[10,12]},clear6:{s:[0,12],e:[10,13]},clear7:{s:[0,13],e:[10,14]}};function getMatrix(e,t,r){var a;switch(r){case"ARS":switch(e){case"I":switch(t){case"i":a=ARS.I.i;break;case"cw":a=ARS.I.cw;break;case"ccw":a=ARS.I.ccw;break;case"u":a=ARS.I.u;break;case"singleton":a=ARS.I.singleton;break}break;case"T":switch(t){case"i":a=ARS.T.i;break;case"cw":a=ARS.T.cw;break;case"ccw":a=ARS.T.ccw;break;case"u":a=ARS.T.u;break;case"singleton":a=ARS.T.singleton;break}break;case"L":switch(t){case"i":a=ARS.L.i;break;case"cw":a=ARS.L.cw;break;case"ccw":a=ARS.L.ccw;break;case"u":a=ARS.L.u;break;case"singleton":a=ARS.L.singleton;break}break;case"J":switch(t){case"i":a=ARS.J.i;break;case"cw":a=ARS.J.cw;break;case"ccw":a=ARS.J.ccw;break;case"u":a=ARS.J.u;break;case"singleton":a=ARS.J.singleton;break}break;case"S":switch(t){case"i":a=ARS.S.i;break;case"cw":a=ARS.S.cw;break;case"ccw":a=ARS.S.ccw;break;case"u":a=ARS.S.u;break;case"singleton":a=ARS.J.singleton;break}break;case"Z":switch(t){case"i":a=ARS.Z.i;break;case"cw":a=ARS.Z.cw;break;case"ccw":a=ARS.Z.ccw;break;case"u":a=ARS.Z.u;break;case"singleton":a=ARS.Z.singleton;break}break;case"O":switch(t){case"i":a=ARS.O.i;break;case"cw":a=ARS.O.cw;break;case"ccw":a=ARS.O.ccw;break;case"u":a=ARS.O.u;break;case"singleton":a=ARS.O.singleton;break}break;case"G":switch(t){case"i":a=ARS.G.i;break;case"cw":a=ARS.G.cw;break;case"ccw":a=ARS.G.ccw;break;case"u":a=ARS.G.u;break;case"singleton":a=ARS.G.singleton;break}break}break;case"SRS":switch(e){case"I":switch(t){case"i":a=SRS.I.i;break;case"cw":a=SRS.I.cw;break;case"ccw":a=SRS.I.ccw;break;case"u":a=SRS.I.u;break;case"singleton":a=SRS.I.singleton;break}break;case"T":switch(t){case"i":a=SRS.T.i;break;case"cw":a=SRS.T.cw;break;case"ccw":a=SRS.T.ccw;break;case"u":a=SRS.T.u;break;case"singleton":a=SRS.T.singleton;break}break;case"L":switch(t){case"i":a=SRS.L.i;break;case"cw":a=SRS.L.cw;break;case"ccw":a=SRS.L.ccw;break;case"u":a=SRS.L.u;break;case"singleton":a=SRS.L.singleton;break}break;case"J":switch(t){case"i":a=SRS.J.i;break;case"cw":a=SRS.J.cw;break;case"ccw":a=SRS.J.ccw;break;case"u":a=SRS.J.u;break;case"singleton":a=SRS.J.singleton;break}break;case"S":switch(t){case"i":a=SRS.S.i;break;case"cw":a=SRS.S.cw;break;case"ccw":a=SRS.S.ccw;break;case"u":a=SRS.S.u;break;case"singleton":a=SRS.S.singleton;break}break;case"Z":switch(t){case"i":a=SRS.Z.i;break;case"cw":a=SRS.Z.cw;break;case"ccw":a=SRS.Z.ccw;break;case"u":a=SRS.Z.u;break;case"singleton":a=SRS.Z.singleton;break}break;case"O":switch(t){case"i":a=SRS.O.i;break;case"cw":a=SRS.O.cw;break;case"ccw":a=SRS.O.ccw;break;case"u":a=SRS.O.u;break;case"singleton":a=SRS.O.singleton;break}break;case"G":switch(t){case"i":a=SRS.G.i;break;case"cw":a=SRS.G.cw;break;case"ccw":a=SRS.G.ccw;break;case"u":a=SRS.G.u;break;case"singleton":a=SRS.G.singleton;break}break}break;case"GB":switch(e){case"I":switch(t){case"i":a=GB.I.i;break;case"cw":a=GB.I.cw;break;case"ccw":a=GB.I.ccw;break;case"u":a=GB.I.u;break;case"singleton":a=GB.I.singleton;break}break;case"T":switch(t){case"i":a=GB.T.i;break;case"cw":a=GB.T.cw;break;case"ccw":a=GB.T.ccw;break;case"u":a=GB.T.u;break;case"singleton":a=GB.T.singleton;break}break;case"L":switch(t){case"i":a=GB.L.i;break;case"cw":a=GB.L.cw;break;case"ccw":a=GB.L.ccw;break;case"u":a=GB.L.u;break;case"singleton":a=GB.L.singleton;break}break;case"J":switch(t){case"i":a=GB.J.i;break;case"cw":a=GB.J.cw;break;case"ccw":a=GB.J.ccw;break;case"u":a=GB.J.u;break;case"singleton":a=GB.J.singleton;break}break;case"S":switch(t){case"i":a=GB.S.i;break;case"cw":a=GB.S.cw;break;case"ccw":a=GB.S.ccw;break;case"u":a=GB.S.u;break;case"singleton":a=GB.S.singleton;break}break;case"Z":switch(t){case"i":a=GB.Z.i;break;case"cw":a=GB.Z.cw;break;case"ccw":a=GB.Z.ccw;break;case"u":a=GB.Z.u;break;case"singleton":a=GB.Z.singleton;break}break;case"O":switch(t){case"i":a=GB.O.i;break;case"cw":a=GB.O.cw;break;case"ccw":a=GB.O.ccw;break;case"u":a=GB.O.u;break;case"singleton":a=GB.O.singleton;break}break;case"G":switch(t){case"i":a=GB.G.i;break;case"cw":a=GB.G.cw;break;case"ccw":a=GB.G.ccw;break;case"u":a=GB.G.u;break;case"singleton":a=GB.G.singleton;break}break}break}return a}function alphanumconvert(e){var t;switch(e){case"a":t=0;break;case"b":t=1;break;case"c":t=2;break;case"d":t=3;break;case"e":t=4;break;case"f":t=5;break;case"g":t=6;break;case"h":t=7;break;case"i":t=8;break;case"j":t=9;break;case"k":t=10;break;case"l":t=11;break;case"m":t=12;break;case"n":t=13;break;case"o":t=14;break;case"p":t=15;break;case"q":t=16;break;case"r":t=17;break;case"s":t=18;break;case"t":t=19;break;case"z":t=-1;break;case-1:t="z";break;case 0:t="a";break;case 1:t="b";break;case 2:t="c";break;case 3:t="d";break;case 4:t="e";break;case 5:t="f";break;case 6:t="g";break;case 7:t="h";break;case 8:t="i";break;case 9:t="j";break;case 10:t="k";break;case 11:t="l";break;case 12:t="m";break;case 13:t="n";break;case 14:t="o";break;case 15:t="p";break;case 16:t="q";break;case 17:t="r";break;case 18:t="s";break;case 19:t="t";break}return t}(function(){var e=0;var t=["ms","moz","webkit","o"];for(var r=0,a=t.length;r<a&&!window.requestAnimationFrame;++r){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t,r){var a=(new Date).getTime();var i=Math.max(0,16-(a-e));var s=window.setTimeout(function(){t(a+i)},i);e=a+i;return s}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){clearTimeout(e)}}})();Array.prototype.compare=function(e){if(this.length!=e.length){return false}for(var t=0,r=e.length;t<r;t++){if(this[t].compare){if(!this[t].compare(e[t])){return false}}if(this[t]!==e[t]){return false}}return true};(function(e,t){[].indexOf||(Array.prototype.indexOf=function(e,t,r){for(r=this.length,t=(r+~~t)%r;t<r&&(!(t in this)||this[t]!==e);t++);return t^r?t:-1});if(typeof define==="function"&&define.amd){define(r)}else{a()}function r(){return e();function e(){var r;r=t("amd");r.fork=e;return r}}function a(){var r;r=a();r.noConflict("KeyboardJS","k");function a(){var r,i=[],s={};r=t("global");r.fork=a;r.noConflict=o;return r;function o(){var t,a,o;o=Array.prototype.slice.apply(arguments);for(a=0;a<i.length;a+=1){if(typeof s[i[a]]==="undefined"){delete e[i[a]]}else{e[i[a]]=s[i[a]]}}s={};for(a=0;a<o.length;a+=1){if(typeof o[a]!=="string"){throw new Error("Cannot replace namespaces. All new namespaces must be strings.")}s[o[a]]=e[o[a]];e[o[a]]=r}i=o;return i}}}})(this,function(e){var t={},r={},a,i,s,o=[],n=[],c=[],l=[],f,h;h={map:{3:["cancel"],8:["backspace"],9:["tab"],12:["clear"],13:["enter"],16:["shift"],17:["ctrl"],18:["alt","menu"],19:["pause","break"],20:["capslock"],27:["escape","esc"],32:["space","spacebar"],33:["pageup"],34:["pagedown"],35:["end"],36:["home"],37:["left"],38:["up"],39:["right"],40:["down"],41:["select"],42:["printscreen"],43:["execute"],44:["snapshot"],45:["insert","ins"],46:["delete","del"],47:["help"],91:["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],92:["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],145:["scrolllock","scroll"],186:["semicolon",";"],187:["equal","equalsign","="],188:["comma",","],189:["dash","-"],190:["period","."],191:["slash","forwardslash","/"],192:["graveaccent","`"],219:["openbracket","["],220:["backslash","\\"],221:["closebracket","]"],222:["apostrophe","'"],48:["zero","0"],49:["one","1"],50:["two","2"],51:["three","3"],52:["four","4"],53:["five","5"],54:["six","6"],55:["seven","7"],56:["eight","8"],57:["nine","9"],96:["numzero","num0"],97:["numone","num1"],98:["numtwo","num2"],99:["numthree","num3"],100:["numfour","num4"],101:["numfive","num5"],102:["numsix","num6"],103:["numseven","num7"],104:["numeight","num8"],105:["numnine","num9"],106:["nummultiply","num*"],107:["numadd","num+"],108:["numenter"],109:["numsubtract","num-"],110:["numdecimal","num."],111:["numdevide","num/"],144:["numlock","num"],112:["f1"],113:["f2"],114:["f3"],115:["f4"],116:["f5"],117:["f6"],118:["f7"],119:["f8"],120:["f9"],121:["f10"],122:["f11"],123:["f12"]},macros:[["shift + `",["tilde","~"]],["shift + 1",["exclamation","exclamationpoint","!"]],["shift + 2",["at","@"]],["shift + 3",["number","#"]],["shift + 4",["dollar","dollars","dollarsign","$"]],["shift + 5",["percent","%"]],["shift + 6",["caret","^"]],["shift + 7",["ampersand","and","&"]],["shift + 8",["asterisk","*"]],["shift + 9",["openparen","("]],["shift + 0",["closeparen",")"]],["shift + -",["underscore","_"]],["shift + =",["plus","+"]],["shift + (",["opencurlybrace","opencurlybracket","{"]],["shift + )",["closecurlybrace","closecurlybracket","}"]],["shift + \\",["verticalbar","|"]],["shift + ;",["colon",":"]],["shift + '",["quotationmark",'"']],["shift + !,",["openanglebracket","<"]],["shift + .",["closeanglebracket",">"]],["shift + /",["questionmark","?"]]]};for(f=65;f<=90;f+=1){h.map[f]=String.fromCharCode(f+32);h.macros.push(["shift + "+String.fromCharCode(f+32)+", capslock + "+String.fromCharCode(f+32),[String.fromCharCode(f)]])}G("us",h);D("us");d();t.enable=d;t.disable=m;t.activeKeys=z;t.on=P;t.clear=S;t.clear.key=C;t.locale=D;t.locale.register=G;t.macro=w;t.macro.remove=g;t.key={};t.key.name=b;t.key.code=k;t.combo={};t.combo.active=R;t.combo.parse=O;t.combo.stringify=B;return t;function d(){if(window.addEventListener){document.addEventListener("keydown",u,false);document.addEventListener("keyup",p,false);window.addEventListener("blur",v,false);window.addEventListener("webkitfullscreenchange",v,false);window.addEventListener("mozfullscreenchange",v,false)}else if(window.attachEvent){document.attachEvent("onkeydown",u);document.attachEvent("onkeyup",p);window.attachEvent("onblur",v)}}function m(){v();if(window.removeEventListener){document.removeEventListener("keydown",u,false);document.removeEventListener("keyup",p,false);window.removeEventListener("blur",v,false);window.removeEventListener("webkitfullscreenchange",v,false);window.removeEventListener("mozfullscreenchange",v,false)}else if(window.detachEvent){document.detachEvent("onkeydown",u);document.detachEvent("onkeyup",p);window.detachEvent("onblur",v)}}function v(e){o=[];_();A(e)}function u(e){var t,r,a;t=b(e.keyCode);if(t.length<1){return}e.isRepeat=false;for(a=0;a<t.length;a+=1){r=t[a];if(z().indexOf(r)!=-1)e.isRepeat=true;F(r)}y();x(e)}function p(e){var t,r;t=b(e.keyCode);if(t.length<1){return}for(r=0;r<t.length;r+=1){T(t[r])}_();A(e)}function b(e){return i[e]||[]}function k(e){var t;for(t in i){if(!i.hasOwnProperty(t)){continue}if(i[t].indexOf(e)>-1){return t}}return false}function w(e,t){if(typeof e!=="string"&&(typeof e!=="object"||typeof e.push!=="function")){throw new Error("Cannot create macro. The combo must be a string or array.")}if(typeof t!=="object"||typeof t.push!=="function"){throw new Error("Cannot create macro. The injectedKeys must be an array.")}s.push([e,t])}function g(e){var t;if(typeof e!=="string"&&(typeof e!=="object"||typeof e.push!=="function")){throw new Error("Cannot remove macro. The combo must be a string or array.")}for(mI=0;mI<s.length;mI+=1){t=s[mI];if($(e,t[0])){T(t[1]);s.splice(mI,1);break}}}function y(){var e,t,r;for(e=0;e<s.length;e+=1){t=O(s[e][0]);if(l.indexOf(s[e])===-1&&R(t)){l.push(s[e]);for(r=0;r<s[e][1].length;r+=1){F(s[e][1][r])}}}}function _(){var e,t,r;for(e=0;e<l.length;e+=1){t=O(l[e][0]);if(R(t)===false){for(r=0;r<l[e][1].length;r+=1){T(l[e][1][r])}l.splice(e,1);e-=1}}}function P(e,t,r){var a={},i,s=[],o={},c,l;if(typeof e==="string"){e=O(e)}for(c=0;c<e.length;c+=1){i={};l=B([e[c]]);if(typeof l!=="string"){throw new Error("Failed to bind key combo. The key combo must be string.")}i.keyCombo=l;i.keyDownCallback=[];i.keyUpCallback=[];if(t){i.keyDownCallback.push(t)}if(r){i.keyUpCallback.push(r)}n.push(i);s.push(i)}a.clear=f;a.on=h;return a;function f(){var e;for(e=0;e<s.length;e+=1){n.splice(n.indexOf(s[e]),1)}}function h(e){var t={},r,a,i;if(typeof e!=="string"){throw new Error("Cannot bind callback. The event name must be a string.")}if(e!=="keyup"&&e!=="keydown"){throw new Error('Cannot bind callback. The event name must be a "keyup" or "keydown".')}r=Array.prototype.slice.apply(arguments,[1]);for(a=0;a<r.length;a+=1){if(typeof r[a]==="function"){if(e==="keyup"){for(i=0;i<s.length;i+=1){s[i].keyUpCallback.push(r[a])}}else if(e==="keydown"){for(i=0;i<s.length;i+=1){s[i].keyDownCallback.push(r[a])}}}}t.clear=o;return t;function o(){var t,a;for(t=0;t<r.length;t+=1){if(typeof r[t]==="function"){if(e==="keyup"){for(a=0;a<s.length;a+=1){s[a].keyUpCallback.splice(s[a].keyUpCallback.indexOf(r[t]),1)}}else{for(a=0;a<s.length;a+=1){s[a].keyDownCallback.splice(s[a].keyDownCallback.indexOf(r[t]),1)}}}}}}}function S(e){var t,r,a;for(t=0;t<n.length;t+=1){r=n[t];if($(e,r.keyCombo)){n.splice(t,1);t-=1}}}function C(e){var t,r,a;if(e){for(t=0;t<n.length;t+=1){a=n[t];for(r=0;r<a.keyCombo.length;r+=1){if(a.keyCombo[r].indexOf(e)>-1){n.splice(t,1);t-=1;break}}}}else{n=[]}}function x(e){var t,r,a,i,s,l,f,h,d,m,v=[],u;s=[].concat(o);for(t=0;t<n.length;t+=1){u=I(n[t].keyCombo).length;if(!v[u]){v[u]=[]}v[u].push(n[t])}for(r=v.length-1;r>=0;r-=1){if(!v[r]){continue}for(t=0;t<v[r].length;t+=1){a=v[r][t];i=I(a.keyCombo);d=true;for(h=0;h<i.length;h+=1){if(s.indexOf(i[h])===-1){d=false;break}}if(d&&R(a.keyCombo)){c.push(a);for(h=0;h<i.length;h+=1){m=s.indexOf(i[h]);if(m>-1){s.splice(m,1);h-=1}}for(l=0;l<a.keyDownCallback.length;l+=1){if(a.keyDownCallback[l](e,z(),a.keyCombo)===false){f=true}}if(f===true){e.preventDefault();e.stopPropagation()}}}}}function A(e){var t,r,a,i;for(t=0;t<c.length;t+=1){a=c[t];if(R(a.keyCombo)===false){for(r=0;r<a.keyUpCallback.length;r+=1){if(a.keyUpCallback[r](e,z(),a.keyCombo)===false){i=true}}if(i===true){e.preventDefault();e.stopPropagation()}c.splice(t,1);t-=1}}}function $(e,t){var r,a,i;e=O(e);t=O(t);if(e.length!==t.length){return false}for(r=0;r<e.length;r+=1){if(e[r].length!==t[r].length){return false}for(a=0;a<e[r].length;a+=1){if(e[r][a].length!==t[r][a].length){return false}for(i=0;i<e[r][a].length;i+=1){if(t[r][a].indexOf(e[r][a][i])===-1){return false}}}}return true}function R(e){var t,r,a,i,s=0,n,c;e=O(e);for(t=0;t<e.length;t+=1){c=true;s=0;for(r=0;r<e[t].length;r+=1){a=[].concat(e[t][r]);for(i=s;i<o.length;i+=1){n=a.indexOf(o[i]);if(n>-1){a.splice(n,1);s=i}}if(a.length!==0){c=false;break}}if(c){return true}}return false}function I(e){var t,r,a,i=[];e=O(e);for(t=0;t<e.length;t+=1){for(r=0;r<e[t].length;r+=1){i=i.concat(e[t][r])}}return i}function O(e){var t=e,r=0,a=0,i=false,s=false,o=[],n=[],c=[],l="";if(typeof e==="object"&&typeof e.push==="function"){return e}if(typeof e!=="string"){throw new Error('Cannot parse "keyCombo" because its type is "'+typeof e+'". It must be a "string".')}while(t.charAt(r)===" "){r+=1}while(true){if(t.charAt(r)===" "){while(t.charAt(r)===" "){r+=1}i=true}else if(t.charAt(r)===","){if(a||s){throw new Error("Failed to parse key combo. Unexpected , at character index "+r+".")}s=true;r+=1}else if(t.charAt(r)==="+"){if(l.length){c.push(l);l=""}if(a||s){throw new Error("Failed to parse key combo. Unexpected + at character index "+r+".")}a=true;r+=1}else if(t.charAt(r)===">"){if(l.length){c.push(l);l=""}if(c.length){n.push(c);c=[]}if(a||s){throw new Error("Failed to parse key combo. Unexpected > at character index "+r+".")}a=true;r+=1}else if(r<t.length-1&&t.charAt(r)==="!"&&(t.charAt(r+1)===">"||t.charAt(r+1)===","||t.charAt(r+1)==="+")){l+=t.charAt(r+1);a=false;i=false;s=false;r+=2}else if(r<t.length&&t.charAt(r)!=="+"&&t.charAt(r)!==">"&&t.charAt(r)!==","&&t.charAt(r)!==" "){if(a===false&&i===true||s===true){if(l.length){c.push(l);l=""}if(c.length){n.push(c);c=[]}if(n.length){o.push(n);n=[]}}a=false;i=false;s=false;while(r<t.length&&t.charAt(r)!=="+"&&t.charAt(r)!==">"&&t.charAt(r)!==","&&t.charAt(r)!==" "){l+=t.charAt(r);r+=1}}else{r+=1;continue}if(r>=t.length){if(l.length){c.push(l);l=""}if(c.length){n.push(c);c=[]}if(n.length){o.push(n);n=[]}break}}return o}function B(e){var t,r,a=[];if(typeof e==="string"){return e}if(typeof e!=="object"||typeof e.push!=="function"){throw new Error("Cannot stringify key combo.")}for(t=0;t<e.length;t+=1){a[t]=[];for(r=0;r<e[t].length;r+=1){a[t][r]=e[t][r].join(" + ")}a[t]=a[t].join(" > ")}return a.join(" ")}function z(){return[].concat(o)}function F(e){if(e.match(/\s/)){throw new Error("Cannot add key name "+e+" to active keys because it contains whitespace.")}if(o.indexOf(e)>-1){return}o.push(e)}function T(e){var t=k(e);if(t==="91"||t==="92"){o=[]}else{o.splice(o.indexOf(e),1)}}function G(e,t){if(typeof e!=="string"){throw new Error("Cannot register new locale. The locale name must be a string.")}if(typeof t!=="object"){throw new Error("Cannot register "+e+" locale. The locale map must be an object.")}if(typeof t.map!=="object"){throw new Error("Cannot register "+e+" locale. The locale map is invalid.")}if(!t.macros){t.macros=[]}r[e]=t}function D(e){if(e){if(typeof e!=="string"){throw new Error("Cannot set locale. The locale name must be a string.")}if(!r[e]){throw new Error("Cannot set locale to "+e+" because it does not exist. If you would like to submit a "+e+" locale map for KeyboardJS please submit it at https://github.com/RobertWHurst/KeyboardJS/issues.")}i=r[e].map;s=r[e].macros;a=e}return a}});function drawPaletteDecoCell(e,t,r){var a=$("#editor-palette-deco-"+e);var i=a[0].getContext("2d");var s,o;switch(e){case"n1":s=decoration.n1.s;o=decoration.n1.e;break;case"n2":s=decoration.n2.s;o=decoration.n2.e;break;case"n3":s=decoration.n3.s;o=decoration.n3.e;break;case"n4":s=decoration.n4.s;o=decoration.n4.e;break;case"n5":s=decoration.n5.s;o=decoration.n5.e;break;case"n6":s=decoration.n6.s;o=decoration.n6.e;break;case"n7":s=decoration.n7.s;o=decoration.n7.e;break;case"n8":s=decoration.n8.s;o=decoration.n8.e;break;case"n9":s=decoration.n9.s;o=decoration.n9.e;break;case"n0":s=decoration.n0.s;o=decoration.n0.e;break;case"smallcw":s=decoration.smallcw.s;o=decoration.smallcw.e;break;case"smallccw":s=decoration.smallccw.s;o=decoration.smallccw.e;break;case"smalloktick":s=decoration.smalloktick.s;o=decoration.smalloktick.e;break;case"smallokcircle":s=decoration.smallokcircle.s;o=decoration.smallokcircle.e;break;case"smallnocross":s=decoration.smallnocross.s;o=decoration.smallnocross.e;break;case"smallquestion":s=decoration.smallquestion.s;o=decoration.smallquestion.e;break;case"smallexclamation":s=decoration.smallexclamation.s;o=decoration.smallexclamation.e;break;case"nwarrow":s=decoration.nwarrow.s;o=decoration.nwarrow.e;break;case"narrow":s=decoration.narrow.s;o=decoration.narrow.e;break;case"nearrow":s=decoration.nearrow.s;o=decoration.nearrow.e;break;case"earrow":s=decoration.earrow.s;o=decoration.earrow.e;break;case"searrow":s=decoration.searrow.s;o=decoration.searrow.e;break;case"sarrow":s=decoration.sarrow.s;o=decoration.sarrow.e;break;case"swarrow":s=decoration.swarrow.s;o=decoration.swarrow.e;break;case"warrow":s=decoration.warrow.s;o=decoration.warrow.e;break;case"bigcw":s=decoration.bigcw.s;o=decoration.bigcw.e;break;case"bigccw":s=decoration.bigccw.s;o=decoration.bigccw.e;break;case"bigquestion":s=decoration.bigquestion.s;o=decoration.bigquestion.e;break;case"bigexclamation":s=decoration.bigexclamation.s;o=decoration.bigexclamation.e;break;case"bigoktick":s=decoration.bigoktick.s;o=decoration.bigoktick.e;break;case"bigokcircle":s=decoration.bigokcircle.s;o=decoration.bigokcircle.e;break;case"bignocross":s=decoration.bignocross.s;o=decoration.bignocross.e;break;case"overlayyellow":s=decoration.overlayyellow.s;o=decoration.overlayyellow.e;break;case"overlayblue":s=decoration.overlayblue.s;o=decoration.overlayblue.e;break;case"overlaygreen":s=decoration.overlaygreen.s;o=decoration.overlaygreen.e;break;case"overlaypink":s=decoration.overlaypink.s;o=decoration.overlaypink.e;break;case"overlayorange":s=decoration.overlayorange.s;o=decoration.overlayorange.e;break;case"clear1":s=decoration.clear1.s;o=decoration.clear1.e;break;case"clear2":s=decoration.clear2.s;o=decoration.clear2.e;break;case"clear3":s=decoration.clear3.s;o=decoration.clear3.e;break;case"clear4":s=decoration.clear4.s;o=decoration.clear4.e;break;case"clear5":s=decoration.clear5.s;o=decoration.clear5.e;break;case"clear6":s=decoration.clear6.s;o=decoration.clear6.e;break;case"clear7":s=decoration.clear7.s;o=decoration.clear7.e;break}var n=s[0]*t;var c=s[1]*t;var l=(o[0]-s[0])*t;var f=(o[1]-s[1])*t;var h=0;var d=0;i.drawImage(r,n,c,l,f,h,d,l,f)}function drawPaletteCell(e,t,r,a,i){var s=$("#editor-palette-"+e+t);var o=s[0].getContext("2d");var n=getMatrix(e,t,r);s.attr("width",s.width());
var c,l;switch(r){case"ARS":switch(e){case"I":c=ARS.I.color;l=ARS.I.offset;break;case"T":c=ARS.T.color;l=ARS.T.offset;break;case"L":c=ARS.L.color;l=ARS.L.offset;break;case"J":c=ARS.J.color;l=ARS.J.offset;break;case"S":c=ARS.S.color;l=ARS.S.offset;break;case"Z":c=ARS.Z.color;l=ARS.Z.offset;break;case"O":c=ARS.O.color;l=ARS.O.offset;break;case"G":c=ARS.G.color;l=ARS.G.offset;break}break;case"SRS":switch(e){case"I":c=SRS.I.color;l=SRS.I.offset;break;case"T":c=SRS.T.color;l=SRS.T.offset;break;case"L":c=SRS.L.color;l=SRS.L.offset;break;case"J":c=SRS.J.color;l=SRS.J.offset;break;case"S":c=SRS.S.color;l=SRS.S.offset;break;case"Z":c=SRS.Z.color;l=SRS.Z.offset;break;case"O":c=SRS.O.color;l=SRS.O.offset;break;case"G":c=SRS.G.color;l=SRS.G.offset;break}break;case"GB":switch(e){case"I":c=GB.I.color;l=GB.I.offset;break;case"T":c=GB.T.color;l=GB.T.offset;break;case"L":c=GB.L.color;l=GB.L.offset;break;case"J":c=GB.J.color;l=GB.J.offset;break;case"S":c=GB.S.color;l=GB.S.offset;break;case"Z":c=GB.Z.color;l=GB.Z.offset;break;case"O":c=GB.O.color;l=GB.O.offset;break;case"G":c=GB.G.color;l=GB.G.offset;break}break}for(var f=0;f<4;f++){for(var h=0;h<4;h++){if(n[f][h]){o.beginPath();o.rect(parseInt(h*a,10),parseInt(f*a,10),a,a);o.fillStyle=c;o.fill();o.closePath();if(i){o.drawImage(i,l[0]*a,l[1]*a,a,a,parseInt(h*a,10),parseInt(f*a,10),a,a)}}}}}function drawPalette(e,t,r){var a=["I","T","S","Z","L","J","O"];var i=["i","cw","ccw","u"];for(var s=0;s<a.length;s++){for(var o=0;o<i.length;o++){drawPaletteCell(a[s],i[o],e,t,r)}}}function drawPaletteDeco(e,t){var r=["n1","n2","n3","n4","n5","n6","n7","n8","n9","n0","smallccw","smallcw","smalloktick","smallokcircle","smallnocross","smallquestion","smallexclamation","nwarrow","narrow","nearrow","earrow","searrow","sarrow","swarrow","warrow","bigcw","bigccw","smallquestion","bigquestion","bigexclamation","bigoktick","bigokcircle","bignocross","overlayyellow","overlayblue","overlaygreen","overlaypink","overlaypink","clear1","clear2","clear3","clear4","clear5","clear6","clear7"];for(var a=0;a<r.length;a++){drawPaletteDecoCell(r[a],e,t)}}Painter.prototype.CanvasExport;Painter.prototype.ContextExport;Painter.prototype.exportImage=function(e){this.ContextExport.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.CanvasExport.attr("width",this.CanvasExport.width());var t=document.createElement("canvas");t.width=this.CanvasWidth;t.height=this.CanvasHeight+this.CanvasControl.height();this.ContextExport.drawImage(this.CanvasNextHold[0],0,0);if(e!="gif"){this.ContextExport.drawImage(this.CanvasBorder[0],0,32);this.ContextExport.drawImage(this.CanvasBackground[0],0,32)}var r=this.ContextPF.getImageData(0,0,this.CanvasWidth,this.CanvasHeight);var a=0;for(var i=0,s=r.data.length;i<s;i+=4){r.data[i+3]=parseInt(255*.65,10);a=r.data[i]+r.data[i+1]+r.data[i+2];if(!a){r.data[i+3]=0}a=0}t.getContext("2d").putImageData(r,0,0);this.ContextExport.drawImage(t,0,32);this.ContextExport.drawImage(this.CanvasActive[0],0,32);this.ContextExport.drawImage(this.CanvasWhiteborder[0],0,32);this.ContextExport.drawImage(this.CanvasDeco[0],0,32);this.ContextExport.drawImage(this.CanvasControl[0],0,this.CanvasHeight+32);if(e=="play"){this.ContextExport.beginPath();this.ContextExport.moveTo(32,60);this.ContextExport.lineTo(75,84);this.ContextExport.lineTo(32,110);this.ContextExport.fillStyle="rgba(255,255,255,0.66)";this.ContextExport.closePath();this.ContextExport.fill()}};Painter.prototype.appendThumbnail=function(e,t){var r='<div id="thumbnail-'+e+'" class="thumbnail"> <canvas class="active" id="thumbnail-'+e+'-active" height="80" width="40"></canvas><canvas class="inactive" id="thumbnail-'+e+'-inactive" height="80" width="40"></canvas><canvas class="deco" id="thumbnail-'+e+'-deco" height="80" width="40"></canvas></div>';$("#thumbnails > .thumbnail:nth-child("+t+")").after(r)};Painter.prototype.clearThumbnail=function(e,t){var r;switch(t){case"inactive":r=$("#thumbnail-"+e+"-inactive");break;case"active":r=$("#thumbnail-"+e+"-active");break;case"deco":r=$("#thumbnail-"+e+"-deco");break}var a=r[0].getContext("2d");a.clearRect(0,0,r[0].width,r[0].height)};var thumbnail_registry_inactive={};var thumbnail_registry_active={};var thumbnail_registry_demo={};Painter.prototype.modifyThumbnail=function(e,t,r,a,i){if(i=="inactive"){if(thumbnail_registry_inactive[a]){var s=thumbnail_registry_inactive[a]}else{thumbnail_registry_inactive[a]=$("#thumbnail-"+a+"-inactive");var s=thumbnail_registry_inactive[a]}}if(i=="active"){if(thumbnail_registry_active[a]){var s=thumbnail_registry_active[a]}else{thumbnail_registry_active[a]=$("#thumbnail-"+a+"-active");var s=thumbnail_registry_active[a]}}var o=s[0].getContext("2d"),n,c=4;switch(r){case"I":n=ARS.I.color;break;case"T":n=ARS.T.color;break;case"L":n=ARS.L.color;break;case"J":n=ARS.J.color;break;case"S":n=ARS.S.color;break;case"Z":n=ARS.Z.color;break;case"O":n=ARS.O.color;break;case"G":n=ARS.G.color;break}if(r=="E"){o.clearRect(e*c,t*c,c,c)}else{if(i=="inactive"){o.beginPath();o.rect(e*c,t*c,c,c);o.fillStyle=n;o.fill();o.closePath()}if(i=="active"){o.beginPath();o.strokeStyle=n;o.lineWidth=1;o.strokeRect(e*c,t*c,c,c);o.closePath()}}};var old_frame_modify=Frame.prototype.modify;Frame.prototype.modify=function(e,t,r){old_frame_modify.apply(this,arguments);this.painter.modifyThumbnail(e,t,r,this.id,"inactive")};var old_frame_addPiece=Frame.prototype.addPiece;Frame.prototype.addPiece=function(e,t,r,a,i,s){old_frame_addPiece.apply(this,arguments);var o=getMatrix(r,a,this.RS);if(i=="active"){this.painter.clearThumbnail(this.id,"active")}for(var n=0;n<4;n++){for(var c=0;c<4;c++){if(o[n][c]){if(i=="inactive"||i=="garbage"){}if(i=="active"){this.painter.modifyThumbnail(parseInt(e-1+c,10),parseInt(t-1+n,10),r,this.id,"active")}}}}};Frame.prototype.loadActiveHook=function(e,t,r,a){this.painter.clearThumbnail(this.id,"active");if(r!="E"){var i=getMatrix(r,a,this.RS);for(var s=0;s<4;s++){for(var o=0;o<4;o++){if(i[s][o]){this.painter.modifyThumbnail(parseInt(e-1+o,10),parseInt(t-1+s,10),r,this.id,"active")}}}}};var old_diagram_new_frame=Diagram.prototype.new_frame;Diagram.prototype.new_frame=function(){old_diagram_new_frame.apply(this,arguments);this.painter.appendThumbnail(this.frames[this.current_frame].id,this.current_frame)};var old_diagram_remove_current_frame=Diagram.prototype.remove_current_frame;Diagram.prototype.remove_current_frame=function(){if(this.frames.length==1){$("#thumbnail-"+this.frames[0].id).toggleClass("selected")}this.painter.deleteThumbnail(this.current_frame);old_diagram_remove_current_frame.apply(this);$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected")};var old_diagram_remove_following_frames=Diagram.prototype.remove_following_frames;Diagram.prototype.remove_following_frames=function(){for(var e=this.frames.length;e>=this.current_frame+1;e--){this.painter.deleteThumbnail(e)}old_diagram_remove_following_frames.apply(this)};Painter.prototype.deleteThumbnail=function(e){if($("#thumbnails > .thumbnail").size()==1){this.clearThumbnail(1,"active");this.clearThumbnail(1,"inactive")}else{$("#thumbnails > .thumbnail:nth-child("+parseInt(e+1)+")").remove()}};var old_diagram_first_frame=Diagram.prototype.first_frame;Diagram.prototype.first_frame=function(){$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected");old_diagram_first_frame.apply(this);$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected")};var old_diagram_previous_frame=Diagram.prototype.previous_frame;Diagram.prototype.previous_frame=function(){$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected");old_diagram_previous_frame.apply(this);$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected")};var old_diagram_next_frame=Diagram.prototype.next_frame;Diagram.prototype.next_frame=function(){$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected");old_diagram_next_frame.apply(this);$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected")};var old_diagram_last_frame=Diagram.prototype.last_frame;Diagram.prototype.last_frame=function(){$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected");old_diagram_last_frame.apply(this);$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected")};var old_diagram_new_copy_frame=Diagram.prototype.new_copy_frame;Diagram.prototype.new_copy_frame=function(){$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected");old_diagram_new_copy_frame.apply(this);$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected")};var old_diagram_goto_frame=Diagram.prototype.goto_frame;Diagram.prototype.goto_frame=function(e){$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected");old_diagram_goto_frame.apply(this,arguments);$("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).toggleClass("selected");$("#thumbnails-container").scrollLeft(0);$("#thumbnails-container").scrollLeft($("#thumbnail-"+parseInt(this.frames[this.current_frame].id)).position().left-180)};Diagram.prototype.remove_frame=function(e){if(e==this.current_frame){this.remove_current_frame()}else if(this.frames.length>1){this.frames.splice(e+1,1)}else{this.current_frame=0;this.frames[this.current_frame].clear("all")}};Diagram.prototype.modify_border=function(e){for(var t=0,r=this.frames.length;t<r;t++){this.frames[t].border=e}this.frames[this.current_frame].modify_border(e)};Diagram.prototype.modify_RS=function(e){for(var t=0,r=this.frames.length;t<r;t++){this.frames[t].RS=e}this.frames[this.current_frame].modify_RS(e)};Diagram.prototype.modify_whiteborder=function(e){for(var t=0,r=this.frames.length;t<r;t++){this.frames[t].whiteborder=e}this.frames[this.current_frame].modify_whiteborder(e)};Diagram.prototype.modify_duration=function(e){for(var t=0,r=this.frames.length;t<r;t++){this.frames[t].duration=e}};Diagram.prototype.flate_encode=function(e){return $.base64.encode(RawDeflate.deflate(unescape(encodeURIComponent(e))))};Diagram.prototype.flate_decode=function(e){return decodeURIComponent(escape(RawDeflate.inflate($.base64.decode(e))))};Diagram.prototype.getGIF=function(){var e=new GIFEncoder;e.setRepeat(0);e.start();e.setQuality(1);for(var t=0,r=this.frames.length;t<r;t++){this.goto_frame(t);e.setDelay(this.frames[t].duration*16.6666);this.painter.exportImage();e.addFrame(this.painter.ContextExport)}e.finish();var a=e.stream().getData();document.getElementById("export-gif").src="data:image/gif;base64,"+$.base64.encode(e.stream().getData())};Frame.prototype.removeBlock=function(e,t){this.playfield[e][t][0]="";this.painter.eraseBlock(e,t);this.painter.modifyThumbnail(e,t,"E",this.id,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e,t,"inactive")}};Frame.prototype.removeDeco=function(e,t){this.painter.drawDeco(e,t,this.playfield[e][t][1],"eraser");this.playfield[e][t][1]=""};Frame.prototype.modify_nexthold=function(e,t){this.nexthold[e]=t};Frame.prototype.modify_AP_opacity=function(e){this.activePieceOpacity=e;this.painter.changeActiveOpacity(e);if(e=="Flash"||e=="flash"){this.addPiece(this.activePiecePositionX,this.activePiecePositionY,this.activePieceType,this.activePieceOrientation,"Flash",false)}};Frame.prototype.modify_RS=function(e){this.RS=e;this.draw()};Frame.prototype.modify_duration=function(e){this.duration=e};Frame.prototype.modify_border=function(e){this.border=e;this.painter.drawBorder(this.border)};Frame.prototype.modify_whiteborder=function(e){this.whiteborder=e;if(this.whiteborder){this.painter.drawWhiteBorder(this.playfield)}else{this.painter.eraseLayer("whiteborder")}};Frame.prototype.recursive_fill=function(e,t,r,a){e=parseFloat(e);t=parseFloat(t);if(this.playfield[e][t][0]!=r){return}this.modify(e,t,a);this.painter.drawBlock(e,t,a,this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e,t)}if(t-1>=0){this.recursive_fill(e,t-1,r,a)}if(t+1<this.height){this.recursive_fill(e,t+1,r,a)}if(e+1<this.width){this.recursive_fill(e+1,t,r,a)}if(e-1>=0){this.recursive_fill(e-1,t,r,a)}};Frame.prototype.stack_lines=function(){var e=true;for(var t=0,r=this.height;t<r;t++){e=true;for(var a=0,i=this.width;a<i;a++){if(this.playfield[a][t][0]){e=false}}if(e){for(k=t;k>-1;k--){if(k!=0){for(a=0;a<this.width;a++){this.modify(a,k,this.playfield[a][k-1][0])}}}}}this.painter.eraseLayer("inactive");this.draw()};Frame.prototype.clear_lines=function(){var e=0;for(var t=0,r=this.height;t<r;t++){e=0;for(var a=0,i=this.width;a<i;a++){if(this.playfield[a][t][0]){e++}}if(e==this.width){for(var s=0,o=this.width;s<o;s++){this.removeBlock(s,t)}}}};Frame.prototype.paintActivePiece=function(){if(this.activePiecePositionX){this.addPiece(this.activePiecePositionX,this.activePiecePositionY,this.activePieceType,this.activePieceOrientation,"inactive",false)}};Frame.prototype.lockActivePiece=function(){if(this.activePiecePositionX){this.paintActivePiece();this.clear("active");this.activePieceOpacity=1;this.painter.eraseLayer("active")}};Frame.prototype.dropActivePiece=function(){if(this.activePiecePositionX){this.addPiece(this.activePiecePositionX,this.activePiecePositionY,this.activePieceType,this.activePieceOrientation,"active",true)}};Frame.prototype.moveActivePiece=function(e){if(this.activePieceType=="I"&&this.activePiecePositionX>=-1||this.activePiecePositionX>=0){var t=this.activePiecePositionX;var r=this.activePiecePositionY;switch(e){case"left":t--;break;case"right":t++;break;case"up":r--;break;case"down":r++;break}if(this.piece_is_in(t,r,this.activePieceType,this.activePieceOrientation)){if($("#checkbox-collision").is(":checked")){if(!this.is_piece_colliding(t,r,this.activePieceType,this.activePieceOrientation)){this.addPiece(t,r,this.activePieceType,this.activePieceOrientation,"active",false)}}else{this.addPiece(t,r,this.activePieceType,this.activePieceOrientation,"active",false)}}}};Frame.prototype.rotateActivePiece=function(e){var t=this.activePieceOrientation;switch(e){case"cw":switch(t){case"i":t="cw";break;case"cw":t="u";break;case"u":t="ccw";break;case"ccw":t="i";break}break;case"ccw":switch(t){case"i":t="ccw";break;case"ccw":t="u";break;case"u":t="cw";break;case"cw":t="i";break}break}function r(e){if(!e.is_piece_colliding(parseInt(e.activePiecePositionX+1),e.activePiecePositionY,e.activePieceType,t)){e.addPiece(parseInt(e.activePiecePositionX+1),e.activePiecePositionY,e.activePieceType,t,"active",false)}else if(!e.is_piece_colliding(parseInt(e.activePiecePositionX-1),e.activePiecePositionY,e.activePieceType,t)){e.addPiece(parseInt(e.activePiecePositionX-1),e.activePiecePositionY,e.activePieceType,t,"active",false)}}function a(e,r,a,i){var s,o,n,c;if(i){switch(a){case"cw":switch(r){case"i":s=[-2,0];o=[1,0];n=[-2,1];c=[1,-2];break;case"cw":s=[-1,0];o=[2,0];n=[-1,-2];c=[2,1];break;case"u":s=[2,0];o=[-1,0];n=[2,-1];c=[-1,2];break;case"ccw":s=[1,0];o=[-2,0];n=[1,2];c=[-2,-1];break}break;case"ccw":switch(r){case"i":s=[-1,0];o=[2,0];n=[-1,-2];c=[2,-1];break;case"cw":s=[2,0];o=[-1,0];n=[2,-1];c=[-1,2];break;case"u":s=[1,0];o=[-2,0];n=[1,2];c=[-2,-1];break;case"ccw":s=[-2,0];o=[1,0];n=[-2,1];c=[1,-2];break}break}}else{switch(a){case"cw":switch(r){case"i":s=[-1,0];o=[-1,-1];n=[0,2];c=[-1,2];break;case"cw":s=[1,0];o=[1,1];n=[0,-2];c=[1,-2];break;case"u":s=[1,0];o=[1,-1];n=[0,2];c=[1,2];break;case"ccw":s=[-1,0];o=[-1,1];n=[0,-2];c=[-1,-2];break}break;case"ccw":switch(r){case"i":s=[1,0];o=[1,-1];n=[0,2];c=[1,2];break;case"cw":s=[1,0];o=[1,1];n=[0,-2];c=[1,-2];break;case"u":s=[-1,0];o=[-1,-1];n=[0,2];c=[-1,2];break;case"ccw":s=[-1,0];o=[-1,1];n=[0,-2];c=[-1,-2];break}break}}if(!e.is_piece_colliding(parseInt(e.activePiecePositionX+s[0]),parseInt(e.activePiecePositionY+s[1]),e.activePieceType,t)){e.addPiece(parseInt(e.activePiecePositionX+s[0]),parseInt(e.activePiecePositionY+s[1]),e.activePieceType,t,"active",false)}else if(!e.is_piece_colliding(parseInt(e.activePiecePositionX+o[0]),parseInt(e.activePiecePositionY+o[1]),e.activePieceType,t)){e.addPiece(parseInt(e.activePiecePositionX+o[0]),parseInt(e.activePiecePositionY+o[1]),e.activePieceType,t,"active",false)}else if(!e.is_piece_colliding(parseInt(e.activePiecePositionX+n[0]),parseInt(e.activePiecePositionY+n[1]),e.activePieceType,t)){e.addPiece(parseInt(e.activePiecePositionX+n[0]),parseInt(e.activePiecePositionY+n[1]),e.activePieceType,t,"active",false)}else if(!e.is_piece_colliding(parseInt(e.activePiecePositionX+c[0]),parseInt(e.activePiecePositionY+c[1]),e.activePieceType,t)){e.addPiece(parseInt(e.activePiecePositionX+c[0]),parseInt(e.activePiecePositionY+c[1]),e.activePieceType,t,"active",false)}}if($("#checkbox-collision").is(":checked")){if(this.is_piece_colliding(this.activePiecePositionX,this.activePiecePositionY,this.activePieceType,t)){if($("#checkbox-wallkick").is(":checked")){switch(this.RS){case"ARS":switch(this.activePieceType){case"J":if(this.activePieceOrientation=="i"){if(this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+2,10)]||this.playfield[parseInt(this.activePiecePositionX-1+2,10)][parseInt(this.activePiecePositionY-1+0,10)]){r(this.sself)}else if(this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+1,10)]||this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+0,10)]){}else{r(this.sself)}}else if(this.activePieceOrientation=="u"){if(this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+2,10)]||this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+0,10)]){}else{r(this.sself)}}else{r(this.sself)}break;case"L":if(this.activePieceOrientation=="i"){if(this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+2,10)]||this.playfield[parseInt(this.activePiecePositionX-1+0,10)][parseInt(this.activePiecePositionY-1+0,10)]){r(this.sself)}else if(this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+1,10)]||this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+0,10)]){}else{r(this.sself)}}else if(this.activePieceOrientation=="u"){if(this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+2,10)]||this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+0,10)]){}else{r(this.sself)}}else{r(this.sself)}break;case"T":if(this.activePieceOrientation=="u"||this.activePieceOrientation=="i"){if(this.playfield[parseInt(this.activePiecePositionX-1+1,10)][parseInt(this.activePiecePositionY-1+0,10)]){}else{r(this.sself)}}else{r(this.sself)}break;default:r(this.sself);break}break;case"SRS":if(this.activePieceType=="I"){a(this.sself,this.activePieceOrientation,e,true)}else{a(this.sself,this.activePieceOrientation,e,false)}break}}}else{this.addPiece(this.activePiecePositionX,this.activePiecePositionY,this.activePieceType,t,"active",false)}}else{this.addPiece(this.activePiecePositionX,this.activePiecePositionY,this.activePieceType,t,"active",false)}};$(document).ready(function(){$('input[type=radio][name="select"][value=Ii]').attr("checked",true);$('input[type=radio][name="editor-tab"][value=inactive]').attr("checked",true);var t;var r=false;var a=false;var i=false;var s=false;var o=false;var n=false;var c=false;var l=true;var h=false;var d=new Painter("pf");var m=new Diagram(d);m.init();d.init();var v=setInterval(function(){if(d.ready){clearInterval(v);drawPalette("ARS",8,d.sprite);drawPaletteDeco(8,d.spritedeco);var e=window.location.search;if(e){$("#import").val(e);$("#import-button").click()}}},10);d.CanvasExport=$("#pf-export");d.ContextExport=d.CanvasExport[0].getContext("2d");m.painter.CanvasPreview.mousemove(function(e){var i=e.pageX;var c=e.pageY;if(i>m.painter.PFOriginXAbsolute&&i<=m.painter.PFOriginXAbsolute+10*m.painter.blockSize&&c<m.painter.PFOriginYAbsolute){}if(i>m.painter.PFOriginXAbsolute&&i<=m.painter.PFOriginXAbsolute+10*m.painter.blockSize&&c>m.painter.PFOriginYAbsolute&&c<=m.painter.PFOriginYAbsolute+20*m.painter.blockSize){var f=parseInt(Math.floor((i-m.painter.PFOriginXAbsolute)/m.painter.blockSize),10);var h=parseInt(Math.floor((c-m.painter.PFOriginYAbsolute)/m.painter.blockSize),10);m.painter.eraseLayer("preview");if(l){var d=$("input[type=radio][name=select]:checked").attr("value");var v=d.charAt(0);var u=d.slice(1);var p="";if($("#checkbox-active").is(":checked")){p="active"}else{p="inactive"}if($("#checkbox-garbage").is(":checked")){p="garbage"}if(t){if(s){m.frames[m.current_frame].addPiece(f,h,v,"singleton",p,r)}else if(o){m.frames[m.current_frame].removeBlock(f,h)}else{m.frames[m.current_frame].addPiece(f,h,v,u,p,r)}}else{if(o){m.frames[m.current_frame].addPiece(f,h,"G","singleton","preview",r)}else if(a||s){m.frames[m.current_frame].addPiece(f,h,v,"singleton","preview",r)}else{if(v=="I"){m.frames[m.current_frame].addPiece(parseInt(f-1,10),h,v,u,"preview",r)}else{m.frames[m.current_frame].addPiece(f,h,v,u,"preview",r)}}}}else{m.painter.eraseLayer("preview");if(n){m.frames[m.current_frame].addPiece(f,h,"G","singleton","preview",r)}else{var d=$('input[type=radio][name="select-deco"]:checked').attr("value");m.frames[m.current_frame].addPiece(f,h,d,"singleton","decoration-preview",false)}}}});m.painter.CanvasPreview.mousedown(function(e){var t=e.pageX;var i=e.pageY;if(t>m.painter.PFOriginXAbsolute&&t<=m.painter.PFOriginXAbsolute+10*m.painter.blockSize&&i>m.painter.PFOriginYAbsolute&&i<=m.painter.PFOriginYAbsolute+20*m.painter.blockSize){var c=parseInt(Math.floor((t-m.painter.PFOriginXAbsolute)/m.painter.blockSize),10);var f=parseInt(Math.floor((i-m.painter.PFOriginYAbsolute)/m.painter.blockSize),10);if(l){var h=$('input[type=radio][name="select"]:checked').attr("value");var d=h.charAt(0);var v=h.slice(1);var u="";if($("#checkbox-active").is(":checked")){u="active"}else{u="inactive"}if($("#checkbox-garbage").is(":checked")){u="garbage"}if(a&&d!=m.frames[m.current_frame].lookup(c,f)){m.frames[m.current_frame].recursive_fill(c,f,m.frames[m.current_frame].lookup(c,f),d)}else if(s){m.frames[m.current_frame].addPiece(c,f,d,"singleton",u,r)}else if(o){m.frames[m.current_frame].removeBlock(c,f)}else{if(d=="I"){if(m.frames[m.current_frame].lookup(c,f)){m.frames[m.current_frame].addPiece(parseInt(c-1,10),f,d,v,"erase",r)}else{m.frames[m.current_frame].addPiece(parseInt(c-1,10),f,d,v,u,r)}}else{if(m.frames[m.current_frame].lookup(c,f)){m.frames[m.current_frame].addPiece(c,f,d,v,"erase",r)}else{m.frames[m.current_frame].addPiece(c,f,d,v,u,r)}}}}else{if(n){m.frames[m.current_frame].removeDeco(c,f)}else{var h=$('input[type=radio][name="select-deco"]:checked').attr("value");m.frames[m.current_frame].addPiece(c,f,h,"singleton","decoration",false)}}}});m.painter.CanvasControl.mousedown(function(e){var t=e.pageX;var r=e.pageY;var a=m.painter.CanvasControl.height();var i;if(t<a+m.painter.CntrlOriginX){if(t<m.painter.CntrlOriginX+a/3&&r<m.painter.CntrlOriginY+a/3){i="ul"}if(t>m.painter.CntrlOriginX+a/3&&t<m.painter.CntrlOriginX+2*a/3&&r<m.painter.CntrlOriginY+a/3){i="u"}if(t>m.painter.CntrlOriginX+2*a/3&&t<m.painter.CntrlOriginX+a&&r<m.painter.CntrlOriginY+a/3){i="ur"}if(t<m.painter.CntrlOriginX+a/3&&r>m.painter.CntrlOriginY+a/3&&r<m.painter.CntrlOriginY+2*a/3){i="l"}if(t>m.painter.CntrlOriginX+a/3&&t<m.painter.CntrlOriginX+2*a/3&&r>m.painter.CntrlOriginY+a/3&&r<m.painter.CntrlOriginY+2*a/3){m.painter.resetJoystick();m.frames[m.current_frame].modify_control("c","rest");d.drawJoystick("c","rest");return}if(t>m.painter.CntrlOriginX+2*a/3&&r>m.painter.CntrlOriginY+a/3&&r<m.painter.CntrlOriginY+2*a/3){i="r"}if(t<m.painter.CntrlOriginX+a/3&&r>m.painter.CntrlOriginY+2*a/3&&r<m.painter.CntrlOriginY+a){i="dl"}if(t>m.painter.CntrlOriginX+a/3&&r>m.painter.CntrlOriginY+2*a/3&&r<m.painter.CntrlOriginY+a){i="d"}if(t>m.painter.CntrlOriginX+2*a/3&&r>m.painter.CntrlOriginY+2*a/3&&r<m.painter.CntrlOriginY+a){i="dr"}if(i!=m.frames[m.current_frame].joystick_direction){m.painter.resetJoystick();m.frames[m.current_frame].modify_control(i,"pressed");d.drawJoystick(i,"pressed")}else{switch(m.frames[m.current_frame].joystick_state){case"rest":m.painter.resetJoystick();m.frames[m.current_frame].modify_control(i,"pressed");d.drawJoystick(i,"pressed");break;case"pressed":m.painter.resetJoystick();m.frames[m.current_frame].modify_control(i,"holded");d.drawJoystick(i,"holded");break;case"holded":m.painter.resetJoystick();m.frames[m.current_frame].modify_control(i,"rest");d.drawJoystick(i,"rest");break;default:break}}}if(t>a+m.painter.CntrlOriginX){var s=a/5;var o="";var n="";if(t<a+a/4+s+m.painter.CntrlOriginX&&r<a/4+s+m.painter.CntrlOriginY){o="A"}if(t>a+a/4+2*s+a/16-s+m.painter.CntrlOriginX&&t<a+a/4+2*s+a/16+s+m.painter.CntrlOriginX&&r<a/4+s+m.painter.CntrlOriginY){o="B"}if(t>a+a/4+4*s+2*a/16-s+m.painter.CntrlOriginX&t<a+a/4+4*s+2*a/16+s+m.painter.CntrlOriginX&r<a/4+s+m.painter.CntrlOriginY){o="C"}if(t<a+a/4+s+m.painter.CntrlOriginX&&r>3*a/4-s+m.painter.CntrlOriginY){o="D"}switch(o){case"A":n=0;break;case"B":n=1;break;case"C":n=2;break;case"D":n=3;break;case"E":n=4;break;case"F":n=5;break}switch(m.frames[m.current_frame].button_state[n]){case"pressed":m.frames[m.current_frame].modify_button(o,"holded");d.drawButton(o,"holded");break;case"holded":m.frames[m.current_frame].modify_button(o,"rest");d.drawButton(o,"rest");break;case"rest":m.frames[m.current_frame].modify_button(o,"pressed");d.drawButton(o,"pressed");break}}});m.painter.CanvasNextHold.click(function(e){var t=e.pageX;var r=e.pageY;var a=parseInt(1+(t-m.painter.CanvasNextHold.offset().left)/m.painter.blockSize,10);var i=parseInt(1+(r-m.painter.CanvasNextHold.offset().top)/m.painter.blockSize,10);var s=$("input[type=radio][name=select]:checked").attr("value");var o=s.charAt(0);if(a>=0&&a<4){if(!m.frames[m.current_frame].nexthold[0]){m.frames[m.current_frame].modify_nexthold(0,o);m.painter.drawNextHold(0,o,m.frames[m.current_frame].RS)}else{m.frames[m.current_frame].modify_nexthold(0,"");m.painter.drawNextHold(0,"",m.frames[m.current_frame].RS)}}if(a>=4&&a<8){if(!m.frames[m.current_frame].nexthold[1]){m.frames[m.current_frame].modify_nexthold(1,o);m.painter.drawNextHold(1,o,m.frames[m.current_frame].RS)}else{m.frames[m.current_frame].modify_nexthold(1,"");m.painter.drawNextHold(1,"",m.frames[m.current_frame].RS)}}if(a>=8&&a<11){if(!m.frames[m.current_frame].nexthold[2]){m.frames[m.current_frame].modify_nexthold(2,o);m.painter.drawNextHold(2,o,m.frames[m.current_frame].RS)}else{m.frames[m.current_frame].modify_nexthold(2,"");m.painter.drawNextHold(2,"",m.frames[m.current_frame].RS)}}if(a>=11){if(!m.frames[m.current_frame].nexthold[3]){m.frames[m.current_frame].modify_nexthold(3,o);m.painter.drawNextHold(3,o,m.frames[m.current_frame].RS)}else{m.frames[m.current_frame].modify_nexthold(3,"");m.painter.drawNextHold(3,"",m.frames[m.current_frame].RS)}}});$("#pf-cmd_first").click(function(){m.first_frame()});$("#pf-cmd_prev").click(function(){m.previous_frame();x();A()});$("#pf-cmd_next").click(function(){if(m.current_frame<m.frames.length-1){m.next_frame();x();A()}else{$("#pf-cmd_clone").click()}});$("#pf-cmd_last").click(function(){m.last_frame()});$("#pf-current-frame").blur(function(){if($("#pf-current-frame").val()>0&&$("#pf-current-frame").val()<=m.frames.length){m.goto_frame(parseInt($("#pf-current-frame").val()-1,10))}});$("#pf-comment").blur(function(){m.frames[m.current_frame].comment=$(this).val()});function u(e){console.log("test");m.painter.resetJoystick();m.frames[m.current_frame].modify_control(e,"pressed");d.drawJoystick(e,"pressed")}function w(e){m.frames[m.current_frame].modify_button(e,"pressed");d.drawButton(e,"pressed")}$("#cmd_move_up").mousedown(function(){if($("#pf-auto-action-frame-increment:checked").val()){$("#pf-cmd_clone").click()}if($("#sync-movement:checked").val()){u("u")}m.frames[m.current_frame].moveActivePiece("up")});$("#cmd_move_down").mousedown(function(){if($("#pf-auto-action-frame-increment:checked").val()){$("#pf-cmd_clone").click()}if($("#sync-movement:checked").val()){u("d")}m.frames[m.current_frame].moveActivePiece("down")});$("#cmd_move_left").mousedown(function(){if($("#pf-auto-action-frame-increment:checked").val()){$("#pf-cmd_clone").click()}if($("#sync-movement:checked").val()){u("l")}m.frames[m.current_frame].moveActivePiece("left")});$("#cmd_move_right").mousedown(function(){if($("#pf-auto-action-frame-increment:checked").val()){$("#pf-cmd_clone").click()}if($("#sync-movement:checked").val()){u("r")}m.frames[m.current_frame].moveActivePiece("right")});$("#cmd_ccw").mousedown(function(){if($("#pf-auto-action-frame-increment:checked").val()){$("#pf-cmd_clone").click()}if($("#sync-movement:checked").val()){w("A")}m.frames[m.current_frame].rotateActivePiece("ccw")});$("#cmd_cw").mousedown(function(){if($("#pf-auto-action-frame-increment:checked").val()){$("#pf-cmd_clone").click()}if($("#sync-movement:checked").val()){w("B")}m.frames[m.current_frame].rotateActivePiece("cw")});$("#cmd_paint").mousedown(function(){m.frames[m.current_frame].paintActivePiece()});$("#cmd_lock").mousedown(function(){m.frames[m.current_frame].lockActivePiece();if(O){$("#cmd_reset_timer").click()}});$("#cmd_drop").mousedown(function(){m.frames[m.current_frame].dropActivePiece()});$("#pf-duration").blur(function(){m.frames[m.current_frame].duration=parseFloat($(this).val())});$("#pf-active-opacity").blur(function(){m.frames[m.current_frame].modify_AP_opacity($(this).val())});var g=$("#cmd_opacity_none"),y=$("#cmd_opacity_3"),_=$("#cmd_opacity_2"),P=$("#cmd_opacity_1"),S=$("#cmd_opacity_lock"),C=$("#cmd_opacity_flash");function x(){g.removeClass("pressed");y.removeClass("pressed");_.removeClass("pressed");P.removeClass("pressed");S.removeClass("pressed");C.removeClass("pressed")}function A(){switch($("#pf-active-opacity").val()){case"1.0":$("#cmd_opacity_none").addClass("pressed");break;case"0.9":$("#cmd_opacity_3").addClass("pressed");break;case"0.8":$("#cmd_opacity_2").addClass("pressed");break;case"0.7":$("#cmd_opacity_1").addClass("pressed");break;case"0.55":$("#cmd_opacity_lock").addClass("pressed");break;case"Flash":$("#cmd_opacity_flash").addClass("pressed");break}}$("#cmd_opacity_none").click(function(){$("#pf-active-opacity").val("1.0").blur();x();$(this).addClass("pressed")});$("#cmd_opacity_3").click(function(){$("#pf-active-opacity").val("0.9").blur();x();$(this).addClass("pressed")});$("#cmd_opacity_2").click(function(){$("#pf-active-opacity").val("0.8").blur();x();$(this).addClass("pressed")});$("#cmd_opacity_1").click(function(){$("#pf-active-opacity").val("0.7").blur();x();$(this).addClass("pressed")});$("#cmd_opacity_lock").click(function(){$("#pf-active-opacity").val("0.55").blur();x();$(this).addClass("pressed")});$("#cmd_opacity_flash").click(function(){$("#pf-active-opacity").val("Flash").blur();x();$(this).addClass("pressed")});var R,I,O=false;$("#cmd_reset_timer").click(function(){O=true;R=1;$("#indic").html(parseInt(F[$("#timer-select").val()].lock-R,10)+" frames left until lock");$("#cmd_timer_tick").attr("style","");$("#cmd_reset_timer").attr("style","");$("#hr_tick").attr("style","")});$("#cmd_startstop_timer").click(function(){if(O){$(this).attr("value","Start timer");O=false;$("#indic").html("");$("#cmd_reset_timer").attr("style","display:none");$("#cmd_timer_tick").attr("style","display:none");$("#hr_tick").attr("style","display:none;")}else{$(this).attr("value","Stop timer");O=true;R=1;$("#indic").html(parseInt(F[$("#timer-select").val()].lock-R,10)+" frames left until lock");$("#cmd_timer_tick").attr("style","");$("#cmd_reset_timer").attr("style","");$("#hr_tick").attr("style","")}});function B(){R++;$("#indic").html(parseInt(F[$("#timer-select").val()].lock-R,10)+" frames left until lock");if(R<=F[$("#timer-select").val()].separation1){$("#cmd_opacity_none").click()}if(R<=F[$("#timer-select").val()].separation2&&R>F[$("#timer-select").val()].separation1){$("#cmd_opacity_3").click()
}if(R<=F[$("#timer-select").val()].separation3&&R>F[$("#timer-select").val()].separation1&&R>F[$("#timer-select").val()].separation2){$("#cmd_opacity_2").click()}if(R<=F[$("#timer-select").val()].separation4&&R>F[$("#timer-select").val()].separation1&&R>F[$("#timer-select").val()].separation2&&R>F[$("#timer-select").val()].separation3){$("#cmd_opacity_1").click()}if(R==parseInt(F[$("#timer-select").val()].separation4)){$("#cmd_opacity_lock").click();$("#indic").html("Lock")}if(R==parseInt(1+F[$("#timer-select").val()].separation4)){$("#cmd_opacity_flash").click();$("#indic").html("Flash")}if(R==parseInt(2+F[$("#timer-select").val()].separation4)){$("#cmd_opacity_flash").click();$("#indic").html("Flash")}if(R>parseInt(2+F[$("#timer-select").val()].separation4)){$("#indic").html("Locked!");$("#cmd_lock").click();$("#cmd_startstop_timer").click()}}var F={TGM1:{ARE:30,lock:30,separation1:12,separation2:18,separation3:24,separation4:30},Master000699:{ARE:25,lock:30,separation1:12,separation2:18,separation3:24,separation4:30},Master700799:{ARE:16,lock:30,separation1:12,separation2:18,separation3:24,separation4:30},Master800899:{ARE:12,lock:30,separation1:12,separation2:18,separation3:24,separation4:30},Master900999:{ARE:12,lock:17,separation1:6,separation2:10,separation3:14,separation4:17},Master10001099:{ARE:6,lock:17,separation1:6,separation2:10,separation3:14,separation4:17},Master11001199:{ARE:5,lock:15,separation1:6,separation2:10,separation3:13,separation4:15},Master12001299:{ARE:4,lock:15,separation1:6,separation2:10,separation3:13,separation4:15},Death000099:{ARE:16,lock:30,separation1:12,separation2:18,separation3:24,separation4:30},Death100199:{ARE:12,lock:26,separation1:10,separation2:16,separation3:21,separation4:26},Death200299:{ARE:12,lock:22,separation1:9,separation2:14,separation3:18,separation4:22},Death300399:{ARE:6,lock:18,separation1:8,separation2:12,separation3:15,separation4:18},Death400499:{ARE:5,lock:15,separation1:6,separation2:9,separation3:12,separation4:15},Death500999:{ARE:4,lock:15,separation1:6,separation2:9,separation3:12,separation4:15},Shirase000199:{ARE:10,lock:18,separation1:8,separation2:12,separation3:15,separation4:18},Shirase200299:{ARE:10,lock:17,separation1:7,separation2:11,separation3:14,separation4:17},Shirase300499:{ARE:4,lock:15,separation1:6,separation2:9,separation3:12,separation4:15},Shirase500599:{ARE:4,lock:13,separation1:6,separation2:9,separation3:11,separation4:13},Shirase6001099:{ARE:4,lock:12,separation1:6,separation2:8,separation3:10,separation4:12},Shirase11001199:{ARE:4,lock:10,separation1:4,separation2:6,separation3:8,separation4:10},Shirase12001299:{ARE:4,lock:8,separation1:4,separation2:6,separation3:7,separation4:8},TDSSRS:{ARE:1,lock:30,separation1:10,separation2:17,separation3:25,separation4:30}};$("#cmd_clear_lines").click(function(){m.frames[m.current_frame].clear_lines()});$("#cmd_stack_lines").click(function(){m.frames[m.current_frame].stack_lines()});$("#cmd_clearstack_lines").click(function(){m.frames[m.current_frame].clear_lines();m.frames[m.current_frame].stack_lines()});$("#cmd_clear_inactive").click(function(){m.frames[m.current_frame].clear("inactive")});$("#cmd_clear_active").click(function(){m.frames[m.current_frame].clear("active")});$("#cmd_clear_decoration").click(function(){m.frames[m.current_frame].clear("decoration")});$("#cmd_clear_all").click(function(){m.frames[m.current_frame].clear("all")});$("#activate-white-border").click(function(){if($("#activate-white-border:checked").val()){m.frames[m.current_frame].modify_whiteborder(true)}else{m.frames[m.current_frame].modify_whiteborder(false)}});$("#change-all-whiteborder").click(function(){m.modify_whiteborder($("#border-select").val())});$("#border-select").change(function(){m.frames[m.current_frame].modify_border($("#border-select").val())});$("#change-all-border").click(function(){m.modify_border($("#border-select").val())});$("#rs-select").change(function(){m.frames[m.current_frame].modify_RS($("#rs-select").val());drawPalette($("#rs-select").val(),8,d.sprite)});$("#change-all-rs").click(function(){m.modify_RS($("#rs-select").val())});$("#duration-1f").click(function(){$("#pf-duration").val("1").blur()});$("#duration-5f").click(function(){$("#pf-duration").val("5").blur()});$("#duration-15f").click(function(){$("#pf-duration").val("15").blur()});$("#duration-60f").click(function(){$("#pf-duration").val("60").blur()});$("#duration-remaining").click(function(){var e=F[$("#timer-select").val()].separation1-R;var t=F[$("#timer-select").val()].separation2-R;var r=F[$("#timer-select").val()].separation3-R;var a=F[$("#timer-select").val()].separation4-R;var i=Math.min(e>0?e:1e3,t>0?t:1e3,r>0?r:1e3,a>0?a:1e3);m.modify_duration(i)});$("#change-all-duration").click(function(){m.modify_duration(parseInt($("#pf-duration").val(),10))});$("#pf-cmd_new").click(function(){m.new_frame();m.frames[m.current_frame].draw()});$("#pf-cmd_clone").click(function(){m.new_copy_frame()});$("#pf-cmd_del").click(function(){m.remove_current_frame();m.frames[m.current_frame].draw();m.update_framecount()});$("#pf-cmd_remove_following").click(function(){m.remove_following_frames();m.frames[m.current_frame].draw();m.update_framecount()});$("#cmd_nuke").click(function(){var e=window.confirm("This will reset everything ! Are you sure ?");if(e){m.remove_all_playfields();m.frames[m.current_frame].draw()}});$("#cmd_timer_tick").click(function(){B()});$('input[name="auto-are"]').click(function(){$("#pf-cmd_clone").click();m.frames[m.current_frame].duration=$(this).val();$("#pf-cmd_clone").click()});$("#tetramino-panel table").click(function(){$("#tetramino-panel td").removeClass("pressed");$("#tetramino-panel input[type=radio]:checked").parent().parent().addClass("pressed")});$("#panel-decorations").click(function(){$("#panel-decorations td").removeClass("pressed");$("#panel-decorations table input:checked").parent().parent().addClass("pressed")});$("#fumen_import").click(function(){var t=$("#import").val();var r=t.slice(t.indexOf("@"));enclim=32768;enc=new Array(enclim+1024);enctbl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";asctbl=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";framelim=2e3;f=new Array(220);encf=new Array(220);af=new Array(220*(framelim+1));p=new Array(3);ap=new Array(3*(framelim+1));au=new Array(framelim);am=new Array(framelim);ac=new Array(framelim);ad=new Array(framelim);ct=1;b=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,1,3,1,1,0,1,1,1,2,1,3,0,1,1,1,2,1,3,1,1,0,1,1,1,2,1,3,0,1,1,1,2,1,0,2,1,0,1,1,1,2,2,2,2,0,0,1,1,1,2,1,0,0,1,0,1,1,1,2,1,1,2,1,1,2,2,2,1,1,2,1,1,2,2,2,1,1,2,1,1,2,2,2,1,1,2,1,1,2,2,2,0,1,1,1,1,2,2,2,2,0,1,1,2,1,1,2,0,1,1,1,1,2,2,2,2,0,1,1,2,1,1,2,0,1,1,1,2,1,1,2,1,0,1,1,2,1,1,2,1,0,0,1,1,1,2,1,1,0,0,1,1,1,1,2,0,1,1,1,2,1,2,2,1,0,2,0,1,1,1,2,0,0,0,1,1,1,2,1,1,0,1,1,0,2,1,2,1,1,2,1,0,2,1,2,0,0,0,1,1,1,1,2,1,1,2,1,0,2,1,2,0,0,0,1,1,1,1,2);enclen=0;for(a=0;a<r.length;a++){tmp=enctbl.indexOf(r.charAt(a));if(tmp>=0)enc[enclen++]=tmp}for(a=enclen;a<enclim;a++)enc[a]=0;encc=0;fldrepcnt=0;for(a=0;a<220;a++)af[a]=0;for(e=0;encc<enclen;e++){if(fldrepcnt<1){for(j=0;j<220;){tmp=enc[encc++];tmp+=enc[encc++]*64;tmp2=tmp%220;tmp=Math.floor(tmp/220);tmp1=tmp%17;tmp=Math.floor(tmp/17);for(a=0;a<=tmp2;a++)af[e*220+j++]+=tmp1-8;if(tmp1*220+tmp2==1979)fldrepcnt=enc[encc++]}}else{fldrepcnt--}tmp=enc[encc++];tmp+=enc[encc++]*64;tmp+=enc[encc++]*4096;ap[e*3+0]=tmp%8;tmp=Math.floor(tmp/8);ap[e*3+1]=tmp%4;tmp=Math.floor(tmp/4);ap[e*3+2]=tmp%220;tmp=Math.floor(tmp/220);au[e]=tmp%2;tmp=Math.floor(tmp/2);am[e]=tmp%2;tmp=Math.floor(tmp/2);if(e===0){ct=tmp%2}tmp=Math.floor(tmp/2);acflg=tmp%2;tmp=Math.floor(tmp/2);ac[e]=e>0?ac[e-1]:"";cmstrrep=ac[e];ac[e]=cmstrrep;ad[e]=tmp%2;tmp=Math.floor(tmp/2);if(acflg){tmp=enc[encc++];tmp+=enc[encc++]*64;tmplen=tmp%4096;tmp=Math.floor(tmp/4096);tmpstr="";for(a=0;a<tmplen;a+=4){tmp=enc[encc++];tmp+=enc[encc++]*64;tmp+=enc[encc++]*4096;tmp+=enc[encc++]*262144;tmp+=enc[encc++]*16777216;tmpstr+=asctbl.charAt(tmp%96);tmp=Math.floor(tmp/96);tmpstr+=asctbl.charAt(tmp%96);tmp=Math.floor(tmp/96);tmpstr+=asctbl.charAt(tmp%96);tmp=Math.floor(tmp/96);tmpstr+=asctbl.charAt(tmp%96);tmp=Math.floor(tmp/96)}ac[e]=unescape(tmpstr.substring(0,tmplen))}for(a=0;a<220;a++)af[(e+1)*220+a]=af[e*220+a];if(!ad[e]){if(ap[e*3+0]>0){for(j=0;j<4;j++)af[(e+1)*220+ap[e*3+2]+b[ap[e*3+0]*32+ap[e*3+1]*8+j*2+1]*10+b[ap[e*3+0]*32+ap[e*3+1]*8+j*2]-11]=ap[e*3+0]}for(a=20,k=20;k>=0;k--){chk=0;for(j=0;j<10;j++)chk+=af[(e+1)*220+k*10+j]>0;if(chk<10){for(j=0;j<10;j++)af[(e+1)*220+a*10+j]=af[(e+1)*220+k*10+j];a--}}for(;a>=0;a--)for(j=0;j<10;j++)af[(e+1)*220+a*10+j]=0;if(au[e]){for(a=0;a<210;a++)af[(e+1)*220+a]=af[(e+1)*220+a+10];for(a=210;a<220;a++)af[(e+1)*220+a]=0}if(am[e])for(a=0;a<21;a++)for(j=0;j<5;j++){tmp=af[(e+1)*220+a*10+j];af[(e+1)*220+a*10+j]=af[(e+1)*220+a*10+9-j];af[(e+1)*220+a*10+9-j]=tmp}}}m.remove_all_playfields();for(z=0;z<e;z++){m.new_frame();if(ct==1){m.frames[z].RS="SRS"}else{m.frames[z].RS="ARS"}for(var a=0;a<10;a++){for(j=0;j<20;j++){m.frames[z].modify(a,j,o(af[z*220+10*(j+1)+a]))}}m.frames[z].activePieceType=o(ap[3*z+0]);if(m.frames[z].activePieceType){m.frames[z].activePieceOrientation=n(ap[3*z+1],ct,m.frames[z].activePieceType);var i=s(ap[3*z+2],m.frames[z].activePieceOrientation,ct);m.frames[z].activePiecePositionX=parseInt(parseInt(i[0])+parseInt(c(m.frames[z].activePieceType,m.frames[z].activePieceOrientation,m.frames[z].RS)));m.frames[z].activePiecePositionY=parseInt(parseInt(i[1])+parseInt(l(m.frames[z].activePieceType,m.frames[z].activePieceOrientation,m.frames[z].RS)))}if(ac[z]){m.frames[z].comment=ac[z]}}m.remove_current_frame();function s(e,t,r){var a;var i;a=e%10;i=parseInt((e-a-10)/10,10);return[a,i]}function o(e){var t;switch(e){case 0:t="";break;case 1:t="I";break;case 2:t="L";break;case 3:t="O";break;case 4:t="Z";break;case 5:t="T";break;case 6:t="J";break;case 7:t="S";break;case 8:t="G";break;default:break}return t}function n(e,t,r){var a;if(t){switch(e){case 0:a="u";if(r=="I"||r=="Z"){a="i"}break;case 1:a="cw";if(r=="S"){a="ccw"}break;case 2:a="i";if(r=="Z"||r=="S"){a="u"}break;case 3:a="ccw";if(r=="Z"){a="ccw"}break}}else{switch(e){case 0:a="i";break;case 1:a="ccw";break;case 2:a="u";break;case 3:a="cw";break}}return a}function c(e,t){var r="0";if(m.frames[z].RS=="ARS"){switch(e){case"I":switch(t){case"cw":r="-1";break;case"ccw":r="-1";break}}}else{switch(e){case"Z":switch(t){case"ccw":r="1";break}case"I":switch(t){case"cw":r="-1";break}}}return r}function l(e,t){var r="0";if(m.frames[z].RS=="ARS"){switch(e){case"J":switch(t){case"u":r="-1";break}case"T":switch(t){case"u":r="-1";break}case"L":switch(t){case"u":r="-1";break}}}else{switch(e){case"Z":switch(t){case"i":r="1";break}}}return r}});var T=16.6666667;$("#pf-cmd_playpause").click(function(){var e=m.current_frame;var t=m.frames.length;if(m.playing){m.playing=false;$("#pf-cmd_playpause").attr("value","▷")}else{m.playing=true;$("#pf-cmd_playpause").attr("value","∥")}var r=0;function a(){if(e<t&&m.playing){if(r<m.frames[m.current_frame].duration){m.goto_frame(e);r++}else{r=0;e++}requestAnimationFrame(a)}else if($("#pf-loop").is(":checked")){e=0;requestAnimationFrame(a)}}a()});var G=$("#main-utilities");var D=$("#tab-deco");var X=$("#tab-tetramino");var W=$("#tetramino-panel");var Y=$("#panel-decorations");var E=$("#tools");$("body").mousedown(function(){t=true}).mouseup(function(){t=false});function L(){c=false;l=false}function J(e){if(e!="decorationspanel"){Y.fadeOut(200)}if(e!="tetraminopanel"){W.fadeOut(200)}}D.click(function(){J("decorationspanel");L();c=true;Y.delay(200).fadeIn();G.removeClass().addClass("border-deco")});X.mousedown(function(){J("tetraminopanel");L();l=true;W.delay(200).fadeIn();G.removeClass().addClass("border-tetramino")});function M(){r=false;a=false;i=false;s=false;o=false;Z.removeClass("pressed");H.removeClass("pressed");N.removeClass("pressed");q.removeClass("pressed")}var Z=$("#button-drop");Z.mousedown(function(){if(r){M()}else{M();r=true;Z.addClass("pressed")}});var H=$("#button-paint-bucket");H.mousedown(function(){if(a){M()}else{M();a=true;H.addClass("pressed")}});var N=$("#button-pencil");N.mousedown(function(){if(s){M()}else{M();s=true;N.addClass("pressed")}});var q=$("#button-eraser");q.mousedown(function(){if(o){M()}else{M();o=true;q.addClass("pressed")}});var U=$("#button-eraser-deco");U.mousedown(function(){if(n){n=false;U.removeClass("pressed")}else{n=true;U.addClass("pressed")}});var K=$("#checkbox-highlight-decoration");K.click(function(){if(K.is(":checked")){K.attr("checked",true);$("#pf-decoPin").fadeIn()}else{K.attr("checked",false);$("#pf-decoPin").fadeOut()}});$("#export-image-frame-button").click(function(){if($("#export-image-play-sign").is(":checked")){m.painter.exportImage("play")}else{m.painter.exportImage()}$("#export-gif").attr("style","display: none");$("#pf-export").attr("style","display: block")});$("#export-image-diagram-button").click(function(){m.getGIF();$("#export-gif").attr("style","display: block");$("#pf-export").attr("style","display: none")});$("#thumbnail-mode").click(function(){$("#thumbnails-container").toggleClass("timeline table")});$("#thumbnails").on("click",".thumbnail",function(){if(m.current_frame+1==m.frames.length){$("#thumbnail-"+parseInt(m.current_frame+1)).toggleClass("selected");old_diagram_goto_frame.call(m,$(this).attr("id").split("-")[1]-1);$("#thumbnail-"+parseInt(m.frames[m.current_frame].id)).toggleClass("selected")}else{$("#thumbnail-"+parseInt(m.frames[m.current_frame].id)).toggleClass("selected");old_diagram_goto_frame.call(m,$(this).attr("id").split("-")[1]-1);$("#thumbnail-"+parseInt(m.frames[m.current_frame].id)).toggleClass("selected")}});$(".export-button").click(function(){var e="";var t=$(this).attr("id");if($("input[name=export-type]:checked").val()=="All"){e="all-"+m.flate_encode(m.print());console.log("all-"+m.print())}if($("input[name=export-type]:checked").val()=="Current"){e="current-"+m.flate_encode(m.frames[m.current_frame].print())}switch(t){case"export-forum-button":$("#export").html("[tedige]v01-"+e+"[/tedige]").select();break;case"export-custom-button":var r=/%TEDIGE%/;var a=$("#export-custom-string").val();a=a.replace(r,"v01-"+e);$("#export").html(a).select();break;case"export-editor-button":$("#export").html(window.location.href.split("?")[0]+"?v01-"+e).select();break;case"export-viewer-button":var i=window.location.href.split("?")[0].split("/");i.pop();$("#export").html(i.join("/")+"/viewer.html?v01-"+e).select();break}});$("#export").focus(function(){var e=$(this);e.select();e.mouseup(function(){e.unbind("mouseup");return false})});var Q=/\[tedige\](.+)\[\/tedige\]/;var V=/v01.+/;$("#import-button").click(function(){var e=$("#import").val();resultforum=Q.exec(e);resultURL=V.exec(e);var t;if(resultURL){t=resultURL[0].split("-")}if(resultforum){t=resultforum[0].split("-");t[2]=t[2].split("[")[0]}switch(t[1]){case"all":m.load(m.flate_decode(t[2]));m.frames[m.current_frame].draw();break;case"current":m.frames[m.current_frame].load(m.flate_decode(t[2]));m.frames[m.current_frame].draw();break}});var et=true;$("#keyboard-control").click(function(){if($("#keyboard-control").attr("checked")){et=true;$("#keyboard-control-list").slideDown()}else{et=false;$("#keyboard-control-list").slideUp()}});KeyboardJS.on("left",function(){if(et){$("#pf-cmd_prev").click()}});KeyboardJS.on("shift + a",function(){if(et){$("#pf-cmd_prev").click()}});KeyboardJS.on("right",function(){if(et){$("#pf-cmd_next").click()}});KeyboardJS.on("shift + d",function(){if(et){$("#pf-cmd_next").click()}});KeyboardJS.on("w",function(){if(et){$("#cmd_move_up").mousedown()}});KeyboardJS.on("a",function(){if(et){$("#cmd_move_left").mousedown()}});KeyboardJS.on("s",function(){if(et){$("#cmd_move_down").mousedown()}});KeyboardJS.on("d",function(){if(et){$("#cmd_move_right").mousedown()}});KeyboardJS.on("h",function(){if(et){$("#cmd_ccw").mousedown()}});KeyboardJS.on("j",function(){if(et){$("#cmd_cw").mousedown()}});KeyboardJS.on("k",function(){if(et){$("#cmd_paint").mousedown()}});KeyboardJS.on("l",function(){if(et){$("#cmd_lock").mousedown()}});KeyboardJS.on("shift + w",function(){if(et){$("#cmd_drop").mousedown()}});KeyboardJS.on("shift + s",function(){if(et&&m.frames[m.current_frame].activePieceType){$("#cmd_drop").mousedown();$("#pf-cmd_clone").mousedown();$("#cmd_opacity_flash").mousedown();$("#pf-cmd_clone").mousedown();$("#cmd_lock").mousedown()}});KeyboardJS.on("shift + h",function(){if(et){tt("up")}});KeyboardJS.on("shift + J",function(){if(et){tt("down")}});function tt(e){var t=$('input[type=radio][name="select"]:checked').attr("value"),r=false;$("#"+t+"-cell").toggleClass("pressed");if(m.frames[m.current_frame].activePieceType){r=true}else{m.frames[m.current_frame].activePieceOrientation="i"}if(e=="down"){switch(t.charAt(0)){case"Z":$("#O"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#O"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"O",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"O":$("#I"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#I"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"I",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"I":$("#T"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#T"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"T",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"T":$("#L"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#L"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"L",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"L":$("#J"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#J"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"J",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"J":$("#S"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#S"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"S",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"S":$("#Z"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#Z"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");break;if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"Z",m.frames[m.current_frame].activePieceOrientation,"active",false)}}}if(e=="up"){switch(t.charAt(0)){case"I":$("#O"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#O"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"O",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"T":$("#I"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#I"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"I",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"L":$("#T"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#T"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"T",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"J":$("#L"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#L"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"L",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"S":$("#J"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#J"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"J",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"Z":$("#S"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#S"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"S",m.frames[m.current_frame].activePieceOrientation,"active",false)};break;case"O":$("#Z"+m.frames[m.current_frame].activePieceOrientation+"-cell").toggleClass("pressed");$("#Z"+m.frames[m.current_frame].activePieceOrientation+"").attr("checked","checked");break;if(r){m.frames[m.current_frame].addPiece(m.frames[m.current_frame].activePiecePositionX,m.frames[m.current_frame].activePiecePositionY,"Z",m.frames[m.current_frame].activePieceOrientation,"active",false)}}}if(!r){m.frames[m.current_frame].activePieceOrientation=""}}$("#foobartest").click(function(){console.log(m);console.log(m.frames[m.current_frame]);console.log(m.print())})});