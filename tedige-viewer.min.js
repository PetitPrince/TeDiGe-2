<<<<<<< HEAD
(function(){var e=32768;var t=0;var r=1;var i=2;var a=9;var s=6;var o=32768;var n=64;var c;var h;var l=null;var f;var v,d;var b;var u;var k;var w;var C;var g;var p,S;var m,x;var y;var P;var _=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);var R=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0);var A=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99);var B=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577);var z=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var O=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var I=function(){this.next=null;this.list=null};var G=function(){this.e=0;this.b=0;this.n=0;this.t=null};var F=function(e,t,r,i,a,s){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;{var o;var n=new Array(this.BMAX+1);var c;var h;var l;var f;var v;var d;var b;var u=new Array(this.BMAX+1);var k;var w;var C;var g=new G;var p=new Array(this.BMAX);var S=new Array(this.N_MAX);var m;var x=new Array(this.BMAX+1);var y;var P;var _;var R;var A;A=this.root=null;for(v=0;v<n.length;v++)n[v]=0;for(v=0;v<u.length;v++)u[v]=0;for(v=0;v<p.length;v++)p[v]=null;for(v=0;v<S.length;v++)S[v]=0;for(v=0;v<x.length;v++)x[v]=0;c=t>256?e[256]:this.BMAX;k=e;w=0;v=t;do{n[k[w]]++;w++}while(--v>0);if(n[0]==t){this.root=null;this.m=0;this.status=0;return}for(d=1;d<=this.BMAX;d++)if(n[d]!=0)break;b=d;if(s<d)s=d;for(v=this.BMAX;v!=0;v--)if(n[v]!=0)break;l=v;if(s>v)s=v;for(P=1<<d;d<v;d++,P<<=1)if((P-=n[d])<0){this.status=2;this.m=s;return}if((P-=n[v])<0){this.status=2;this.m=s;return}n[v]+=P;x[1]=d=0;k=n;w=1;y=2;while(--v>0)x[y++]=d+=k[w++];k=e;w=0;v=0;do{if((d=k[w++])!=0)S[x[d]++]=v}while(++v<t);t=x[l];x[0]=v=0;k=S;w=0;f=-1;m=u[0]=0;C=null;_=0;for(;b<=l;b++){o=n[b];while(o-->0){while(b>m+u[1+f]){m+=u[1+f];f++;_=(_=l-m)>s?s:_;if((h=1<<(d=b-m))>o+1){h-=o+1;y=b;while(++d<_){if((h<<=1)<=n[++y])break;h-=n[y]}}if(m+d>c&&m<c)d=c-m;_=1<<d;u[1+f]=d;C=new Array(_);for(R=0;R<_;R++){C[R]=new G}if(A==null)A=this.root=new I;else A=A.next=new I;A.next=null;A.list=C;p[f]=C;if(f>0){x[f]=v;g.b=u[f];g.e=16+d;g.t=C;d=(v&(1<<m)-1)>>m-u[f];p[f-1][d].e=g.e;p[f-1][d].b=g.b;p[f-1][d].n=g.n;p[f-1][d].t=g.t}}g.b=b-m;if(w>=t)g.e=99;else if(k[w]<r){g.e=k[w]<256?16:15;g.n=k[w++]}else{g.e=a[k[w]-r];g.n=i[k[w++]-r]}h=1<<b-m;for(d=v>>m;d<_;d+=h){C[d].e=g.e;C[d].b=g.b;C[d].n=g.n;C[d].t=g.t}for(d=1<<b-1;(v&d)!=0;d>>=1)v^=d;v^=d;while((v&(1<<m)-1)!=x[f]){m-=u[f];f--}}}this.m=u[1];this.status=P!=0&&l!=1?1:0}};var W=function(){if(y.length==P)return-1;return y.charCodeAt(P++)&255};var T=function(e){while(u<e){b|=W()<<u;u+=8}};var L=function(e){return b&_[e]};var D=function(e){b>>=e;u-=e};var $=function(t,r,i){var a;var s;var o;if(i==0)return 0;o=0;for(;;){T(m);s=p.list[L(m)];a=s.e;while(a>16){if(a==99)return-1;D(s.b);a-=16;T(a);s=s.t[L(a)];a=s.e}D(s.b);if(a==16){h&=e-1;t[r+o++]=c[h++]=s.n;if(o==i)return i;continue}if(a==15)break;T(a);C=s.n+L(a);D(a);T(x);s=S.list[L(x)];a=s.e;while(a>16){if(a==99)return-1;D(s.b);a-=16;T(a);s=s.t[L(a)];a=s.e}D(s.b);T(a);g=h-s.n-L(a);D(a);while(C>0&&o<i){C--;g&=e-1;h&=e-1;t[r+o++]=c[h++]=c[g++]}if(o==i)return i}k=-1;return o};var J=function(t,r,i){var a;a=u&7;D(a);T(16);a=L(16);D(16);T(16);if(a!=(~b&65535))return-1;D(16);C=a;a=0;while(C>0&&a<i){C--;h&=e-1;T(8);t[r+a++]=c[h++]=L(8);D(8)}if(C==0)k=-1;return a};var X=function(e,t,r){if(l==null){var i;var a=new Array(288);var s;for(i=0;i<144;i++)a[i]=8;for(;i<256;i++)a[i]=9;for(;i<280;i++)a[i]=7;for(;i<288;i++)a[i]=8;v=7;s=new F(a,288,257,R,A,v);if(s.status!=0){alert("HufBuild error: "+s.status);return-1}l=s.root;v=s.m;for(i=0;i<30;i++)a[i]=5;zip_fixed_bd=5;s=new F(a,30,0,B,z,zip_fixed_bd);if(s.status>1){l=null;alert("HufBuild error: "+s.status);return-1}f=s.root;zip_fixed_bd=s.m}p=l;S=f;m=v;x=zip_fixed_bd;return $(e,t,r)};var Y=function(e,t,r){var i;var o;var n;var c;var h;var l;var f;var v;var d=new Array(286+30);var b;for(i=0;i<d.length;i++)d[i]=0;T(5);f=257+L(5);D(5);T(5);v=1+L(5);D(5);T(4);l=4+L(4);D(4);if(f>286||v>30)return-1;for(o=0;o<l;o++){T(3);d[O[o]]=L(3);D(3)}for(;o<19;o++)d[O[o]]=0;m=7;b=new F(d,19,19,null,null,m);if(b.status!=0)return-1;p=b.root;m=b.m;c=f+v;i=n=0;while(i<c){T(m);h=p.list[L(m)];o=h.b;D(o);o=h.n;if(o<16)d[i++]=n=o;else if(o==16){T(2);o=3+L(2);D(2);if(i+o>c)return-1;while(o-->0)d[i++]=n}else if(o==17){T(3);o=3+L(3);D(3);if(i+o>c)return-1;while(o-->0)d[i++]=0;n=0}else{T(7);o=11+L(7);D(7);if(i+o>c)return-1;while(o-->0)d[i++]=0;n=0}}m=a;b=new F(d,f,257,R,A,m);if(m==0)b.status=1;if(b.status!=0){if(b.status==1);return-1}p=b.root;m=b.m;for(i=0;i<v;i++)d[i]=d[i+f];x=s;b=new F(d,v,0,B,z,x);S=b.root;x=b.m;if(x==0&&f>257){return-1}if(b.status==1){}if(b.status!=0)return-1;return $(e,t,r)};var Z=function(){var t;if(c==null)c=new Array(2*e);h=0;b=0;u=0;k=-1;w=false;C=g=0;p=null};var M=function(r,i,a){var s,o;s=0;while(s<a){if(w&&k==-1)return s;if(C>0){if(k!=t){while(C>0&&s<a){C--;g&=e-1;h&=e-1;r[i+s++]=c[h++]=c[g++]}}else{while(C>0&&s<a){C--;h&=e-1;T(8);r[i+s++]=c[h++]=L(8);D(8)}if(C==0)k=-1}if(s==a)return s}if(k==-1){if(w)break;T(1);if(L(1)!=0)w=true;D(1);T(2);k=L(2);D(2);p=null;C=0}switch(k){case 0:o=J(r,i+s,a-s);break;case 1:if(p!=null)o=$(r,i+s,a-s);else o=X(r,i+s,a-s);break;case 2:if(p!=null)o=$(r,i+s,a-s);else o=Y(r,i+s,a-s);break;default:o=-1;break}if(o==-1){if(w)return 0;return-1}s+=o}return s};var E=function(e){var t,r;Z();y=e;P=0;var i=new Array(1024);var a=[];while((t=M(i,0,i.length))>0){var s=new Array(t);for(r=0;r<t;r++){s[r]=String.fromCharCode(i[r])}a[a.length]=s.join("")}y=null;return a.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.inflate=E})();(function(){var e=32768;var t=0;var r=1;var i=2;var a=6;var s=true;var o=32768;var n=64;var c=1024*8;var h=2*e;var l=3;var f=258;var v=16;var d=8192;var b=13;if(d>o)alert("error: zip_INBUFSIZ is too small");if(e<<1>1<<v)alert("error: zip_WSIZE is too large");if(b>v-1)alert("error: zip_HASH_BITS is too large");if(b<8||f!=258)alert("error: Code too clever");var u=d;var k=1<<b;var w=k-1;var C=e-1;var g=0;var p=4096;var S=f+l+1;var m=e-S;var x=1;var y=15;var P=7;var _=29;var R=256;var A=256;var B=R+1+_;var z=30;var O=19;var I=16;var G=17;var F=18;var W=2*B+1;var T=parseInt((b+l-1)/l);var L;var D,$;var J;var X=null;var Y,Z;var M;var E;var H;var N;var j;var q;var U;var Q;var V;var K;var et;var tt;var rt;var it;var at;var st;var ot;var nt;var ct;var ht;var lt;var ft;var vt;var dt;var bt;var ut;var kt;var wt;var Ct;var gt;var pt;var St;var mt;var xt;var yt;var Pt;var _t;var Rt;var At;var Bt;var zt;var Ot;var It;var Gt;var Ft;var Wt;var Tt;var Lt;var Dt;var $t;var Jt=function(){this.fc=0;this.dl=0};var Xt=function(){this.dyn_tree=null;this.static_tree=null;this.extra_bits=null;this.extra_base=0;this.elems=0;this.max_length=0;this.max_code=0};var Yt=function(e,t,r,i){this.good_length=e;this.max_lazy=t;this.nice_length=r;this.max_chain=i};var Zt=function(){this.next=null;this.len=0;this.ptr=new Array(c);this.off=0};var Mt=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0);var Et=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var Ht=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7);var Nt=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var jt=new Array(new Yt(0,0,0,0),new Yt(4,4,8,4),new Yt(4,5,16,8),new Yt(4,6,32,32),new Yt(4,4,16,16),new Yt(8,16,32,32),new Yt(8,16,128,128),new Yt(8,32,128,256),new Yt(32,128,258,1024),new Yt(32,258,258,4096));var qt=function(e){var t;if(!e)e=a;else if(e<1)e=1;else if(e>9)e=9;lt=e;J=false;ot=false;if(X!=null)return;L=D=$=null;X=new Array(c);E=new Array(h);H=new Array(u);N=new Array(o+n);j=new Array(1<<v);dt=new Array(W);for(t=0;t<W;t++)dt[t]=new Jt;bt=new Array(2*z+1);for(t=0;t<2*z+1;t++)bt[t]=new Jt;ut=new Array(B+2);for(t=0;t<B+2;t++)ut[t]=new Jt;kt=new Array(z);for(t=0;t<z;t++)kt[t]=new Jt;wt=new Array(2*O+1);for(t=0;t<2*O+1;t++)wt[t]=new Jt;Ct=new Xt;gt=new Xt;pt=new Xt;St=new Array(y+1);mt=new Array(2*B+1);Pt=new Array(2*B+1);_t=new Array(f-l+1);Rt=new Array(512);At=new Array(_);Bt=new Array(z);zt=new Array(parseInt(d/8))};var Ut=function(){L=D=$=null;X=null;E=null;H=null;N=null;j=null;dt=null;bt=null;ut=null;kt=null;wt=null;Ct=null;gt=null;pt=null;St=null;mt=null;Pt=null;_t=null;Rt=null;At=null;Bt=null;zt=null};var Qt=function(e){e.next=L;L=e};var Vt=function(){var e;if(L!=null){e=L;L=L.next}else e=new Zt;e.next=null;e.len=e.off=0;return e};var Kt=function(t){return j[e+t]};var er=function(t,r){return j[e+t]=r};var tr=function(e){X[Z+Y++]=e;if(Z+Y==c)Gr()};var rr=function(e){e&=65535;if(Z+Y<c-2){X[Z+Y++]=e&255;X[Z+Y++]=e>>>8}else{tr(e&255);tr(e>>>8)}};var ir=function(){V=(V<<T^E[at+l-1]&255)&w;K=Kt(V);j[at&C]=K;er(V,at)};var ar=function(e,t){zr(t[e].fc,t[e].dl)};var sr=function(e){return(e<256?Rt[e]:Rt[256+(e>>7)])&255};var or=function(e,t,r){return e[t].fc<e[r].fc||e[t].fc==e[r].fc&&Pt[t]<=Pt[r]};var nr=function(e,t,r){var i;for(i=0;i<r&&$t<Dt.length;i++)e[t+i]=Dt.charCodeAt($t++)&255;return i};var cr=function(){var t;for(t=0;t<k;t++)j[e+t]=0;ht=jt[lt].max_lazy;ft=jt[lt].good_length;if(!s)vt=jt[lt].nice_length;ct=jt[lt].max_chain;at=0;Q=0;nt=nr(E,0,2*e);if(nt<=0){ot=true;nt=0;return}ot=false;while(nt<S&&!ot)lr();V=0;for(t=0;t<l-1;t++){V=(V<<T^E[t]&255)&w}};var hr=function(e){var t=ct;var r=at;var i;var a;var o=it;var n=at>m?at-m:g;var c=at+f;var h=E[r+o-1];var l=E[r+o];if(it>=ft)t>>=2;do{i=e;if(E[i+o]!=l||E[i+o-1]!=h||E[i]!=E[r]||E[++i]!=E[r+1]){continue}r+=2;i++;do{}while(E[++r]==E[++i]&&E[++r]==E[++i]&&E[++r]==E[++i]&&E[++r]==E[++i]&&E[++r]==E[++i]&&E[++r]==E[++i]&&E[++r]==E[++i]&&E[++r]==E[++i]&&r<c);a=f-(c-r);r=c-f;if(a>o){st=e;o=a;if(s){if(a>=f)break}else{if(a>=vt)break}h=E[r+o-1];l=E[r+o]}}while((e=j[e&C])>n&&--t!=0);return o};var lr=function(){var t,r;var i=h-nt-at;if(i==-1){i--}else if(at>=e+m){for(t=0;t<e;t++)E[t]=E[t+e];st-=e;at-=e;Q-=e;for(t=0;t<k;t++){r=Kt(t);er(t,r>=e?r-e:g)}for(t=0;t<e;t++){r=j[t];j[t]=r>=e?r-e:g}i+=e}if(!ot){t=nr(E,at+nt,i);if(t<=0)ot=true;else nt+=t}};var fr=function(){while(nt!=0&&D==null){var e;ir();if(K!=g&&at-K<=m){rt=hr(K);if(rt>nt)rt=nt}if(rt>=l){e=Rr(at-st,rt-l);nt-=rt;if(rt<=ht){rt--;do{at++;ir()}while(--rt!=0);at++}else{at+=rt;rt=0;V=E[at]&255;V=(V<<T^E[at+1]&255)&w}}else{e=Rr(0,E[at]&255);nt--;at++}if(e){_r(0);Q=at}while(nt<S&&!ot)lr()}};var vr=function(){while(nt!=0&&D==null){ir();it=rt;et=st;rt=l-1;if(K!=g&&it<ht&&at-K<=m){rt=hr(K);if(rt>nt)rt=nt;if(rt==l&&at-st>p){rt--}}if(it>=l&&rt<=it){var e;e=Rr(at-1-et,it-l);nt-=it-1;it-=2;do{at++;ir()}while(--it!=0);tt=0;rt=l-1;at++;if(e){_r(0);Q=at}}else if(tt!=0){if(Rr(0,E[at-1]&255)){_r(0);Q=at}at++;nt--}else{tt=1;at++;nt--}while(nt<S&&!ot)lr()}};var dr=function(){if(ot)return;q=0;U=0;kr();cr();D=null;Y=0;Z=0;if(lt<=3){it=l-1;rt=0}else{rt=l-1;tt=0}M=false};var br=function(e,t,r){var i;if(!J){dr();J=true;if(nt==0){M=true;return 0}}if((i=ur(e,t,r))==r)return r;if(M)return i;if(lt<=3)fr();else vr();if(nt==0){if(tt!=0)Rr(0,E[at-1]&255);_r(1);M=true}return i+ur(e,i+t,r-i)};var ur=function(e,t,r){var i,a,s;i=0;while(D!=null&&i<r){a=r-i;if(a>D.len)a=D.len;for(s=0;s<a;s++)e[t+i+s]=D.ptr[D.off+s];D.off+=a;D.len-=a;i+=a;if(D.len==0){var o;o=D;D=D.next;Qt(o)}}if(i==r)return i;if(Z<Y){a=r-i;if(a>Y-Z)a=Y-Z;for(s=0;s<a;s++)e[t+i+s]=X[Z+s];Z+=a;i+=a;if(Y==Z)Y=Z=0}return i};var kr=function(){var e;var t;var r;var i;var a;if(kt[0].dl!=0)return;Ct.dyn_tree=dt;Ct.static_tree=ut;Ct.extra_bits=Mt;Ct.extra_base=R+1;Ct.elems=B;Ct.max_length=y;Ct.max_code=0;gt.dyn_tree=bt;gt.static_tree=kt;gt.extra_bits=Et;gt.extra_base=0;gt.elems=z;gt.max_length=y;gt.max_code=0;pt.dyn_tree=wt;pt.static_tree=null;pt.extra_bits=Ht;pt.extra_base=0;pt.elems=O;pt.max_length=P;pt.max_code=0;r=0;for(i=0;i<_-1;i++){At[i]=r;for(e=0;e<1<<Mt[i];e++)_t[r++]=i}_t[r-1]=i;a=0;for(i=0;i<16;i++){Bt[i]=a;for(e=0;e<1<<Et[i];e++){Rt[a++]=i}}a>>=7;for(;i<z;i++){Bt[i]=a<<7;for(e=0;e<1<<Et[i]-7;e++)Rt[256+a++]=i}for(t=0;t<=y;t++)St[t]=0;e=0;while(e<=143){ut[e++].dl=8;St[8]++}while(e<=255){ut[e++].dl=9;St[9]++}while(e<=279){ut[e++].dl=7;St[7]++}while(e<=287){ut[e++].dl=8;St[8]++}pr(ut,B+1);for(e=0;e<z;e++){kt[e].dl=5;kt[e].fc=Or(e,5)}wr()};var wr=function(){var e;for(e=0;e<B;e++)dt[e].fc=0;for(e=0;e<z;e++)bt[e].fc=0;for(e=0;e<O;e++)wt[e].fc=0;dt[A].fc=1;Tt=Lt=0;Ot=It=Gt=0;Ft=0;Wt=1};var Cr=function(e,t){var r=mt[t];var i=t<<1;while(i<=xt){if(i<xt&&or(e,mt[i+1],mt[i]))i++;if(or(e,r,mt[i]))break;mt[t]=mt[i];t=i;i<<=1}mt[t]=r};var gr=function(e){var t=e.dyn_tree;var r=e.extra_bits;var i=e.extra_base;var a=e.max_code;var s=e.max_length;var o=e.static_tree;var n;var c,h;var l;var f;var v;var d=0;for(l=0;l<=y;l++)St[l]=0;t[mt[yt]].dl=0;for(n=yt+1;n<W;n++){c=mt[n];l=t[t[c].dl].dl+1;if(l>s){l=s;d++}t[c].dl=l;if(c>a)continue;St[l]++;f=0;if(c>=i)f=r[c-i];v=t[c].fc;Tt+=v*(l+f);if(o!=null)Lt+=v*(o[c].dl+f)}if(d==0)return;do{l=s-1;while(St[l]==0)l--;St[l]--;St[l+1]+=2;St[s]--;d-=2}while(d>0);for(l=s;l!=0;l--){c=St[l];while(c!=0){h=mt[--n];if(h>a)continue;if(t[h].dl!=l){Tt+=(l-t[h].dl)*t[h].fc;t[h].fc=l}c--}}};var pr=function(e,t){var r=new Array(y+1);var i=0;var a;var s;for(a=1;a<=y;a++){i=i+St[a-1]<<1;r[a]=i}for(s=0;s<=t;s++){var o=e[s].dl;if(o==0)continue;e[s].fc=Or(r[o]++,o)}};var Sr=function(e){var t=e.dyn_tree;var r=e.static_tree;var i=e.elems;var a,s;var o=-1;var n=i;xt=0;yt=W;for(a=0;a<i;a++){if(t[a].fc!=0){mt[++xt]=o=a;Pt[a]=0}else t[a].dl=0}while(xt<2){var c=mt[++xt]=o<2?++o:0;t[c].fc=1;Pt[c]=0;Tt--;if(r!=null)Lt-=r[c].dl}e.max_code=o;for(a=xt>>1;a>=1;a--)Cr(t,a);do{a=mt[x];mt[x]=mt[xt--];Cr(t,x);s=mt[x];mt[--yt]=a;mt[--yt]=s;t[n].fc=t[a].fc+t[s].fc;if(Pt[a]>Pt[s]+1)Pt[n]=Pt[a];else Pt[n]=Pt[s]+1;t[a].dl=t[s].dl=n;mt[x]=n++;Cr(t,x)}while(xt>=2);mt[--yt]=mt[x];gr(e);pr(t,o)};var mr=function(e,t){var r;var i=-1;var a;var s=e[0].dl;var o=0;var n=7;var c=4;if(s==0){n=138;c=3}e[t+1].dl=65535;for(r=0;r<=t;r++){a=s;s=e[r+1].dl;if(++o<n&&a==s)continue;else if(o<c)wt[a].fc+=o;else if(a!=0){if(a!=i)wt[a].fc++;wt[I].fc++}else if(o<=10)wt[G].fc++;else wt[F].fc++;o=0;i=a;if(s==0){n=138;c=3}else if(a==s){n=6;c=3}else{n=7;c=4}}};var xr=function(e,t){var r;var i=-1;var a;var s=e[0].dl;var o=0;var n=7;var c=4;if(s==0){n=138;c=3}for(r=0;r<=t;r++){a=s;s=e[r+1].dl;if(++o<n&&a==s){continue}else if(o<c){do{ar(a,wt)}while(--o!=0)}else if(a!=0){if(a!=i){ar(a,wt);o--}ar(I,wt);zr(o-3,2)}else if(o<=10){ar(G,wt);zr(o-3,3)}else{ar(F,wt);zr(o-11,7)}o=0;i=a;if(s==0){n=138;c=3}else if(a==s){n=6;c=3}else{n=7;c=4}}};var yr=function(){var e;mr(dt,Ct.max_code);mr(bt,gt.max_code);Sr(pt);for(e=O-1;e>=3;e--){if(wt[Nt[e]].dl!=0)break}Tt+=3*(e+1)+5+5+4;return e};var Pr=function(e,t,r){var i;zr(e-257,5);zr(t-1,5);zr(r-4,4);for(i=0;i<r;i++){zr(wt[Nt[i]].dl,3)}xr(dt,e-1);xr(bt,t-1)};var _r=function(e){var a,s;var o;var n;n=at-Q;zt[Gt]=Ft;Sr(Ct);Sr(gt);o=yr();a=Tt+3+7>>3;s=Lt+3+7>>3;if(s<=a)a=s;if(n+4<=a&&Q>=0){var c;zr((t<<1)+e,3);Ir();rr(n);rr(~n);for(c=0;c<n;c++)tr(E[Q+c])}else if(s==a){zr((r<<1)+e,3);Ar(ut,kt)}else{zr((i<<1)+e,3);Pr(Ct.max_code+1,gt.max_code+1,o+1);Ar(dt,bt)}wr();if(e!=0)Ir()};var Rr=function(e,t){N[Ot++]=t;if(e==0){dt[t].fc++}else{e--;dt[_t[t]+R+1].fc++;bt[sr(e)].fc++;H[It++]=e;Ft|=Wt}Wt<<=1;if((Ot&7)==0){zt[Gt++]=Ft;Ft=0;Wt=1}if(lt>2&&(Ot&4095)==0){var r=Ot*8;var i=at-Q;var a;for(a=0;a<z;a++){r+=bt[a].fc*(5+Et[a])}r>>=3;if(It<parseInt(Ot/2)&&r<parseInt(i/2))return true}return Ot==d-1||It==u};var Ar=function(e,t){var r;var i;var a=0;var s=0;var o=0;var n=0;var c;var h;if(Ot!=0)do{if((a&7)==0)n=zt[o++];i=N[a++]&255;if((n&1)==0){ar(i,e)}else{c=_t[i];ar(c+R+1,e);h=Mt[c];if(h!=0){i-=At[c];zr(i,h)}r=H[s++];c=sr(r);ar(c,t);h=Et[c];if(h!=0){r-=Bt[c];zr(r,h)}}n>>=1}while(a<Ot);ar(A,e)};var Br=16;var zr=function(e,t){if(U>Br-t){q|=e<<U;rr(q);q=e>>Br-U;U+=t-Br}else{q|=e<<U;U+=t}};var Or=function(e,t){var r=0;do{r|=e&1;e>>=1;r<<=1}while(--t>0);return r>>1};var Ir=function(){if(U>8){rr(q)}else if(U>0){tr(q)}q=0;U=0};var Gr=function(){if(Y!=0){var e,t;e=Vt();if(D==null)D=$=e;else $=$.next=e;e.len=Y-Z;for(t=0;t<e.len;t++)e.ptr[t]=X[Z+t];Y=Z=0}};var Fr=function(e,t){var r,i;Dt=e;$t=0;if(typeof t=="undefined")t=a;qt(t);var s=new Array(1024);var o=[];while((r=br(s,0,s.length))>0){var n=new Array(r);for(i=0;i<r;i++){n[i]=String.fromCharCode(s[i])}o[o.length]=n.join("")}Dt=null;return o.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.deflate=Fr})();"use strict";jQuery.base64=function(e){var t="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="1.0";function a(e,t){var i=r.indexOf(e.charAt(t));if(i===-1){throw"Cannot decode base64"}return i}function s(e){var r=0,i,s,o=e.length,n=[];e=String(e);if(o===0){return e}if(o%4!==0){throw"Cannot decode base64"}if(e.charAt(o-1)===t){r=1;if(e.charAt(o-2)===t){r=2}o-=4}for(i=0;i<o;i+=4){s=a(e,i)<<18|a(e,i+1)<<12|a(e,i+2)<<6|a(e,i+3);n.push(String.fromCharCode(s>>16,s>>8&255,s&255))}switch(r){case 1:s=a(e,i)<<18|a(e,i+1)<<12|a(e,i+2)<<6;n.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=a(e,i)<<18|a(e,i+1)<<12;n.push(String.fromCharCode(s>>16));break}return n.join("")}function o(e,t){var r=e.charCodeAt(t);if(r>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return r}function n(e){if(arguments.length!==1){throw"SyntaxError: exactly one argument required"}e=String(e);var i,a,s=[],n=e.length-e.length%3;if(e.length===0){return e}for(i=0;i<n;i+=3){a=o(e,i)<<16|o(e,i+1)<<8|o(e,i+2);s.push(r.charAt(a>>18));s.push(r.charAt(a>>12&63));s.push(r.charAt(a>>6&63));s.push(r.charAt(a&63))}switch(e.length-n){case 1:a=o(e,i)<<16;s.push(r.charAt(a>>18)+r.charAt(a>>12&63)+t+t);break;case 2:a=o(e,i)<<16|o(e,i+1)<<8;s.push(r.charAt(a>>18)+r.charAt(a>>12&63)+r.charAt(a>>6&63)+t);break}return s.join("")}return{decode:s,encode:n,VERSION:i}}(jQuery);LZWEncoder=function(){var e={};var t=-1;var r;var i;var a;var s;var o;var n;var c=12;var h=5003;var l;var f=c;var v;var d=1<<c;var b=new Array;var u=new Array;var k=h;var w=0;var C=false;var g;var p;var S;var m=0;var x=0;var y=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var P;var _=[];var R=e.LZWEncoder=function R(e,t,o,n){r=e;i=t;a=o;s=Math.max(2,n)};var A=function A(e,t){_[P++]=e;if(P>=254)G(t)};var B=function B(e){z(k);w=p+2;C=true;T(p,e)};var z=function z(e){for(var t=0;t<e;++t)b[t]=-1};var O=e.compress=function O(e,r){var i;var a;var s;var o;var n;var c;var h;g=e;C=false;l=g;v=F(l);p=1<<e-1;S=p+1;w=p+2;P=0;o=W();h=0;for(i=k;i<65536;i*=2)++h;h=8-h;c=k;z(c);T(p,r);e:while((s=W())!=t){i=(s<<f)+o;a=s<<h^o;if(b[a]==i){o=u[a];continue}else if(b[a]>=0){n=c-a;if(a==0)n=1;do{if((a-=n)<0)a+=c;if(b[a]==i){o=u[a];continue e}}while(b[a]>=0)}T(o,r);o=s;if(w<d){u[a]=w++;b[a]=i}else B(r)}T(o,r);T(S,r)};var I=e.encode=function I(e){e.writeByte(s);o=r*i;n=0;O(s+1,e);e.writeByte(0)};var G=function G(e){if(P>0){e.writeByte(P);e.writeBytes(_,0,P);P=0}};var F=function F(e){return(1<<e)-1};var W=function W(){if(o==0)return t;--o;var e=a[n++];return e&255};var T=function T(e,t){m&=y[x];if(x>0)m|=e<<x;else m=e;x+=l;while(x>=8){A(m&255,t);m>>=8;x-=8}if(w>v||C){if(C){v=F(l=g);C=false}else{++l;if(l==f)v=d;else v=F(l)}}if(e==S){while(x>0){A(m&255,t);m>>=8;x-=8}G(t)}};R.apply(this,arguments);return e};GIFEncoder=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function r(){this.bin=[]}r.prototype.getData=function(){for(var e="",r=this.bin.length,i=0;i<r;i++)e+=t[this.bin[i]];return e};r.prototype.writeByte=function(e){this.bin.push(e)};r.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;r<t;r++)this.writeByte(e.charCodeAt(r))};r.prototype.writeBytes=function(e,t,r){for(var i=r||e.length,a=t||0;a<i;a++)this.writeByte(e[a])};var i={};var a;var s;var o=null;var n;var c=-1;var h=0;var l=false;var f;var v;var d;var b;var u;var k;var w=new Array;var C=7;var g=-1;var p=false;var S=true;var m=false;var x=10;var y=i.setDelay=function y(e){h=Math.round(e/10)};var P=i.setDispose=function P(e){if(e>=0)g=e};var _=i.setRepeat=function _(e){if(e>=0)c=e};var R=i.setTransparent=function R(e){o=e};var A=i.addFrame=function A(e,t){if(e==null||!l||f==null){throw new Error("Please call start method before calling addFrame");return false}var r=true;try{if(!t){v=e.getImageData(0,0,e.canvas.width,e.canvas.height).data;if(!m)G(e.canvas.width,e.canvas.height)}else{v=e}L();W();if(S){J();Y();if(c>=0){X()}}D();$();if(!S)Y();M();S=false}catch(i){r=false}return r};var B=i.finish=function B(){if(!l)return false;var e=true;l=false;try{f.writeByte(59)}catch(t){e=false}return e};var z=function z(){n=0;v=null;d=null;b=null;k=null;p=false;S=true};var O=i.setFrameRate=function O(e){if(e!=15)h=Math.round(100/e)};var I=i.setQuality=function I(e){if(e<1)e=1;x=e};var G=i.setSize=function G(e,t){if(l&&!S)return;a=e;s=t;if(a<1)a=320;if(s<1)s=240;m=true};var F=i.start=function F(){z();var e=true;p=false;f=new r;try{f.writeUTFBytes("GIF89a")}catch(t){e=false}return l=e};var W=function W(){var e=d.length;var t=e/3;b=[];var r=new NeuQuant(d,e,x);k=r.process();var i=0;for(var a=0;a<t;a++){var s=r.map(d[i++]&255,d[i++]&255,d[i++]&255);w[s]=true;b[a]=s}d=null;u=8;C=7;if(o!=null){n=T(o)}};var T=function T(e){if(k==null)return-1;var t=(e&16711680)>>16;var r=(e&65280)>>8;var i=e&255;var a=0;var s=256*256*256;var o=k.length;for(var n=0;n<o;){var c=t-(k[n++]&255);var h=r-(k[n++]&255);var l=i-(k[n]&255);var f=c*c+h*h+l*l;var v=n/3;if(w[v]&&f<s){s=f;a=v}n++}return a};var L=function L(){var e=a;var t=s;d=[];var r=v;var i=0;for(var o=0;o<t;o++){for(var n=0;n<e;n++){var c=o*e*4+n*4;d[i++]=r[c];d[i++]=r[c+1];d[i++]=r[c+2]}}};var D=function D(){f.writeByte(33);f.writeByte(249);f.writeByte(4);var e;var t;if(o==null){e=0;t=0}else{e=1;t=2}if(g>=0){t=g&7}t<<=2;f.writeByte(0|t|0|e);Z(h);f.writeByte(n);f.writeByte(0)};var $=function $(){f.writeByte(44);Z(0);Z(0);Z(a);Z(s);if(S){f.writeByte(0)}else{f.writeByte(128|0|0|0|C)}};var J=function J(){Z(a);Z(s);f.writeByte(128|112|0|C);f.writeByte(0);f.writeByte(0)};var X=function X(){f.writeByte(33);f.writeByte(255);f.writeByte(11);f.writeUTFBytes("NETSCAPE"+"2.0");f.writeByte(3);f.writeByte(1);Z(c);f.writeByte(0)};var Y=function Y(){f.writeBytes(k);var e=3*256-k.length;for(var t=0;t<e;t++)f.writeByte(0)};var Z=function Z(e){f.writeByte(e&255);f.writeByte(e>>8&255)};var M=function M(){var e=new LZWEncoder(a,s,b,u);e.encode(f)};var E=i.stream=function E(){return f};var H=i.setProperties=function H(e,t){l=e;S=t};return i};NeuQuant=function(){var e={};var t=256;var r=499;var i=491;var a=487;var s=503;var o=3*s;var n=t-1;var c=4;var h=100;var l=16;var f=1<<l;var v=10;var d=1<<v;var b=10;var u=f>>b;var k=f<<v-b;var w=t>>3;var C=6;var g=1<<C;var p=w*g;var S=30;var m=10;var x=1<<m;var y;var P=8;var _=1<<P;var R=m+P;var A=1<<R;var B;var z;var O;var I;var G=new Array;var F=new Array;var W=new Array;var T=new Array;var L=e.NeuQuant=function L(e,r,i){var a;var s;B=e;z=r;O=i;I=new Array(t);for(a=0;a<t;a++){I[a]=new Array(4);s=I[a];s[0]=s[1]=s[2]=(a<<c+8)/t;W[a]=f/t;F[a]=0}};var D=function D(){var e=[];var r=new Array(t);for(var i=0;i<t;i++)r[I[i][3]]=i;var a=0;for(var s=0;s<t;s++){var o=r[s];e[a++]=I[o][0];e[a++]=I[o][1];e[a++]=I[o][2]}return e};var $=function $(){var e;var r;var i;var a;var s;var o;var c;var h;c=0;h=0;for(e=0;e<t;e++){s=I[e];i=e;a=s[1];for(r=e+1;r<t;r++){o=I[r];if(o[1]<a){i=r;a=o[1]}}o=I[i];if(e!=i){r=o[0];o[0]=s[0];s[0]=r;r=o[1];o[1]=s[1];s[1]=r;r=o[2];o[2]=s[2];s[2]=r;r=o[3];o[3]=s[3];s[3]=r}if(a!=c){G[c]=h+e>>1;for(r=c+1;r<a;r++)G[r]=e;c=a;h=e}}G[c]=h+n>>1;for(r=c+1;r<256;r++)G[r]=n};var J=function J(){var e;var t;var n;var l;var f;var v;var d;var b;var u;var k;var w;var g;var m;var P;if(z<o)O=1;y=30+(O-1)/3;g=B;m=0;P=z;w=z/(3*O);k=w/h|0;b=x;v=p;d=v>>C;if(d<=1)d=0;for(e=0;e<d;e++)T[e]=b*((d*d-e*e)*_/(d*d));if(z<o)u=3;else if(z%r!=0)u=3*r;else{if(z%i!=0)u=3*i;else{if(z%a!=0)u=3*a;else u=3*s}}e=0;while(e<w){n=(g[m+0]&255)<<c;l=(g[m+1]&255)<<c;f=(g[m+2]&255)<<c;t=H(n,l,f);E(b,t,n,l,f);if(d!=0)M(d,t,n,l,f);m+=u;if(m>=P)m-=z;e++;if(k==0)k=1;if(e%k==0){b-=b/y;v-=v/S;d=v>>C;if(d<=1)d=0;for(t=0;t<d;t++)T[t]=b*((d*d-t*t)*_/(d*d))}}};var X=e.map=function X(e,r,i){var a;var s;var o;var n;var c;var h;var l;c=1e3;l=-1;a=G[r];s=a-1;while(a<t||s>=0){if(a<t){h=I[a];o=h[1]-r;if(o>=c)a=t;else{a++;if(o<0)o=-o;n=h[0]-e;if(n<0)n=-n;o+=n;if(o<c){n=h[2]-i;if(n<0)n=-n;o+=n;if(o<c){c=o;l=h[3]}}}}if(s>=0){h=I[s];o=r-h[1];if(o>=c)s=-1;else{s--;if(o<0)o=-o;n=h[0]-e;if(n<0)n=-n;o+=n;if(o<c){n=h[2]-i;if(n<0)n=-n;o+=n;if(o<c){c=o;l=h[3]}}}}}return l};var Y=e.process=function Y(){J();Z();$();return D()};var Z=function Z(){var e;var r;for(e=0;e<t;e++){I[e][0]>>=c;I[e][1]>>=c;I[e][2]>>=c;I[e][3]=e}};var M=function M(e,r,i,a,s){var o;var n;var c;var h;var l;var f;var v;c=r-e;if(c<-1)c=-1;h=r+e;if(h>t)h=t;o=r+1;n=r-1;f=1;while(o<h||n>c){l=T[f++];if(o<h){v=I[o++];try{v[0]-=l*(v[0]-i)/A;v[1]-=l*(v[1]-a)/A;v[2]-=l*(v[2]-s)/A}catch(d){}}if(n>c){v=I[n--];try{v[0]-=l*(v[0]-i)/A;v[1]-=l*(v[1]-a)/A;v[2]-=l*(v[2]-s)/A}catch(d){}}}};var E=function E(e,t,r,i,a){var s=I[t];s[0]-=e*(s[0]-r)/x;s[1]-=e*(s[1]-i)/x;s[2]-=e*(s[2]-a)/x};var H=function H(e,r,i){var a;var s;var o;var n;var h;var f;var d;var w;var C;var g;w=~(1<<31);C=w;f=-1;d=f;for(a=0;a<t;a++){g=I[a];s=g[0]-e;if(s<0)s=-s;o=g[1]-r;if(o<0)o=-o;s+=o;o=g[2]-i;if(o<0)o=-o;s+=o;if(s<w){w=s;f=a}n=s-(F[a]>>l-c);if(n<C){C=n;d=a}h=W[a]>>b;W[a]-=h;F[a]+=h<<v}W[f]+=u;F[f]-=k;return d};L.apply(this,arguments);return e};function Painter(e){var t=this;this.CanvasHeight=177;this.CanvasWidth=97;this.blockSize=8;this.IDString=e;this.CanvasPreview=$("#"+e+"-preview");this.ContextPreview=this.CanvasPreview[0].getContext("2d");this.CanvasDeco=$("#"+e+"-deco");this.ContextDeco=this.CanvasDeco[0].getContext("2d");this.CanvasPF=$("#"+e+"-inactive");this.ContextPF=this.CanvasPF[0].getContext("2d");this.CanvasActive=$("#"+e+"-active");this.ContextActive=this.CanvasActive[0].getContext("2d");this.CanvasWhiteborder=$("#"+e+"-whiteborder");this.ContextWhiteborder=this.CanvasWhiteborder[0].getContext("2d");this.CanvasBackground=$("#"+e+"-background");this.ContextBackground=this.CanvasBackground[0].getContext("2d");this.CanvasBorder=$("#"+e+"-border");this.ContextBorder=this.CanvasBorder[0].getContext("2d");this.CanvasDecoPin=$("#"+e+"-decoPin");this.ContextDecoPin=this.CanvasDecoPin[0].getContext("2d");this.CanvasNextHold=$("#"+e+"-nexthold");this.ContextNextHold=this.CanvasNextHold[0].getContext("2d");this.CanvasProgressbar=$("#"+e+"-progressbar");this.ContextProgressbar=this.CanvasProgressbar[0].getContext("2d");this.CanvasControl=$("#"+e+"-control");this.ContextControl=this.CanvasControl[0].getContext("2d");this.PFOriginX=1*this.blockSize;this.PFOriginY=1*this.blockSize;this.PFOriginXAbsolute=this.CanvasPF.offset().left+this.PFOriginX-1;this.PFOriginYAbsolute=this.CanvasPF.offset().top+this.PFOriginY;this.CntrlOriginX=this.CanvasControl.offset().left;this.CntrlOriginY=this.CanvasControl.offset().top;this.CanvasControlheight=this.CanvasControl.height();this.sprite="";this.spritemini="";this.spritedeco="";this.ready=false;this.init=function(){this.spritedeco=new Image;this.sprite=new Image;this.spritemini=new Image;this.spritedeco.src="res/deco-8px.png";this.sprite.src="res/palette-8px.png";this.spritemini.src="res/palette-4px.png";this.sprite.onload=function(){t.ready=true};this.sprite.onerror=function(){t.ready=true};this.drawJoystick("all","rest");this.drawAllButtons("rest");this.drawBorder("master");this.drawGrid()};this.eraseLayer=function(e){var t;switch(e){case"decoration":Context=this.ContextDeco;break;case"inactive":Context=this.ContextPF;break;case"preview":Context=this.ContextPreview;break;case"active":Context=this.ContextActive;break;case"nexthold":Context=this.ContextNextHold;break;case"whiteborder":Context=this.ContextWhiteborder;break;case"all":Context=this.ContextPF;this.ContextDeco.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextPreview.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextActive.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextNextHold.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextWhiteborder.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);break}Context.clearRect(0,0,this.CanvasWidth,this.CanvasHeight)};this.eraseBlock=function(e,t){this.ContextPF.clearRect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)};this.eraseDeco=function(e,t){this.ContextDeco.clearRect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)};this.drawComment=function(e){$("#"+this.IDString+"-comment").val(e)};this.drawDuration=function(e){$("#"+this.IDString+"-duration").val(e)};this.drawOpacity=function(e){$("#"+this.IDString+"-active-opacity").val(e)};this.drawProgressbar=function(e,t){if(e<=t&&e>0){this.ContextProgressbar.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextProgressbar.beginPath();this.ContextProgressbar.rect(0,0,parseInt(e/t*100,10),24);this.ContextProgressbar.fillStyle="gray";this.ContextProgressbar.fill();this.ContextProgressbar.closePath()}};this.drawWhiteBorder=function(e){this.eraseLayer("whiteborder");for(var t=0,r=e.length;t<r;t++){for(var i=0,a=e[0].length;i<a;i++){if(e[t][i][0]){this.drawLocalWhiteBorder(e,t,i)}}}};this.drawLocalWhiteBorder=function(e,t,r){this.ContextWhiteborder.beginPath();if(e[t][r][0]){if(t-1>=0){if(!e[t-1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(t+1<e.length){if(!e[t+1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(t+1)*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(t+1)*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r-1>=0){if(!e[t][r-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r+1<e[0].length){if(!e[t][r+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}else{if(t-1>=0){if(e[t-1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();
this.ContextWhiteborder.fill()}}if(t+1<e.length){if(e[t+1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(t+1)*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(t+1)*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r-1>=0){if(e[t][r-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r+1<e[0].length){if(e[t][r+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}};this.drawGrid=function(){this.ContextBackground.beginPath();this.ContextBackground.beginPath();for(var e=1;e<=9;e++){this.ContextBackground.rect(this.PFOriginX+e*this.blockSize,this.PFOriginY,1,20*this.blockSize)}for(var e=1;e<=19;e++){this.ContextBackground.rect(this.PFOriginX,this.PFOriginY+e*this.blockSize,10*this.blockSize,1)}this.ContextBackground.fillStyle="#444";this.ContextBackground.fill();this.ContextBackground.closePath()};this.drawBorder=function(e){var r="#afafaf";var i="#46545f";switch(e){case"master":r="#afafaf";i="#46545f";break;case"easy":r="#afafaf";i="#475f46";break;case"death":r="#ac434a";i="#5f0004";break;default:r="#afafaf";i="#46545f";break}var a=this.ContextBorder.createRadialGradient(0,0,this.blockSize,0,0,this.CanvasWidth-2*this.blockSize),s=this.ContextBorder.createRadialGradient(this.CanvasWidth,this.CanvasHeight,this.blockSize,this.CanvasWidth,this.CanvasHeight,this.CanvasWidth-2*this.blockSize);a.addColorStop(0,r);a.addColorStop(1,i);s.addColorStop(0,r);s.addColorStop(1,i);var o=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),n=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),c=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize),h=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize);o.addColorStop(0,r);o.addColorStop(1,i);n.addColorStop(0,i);n.addColorStop(1,r);c.addColorStop(0,r);c.addColorStop(1,i);h.addColorStop(0,i);h.addColorStop(1,r);function l(e,r,i,a,s){t.ContextBorder.beginPath();t.ContextBorder.rect(e,r,i,a);t.ContextBorder.fillStyle=s;t.ContextBorder.fill();t.ContextBorder.closePath()}l(0,0,this.CanvasWidth,this.CanvasHeight,i);l(0,0,this.CanvasWidth,this.CanvasWidth,a);l(0,this.CanvasHeight-this.CanvasWidth,this.CanvasWidth,this.CanvasWidth,s);l(0,0,this.CanvasWidth,1,n);l(0,0,1,this.CanvasHeight,h);l(this.CanvasWidth-1,0,1,this.CanvasHeight,c);l(0,this.CanvasHeight-1,this.CanvasWidth,1,o);l(this.blockSize-1,this.blockSize-1,10*this.blockSize+1,1,n);l(this.blockSize+10*this.blockSize,this.blockSize-1,1,20*this.blockSize+2,c);l(this.blockSize-1,this.blockSize-1,1,20*this.blockSize+1,h);l(this.blockSize-1,this.blockSize+20*this.blockSize,10*this.blockSize+1,1,o);l(1*this.blockSize,1*this.blockSize,10*this.blockSize,20*this.blockSize,"black")};this.drawNextHold=function(e,t,r){matrix=getMatrix(t,"i",r);switch(e){case 0:this.ContextNextHold.clearRect(0,this.blockSize+3,4*this.blockSize,3*this.blockSize);if(!t){return}for(var i=0;i<4;i++){for(var a=0;a<4;a++){if(matrix[i][a]){this.drawBlock(parseInt(-1+a,10),parseInt(2+i,10),t,r,"nextholdmini")}}}break;case 1:this.ContextNextHold.clearRect(4*this.blockSize,this.blockSize,4*this.blockSize,3*this.blockSize+3);if(!t){return}for(var i=0;i<4;i++){for(var a=0;a<4;a++){if(matrix[i][a]){if(r=="SRS"){this.drawBlock(parseInt(3+a,10),parseInt(1+i,10),t,r,"nexthold")}else{this.drawBlock(parseInt(3+a,10),parseInt(0+i,10),t,r,"nexthold")}}}}break;case 2:this.ContextNextHold.clearRect(8*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);if(!t){return}for(var i=0;i<4;i++){for(var a=0;a<4;a++){if(matrix[i][a]){this.drawBlock(parseInt(13+a,10),parseInt(3+i,10),t,r,"nextholdmini")}}}break;case 3:if(!t){return}this.ContextNextHold.clearRect(10*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);for(var i=0;i<4;i++){for(var a=0;a<4;a++){if(matrix[i][a]){this.drawBlock(parseInt(17+a,10),parseInt(3+i,10),t,r,"nextholdmini")}}}break}};this.changeActiveOpacity=function(e){if(e=="Flash"||e=="flash"){this.CanvasActive.attr("style","z-index:4; opacity: 1.0")}else{this.CanvasActive.attr("style","z-index:4; opacity: "+e)}};this.drawDeco=function(e,t,r,i){if(!r){return}var a=this.spritedeco;var s,o;var n;if(i=="preview"){n=this.ContextPreview}else{n=this.ContextDeco}switch(r){case"n1":s=decoration.n1.s;o=decoration.n1.e;break;case"n2":s=decoration.n2.s;o=decoration.n2.e;break;case"n3":s=decoration.n3.s;o=decoration.n3.e;break;case"n4":s=decoration.n4.s;o=decoration.n4.e;break;case"n5":s=decoration.n5.s;o=decoration.n5.e;break;case"n6":s=decoration.n6.s;o=decoration.n6.e;break;case"n7":s=decoration.n7.s;o=decoration.n7.e;break;case"n8":s=decoration.n8.s;o=decoration.n8.e;break;case"n9":s=decoration.n9.s;o=decoration.n9.e;break;case"n0":s=decoration.n0.s;o=decoration.n0.e;break;case"smallcw":s=decoration.smallcw.s;o=decoration.smallcw.e;break;case"smallccw":s=decoration.smallccw.s;o=decoration.smallccw.e;break;case"smalloktick":s=decoration.smalloktick.s;o=decoration.smalloktick.e;break;case"smallokcircle":s=decoration.smallokcircle.s;o=decoration.smallokcircle.e;break;case"smallnocross":s=decoration.smallnocross.s;o=decoration.smallnocross.e;break;case"smallquestion":s=decoration.smallquestion.s;o=decoration.smallquestion.e;break;case"smallexclamation":s=decoration.smallexclamation.s;o=decoration.smallexclamation.e;break;case"nwarrow":s=decoration.nwarrow.s;o=decoration.nwarrow.e;break;case"narrow":s=decoration.narrow.s;o=decoration.narrow.e;break;case"nearrow":s=decoration.nearrow.s;o=decoration.nearrow.e;break;case"earrow":s=decoration.earrow.s;o=decoration.earrow.e;break;case"searrow":s=decoration.searrow.s;o=decoration.searrow.e;break;case"sarrow":s=decoration.sarrow.s;o=decoration.sarrow.e;break;case"swarrow":s=decoration.swarrow.s;o=decoration.swarrow.e;break;case"warrow":s=decoration.warrow.s;o=decoration.warrow.e;break;case"bigcw":s=decoration.bigcw.s;o=decoration.bigcw.e;break;case"bigccw":s=decoration.bigccw.s;o=decoration.bigccw.e;break;case"bigquestion":s=decoration.bigquestion.s;o=decoration.bigquestion.e;break;case"bigexclamation":s=decoration.bigexclamation.s;o=decoration.bigexclamation.e;break;case"bigoktick":s=decoration.bigoktick.s;o=decoration.bigoktick.e;break;case"bigokcircle":s=decoration.bigokcircle.s;o=decoration.bigokcircle.e;break;case"bignocross":s=decoration.bignocross.s;o=decoration.bignocross.e;break;case"overlayyellow":s=decoration.overlayyellow.s;o=decoration.overlayyellow.e;break;case"overlayblue":s=decoration.overlayblue.s;o=decoration.overlayblue.e;break;case"overlaygreen":s=decoration.overlaygreen.s;o=decoration.overlaygreen.e;break;case"overlaypink":s=decoration.overlaypink.s;o=decoration.overlaypink.e;break;case"overlayorange":s=decoration.overlayorange.s;o=decoration.overlayorange.e;break;case"clear1":s=decoration.clear1.s;o=decoration.clear1.e;break;case"clear2":s=decoration.clear2.s;o=decoration.clear2.e;break;case"clear3":s=decoration.clear3.s;o=decoration.clear3.e;break;case"clear4":s=decoration.clear4.s;o=decoration.clear4.e;break;case"clear5":s=decoration.clear5.s;o=decoration.clear5.e;break;case"clear6":s=decoration.clear6.s;o=decoration.clear6.e;break;case"clear7":s=decoration.clear7.s;o=decoration.clear7.e;break}var c=s[0]*this.blockSize;var h=s[1]*this.blockSize;var l=(o[0]-s[0])*this.blockSize;var f=(o[1]-s[1])*this.blockSize;var v=this.PFOriginX+e*this.blockSize;var d=this.PFOriginY+t*this.blockSize;if(i!="eraser"){n.clearRect(v,d,l,f);n.drawImage(a,c,h,l,f,v,d,l,f)}else{n.clearRect(v,d,l,f);this.ContextDecoPin.clearRect(v-this.blockSize/2,d-this.blockSize/2,this.blockSize,this.blockSize)}if(i!="preview"&&i!="eraser"){this.ContextDecoPin.beginPath();this.ContextDecoPin.fillStyle="red";this.ContextDecoPin.strokeStyle="red";this.ContextDecoPin.arc(v,d,this.blockSize/4,2*Math.PI,false);this.ContextDecoPin.fill();this.ContextDecoPin.lineTo(v+4,d+4);this.ContextDecoPin.stroke();this.ContextDecoPin.closePath()}};this.drawBrowserBlock=function(e,t,r,i,a,s){var o;switch(i){case"ARS":switch(r){case"I":o=ARS.I.color;spriteOffset=ARS.I.offset;break;case"T":o=ARS.T.color;spriteOffset=ARS.T.offset;break;case"L":o=ARS.L.color;spriteOffset=ARS.L.offset;break;case"J":o=ARS.J.color;spriteOffset=ARS.J.offset;break;case"S":o=ARS.S.color;spriteOffset=ARS.S.offset;break;case"Z":o=ARS.Z.color;spriteOffset=ARS.Z.offset;break;case"O":o=ARS.O.color;spriteOffset=ARS.O.offset;break;case"G":o=ARS.G.color;spriteOffset=ARS.G.offset;break}break;case"SRS":switch(r){case"I":o=SRS.I.color;spriteOffset=SRS.I.offset;break;case"T":o=SRS.T.color;spriteOffset=SRS.T.offset;break;case"L":o=SRS.L.color;spriteOffset=SRS.L.offset;break;case"J":o=SRS.J.color;spriteOffset=SRS.J.offset;break;case"S":o=SRS.S.color;spriteOffset=SRS.S.offset;break;case"Z":o=SRS.Z.color;spriteOffset=SRS.Z.offset;break;case"O":o=SRS.O.color;spriteOffset=SRS.O.offset;break;case"G":o=SRS.G.color;spriteOffset=SRS.G.offset;break}break;case"GB":switch(r){case"I":o=GB.I.color;spriteOffset=GB.I.offset;break;case"T":o=GB.T.color;spriteOffset=GB.T.offset;break;case"L":o=GB.L.color;spriteOffset=GB.L.offset;break;case"J":o=GB.J.color;spriteOffset=GB.J.offset;break;case"S":o=GB.S.color;spriteOffset=GB.S.offset;break;case"Z":o=GB.Z.color;spriteOffset=GB.Z.offset;break;case"O":o=GB.O.color;spriteOffset=GB.O.offset;break;case"G":o=GB.G.color;spriteOffset=GB.G.offset;break}break}if(s=="inactive"){if(r=="E"){$("#pf-"+a+"-row-"+t+"-col-"+e+" .inactive").attr("style","background-color: transparent;")}else{$("#pf-"+a+"-row-"+t+"-col-"+e+" .inactive").attr("style","background-color: "+o+";")}}if(s=="resetactive"){$("table div.active").attr("style","background-color: transparent;")}if(s=="active"){$("#pf-"+a+"-row-"+t+"-col-"+e+" .active").attr("style","background-color: "+o+";")}};this.drawBlock=function(e,t,r,i,a,s){if(r){var o;var n=false;switch(a){case"inactive":o=this.ContextPF;break;case"preview":o=this.ContextPreview;break;case"active":o=this.ContextActive;break;case"flash":o=this.ContextActive;break;case"nexthold":o=this.ContextNextHold;break;case"nextholdmini":o=this.ContextNextHold;n=true;break}o.beginPath();if(n){if(e>=17){o.rect(6+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*this.blockSize/2,this.blockSize/2,this.blockSize/2)}else{o.rect(5+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*this.blockSize/2,this.blockSize/2,this.blockSize/2)}}else{o.rect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)}var c;var h;var l;if(n){h=this.spritemini}else{h=this.sprite}switch(i){case"ARS":switch(r){case"I":c=ARS.I.color;l=ARS.I.offset;break;case"T":c=ARS.T.color;l=ARS.T.offset;break;case"L":c=ARS.L.color;l=ARS.L.offset;break;case"J":c=ARS.J.color;l=ARS.J.offset;break;case"S":c=ARS.S.color;l=ARS.S.offset;break;case"Z":c=ARS.Z.color;l=ARS.Z.offset;break;case"O":c=ARS.O.color;l=ARS.O.offset;break;case"G":c=ARS.G.color;l=ARS.G.offset;break}break;case"SRS":switch(r){case"I":c=SRS.I.color;l=SRS.I.offset;break;case"T":c=SRS.T.color;l=SRS.T.offset;break;case"L":c=SRS.L.color;l=SRS.L.offset;break;case"J":c=SRS.J.color;l=SRS.J.offset;break;case"S":c=SRS.S.color;l=SRS.S.offset;break;case"Z":c=SRS.Z.color;l=SRS.Z.offset;break;case"O":c=SRS.O.color;l=SRS.O.offset;break;case"G":c=SRS.G.color;l=SRS.G.offset;break}break;case"GB":switch(r){case"I":c=GB.I.color;l=GB.I.offset;break;case"T":c=GB.T.color;l=GB.T.offset;break;case"L":c=GB.L.color;l=GB.L.offset;break;case"J":c=GB.J.color;l=GB.J.offset;break;case"S":c=GB.S.color;l=GB.S.offset;break;case"Z":c=GB.Z.color;l=GB.Z.offset;break;case"O":c=GB.O.color;l=GB.O.offset;break;case"G":c=GB.G.color;l=GB.G.offset;break}break}if(a=="flash"){if(i=="ARS"){c=ARS.Flash.color;l=ARS.Flash.offset}if(i=="SRS"){c=SRS.Flash.color;l=SRS.Flash.offset}if(i=="GB"){c=GB.Flash.color;l=GB.Flash.offset}}o.fillStyle=c;o.fill();o.closePath();if(h){if(n){if(e>=17){o.drawImage(h,l[0]*(this.blockSize/2),l[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,6+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}else{o.drawImage(h,l[0]*(this.blockSize/2),l[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,5+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}}else{o.drawImage(h,l[0]*this.blockSize,l[1]*this.blockSize,this.blockSize,this.blockSize,this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)}}}};this.highlight=function(e,r){var i=this.PFOriginX+(e+.5)*this.blockSize;var a=this.PFOriginY+(r+.5)*this.blockSize;var s=20;function o(){setTimeout(function(){var e=window.requestAnimationFrame(o);if(s>0){t.ContextPreview.beginPath();t.ContextPreview.strokeStyle="rgba(255,255,255,255)";t.ContextPreview.globalCompositeOperation="destination-out";t.ContextPreview.arc(i,a,s+2,2*Math.PI,false);t.ContextPreview.arc(i,a,s+1,2*Math.PI,false);t.ContextPreview.stroke();t.ContextPreview.closePath();t.ContextPreview.beginPath();t.ContextPreview.arc(i,a,s,2*Math.PI,false);t.ContextPreview.globalCompositeOperation="source-over";t.ContextPreview.strokeStyle="white";t.ContextPreview.stroke();t.ContextPreview.closePath();s-=1}else{t.ContextPreview.beginPath();t.ContextPreview.strokeStyle="rgba(255,255,255,255)";t.ContextPreview.globalCompositeOperation="destination-out";t.ContextPreview.arc(i,a,s+2,2*Math.PI,false);t.ContextPreview.arc(i,a,s+1,2*Math.PI,false);t.ContextPreview.stroke();t.ContextPreview.closePath();window.cancelAnimationFrame(e)}},1e3/60)}};this.resetJoystick=function(){var e=this.CanvasControl.height();this.ContextControl.clearRect(0,0,e,e);this.drawJoystick("all","rest")};this.drawJoystick=function(e,r){if(e=="all"){t.drawJoystick("u","rest");t.drawJoystick("r","rest");t.drawJoystick("l","rest");t.drawJoystick("d","rest");t.drawJoystick("ul","rest");t.drawJoystick("ur","rest");t.drawJoystick("dl","rest");t.drawJoystick("dr","rest")}else{switch(e){case"u":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(2*this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/2,0);this.ContextControl.closePath();break;case"r":this.ContextControl.beginPath();this.ContextControl.moveTo(2*this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(2*this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight,this.CanvasControlheight/2);this.ContextControl.closePath();break;case"d":this.ContextControl.beginPath();this.ContextControl.moveTo(2*this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/2,this.CanvasControlheight);this.ContextControl.closePath();break;case"l":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(0,this.CanvasControlheight/2);this.ContextControl.closePath();break;case"ul":this.ContextControl.beginPath();this.ContextControl.moveTo(0+this.CanvasControlheight/8,0+this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight/4+this.CanvasControlheight/8,0+this.CanvasControlheight/8);this.ContextControl.lineTo(0+this.CanvasControlheight/8,this.CanvasControlheight/4+this.CanvasControlheight/8);this.ContextControl.closePath();break;case"ur":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight/4+this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8,0+this.CanvasControlheight/8);this.ContextControl.closePath();break;case"dr":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.closePath();break;case"dl":this.ContextControl.beginPath();this.ContextControl.moveTo(0+this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.lineTo(0+this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight/4+this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.closePath();break}switch(r){case"rest":this.ContextControl.fillStyle="#808080";break;case"pressed":this.ContextControl.fillStyle="#ff0000";break;case"holded":this.ContextControl.fillStyle="#ffa600";break}this.ContextControl.fill()}};this.drawAllButtons=function(e,t){this.drawButton("A",e);this.drawButton("B",e);this.drawButton("C",e);this.drawButton("D",e)};this.drawButton=function(e,t){var r=this.CanvasControl.height();var i=r/5;this.ContextControl.textBaseline="middle";this.ContextControl.font="bold 10px sans-serif";this.ContextControl.beginPath();switch(e){case"A":this.ContextControl.clearRect(r+r/4-i-1,r/4-i-1,2*i+2,2*i+2);this.ContextControl.arc(r+r/4,r/4,i,0,2*Math.PI,false);break;case"B":this.ContextControl.clearRect(r+r/4+2*i+r/16-i-1,r/4-i-1,2*i+2,2*i+2);this.ContextControl.arc(r+r/4+2*i+r/16,r/4,i,0,2*Math.PI,false);break;case"C":this.ContextControl.clearRect(r+r/4+4*i+2*r/16-i-1,r/4-i-1,2*i+2,2*i+2);this.ContextControl.arc(r+r/4+4*i+2*r/16,r/4,i,0,2*Math.PI,false);break;case"D":this.ContextControl.clearRect(r+r/4-i-1,3*r/4-i-1,2*i+2,2*i+2);this.ContextControl.arc(r+r/4,3*r/4,i,0,2*Math.PI,false);break}this.ContextControl.closePath();switch(t){case"pressed":this.ContextControl.fillStyle="#ff0000";break;case"holded":this.ContextControl.fillStyle="#ffa600";break;case"rest":this.ContextControl.fillStyle="#808080";break}this.ContextControl.fill();switch(e){case"A":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("A",r+r/4-r/10,r/4+1);break;case"B":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("B",r+r/4+2*i+r/16-r/10,r/4+1);break;case"C":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("C",r+r/4+4*i+2*r/16-r/10,r/4+1);break;case"D":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("H",r+r/4-r/10,3*r/4+1);break}};this.frameCount=function(t,r){$("#"+e+"-current-frame").attr("value",t);$("#"+e+"-total-frame").html(r)};this.generateNewPreviewTable=function(e,t){var r="";var i='$(this).parent().addClass("pressed");';var a='console.log("fooooo")';r+='<td "id="preview-block-'+this.IDString+"-"+e+'" class="preview-block"><table onclick="'+i+'" ondblclick="'+a+'" class="preview-table" id="'+this.IDString+"-"+e+'">';for(var s=0;s<20;s++){r+='<tr class="preview-row" id="'+this.IDString+"-"+e+"-row-"+s+'">';for(var o=0;o<10;o++){r+='<td class="preview-cell" id="'+this.IDString+"-"+e+"-row-"+s+"-col-"+o+'"><div class="active"><div class="inactive"></div></div></td>'}}r+="</table><!--"+GLOBAL_FRAME_COUNTER+' --> <input type="checkbox" class="select"> <input type="button" value="✕" class="delete actions-button" /> </div></td>';if(t){$("#browser #preview-container > td:nth-child("+parseInt(t+1,10)+")").before(r)}else{$("#browser #preview-container > td:nth-child("+parseInt(t+1,10)+")").before(r)}};this.deletePreviewTable=function(e,t){$("#browser #preview-container > td:nth-child("+parseInt(t+1,10)+")").remove()}}function Diagram(e){var t=this;this.painter=e;this.frames=[];this.current_frame=0;this.playing=false;this.init=function(){this.frames.push(new Frame(this.painter));this.painter.generateNewPreviewTable(this.frames[this.current_frame].id,this.current_frame)};this.new_frame=function(){this.current_frame++;this.painter.eraseLayer("all");this.frames.splice(this.current_frame,0,new Frame(this.painter));this.update_framecount()};this.new_copy_frame=function(){var e=this.frames[this.current_frame].print();this.new_frame();this.frames[this.current_frame].load(e,"blank")};this.remove_current_frame=function(){if(this.frames.length>1){if(this.current_frame-1>=0){this.current_frame--;this.frames.splice(this.current_frame+1,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}else{this.frames.splice(this.current_frame,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}}else{this.current_frame=0;this.frames[this.current_frame].clear("all")}};this.remove_following_frames=function(){this.frames.splice(this.current_frame+1);this.frames[this.current_frame].draw()};this.remove_all_playfields=function(){this.current_frame=this.frames.length;while(this.current_frame>0){this.remove_current_frame()}this.frames[0].clear("all");this.frames[this.current_frame].draw();this.update_framecount()};this.remove_all_playfields2=function(){this.frames.splice(1);this.frames[0].clear("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};this.goto_frame=function(e){this.painter.eraseLayer("all");this.current_frame=e;if(e==0){this.frames[this.current_frame].draw()}else{var t={border:true};this.frames[this.current_frame].draw(t)}this.update_framecount()};this.first_frame=function(){this.painter.eraseLayer("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};this.previous_frame=function(){if(this.current_frame>0){this.painter.eraseLayer("all");this.current_frame--,this.frames[this.current_frame].draw();this.update_framecount()}};this.next_frame=function(){this.painter.eraseLayer("all");this.current_frame++,this.frames[this.current_frame].draw();this.update_framecount()};this.last_frame=function(){this.painter.eraseLayer("all");this.current_frame=parseInt(this.frames.length-1,0);this.frames[this.current_frame].draw();this.update_framecount()};this.update_framecount=function(){this.painter.frameCount(this.current_frame+1,this.frames.length);this.painter.drawProgressbar(this.current_frame+1,this.frames.length)};this.print=function(){var e="";e+=this.frames[0].print();if(this.frames.length){for(var t=1,r=this.frames.length;t<r;t++){e+="+";e+=this.print_differences(t,t-1)}}return e};this.print_differences=function(e,t){var r="";var i="";if(this.frames[e].activePieceType!=this.frames[t].activePieceType||this.frames[e].activePieceOrientation!=this.frames[t].activePieceOrientation||this.frames[e].activePiecePositionX!=this.frames[t].activePiecePositionX||this.frames[e].activePiecePositionY!=this.frames[t].activePiecePositionY){if(this.frames[e].activePieceType){r+="A~"+this.frames[e].activePieceType;i=alphanumconvert(this.frames[e].activePiecePositionX);r+=i;i=alphanumconvert(this.frames[e].activePiecePositionY);r+=i+this.frames[e].activePieceOrientation+"_";i=""}else{r+="A~E_"}}var a=[];var s=true;var o=false;var n=[];var c=true;var h=false;for(var l=0;l<10;l++){for(var f=0;f<20;f++){if(this.frames[e].playfield[l][f][0]!=this.frames[t].playfield[l][f][0]){if(s){if(this.frames[e].playfield[l][f][0]){a.push([]);a[0].val=this.frames[e].playfield[l][f][0];a[0].push(alphanumconvert(l)+alphanumconvert(f));s=false}else{a.push([]);a[0].val="";a[0].push(alphanumconvert(l)+alphanumconvert(f));s=false}}else{for(var v=0,d=a.length;v<d;v++){if(this.frames[e].playfield[l][f][0]==a[v].val){if(o){o=false}else{a[v].push(alphanumconvert(l)+alphanumconvert(f));break}}else if(v==parseFloat(a.length-1)){a.push([]);a[parseFloat(v+1)].val=this.frames[e].playfield[l][f][0];a[parseFloat(v+1)].push(alphanumconvert(l)+alphanumconvert(f));o=true}}}}if(this.frames[e].playfield[l][f][1]!=this.frames[t].playfield[l][f][1]){if(c){if(this.frames[e].playfield[l][f][1]){n.push([]);n[0].val=this.frames[e].playfield[l][f][1];n[0].push(alphanumconvert(l)+alphanumconvert(f));c=false}else{n.push([]);n[0].val="";n[0].push(alphanumconvert(l)+alphanumconvert(f));c=false}}else{for(var v=0,d=n.length;v<d;v++){if(this.frames[e].playfield[l][f][1]==n[v].val){if(h){h=false}else{n[v].push(alphanumconvert(l)+alphanumconvert(f));break}}else if(v==parseFloat(n.length-1)){n.push([]);n[parseFloat(v+1)].val=this.frames[e].playfield[l][f][1];n[parseFloat(v+1)].push(alphanumconvert(l)+alphanumconvert(f));h=true}}}}}}if(a){r+="I";i="";for(var l=0,b=a.length;l<b;l++){i+="~";if(a[l].val){i+=a[l].val}else{i+="E"}for(var f=0,u=a[l].length;f<u;f++){i+=a[l][f]}}r+=i+"_"}if(n){r+="D";i="";for(var l=0,b=n.length;l<b;l++){i+="~";if(n[l].val){i+=n[l].val+"*"}else{i+="E*"}for(var f=0,u=n[l].length;f<u;f++){i+=n[l][f]}}r+=i+"_"}i="";if(this.frames[e].RS!=this.frames[t].RS){r+="R~"+this.frames[e].RS+"_"}if(this.frames[e].activePieceOpacity!=this.frames[t].activePieceOpacity){r+="O~"+this.frames[e].activePieceOpacity+"_"}if(this.frames[e].whiteborder!=this.frames[t].whiteborder){if(this.frames[e].whiteborder){r+="W~1_"}else{r+="W~0_"}}if(this.frames[e].border!=this.frames[t].border){r+="B~"+this.frames[e].border+"_"}if(this.frames[e].duration!=this.frames[t].duration){r+="T~"+parseInt(this.frames[e].duration,10)+"_"}if(this.frames[e].joystick_direction!=this.frames[t].joystick_direction||this.frames[e].joystick_state!=this.frames[t].joystick_state){switch(this.frames[e].joystick_state){case"rest":i+="r";break;case"pressed":i+="p";break;case"holded":i+="h";break}switch(this.frames[e].joystick_direction){case"u":i+="8";break;case"r":i+="6";break;case"d":i+="2";break;case"l":i+="4";break;case"c":i+="5";break;case"ul":i+="7";break;case"ur":i+="9";break;case"dr":i+="3";break;case"dl":i+="1";break}r+="J~"+i+"_";i=""}if(!this.frames[e].button_state.compare(this.frames[t].button_state)){for(var l=0,b=this.frames[e].button_state.length;l<b;l++){switch(this.frames[e].button_state[l]){case"rest":i+="r";break;case"pressed":i+="p";break;case"holded":i+="h";break}}r+="C~"+i+"_";i=""}if(!this.frames[e].nexthold.compare(this.frames[t].nexthold)){for(var l=0,b=this.frames[e].nexthold.length;l<b;l++){if(this.frames[e].nexthold[l]){i+=this.frames[e].nexthold[l]}else{i+=0}}r+="N~"+i+"_";i=""}if(this.frames[e].comment.localeCompare(this.frames[t].comment)!==0){r+="S~"+this.frames[e].comment}return r};this.load=function(e){if(!e){return}this.remove_all_playfields();this.current_frame=0;this.update_framecount();var t=e.split("+");this.frames[0].load(t[0],"blank");for(var r=1,i=t.length;r<i;r++){this.new_copy_frame();this.frames[r].load(t[r],"differences")}this.frames[this.current_frame].draw();this.update_framecount()}}var GLOBAL_FRAME_COUNTER=0;function Frame(e){GLOBAL_FRAME_COUNTER++;var t=this;this.sself=this;this.id=GLOBAL_FRAME_COUNTER;this.painter=e;this.height=20;this.width=10;this.RS="ARS";this.border="Master";this.whiteborder=false;this.playfield=[];this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.activePieceOpacity=1;this.duration=15;this.nexthold=["","","",""];this.joystick_direction="c";this.joystick_state="rest";this.button_state=["rest","rest","rest","rest","rest","rest"];this.comment="";for(var r=0,i=this.width;r<i;r++){this.playfield.push(new Array(this.height));for(var a=0,s=this.height;a<s;a++){this.playfield[r][a]=new Array(1);this.playfield[r][a][0]="";this.playfield[r][a][1]=""}}this.is_in=function(e,t){if(e<0||t<0||e>=this.width||t>=this.height){return false}return true};this.lookup=function(e,t){return this.playfield[e][t][0]};this.piece_is_in=function(e,t,r,i){var a=getMatrix(r,i,this.RS);if(i=="singleton"&&this.is_in(parseInt(e,10),parseInt(t,10))){return true}else{var s=0;for(var o=0;o<4;o++){for(var n=0;n<4;n++){if(a[o][n]&&this.is_in(parseInt(e-1+n,10),parseInt(t-1+o,10))){s++}}}if(s==4){return true}return false}};this.draw=function(e){for(var t=0,r=this.width;t<r;t++){for(var i=0,a=this.height;i<a;i++){if(this.playfield[t][i][0]){this.painter.drawBlock(t,i,this.playfield[t][i][0],this.RS,"inactive")}if(this.playfield[t][i][1]){this.painter.drawDeco(t,i,this.playfield[t][i][1],"decoration")}}}if(this.activePieceType){var s=getMatrix(this.activePieceType,this.activePieceOrientation,this.RS);for(var t=0;t<4;t++){for(var i=0;i<4;i++){if(s[t][i]){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+i,10),parseInt(this.activePiecePositionY-1+t,10),this.activePieceType,this.RS,"active");if(this.activePieceOpacity=="Flash"){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+i,10),parseInt(this.activePiecePositionY-1+t,10),this.activePieceType,this.RS,"flash")}}}}}for(var t=0,r=this.nexthold.length;t<r;t++){this.painter.drawNextHold(t,this.nexthold[t],this.RS)}if(!(e&&e["border"])){this.painter.drawBorder(this.border)}if(!(e&&e["joystick"])){this.painter.resetJoystick();this.painter.drawJoystick(this.joystick_direction,this.joystick_state)}if(!(e&&e["buttons"])){this.painter.drawButton("A",this.button_state[0]);this.painter.drawButton("B",this.button_state[1]);this.painter.drawButton("C",this.button_state[2]);this.painter.drawButton("D",this.button_state[3])}this.painter.drawComment(this.comment);this.painter.drawDuration(this.duration);this.painter.drawOpacity(this.activePieceOpacity);this.painter.changeActiveOpacity(this.activePieceOpacity);this.painter.eraseLayer("whiteborder");if(this.whiteborder){this.painter.drawWhiteBorder(this.playfield)}};this.print=function(){var e="";var t="";if(this.activePieceType){e+="A~"+this.activePieceType;t=alphanumconvert(this.activePiecePositionX);e+=t;t=alphanumconvert(this.activePiecePositionY);e+=t+this.activePieceOrientation+"_";t=""}if(this.RS!="ARS"){e+="R~"+this.RS+"_"}if(this.activePieceOpacity!=1){e+="O~"+this.activePieceOpacity+"_"}if(this.border!="Master"){e+="B~"+this.border+"_"}if(this.duration!=15){e+="T~"+this.duration+"_"}switch(this.joystick_state){case"rest":t+="r";break;case"pressed":t+="p";break;case"holded":t+="h";break}switch(this.joystick_direction){case"u":t+="8";break;case"r":t+="6";break;case"d":t+="2";break;case"l":t+="4";break;case"c":t+="5";break;case"ul":t+="7";break;case"ur":t+="9";break;case"dr":t+="3";break;case"dl":t+="1";break}e+="J~"+t+"_";t="";for(var r=0,i=this.button_state.length;r<i;r++){switch(this.button_state[r]){case"rest":t+="r";break;case"pressed":t+="p";break;case"holded":t+="h";break}}e+="C~"+t+"_";t="";if(this.comment){e+="S~"+this.comment+"_"}if(this.whiteborder){e+="W~1_"}if(this.nexthold.length){for(var r=0,i=this.nexthold.length;r<i;r++){if(this.nexthold[r]){t+=this.nexthold[r]
}else{t+=0}}e+="N~"+t+"_";t=""}var a=[];var s=[];var o=true;var n=true;for(var r=0;r<10;r++){for(var c=0;c<20;c++){if(this.playfield[r][c][0]){if(o){a.push([]);a[0].val=this.playfield[r][c][0];a[0].push(alphanumconvert(r)+alphanumconvert(c));o=false}else{for(var h=0,l=a.length;h<l;h++){if(this.playfield[r][c][0]==a[h].val){a[h].push(alphanumconvert(r)+alphanumconvert(c));break}else if(h==parseFloat(a.length-1)){a.push([]);a[parseFloat(h+1)].val=this.playfield[r][c][0];a[parseFloat(h+1)].push(alphanumconvert(r)+alphanumconvert(c))}}}}if(this.playfield[r][c][1]){if(n){s.push([]);s[0].val=this.playfield[r][c][1];s[0].push(alphanumconvert(r)+alphanumconvert(c));n=false}else{for(var h=0,l=s.length;h<l;h++){if(this.playfield[r][c][1]==s[h].val){s[h].push(alphanumconvert(r)+alphanumconvert(c));break}else if(h==parseFloat(s.length-1)){s.push([]);s[parseFloat(h+1)].val=this.playfield[r][c][1];s[parseFloat(h+1)].push(alphanumconvert(r)+alphanumconvert(c))}}}}}}if(a.length){e+="I~";for(var r=0,i=a.length;r<i;r++){t+=a[r].val;for(var c=0,f=a[r].length;c<f;c++){t+=a[r][c]}if(r<a.length-1){t+="~"}}e+=t+"_"}t="";if(s.length){e+="D~";for(var r=0,i=s.length;r<i;r++){t+=s[r].val+"*";for(var c=0,f=s[r].length;c<f;c++){t+=s[r][c]}if(r<s.length-1){t+="~"}}e+=t+"_"}t="";return e};this.load=function(e,t){if(t!="differences"){this.clear("all")}if(!e){return}var r=e.split("_");for(var i=0,a=r.length;i<a;i++){var s=r[i].split("~");switch(s[0]){case"A":if(s[1].charAt(0)!=="E"){this.activePieceType=s[1].charAt(0);this.activePieceOrientation=s[1].slice(3);this.activePiecePositionX=alphanumconvert(s[1].charAt(1));this.activePiecePositionY=alphanumconvert(s[1].charAt(2))}else{this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY=""}break;case"I":for(var o=1,n=s.length;o<n;o++){var c=s[o].charAt(0);if(c=="E"){c=""}for(var h=1,l=s[o].length;h<l;h+=2){var f=s[o].charAt(h);var v=s[o].charAt(h+1);this.modify(alphanumconvert(f),alphanumconvert(v),c)}}break;case"D":for(var o=1,n=s.length;o<n;o++){var d=s[o].split("*");var c=d[0];if(c=="E"){c=""}if(s[1]!==""){for(var h=0,l=d[1].length;h<l;h+=2){var b=d[1].charAt(h);var u=d[1].charAt(h+1);this.modify_decoration(alphanumconvert(b),alphanumconvert(u),c)}}}break;case"R":this.RS=s[1];break;case"O":this.activePieceOpacity=s[1];break;case"N":for(var h=0,l=s[1].length;h<l;h++){if(s[1].charAt(h)!="0"){this.nexthold[h]=s[1].charAt(h)}else{this.nexthold[h]=""}}break;case"S":this.comment=s[1];break;case"W":this.whiteborder=s[1];break;case"T":this.duration=s[1];break;case"B":this.border=s[1];break;case"J":var k,w;switch(s[1].charAt(0)){case"r":k="rest";break;case"p":k="pressed";break;case"h":k="holded";break}switch(s[1].charAt(1)){case"8":w="u";break;case"6":w="r";break;case"2":w="d";break;case"4":w="l";break;case"7":w="ul";break;case"5":w="c";break;case"9":w="ur";break;case"3":w="dr";break;case"1":w="dl";break}this.modify_control(w,k);break;case"C":for(var h=0,l=s[1].length;h<=l;h++){var C;switch(s[1].charAt(h)){case"r":C="rest";break;case"h":C="holded";break;case"p":C="pressed";break}switch(h){case 0:this.modify_button("A",C);break;case 1:this.modify_button("B",C);break;case 2:this.modify_button("C",C);break;case 3:this.modify_button("D",C);break}}break}}};this.clear=function(e){switch(e){case"inactive":this.painter.eraseLayer("inactive");for(var t=0,r=this.width;t<r;t++){for(var i=0,a=this.height;i<a;i++){this.playfield[t][i][0]=""}}break;case"active":this.painter.eraseLayer("active");this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";break;case"decoration":this.painter.eraseLayer("decoration");for(var t=0,r=this.width;t<r;t++){for(var i=0,a=this.height;i<a;i++){this.playfield[t][i][1]=""}}break;case"all":this.painter.eraseLayer("inactive");this.painter.eraseLayer("active");this.painter.eraseLayer("decoration");for(var t=0,r=this.width;t<r;t++){for(var i=0,a=this.height;i<a;i++){this.playfield[t][i][0]="";this.playfield[t][i][1]=""}}this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.comment="";break}};this.is_piece_colliding=function(e,t,r,i){var a=getMatrix(r,i,this.RS);var s="",o="";for(var n=0;n<4;n++){for(var c=0;c<4;c++){if(a[n][c]){}if(a[n][c]&&!this.is_in(parseInt(e-1+c,10),parseInt(t-1+n,10))){return true}if(a[n][c]&&this.is_in(parseInt(e-1+c,10),parseInt(t-1+n,10))&&this.playfield[parseInt(e-1+c,10)][parseInt(t+n-1,10)][0]){return true}}}return false};this.addPiece=function(e,t,r,i,a,s){var o=getMatrix(r,i,this.RS);var n=true;var c=0;while(s&n){c=0;if(this.is_piece_colliding(parseInt(e),parseInt(t),r,i)){n=false}else{t++}}if(s){t--}if(a=="inactive"||a=="garbage"){this.painter.CanvasPreview.attr("width",this.painter.CanvasPreview.width())}if(a=="active"){this.activePieceType=r;this.activePieceOrientation=i;this.activePiecePositionX=e;this.activePiecePositionY=t;this.painter.CanvasActive.attr("width",this.painter.CanvasPreview.width());this.painter.drawBrowserBlock(parseInt(e,10),parseInt(t,10),r,this.RS,this.id,"resetactive")}if(a=="decoration-preview"){this.painter.drawDeco(e,t,r,"preview")}else if(a=="decoration"){this.modify_decoration(e,t,r);this.painter.drawDeco(e,t,r,"decoration");this.painter.highlight(e,t)}else{for(var h=0;h<4;h++){for(var l=0;l<4;l++){if(o[h][l]&&this.piece_is_in(e,t,r,i)){switch(a){case"inactive":this.modify(parseInt(e-1+l,10),parseInt(t-1+h,10),r);this.painter.drawBlock(parseInt(e-1+l,10),parseInt(t-1+h,10),r,this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e-1+l,t-1+h)}this.painter.highlight(e-1+l,t-1+h);break;case"garbage":this.modify(parseInt(e-1+l,10),parseInt(t-1+h,10),"G");this.painter.drawBlock(parseInt(e-1+l,10),parseInt(t-1+h,10),"G",this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e-1+l,t-1+h)}this.painter.highlight(e-1+l,t-1+h);break;case"preview":this.painter.drawBlock(parseInt(e-1+l,10),parseInt(t-1+h,10),r,this.RS,"preview");break;case"active":this.painter.drawBlock(parseInt(e-1+l,10),parseInt(t-1+h,10),r,this.RS,"active");this.painter.highlight(e-1+l,t-1+h);this.painter.drawBrowserBlock(parseInt(e-1+l,10),parseInt(t-1+h,10),r,this.RS,this.id,"active");break;case"erase":this.removeBlock(parseInt(e-1+l,10),parseInt(t-1+h,10));this.painter.highlight(e-1+l,t-1+h);this.painter.drawBrowserBlock(parseInt(e-1+l,10),parseInt(t-1+h,10),"E",this.RS,this.id,"inactive");break;case"preview-eraser":this.painter.drawBlock(parseInt(e-1+l,10),parseInt(t-1+h,10),"G",this.RS,"preview");break}}}}}};this.modify=function(e,t,r){if(r=="E"){this.playfield[e][t][0]=""}else{this.playfield[e][t][0]=r}};Frame.prototype.modify_decoration=function(e,t,r){this.playfield[e][t][1]=r};this.modify_control=function(e,t){this.joystick_state=t;this.joystick_direction=e};this.modify_button=function(e,t){var r="";switch(e){case"A":r=0;break;case"B":r=1;break;case"C":r=2;break;case"D":r=3;break}this.button_state[r]=t}}var ARS={I:{color:"red",offset:[2,1],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],ccw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"cyan",offset:[6,1],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,1],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,1],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"magenta",offset:[8,0],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"green",offset:[5,1],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,1],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var SRS={I:{color:"cyan",offset:[6,2],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,2],i:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,2],i:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],ccw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,2],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"green",offset:[5,2],i:[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"purple",offset:[8,2],i:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"red",offset:[2,2],i:[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var GB={I:{color:"yellowgreen",offset:[6,9],i:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"yellowgreen",offset:[1,9],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],u:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"yellowgreen",offset:[3,9],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellowgreen",offset:[4,9],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"yellowgreen",offset:[5,9],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"yellowgreen",offset:[8,9],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"yellowgreen",offset:[2,9],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var decoration={n1:{s:[0,0],e:[1,1]},n2:{s:[1,0],e:[2,1]},n3:{s:[2,0],e:[3,1]},n4:{s:[3,0],e:[4,1]},n5:{s:[4,0],e:[5,1]},n6:{s:[5,0],e:[6,1]},n7:{s:[6,0],e:[7,1]},n8:{s:[7,0],e:[8,1]},n9:{s:[8,0],e:[9,1]},n0:{s:[9,0],e:[10,1]},smallccw:{s:[0,1],e:[1,2]},smallcw:{s:[1,1],e:[2,2]},smalloktick:{s:[2,1],e:[3,2]},smallokcircle:{s:[3,1],e:[4,2]},smallnocross:{s:[4,1],e:[5,2]},smallquestion:{s:[5,1],e:[6,2]},smallexclamation:{s:[6,1],e:[7,2]},nwarrow:{s:[0,2],e:[1,3]},narrow:{s:[1,2],e:[2,3]},nearrow:{s:[2,2],e:[3,3]},warrow:{s:[0,3],e:[1,4]},earrow:{s:[2,3],e:[3,4]},swarrow:{s:[0,4],e:[1,5]},sarrow:{s:[1,4],e:[2,5]},searrow:{s:[2,4],e:[3,5]},bigcw:{s:[3,2],e:[5,4]},bigccw:{s:[5,2],e:[7,4]},bigquestion:{s:[7,2],e:[9,4]},bigexclamation:{s:[9,2],e:[10,4]},bigoktick:{s:[3,4],e:[5,6]},bigokcircle:{s:[5,4],e:[7,6]},bignocross:{s:[7,4],e:[9,6]},overlayyellow:{s:[1,6],e:[2,7]},overlayblue:{s:[2,6],e:[3,7]},overlaygreen:{s:[3,6],e:[4,7]},overlaypink:{s:[4,6],e:[5,7]},overlayorange:{s:[5,6],e:[6,7]},clear1:{s:[0,7],e:[10,8]},clear2:{s:[0,8],e:[10,9]},clear3:{s:[0,9],e:[10,10]},clear4:{s:[0,10],e:[10,11]},clear5:{s:[0,11],e:[10,12]},clear6:{s:[0,12],e:[10,13]},clear7:{s:[0,13],e:[10,14]}};function getMatrix(e,t,r){var i;switch(r){case"ARS":switch(e){case"I":switch(t){case"i":i=ARS.I.i;break;case"cw":i=ARS.I.cw;break;case"ccw":i=ARS.I.ccw;break;case"u":i=ARS.I.u;break;case"singleton":i=ARS.I.singleton;break}break;case"T":switch(t){case"i":i=ARS.T.i;break;case"cw":i=ARS.T.cw;break;case"ccw":i=ARS.T.ccw;break;case"u":i=ARS.T.u;break;case"singleton":i=ARS.T.singleton;break}break;case"L":switch(t){case"i":i=ARS.L.i;break;case"cw":i=ARS.L.cw;break;case"ccw":i=ARS.L.ccw;break;case"u":i=ARS.L.u;break;case"singleton":i=ARS.L.singleton;break}break;case"J":switch(t){case"i":i=ARS.J.i;break;case"cw":i=ARS.J.cw;break;case"ccw":i=ARS.J.ccw;break;case"u":i=ARS.J.u;break;case"singleton":i=ARS.J.singleton;break}break;case"S":switch(t){case"i":i=ARS.S.i;break;case"cw":i=ARS.S.cw;break;case"ccw":i=ARS.S.ccw;break;case"u":i=ARS.S.u;break;case"singleton":i=ARS.J.singleton;break}break;case"Z":switch(t){case"i":i=ARS.Z.i;break;case"cw":i=ARS.Z.cw;break;case"ccw":i=ARS.Z.ccw;break;case"u":i=ARS.Z.u;break;case"singleton":i=ARS.Z.singleton;break}break;case"O":switch(t){case"i":i=ARS.O.i;break;case"cw":i=ARS.O.cw;break;case"ccw":i=ARS.O.ccw;break;case"u":i=ARS.O.u;break;case"singleton":i=ARS.O.singleton;break}break;case"G":switch(t){case"i":i=ARS.G.i;break;case"cw":i=ARS.G.cw;break;case"ccw":i=ARS.G.ccw;break;case"u":i=ARS.G.u;break;case"singleton":i=ARS.G.singleton;break}break}break;case"SRS":switch(e){case"I":switch(t){case"i":i=SRS.I.i;break;case"cw":i=SRS.I.cw;break;case"ccw":i=SRS.I.ccw;break;case"u":i=SRS.I.u;break;case"singleton":i=SRS.I.singleton;break}break;case"T":switch(t){case"i":i=SRS.T.i;break;case"cw":i=SRS.T.cw;break;case"ccw":i=SRS.T.ccw;break;case"u":i=SRS.T.u;break;case"singleton":i=SRS.T.singleton;break}break;case"L":switch(t){case"i":i=SRS.L.i;break;case"cw":i=SRS.L.cw;break;case"ccw":i=SRS.L.ccw;break;case"u":i=SRS.L.u;break;case"singleton":i=SRS.L.singleton;break}break;case"J":switch(t){case"i":i=SRS.J.i;break;case"cw":i=SRS.J.cw;break;case"ccw":i=SRS.J.ccw;break;case"u":i=SRS.J.u;break;case"singleton":i=SRS.J.singleton;break}break;case"S":switch(t){case"i":i=SRS.S.i;break;case"cw":i=SRS.S.cw;break;case"ccw":i=SRS.S.ccw;break;case"u":i=SRS.S.u;break;case"singleton":i=SRS.S.singleton;break}break;case"Z":switch(t){case"i":i=SRS.Z.i;break;case"cw":i=SRS.Z.cw;break;case"ccw":i=SRS.Z.ccw;break;case"u":i=SRS.Z.u;break;case"singleton":i=SRS.Z.singleton;break}break;case"O":switch(t){case"i":i=SRS.O.i;break;case"cw":i=SRS.O.cw;break;case"ccw":i=SRS.O.ccw;break;case"u":i=SRS.O.u;break;case"singleton":i=SRS.O.singleton;break}break;case"G":switch(t){case"i":i=SRS.G.i;break;case"cw":i=SRS.G.cw;break;case"ccw":i=SRS.G.ccw;break;case"u":i=SRS.G.u;break;case"singleton":i=SRS.G.singleton;break}break}break;case"GB":switch(e){case"I":switch(t){case"i":i=GB.I.i;break;case"cw":i=GB.I.cw;break;case"ccw":i=GB.I.ccw;break;case"u":i=GB.I.u;break;case"singleton":i=GB.I.singleton;break}break;case"T":switch(t){case"i":i=GB.T.i;break;case"cw":i=GB.T.cw;break;case"ccw":i=GB.T.ccw;break;case"u":i=GB.T.u;break;case"singleton":i=GB.T.singleton;break}break;case"L":switch(t){case"i":i=GB.L.i;break;case"cw":i=GB.L.cw;break;case"ccw":i=GB.L.ccw;break;case"u":i=GB.L.u;break;case"singleton":i=GB.L.singleton;break}break;case"J":switch(t){case"i":i=GB.J.i;break;case"cw":i=GB.J.cw;break;case"ccw":i=GB.J.ccw;break;case"u":i=GB.J.u;break;case"singleton":i=GB.J.singleton;break}break;case"S":switch(t){case"i":i=GB.S.i;break;case"cw":i=GB.S.cw;break;case"ccw":i=GB.S.ccw;break;case"u":i=GB.S.u;break;case"singleton":i=GB.S.singleton;break}break;case"Z":switch(t){case"i":i=GB.Z.i;break;case"cw":i=GB.Z.cw;break;case"ccw":i=GB.Z.ccw;break;case"u":i=GB.Z.u;break;case"singleton":i=GB.Z.singleton;break}break;case"O":switch(t){case"i":i=GB.O.i;break;case"cw":i=GB.O.cw;break;case"ccw":i=GB.O.ccw;break;case"u":i=GB.O.u;break;case"singleton":i=GB.O.singleton;break}break;case"G":switch(t){case"i":i=GB.G.i;break;case"cw":i=GB.G.cw;break;case"ccw":i=GB.G.ccw;break;case"u":i=GB.G.u;break;case"singleton":i=GB.G.singleton;break}break}break}return i}function alphanumconvert(e){var t;switch(e){case"a":t=0;break;case"b":t=1;break;case"c":t=2;break;case"d":t=3;break;case"e":t=4;break;case"f":t=5;break;case"g":t=6;break;case"h":t=7;break;case"i":t=8;break;case"j":t=9;break;case"k":t=10;break;case"l":t=11;break;case"m":t=12;break;case"n":t=13;break;case"o":t=14;break;case"p":t=15;break;case"q":t=16;break;case"r":t=17;break;case"s":t=18;break;case"t":t=19;break;case"z":t=-1;break;case-1:t="z";break;case 0:t="a";break;case 1:t="b";break;case 2:t="c";break;case 3:t="d";break;case 4:t="e";break;case 5:t="f";break;case 6:t="g";break;case 7:t="h";break;case 8:t="i";break;case 9:t="j";break;case 10:t="k";break;case 11:t="l";break;case 12:t="m";break;case 13:t="n";break;case 14:t="o";break;case 15:t="p";break;case 16:t="q";break;case 17:t="r";break;case 18:t="s";break;case 19:t="t";break}return t}(function(){var e=0;var t=["ms","moz","webkit","o"];for(var r=0,i=t.length;r<i&&!window.requestAnimationFrame;++r){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t,r){var i=(new Date).getTime();var a=Math.max(0,16-(i-e));var s=window.setTimeout(function(){t(i+a)},a);e=i+a;return s}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){clearTimeout(e)}}})();Array.prototype.compare=function(e){if(this.length!=e.length){return false}for(var t=0,r=e.length;t<r;t++){if(this[t].compare){if(!this[t].compare(e[t])){return false}}if(this[t]!==e[t]){return false}}return true};$(document).ready(function(){$("#tomtom").data("tedigecode",window.location.search)});Diagram.prototype.flate_encode=function(e){return $.base64.encode(RawDeflate.deflate(unescape(encodeURIComponent(e))))};Diagram.prototype.flate_decode=function(e){return decodeURIComponent(escape(RawDeflate.inflate($.base64.decode(e))))};$(document).ready(function(){var e=[];var t=[];$(".tedige-playfield-wrapper").each(function(r){var i=$(this).attr("id");var a=0;var s=[];s[a++]='	<div class="left-pane">';s[a++]='		<div class="nexthold-container">';s[a++]='			<canvas id="'+i+'-nexthold-background"	width="97" height="32" style="z-index:0;"></canvas>';s[a++]='			<canvas id="'+i+'-nexthold"	width="97" height="32" style="z-index:1;"></canvas>';s[a++]="		</div>";s[a++]='		<div class="canvas-container" id="'+i+'-container border-gray">';s[a++]='			<canvas id="'+i+'-border"		width="97" height="177" style="z-index:0;background-color: black"></canvas>';s[a++]='			<canvas id="'+i+'-background"	width="97" height="177" style="z-index:1;//background-color: black"></canvas>';s[a++]='			<canvas id="'+i+'-inactive"	 width="97" height="177" style="z-index:2; border:none; opacity: 0.65"></canvas>';s[a++]='			<canvas id="'+i+'-whiteborder" width="97" height="177" style="z-index:3"></canvas>';s[a++]='			<canvas id="'+i+'-active"		width="97" height="177" style="z-index:4"></canvas>';s[a++]='			<canvas id="'+i+'-deco"			width="97" height="177" style="z-index:5"></canvas>';s[a++]='			<canvas id="'+i+'-decoPin"	 width="97" height="177" style="z-index:6; border:none; opacity: 0.65;display:none"></canvas>';s[a++]='			<canvas id="'+i+'-preview"		width="97" height="177" style="z-index:6"></canvas>';s[a++]="		</div>";s[a++]='		<div class="control-div">';s[a++]='		<canvas class="canvas-control" id="'+i+'-control" width="97" height="35" style=""></canvas>';s[a++]="		</div>";s[a++]="		</div>";s[a++]='		<div class="right-pane">';s[a++]='		<div class="progressbar">';s[a++]="			<p>";s[a++]='				<input class="current-frame" id="'+i+'-current-frame" type="text" style="width: 2.5em; text-align:center" /> / <span id="'+i+'-total-frame">1</span>';s[a++]="			</p>";s[a++]='			<canvas id="'+i+'-progressbar" width="97" height="24" style="border: 1px solid white;" />';s[a++]="		</div>";s[a++]='		<div id="order-control"> ';s[a++]='			<input class="cmd_prev" id="'+i+'-cmd_prev"	value="◄"	type="button" />';s[a++]='			<input class="cmd_next" id="'+i+'-cmd_next"	value="►"	type="button" /><br />';s[a++]='			<input class="cmd_first" id="'+i+'-cmd_first" value="|◄" type="button"/>';s[a++]='			<input class="cmd_last" id="'+i+'-cmd_last" value="►|" type="button"	style="width:2.5em"/><br />';s[a++]='			<input class="cmd_playpause" id="'+i+'-cmd_playpause" value ="▷" type="button" style="width:2.5em" /><br />';s[a++]='			<input class="check-loop" id="'+i+'-loop"type="checkbox"> loop';s[a++]="		</div>";s[a++]='		<div class="links">';s[a++]='			<a class="Link2Editor" href="">[Edit]</a>';s[a++]="		</div>";s[a++]="	</div>";s[a++]='	<div id="under">';s[a++]='		<textarea readonly="" id="'+i+'-comment" class="comment"></textarea>';s[a++]="	</div>";$("#"+i).html(s.join("\n"));t[i]=new Painter(i);e[i]=new Diagram(t[i]);e[i].init();t[i].init()});$(".tedige-playfield-wrapper").each(function(r){var i=$(this).attr("id");var a=setInterval(function(){if(t[i].ready){clearInterval(a);var r=$("#"+i).data("tedigecode");if(r){console.log($("#"+i).find(".Link2Editor"));$("#"+i).find(".Link2Editor").attr("href","http://petitprince.github.com/TeDiGe-2/editor.html?"+r);var s=r.split("-");switch(s[1]){case"all":e[i].load(e[i].flate_decode(s[2]));e[i].frames[e[i].current_frame].draw();break;case"current":e[i].frames[e[i].current_frame].load(e[i].flate_decode(s[2]));e[i].frames[e[i].current_frame].draw();break}e[i].first_frame()}}},10)});$(".cmd_playpause").click(function(){var t=e[$(this).attr("id").split("-")[0]];var r=t.current_frame;var i=t.frames.length;if(t.playing){t.playing=false;$("#pf-cmd_playpause").attr("value","▷")}else{t.playing=true;$("#pf-cmd_playpause").attr("value","||")}var a=0;function s(){if(r<i&&t.playing){if(a<t.frames[t.current_frame].duration){t.goto_frame(r);a++}else{a=0;r++}requestAnimationFrame(s)}else if($("#"+t.painter.IDString+"-loop").is(":checked")){r=0;requestAnimationFrame(s)}}s()});$(".current-frame").blur(function(){if($("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()>0&&$("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()<=e[$(this).attr("id").split("-")[0]].frames.length){e[$(this).attr("id").split("-")[0]].goto_frame($("#tomtom-current-frame").val())}});$(".cmd_first").click(function(){e[$(this).attr("id").split("-")[0]].first_frame()});$(".cmd_prev").click(function(){e[$(this).attr("id").split("-")[0]].previous_frame()});$(".cmd_next").click(function(){if(e[$(this).attr("id").split("-")[0]].current_frame<e[$(this).attr("id").split("-")[0]].frames.length-1){e[$(this).attr("id").split("-")[0]].next_frame()}});$(".cmd_last").click(function(){e[$(this).attr("id").split("-")[0]].last_frame()})});
=======
(function(){var e=32768;var t=0;var r=1;var a=2;var i=9;var s=6;var o=32768;var n=64;var c;var l;var h=null;var f;var v,d;var b;var u;var k;var w;var p;var m;var g,S;var y,C;var x;var P;var _=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);var R=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0);var A=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99);var B=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577);var z=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var I=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var O=function(){this.next=null;this.list=null};var F=function(){this.e=0;this.b=0;this.n=0;this.t=null};var W=function(e,t,r,a,i,s){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;{var o;var n=new Array(this.BMAX+1);var c;var l;var h;var f;var v;var d;var b;var u=new Array(this.BMAX+1);var k;var w;var p;var m=new F;var g=new Array(this.BMAX);var S=new Array(this.N_MAX);var y;var C=new Array(this.BMAX+1);var x;var P;var _;var R;var A;A=this.root=null;for(v=0;v<n.length;v++)n[v]=0;for(v=0;v<u.length;v++)u[v]=0;for(v=0;v<g.length;v++)g[v]=null;for(v=0;v<S.length;v++)S[v]=0;for(v=0;v<C.length;v++)C[v]=0;c=t>256?e[256]:this.BMAX;k=e;w=0;v=t;do{n[k[w]]++;w++}while(--v>0);if(n[0]==t){this.root=null;this.m=0;this.status=0;return}for(d=1;d<=this.BMAX;d++)if(n[d]!=0)break;b=d;if(s<d)s=d;for(v=this.BMAX;v!=0;v--)if(n[v]!=0)break;h=v;if(s>v)s=v;for(P=1<<d;d<v;d++,P<<=1)if((P-=n[d])<0){this.status=2;this.m=s;return}if((P-=n[v])<0){this.status=2;this.m=s;return}n[v]+=P;C[1]=d=0;k=n;w=1;x=2;while(--v>0)C[x++]=d+=k[w++];k=e;w=0;v=0;do{if((d=k[w++])!=0)S[C[d]++]=v}while(++v<t);t=C[h];C[0]=v=0;k=S;w=0;f=-1;y=u[0]=0;p=null;_=0;for(;b<=h;b++){o=n[b];while(o-->0){while(b>y+u[1+f]){y+=u[1+f];f++;_=(_=h-y)>s?s:_;if((l=1<<(d=b-y))>o+1){l-=o+1;x=b;while(++d<_){if((l<<=1)<=n[++x])break;l-=n[x]}}if(y+d>c&&y<c)d=c-y;_=1<<d;u[1+f]=d;p=new Array(_);for(R=0;R<_;R++){p[R]=new F}if(A==null)A=this.root=new O;else A=A.next=new O;A.next=null;A.list=p;g[f]=p;if(f>0){C[f]=v;m.b=u[f];m.e=16+d;m.t=p;d=(v&(1<<y)-1)>>y-u[f];g[f-1][d].e=m.e;g[f-1][d].b=m.b;g[f-1][d].n=m.n;g[f-1][d].t=m.t}}m.b=b-y;if(w>=t)m.e=99;else if(k[w]<r){m.e=k[w]<256?16:15;m.n=k[w++]}else{m.e=i[k[w]-r];m.n=a[k[w++]-r]}l=1<<b-y;for(d=v>>y;d<_;d+=l){p[d].e=m.e;p[d].b=m.b;p[d].n=m.n;p[d].t=m.t}for(d=1<<b-1;(v&d)!=0;d>>=1)v^=d;v^=d;while((v&(1<<y)-1)!=C[f]){y-=u[f];f--}}}this.m=u[1];this.status=P!=0&&h!=1?1:0}};var G=function(){if(x.length==P)return-1;return x.charCodeAt(P++)&255};var D=function(e){while(u<e){b|=G()<<u;u+=8}};var T=function(e){return b&_[e]};var L=function(e){b>>=e;u-=e};var X=function(t,r,a){var i;var s;var o;if(a==0)return 0;o=0;for(;;){D(y);s=g.list[T(y)];i=s.e;while(i>16){if(i==99)return-1;L(s.b);i-=16;D(i);s=s.t[T(i)];i=s.e}L(s.b);if(i==16){l&=e-1;t[r+o++]=c[l++]=s.n;if(o==a)return a;continue}if(i==15)break;D(i);p=s.n+T(i);L(i);D(C);s=S.list[T(C)];i=s.e;while(i>16){if(i==99)return-1;L(s.b);i-=16;D(i);s=s.t[T(i)];i=s.e}L(s.b);D(i);m=l-s.n-T(i);L(i);while(p>0&&o<a){p--;m&=e-1;l&=e-1;t[r+o++]=c[l++]=c[m++]}if(o==a)return a}k=-1;return o};var $=function(t,r,a){var i;i=u&7;L(i);D(16);i=T(16);L(16);D(16);if(i!=(~b&65535))return-1;L(16);p=i;i=0;while(p>0&&i<a){p--;l&=e-1;D(8);t[r+i++]=c[l++]=T(8);L(8)}if(p==0)k=-1;return i};var J=function(e,t,r){if(h==null){var a;var i=new Array(288);var s;for(a=0;a<144;a++)i[a]=8;for(;a<256;a++)i[a]=9;for(;a<280;a++)i[a]=7;for(;a<288;a++)i[a]=8;v=7;s=new W(i,288,257,R,A,v);if(s.status!=0){alert("HufBuild error: "+s.status);return-1}h=s.root;v=s.m;for(a=0;a<30;a++)i[a]=5;zip_fixed_bd=5;s=new W(i,30,0,B,z,zip_fixed_bd);if(s.status>1){h=null;alert("HufBuild error: "+s.status);return-1}f=s.root;zip_fixed_bd=s.m}g=h;S=f;y=v;C=zip_fixed_bd;return X(e,t,r)};var Y=function(e,t,r){var a;var o;var n;var c;var l;var h;var f;var v;var d=new Array(286+30);var b;for(a=0;a<d.length;a++)d[a]=0;D(5);f=257+T(5);L(5);D(5);v=1+T(5);L(5);D(4);h=4+T(4);L(4);if(f>286||v>30)return-1;for(o=0;o<h;o++){D(3);d[I[o]]=T(3);L(3)}for(;o<19;o++)d[I[o]]=0;y=7;b=new W(d,19,19,null,null,y);if(b.status!=0)return-1;g=b.root;y=b.m;c=f+v;a=n=0;while(a<c){D(y);l=g.list[T(y)];o=l.b;L(o);o=l.n;if(o<16)d[a++]=n=o;else if(o==16){D(2);o=3+T(2);L(2);if(a+o>c)return-1;while(o-->0)d[a++]=n}else if(o==17){D(3);o=3+T(3);L(3);if(a+o>c)return-1;while(o-->0)d[a++]=0;n=0}else{D(7);o=11+T(7);L(7);if(a+o>c)return-1;while(o-->0)d[a++]=0;n=0}}y=i;b=new W(d,f,257,R,A,y);if(y==0)b.status=1;if(b.status!=0){if(b.status==1);return-1}g=b.root;y=b.m;for(a=0;a<v;a++)d[a]=d[a+f];C=s;b=new W(d,v,0,B,z,C);S=b.root;C=b.m;if(C==0&&f>257){return-1}if(b.status==1){}if(b.status!=0)return-1;return X(e,t,r)};var j=function(){var t;if(c==null)c=new Array(2*e);l=0;b=0;u=0;k=-1;w=false;p=m=0;g=null};var Z=function(r,a,i){var s,o;s=0;while(s<i){if(w&&k==-1)return s;if(p>0){if(k!=t){while(p>0&&s<i){p--;m&=e-1;l&=e-1;r[a+s++]=c[l++]=c[m++]}}else{while(p>0&&s<i){p--;l&=e-1;D(8);r[a+s++]=c[l++]=T(8);L(8)}if(p==0)k=-1}if(s==i)return s}if(k==-1){if(w)break;D(1);if(T(1)!=0)w=true;L(1);D(2);k=T(2);L(2);g=null;p=0}switch(k){case 0:o=$(r,a+s,i-s);break;case 1:if(g!=null)o=X(r,a+s,i-s);else o=J(r,a+s,i-s);break;case 2:if(g!=null)o=X(r,a+s,i-s);else o=Y(r,a+s,i-s);break;default:o=-1;break}if(o==-1){if(w)return 0;return-1}s+=o}return s};var M=function(e){var t,r;j();x=e;P=0;var a=new Array(1024);var i=[];while((t=Z(a,0,a.length))>0){var s=new Array(t);for(r=0;r<t;r++){s[r]=String.fromCharCode(a[r])}i[i.length]=s.join("")}x=null;return i.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.inflate=M})();(function(){var e=32768;var t=0;var r=1;var a=2;var i=6;var s=true;var o=32768;var n=64;var c=1024*8;var l=2*e;var h=3;var f=258;var v=16;var d=8192;var b=13;if(d>o)alert("error: zip_INBUFSIZ is too small");if(e<<1>1<<v)alert("error: zip_WSIZE is too large");if(b>v-1)alert("error: zip_HASH_BITS is too large");if(b<8||f!=258)alert("error: Code too clever");var u=d;var k=1<<b;var w=k-1;var p=e-1;var m=0;var g=4096;var S=f+h+1;var y=e-S;var C=1;var x=15;var P=7;var _=29;var R=256;var A=256;var B=R+1+_;var z=30;var I=19;var O=16;var F=17;var W=18;var G=2*B+1;var D=parseInt((b+h-1)/h);var T;var L,X;var $;var J=null;var Y,j;var Z;var M;var H;var E;var N;var q;var U;var Q;var V;var K;var et;var tt;var rt;var at;var it;var st;var ot;var nt;var ct;var lt;var ht;var ft;var vt;var dt;var bt;var ut;var kt;var wt;var pt;var mt;var gt;var St;var yt;var Ct;var xt;var Pt;var _t;var Rt;var At;var Bt;var zt;var It;var Ot;var Ft;var Wt;var Gt;var Dt;var Tt;var Lt;var Xt;var $t=function(){this.fc=0;this.dl=0};var Jt=function(){this.dyn_tree=null;this.static_tree=null;this.extra_bits=null;this.extra_base=0;this.elems=0;this.max_length=0;this.max_code=0};var Yt=function(e,t,r,a){this.good_length=e;this.max_lazy=t;this.nice_length=r;this.max_chain=a};var jt=function(){this.next=null;this.len=0;this.ptr=new Array(c);this.off=0};var Zt=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0);var Mt=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var Ht=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7);var Et=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var Nt=new Array(new Yt(0,0,0,0),new Yt(4,4,8,4),new Yt(4,5,16,8),new Yt(4,6,32,32),new Yt(4,4,16,16),new Yt(8,16,32,32),new Yt(8,16,128,128),new Yt(8,32,128,256),new Yt(32,128,258,1024),new Yt(32,258,258,4096));var qt=function(e){var t;if(!e)e=i;else if(e<1)e=1;else if(e>9)e=9;ht=e;$=false;ot=false;if(J!=null)return;T=L=X=null;J=new Array(c);M=new Array(l);H=new Array(u);E=new Array(o+n);N=new Array(1<<v);dt=new Array(G);for(t=0;t<G;t++)dt[t]=new $t;bt=new Array(2*z+1);for(t=0;t<2*z+1;t++)bt[t]=new $t;ut=new Array(B+2);for(t=0;t<B+2;t++)ut[t]=new $t;kt=new Array(z);for(t=0;t<z;t++)kt[t]=new $t;wt=new Array(2*I+1);for(t=0;t<2*I+1;t++)wt[t]=new $t;pt=new Jt;mt=new Jt;gt=new Jt;St=new Array(x+1);yt=new Array(2*B+1);Pt=new Array(2*B+1);_t=new Array(f-h+1);Rt=new Array(512);At=new Array(_);Bt=new Array(z);zt=new Array(parseInt(d/8))};var Ut=function(){T=L=X=null;J=null;M=null;H=null;E=null;N=null;dt=null;bt=null;ut=null;kt=null;wt=null;pt=null;mt=null;gt=null;St=null;yt=null;Pt=null;_t=null;Rt=null;At=null;Bt=null;zt=null};var Qt=function(e){e.next=T;T=e};var Vt=function(){var e;if(T!=null){e=T;T=T.next}else e=new jt;e.next=null;e.len=e.off=0;return e};var Kt=function(t){return N[e+t]};var er=function(t,r){return N[e+t]=r};var tr=function(e){J[j+Y++]=e;if(j+Y==c)Fr()};var rr=function(e){e&=65535;if(j+Y<c-2){J[j+Y++]=e&255;J[j+Y++]=e>>>8}else{tr(e&255);tr(e>>>8)}};var ar=function(){V=(V<<D^M[it+h-1]&255)&w;K=Kt(V);N[it&p]=K;er(V,it)};var ir=function(e,t){zr(t[e].fc,t[e].dl)};var sr=function(e){return(e<256?Rt[e]:Rt[256+(e>>7)])&255};var or=function(e,t,r){return e[t].fc<e[r].fc||e[t].fc==e[r].fc&&Pt[t]<=Pt[r]};var nr=function(e,t,r){var a;for(a=0;a<r&&Xt<Lt.length;a++)e[t+a]=Lt.charCodeAt(Xt++)&255;return a};var cr=function(){var t;for(t=0;t<k;t++)N[e+t]=0;lt=Nt[ht].max_lazy;ft=Nt[ht].good_length;if(!s)vt=Nt[ht].nice_length;ct=Nt[ht].max_chain;it=0;Q=0;nt=nr(M,0,2*e);if(nt<=0){ot=true;nt=0;return}ot=false;while(nt<S&&!ot)hr();V=0;for(t=0;t<h-1;t++){V=(V<<D^M[t]&255)&w}};var lr=function(e){var t=ct;var r=it;var a;var i;var o=at;var n=it>y?it-y:m;var c=it+f;var l=M[r+o-1];var h=M[r+o];if(at>=ft)t>>=2;do{a=e;if(M[a+o]!=h||M[a+o-1]!=l||M[a]!=M[r]||M[++a]!=M[r+1]){continue}r+=2;a++;do{}while(M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&M[++r]==M[++a]&&r<c);i=f-(c-r);r=c-f;if(i>o){st=e;o=i;if(s){if(i>=f)break}else{if(i>=vt)break}l=M[r+o-1];h=M[r+o]}}while((e=N[e&p])>n&&--t!=0);return o};var hr=function(){var t,r;var a=l-nt-it;if(a==-1){a--}else if(it>=e+y){for(t=0;t<e;t++)M[t]=M[t+e];st-=e;it-=e;Q-=e;for(t=0;t<k;t++){r=Kt(t);er(t,r>=e?r-e:m)}for(t=0;t<e;t++){r=N[t];N[t]=r>=e?r-e:m}a+=e}if(!ot){t=nr(M,it+nt,a);if(t<=0)ot=true;else nt+=t}};var fr=function(){while(nt!=0&&L==null){var e;ar();if(K!=m&&it-K<=y){rt=lr(K);if(rt>nt)rt=nt}if(rt>=h){e=Rr(it-st,rt-h);nt-=rt;if(rt<=lt){rt--;do{it++;ar()}while(--rt!=0);it++}else{it+=rt;rt=0;V=M[it]&255;V=(V<<D^M[it+1]&255)&w}}else{e=Rr(0,M[it]&255);nt--;it++}if(e){_r(0);Q=it}while(nt<S&&!ot)hr()}};var vr=function(){while(nt!=0&&L==null){ar();at=rt;et=st;rt=h-1;if(K!=m&&at<lt&&it-K<=y){rt=lr(K);if(rt>nt)rt=nt;if(rt==h&&it-st>g){rt--}}if(at>=h&&rt<=at){var e;e=Rr(it-1-et,at-h);nt-=at-1;at-=2;do{it++;ar()}while(--at!=0);tt=0;rt=h-1;it++;if(e){_r(0);Q=it}}else if(tt!=0){if(Rr(0,M[it-1]&255)){_r(0);Q=it}it++;nt--}else{tt=1;it++;nt--}while(nt<S&&!ot)hr()}};var dr=function(){if(ot)return;q=0;U=0;kr();cr();L=null;Y=0;j=0;if(ht<=3){at=h-1;rt=0}else{rt=h-1;tt=0}Z=false};var br=function(e,t,r){var a;if(!$){dr();$=true;if(nt==0){Z=true;return 0}}if((a=ur(e,t,r))==r)return r;if(Z)return a;if(ht<=3)fr();else vr();if(nt==0){if(tt!=0)Rr(0,M[it-1]&255);_r(1);Z=true}return a+ur(e,a+t,r-a)};var ur=function(e,t,r){var a,i,s;a=0;while(L!=null&&a<r){i=r-a;if(i>L.len)i=L.len;for(s=0;s<i;s++)e[t+a+s]=L.ptr[L.off+s];L.off+=i;L.len-=i;a+=i;if(L.len==0){var o;o=L;L=L.next;Qt(o)}}if(a==r)return a;if(j<Y){i=r-a;if(i>Y-j)i=Y-j;for(s=0;s<i;s++)e[t+a+s]=J[j+s];j+=i;a+=i;if(Y==j)Y=j=0}return a};var kr=function(){var e;var t;var r;var a;var i;if(kt[0].dl!=0)return;pt.dyn_tree=dt;pt.static_tree=ut;pt.extra_bits=Zt;pt.extra_base=R+1;pt.elems=B;pt.max_length=x;pt.max_code=0;mt.dyn_tree=bt;mt.static_tree=kt;mt.extra_bits=Mt;mt.extra_base=0;mt.elems=z;mt.max_length=x;mt.max_code=0;gt.dyn_tree=wt;gt.static_tree=null;gt.extra_bits=Ht;gt.extra_base=0;gt.elems=I;gt.max_length=P;gt.max_code=0;r=0;for(a=0;a<_-1;a++){At[a]=r;for(e=0;e<1<<Zt[a];e++)_t[r++]=a}_t[r-1]=a;i=0;for(a=0;a<16;a++){Bt[a]=i;for(e=0;e<1<<Mt[a];e++){Rt[i++]=a}}i>>=7;for(;a<z;a++){Bt[a]=i<<7;for(e=0;e<1<<Mt[a]-7;e++)Rt[256+i++]=a}for(t=0;t<=x;t++)St[t]=0;e=0;while(e<=143){ut[e++].dl=8;St[8]++}while(e<=255){ut[e++].dl=9;St[9]++}while(e<=279){ut[e++].dl=7;St[7]++}while(e<=287){ut[e++].dl=8;St[8]++}gr(ut,B+1);for(e=0;e<z;e++){kt[e].dl=5;kt[e].fc=Ir(e,5)}wr()};var wr=function(){var e;for(e=0;e<B;e++)dt[e].fc=0;for(e=0;e<z;e++)bt[e].fc=0;for(e=0;e<I;e++)wt[e].fc=0;dt[A].fc=1;Dt=Tt=0;It=Ot=Ft=0;Wt=0;Gt=1};var pr=function(e,t){var r=yt[t];var a=t<<1;while(a<=Ct){if(a<Ct&&or(e,yt[a+1],yt[a]))a++;if(or(e,r,yt[a]))break;yt[t]=yt[a];t=a;a<<=1}yt[t]=r};var mr=function(e){var t=e.dyn_tree;var r=e.extra_bits;var a=e.extra_base;var i=e.max_code;var s=e.max_length;var o=e.static_tree;var n;var c,l;var h;var f;var v;var d=0;for(h=0;h<=x;h++)St[h]=0;t[yt[xt]].dl=0;for(n=xt+1;n<G;n++){c=yt[n];h=t[t[c].dl].dl+1;if(h>s){h=s;d++}t[c].dl=h;if(c>i)continue;St[h]++;f=0;if(c>=a)f=r[c-a];v=t[c].fc;Dt+=v*(h+f);if(o!=null)Tt+=v*(o[c].dl+f)}if(d==0)return;do{h=s-1;while(St[h]==0)h--;St[h]--;St[h+1]+=2;St[s]--;d-=2}while(d>0);for(h=s;h!=0;h--){c=St[h];while(c!=0){l=yt[--n];if(l>i)continue;if(t[l].dl!=h){Dt+=(h-t[l].dl)*t[l].fc;t[l].fc=h}c--}}};var gr=function(e,t){var r=new Array(x+1);var a=0;var i;var s;for(i=1;i<=x;i++){a=a+St[i-1]<<1;r[i]=a}for(s=0;s<=t;s++){var o=e[s].dl;if(o==0)continue;e[s].fc=Ir(r[o]++,o)}};var Sr=function(e){var t=e.dyn_tree;var r=e.static_tree;var a=e.elems;var i,s;var o=-1;var n=a;Ct=0;xt=G;for(i=0;i<a;i++){if(t[i].fc!=0){yt[++Ct]=o=i;Pt[i]=0}else t[i].dl=0}while(Ct<2){var c=yt[++Ct]=o<2?++o:0;t[c].fc=1;Pt[c]=0;Dt--;if(r!=null)Tt-=r[c].dl}e.max_code=o;for(i=Ct>>1;i>=1;i--)pr(t,i);do{i=yt[C];yt[C]=yt[Ct--];pr(t,C);s=yt[C];yt[--xt]=i;yt[--xt]=s;t[n].fc=t[i].fc+t[s].fc;if(Pt[i]>Pt[s]+1)Pt[n]=Pt[i];else Pt[n]=Pt[s]+1;t[i].dl=t[s].dl=n;yt[C]=n++;pr(t,C)}while(Ct>=2);yt[--xt]=yt[C];mr(e);gr(t,o)};var yr=function(e,t){var r;var a=-1;var i;var s=e[0].dl;var o=0;var n=7;var c=4;if(s==0){n=138;c=3}e[t+1].dl=65535;for(r=0;r<=t;r++){i=s;s=e[r+1].dl;if(++o<n&&i==s)continue;else if(o<c)wt[i].fc+=o;else if(i!=0){if(i!=a)wt[i].fc++;wt[O].fc++}else if(o<=10)wt[F].fc++;else wt[W].fc++;o=0;a=i;if(s==0){n=138;c=3}else if(i==s){n=6;c=3}else{n=7;c=4}}};var Cr=function(e,t){var r;var a=-1;var i;var s=e[0].dl;var o=0;var n=7;var c=4;if(s==0){n=138;c=3}for(r=0;r<=t;r++){i=s;s=e[r+1].dl;if(++o<n&&i==s){continue}else if(o<c){do{ir(i,wt)}while(--o!=0)}else if(i!=0){if(i!=a){ir(i,wt);o--}ir(O,wt);zr(o-3,2)}else if(o<=10){ir(F,wt);zr(o-3,3)}else{ir(W,wt);zr(o-11,7)}o=0;a=i;if(s==0){n=138;c=3}else if(i==s){n=6;c=3}else{n=7;c=4}}};var xr=function(){var e;yr(dt,pt.max_code);yr(bt,mt.max_code);Sr(gt);for(e=I-1;e>=3;e--){if(wt[Et[e]].dl!=0)break}Dt+=3*(e+1)+5+5+4;return e};var Pr=function(e,t,r){var a;zr(e-257,5);zr(t-1,5);zr(r-4,4);for(a=0;a<r;a++){zr(wt[Et[a]].dl,3)}Cr(dt,e-1);Cr(bt,t-1)};var _r=function(e){var i,s;var o;var n;n=it-Q;zt[Ft]=Wt;Sr(pt);Sr(mt);o=xr();i=Dt+3+7>>3;s=Tt+3+7>>3;if(s<=i)i=s;if(n+4<=i&&Q>=0){var c;zr((t<<1)+e,3);Or();rr(n);rr(~n);for(c=0;c<n;c++)tr(M[Q+c])}else if(s==i){zr((r<<1)+e,3);Ar(ut,kt)}else{zr((a<<1)+e,3);Pr(pt.max_code+1,mt.max_code+1,o+1);Ar(dt,bt)}wr();if(e!=0)Or()};var Rr=function(e,t){E[It++]=t;if(e==0){dt[t].fc++}else{e--;dt[_t[t]+R+1].fc++;bt[sr(e)].fc++;H[Ot++]=e;Wt|=Gt}Gt<<=1;if((It&7)==0){zt[Ft++]=Wt;Wt=0;Gt=1}if(ht>2&&(It&4095)==0){var r=It*8;var a=it-Q;var i;for(i=0;i<z;i++){r+=bt[i].fc*(5+Mt[i])}r>>=3;if(Ot<parseInt(It/2)&&r<parseInt(a/2))return true}return It==d-1||Ot==u};var Ar=function(e,t){var r;var a;var i=0;var s=0;var o=0;var n=0;var c;var l;if(It!=0)do{if((i&7)==0)n=zt[o++];a=E[i++]&255;if((n&1)==0){ir(a,e)}else{c=_t[a];ir(c+R+1,e);l=Zt[c];if(l!=0){a-=At[c];zr(a,l)}r=H[s++];c=sr(r);ir(c,t);l=Mt[c];if(l!=0){r-=Bt[c];zr(r,l)}}n>>=1}while(i<It);ir(A,e)};var Br=16;var zr=function(e,t){if(U>Br-t){q|=e<<U;rr(q);q=e>>Br-U;U+=t-Br}else{q|=e<<U;U+=t}};var Ir=function(e,t){var r=0;do{r|=e&1;e>>=1;r<<=1}while(--t>0);return r>>1};var Or=function(){if(U>8){rr(q)}else if(U>0){tr(q)}q=0;U=0};var Fr=function(){if(Y!=0){var e,t;e=Vt();if(L==null)L=X=e;else X=X.next=e;e.len=Y-j;for(t=0;t<e.len;t++)e.ptr[t]=J[j+t];Y=j=0}};var Wr=function(e,t){var r,a;Lt=e;Xt=0;if(typeof t=="undefined")t=i;qt(t);var s=new Array(1024);var o=[];while((r=br(s,0,s.length))>0){var n=new Array(r);for(a=0;a<r;a++){n[a]=String.fromCharCode(s[a])}o[o.length]=n.join("")}Lt=null;return o.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.deflate=Wr})();"use strict";jQuery.base64=function(e){var t="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="1.0";function i(e,t){var a=r.indexOf(e.charAt(t));if(a===-1){throw"Cannot decode base64"}return a}function s(e){var r=0,a,s,o=e.length,n=[];e=String(e);if(o===0){return e}if(o%4!==0){throw"Cannot decode base64"}if(e.charAt(o-1)===t){r=1;if(e.charAt(o-2)===t){r=2}o-=4}for(a=0;a<o;a+=4){s=i(e,a)<<18|i(e,a+1)<<12|i(e,a+2)<<6|i(e,a+3);n.push(String.fromCharCode(s>>16,s>>8&255,s&255))}switch(r){case 1:s=i(e,a)<<18|i(e,a+1)<<12|i(e,a+2)<<6;n.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=i(e,a)<<18|i(e,a+1)<<12;n.push(String.fromCharCode(s>>16));break}return n.join("")}function o(e,t){var r=e.charCodeAt(t);if(r>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return r}function n(e){if(arguments.length!==1){throw"SyntaxError: exactly one argument required"}e=String(e);var a,i,s=[],n=e.length-e.length%3;if(e.length===0){return e}for(a=0;a<n;a+=3){i=o(e,a)<<16|o(e,a+1)<<8|o(e,a+2);s.push(r.charAt(i>>18));s.push(r.charAt(i>>12&63));s.push(r.charAt(i>>6&63));s.push(r.charAt(i&63))}switch(e.length-n){case 1:i=o(e,a)<<16;s.push(r.charAt(i>>18)+r.charAt(i>>12&63)+t+t);break;case 2:i=o(e,a)<<16|o(e,a+1)<<8;s.push(r.charAt(i>>18)+r.charAt(i>>12&63)+r.charAt(i>>6&63)+t);break}return s.join("")}return{decode:s,encode:n,VERSION:a}}(jQuery);LZWEncoder=function(){var e={};var t=-1;var r;var a;var i;var s;var o;var n;var c=12;var l=5003;var h;var f=c;var v;var d=1<<c;var b=new Array;var u=new Array;var k=l;var w=0;var p=false;var m;var g;var S;var y=0;var C=0;var x=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var P;var _=[];var R=e.LZWEncoder=function T(e,t,o,n){r=e;a=t;i=o;s=Math.max(2,n)};var A=function L(e,t){_[P++]=e;if(P>=254)F(t)};var B=function X(e){z(k);w=g+2;p=true;D(g,e)};var z=function $(e){for(var t=0;t<e;++t)b[t]=-1};var I=e.compress=function J(e,r){var a;var i;var s;var o;var n;var c;var l;m=e;p=false;h=m;v=W(h);g=1<<e-1;S=g+1;w=g+2;P=0;o=G();l=0;for(a=k;a<65536;a*=2)++l;l=8-l;c=k;z(c);D(g,r);e:while((s=G())!=t){a=(s<<f)+o;i=s<<l^o;if(b[i]==a){o=u[i];continue}else if(b[i]>=0){n=c-i;if(i==0)n=1;do{if((i-=n)<0)i+=c;if(b[i]==a){o=u[i];continue e}}while(b[i]>=0)}D(o,r);o=s;if(w<d){u[i]=w++;b[i]=a}else B(r)}D(o,r);D(S,r)};var O=e.encode=function Y(e){e.writeByte(s);o=r*a;n=0;I(s+1,e);e.writeByte(0)};var F=function j(e){if(P>0){e.writeByte(P);e.writeBytes(_,0,P);P=0}};var W=function Z(e){return(1<<e)-1};var G=function M(){if(o==0)return t;--o;var e=i[n++];return e&255};var D=function H(e,t){y&=x[C];if(C>0)y|=e<<C;else y=e;C+=h;while(C>=8){A(y&255,t);y>>=8;C-=8}if(w>v||p){if(p){v=W(h=m);p=false}else{++h;if(h==f)v=d;else v=W(h)}}if(e==S){while(C>0){A(y&255,t);y>>=8;C-=8}F(t)}};R.apply(this,arguments);return e};GIFEncoder=function(){for(var e=0,t={};e<256;e++)t[e]=String.fromCharCode(e);function r(){this.bin=[]}r.prototype.getData=function(){for(var e="",r=this.bin.length,a=0;a<r;a++)e+=t[this.bin[a]];return e};r.prototype.writeByte=function(e){this.bin.push(e)};r.prototype.writeUTFBytes=function(e){for(var t=e.length,r=0;r<t;r++)this.writeByte(e.charCodeAt(r))};r.prototype.writeBytes=function(e,t,r){for(var a=r||e.length,i=t||0;i<a;i++)this.writeByte(e[i])};var a={};var i;var s;var o=null;var n;var c=-1;var l=0;var h=false;var f;var v;var d;var b;var u;var k;var w=new Array;var p=7;var m=-1;var g=false;var S=true;var y=false;var C=10;var x=a.setDelay=function E(e){l=Math.round(e/10)};var P=a.setDispose=function N(e){if(e>=0)m=e};var _=a.setRepeat=function q(e){if(e>=0)c=e};var R=a.setTransparent=function U(e){o=e};var A=a.addFrame=function Q(e,t){if(e==null||!h||f==null){throw new Error("Please call start method before calling addFrame");return false}var r=true;try{if(!t){v=e.getImageData(0,0,e.canvas.width,e.canvas.height).data;if(!y)F(e.canvas.width,e.canvas.height)}else{v=e}T();G();if(S){$();Y();if(c>=0){J()}}L();X();if(!S)Y();Z();S=false}catch(a){r=false}return r};var B=a.finish=function V(){if(!h)return false;var e=true;h=false;try{f.writeByte(59)}catch(t){e=false}return e};var z=function K(){n=0;v=null;d=null;b=null;k=null;g=false;S=true};var I=a.setFrameRate=function et(e){if(e!=15)l=Math.round(100/e)};var O=a.setQuality=function tt(e){if(e<1)e=1;C=e};var F=a.setSize=function rt(e,t){if(h&&!S)return;i=e;s=t;if(i<1)i=320;if(s<1)s=240;y=true};var W=a.start=function at(){z();var e=true;g=false;f=new r;try{f.writeUTFBytes("GIF89a")}catch(t){e=false}return h=e};var G=function it(){var e=d.length;var t=e/3;b=[];var r=new NeuQuant(d,e,C);k=r.process();var a=0;for(var i=0;i<t;i++){var s=r.map(d[a++]&255,d[a++]&255,d[a++]&255);w[s]=true;b[i]=s}d=null;u=8;p=7;if(o!=null){n=D(o)}};var D=function st(e){if(k==null)return-1;var t=(e&16711680)>>16;var r=(e&65280)>>8;var a=e&255;var i=0;var s=256*256*256;var o=k.length;for(var n=0;n<o;){var c=t-(k[n++]&255);var l=r-(k[n++]&255);var h=a-(k[n]&255);var f=c*c+l*l+h*h;var v=n/3;if(w[v]&&f<s){s=f;i=v}n++}return i};var T=function ot(){var e=i;var t=s;d=[];var r=v;var a=0;for(var o=0;o<t;o++){for(var n=0;n<e;n++){var c=o*e*4+n*4;d[a++]=r[c];d[a++]=r[c+1];d[a++]=r[c+2]}}};var L=function nt(){f.writeByte(33);f.writeByte(249);f.writeByte(4);var e;var t;if(o==null){e=0;t=0}else{e=1;t=2}if(m>=0){t=m&7}t<<=2;f.writeByte(0|t|0|e);j(l);f.writeByte(n);f.writeByte(0)};var X=function ct(){f.writeByte(44);j(0);j(0);j(i);j(s);if(S){f.writeByte(0)}else{f.writeByte(128|0|0|0|p)}};var $=function lt(){j(i);j(s);f.writeByte(128|112|0|p);f.writeByte(0);f.writeByte(0)};var J=function ht(){f.writeByte(33);f.writeByte(255);f.writeByte(11);f.writeUTFBytes("NETSCAPE"+"2.0");f.writeByte(3);f.writeByte(1);j(c);f.writeByte(0)};var Y=function ft(){f.writeBytes(k);var e=3*256-k.length;for(var t=0;t<e;t++)f.writeByte(0)};var j=function vt(e){f.writeByte(e&255);f.writeByte(e>>8&255)};var Z=function dt(){var e=new LZWEncoder(i,s,b,u);e.encode(f)};var M=a.stream=function bt(){return f};var H=a.setProperties=function ut(e,t){h=e;S=t};return a};NeuQuant=function(){var e={};var t=256;var r=499;var a=491;var i=487;var s=503;var o=3*s;var n=t-1;var c=4;var l=100;var h=16;var f=1<<h;var v=10;var d=1<<v;var b=10;var u=f>>b;var k=f<<v-b;var w=t>>3;var p=6;var m=1<<p;var g=w*m;var S=30;var y=10;var C=1<<y;var x;var P=8;var _=1<<P;var R=y+P;var A=1<<R;var B;var z;var I;var O;var F=new Array;var W=new Array;var G=new Array;var D=new Array;var T=e.NeuQuant=function E(e,r,a){var i;var s;B=e;z=r;I=a;O=new Array(t);for(i=0;i<t;i++){O[i]=new Array(4);s=O[i];s[0]=s[1]=s[2]=(i<<c+8)/t;G[i]=f/t;W[i]=0}};var L=function N(){var e=[];var r=new Array(t);for(var a=0;a<t;a++)r[O[a][3]]=a;var i=0;for(var s=0;s<t;s++){var o=r[s];e[i++]=O[o][0];e[i++]=O[o][1];e[i++]=O[o][2]}return e};var X=function q(){var e;var r;var a;var i;var s;var o;var c;var l;c=0;l=0;for(e=0;e<t;e++){s=O[e];a=e;i=s[1];for(r=e+1;r<t;r++){o=O[r];if(o[1]<i){a=r;i=o[1]}}o=O[a];if(e!=a){r=o[0];o[0]=s[0];s[0]=r;r=o[1];o[1]=s[1];s[1]=r;r=o[2];o[2]=s[2];s[2]=r;r=o[3];o[3]=s[3];s[3]=r}if(i!=c){F[c]=l+e>>1;for(r=c+1;r<i;r++)F[r]=e;c=i;l=e}}F[c]=l+n>>1;for(r=c+1;r<256;r++)F[r]=n};var $=function U(){var e;var t;var n;var h;var f;var v;var d;var b;var u;var k;var w;var m;var y;var P;if(z<o)I=1;x=30+(I-1)/3;m=B;y=0;P=z;w=z/(3*I);k=w/l|0;b=C;v=g;d=v>>p;if(d<=1)d=0;for(e=0;e<d;e++)D[e]=b*((d*d-e*e)*_/(d*d));if(z<o)u=3;else if(z%r!=0)u=3*r;else{if(z%a!=0)u=3*a;else{if(z%i!=0)u=3*i;else u=3*s}}e=0;while(e<w){n=(m[y+0]&255)<<c;h=(m[y+1]&255)<<c;f=(m[y+2]&255)<<c;t=H(n,h,f);M(b,t,n,h,f);if(d!=0)Z(d,t,n,h,f);y+=u;if(y>=P)y-=z;e++;if(k==0)k=1;if(e%k==0){b-=b/x;v-=v/S;d=v>>p;if(d<=1)d=0;for(t=0;t<d;t++)D[t]=b*((d*d-t*t)*_/(d*d))}}};var J=e.map=function Q(e,r,a){var i;var s;var o;var n;var c;var l;var h;c=1e3;h=-1;i=F[r];s=i-1;while(i<t||s>=0){if(i<t){l=O[i];o=l[1]-r;if(o>=c)i=t;else{i++;if(o<0)o=-o;n=l[0]-e;if(n<0)n=-n;o+=n;if(o<c){n=l[2]-a;if(n<0)n=-n;o+=n;if(o<c){c=o;h=l[3]}}}}if(s>=0){l=O[s];o=r-l[1];if(o>=c)s=-1;else{s--;if(o<0)o=-o;n=l[0]-e;if(n<0)n=-n;o+=n;if(o<c){n=l[2]-a;if(n<0)n=-n;o+=n;if(o<c){c=o;h=l[3]}}}}}return h};var Y=e.process=function V(){$();j();X();return L()};var j=function K(){var e;var r;for(e=0;e<t;e++){O[e][0]>>=c;O[e][1]>>=c;O[e][2]>>=c;O[e][3]=e}};var Z=function et(e,r,a,i,s){var o;var n;var c;var l;var h;var f;var v;c=r-e;if(c<-1)c=-1;l=r+e;if(l>t)l=t;o=r+1;n=r-1;f=1;while(o<l||n>c){h=D[f++];if(o<l){v=O[o++];try{v[0]-=h*(v[0]-a)/A;v[1]-=h*(v[1]-i)/A;v[2]-=h*(v[2]-s)/A}catch(d){}}if(n>c){v=O[n--];try{v[0]-=h*(v[0]-a)/A;v[1]-=h*(v[1]-i)/A;v[2]-=h*(v[2]-s)/A}catch(d){}}}};var M=function tt(e,t,r,a,i){var s=O[t];s[0]-=e*(s[0]-r)/C;s[1]-=e*(s[1]-a)/C;s[2]-=e*(s[2]-i)/C};var H=function rt(e,r,a){var i;var s;var o;var n;var l;var f;var d;var w;var p;var m;w=~(1<<31);p=w;f=-1;d=f;for(i=0;i<t;i++){m=O[i];s=m[0]-e;if(s<0)s=-s;o=m[1]-r;if(o<0)o=-o;s+=o;o=m[2]-a;if(o<0)o=-o;s+=o;if(s<w){w=s;f=i}n=s-(W[i]>>h-c);if(n<p){p=n;d=i}l=G[i]>>b;G[i]-=l;W[i]+=l<<v}G[f]+=u;W[f]-=k;return d};T.apply(this,arguments);return e};function Painter(e){this.myself=this;this.CanvasHeight=177;this.CanvasWidth=97;this.blockSize=8;this.IDString=e;this.CanvasPreview=$("#"+this.IDString+"-preview");this.ContextPreview=this.CanvasPreview[0].getContext("2d");this.CanvasDeco=$("#"+this.IDString+"-deco");this.ContextDeco=this.CanvasDeco[0].getContext("2d");this.CanvasPF=$("#"+this.IDString+"-inactive");this.ContextPF=this.CanvasPF[0].getContext("2d");this.CanvasActive=$("#"+this.IDString+"-active");this.ContextActive=this.CanvasActive[0].getContext("2d");this.CanvasWhiteborder=$("#"+this.IDString+"-whiteborder");this.ContextWhiteborder=this.CanvasWhiteborder[0].getContext("2d");this.CanvasBackground=$("#"+this.IDString+"-background");this.ContextBackground=this.CanvasBackground[0].getContext("2d");this.CanvasBorder=$("#"+this.IDString+"-border");this.ContextBorder=this.CanvasBorder[0].getContext("2d");this.CanvasDecoPin=$("#"+this.IDString+"-decoPin");this.ContextDecoPin=this.CanvasDecoPin[0].getContext("2d");this.CanvasNextHold=$("#"+this.IDString+"-nexthold");this.ContextNextHold=this.CanvasNextHold[0].getContext("2d");this.CanvasProgressbar=$("#"+this.IDString+"-progressbar");this.ContextProgressbar=this.CanvasProgressbar[0].getContext("2d");this.CanvasControl=$("#"+this.IDString+"-control");this.ContextControl=this.CanvasControl[0].getContext("2d");this.PFOriginX=1*this.blockSize;this.PFOriginY=1*this.blockSize;this.PFOriginXAbsolute=this.CanvasPF.offset().left+this.PFOriginX-1;this.PFOriginYAbsolute=this.CanvasPF.offset().top+this.PFOriginY;this.CntrlOriginX=this.CanvasControl.offset().left;this.CntrlOriginY=this.CanvasControl.offset().top;this.CanvasControlheight=this.CanvasControl.height();this.sprite="";this.spritemini="";this.spritedeco="";this.joypalette="";this.ready=false}Painter.prototype.init=function(){var e=this.myself;this.spritedeco=new Image;this.sprite=new Image;this.spritemini=new Image;this.joypalette=new Image;this.spritedeco.src="res/deco-8px.png";this.sprite.src="res/palette-8px.png";this.spritemini.src="res/palette-4px.png";this.joypalette.src="res/control-palette.png";this.sprite.onload=function(){e.ready=true};this.sprite.onerror=function(){e.ready=true};this.drawJoystick("all","rest");this.drawAllButtons("rest");this.drawBorder("master");this.drawGrid()};Painter.prototype.eraseLayer=function(e){var t;switch(e){case"decoration":Context=this.ContextDeco;break;case"inactive":Context=this.ContextPF;break;case"preview":Context=this.ContextPreview;break;case"active":Context=this.ContextActive;break;case"nexthold":Context=this.ContextNextHold;break;case"whiteborder":Context=this.ContextWhiteborder;break;case"all":Context=this.ContextPF;this.ContextDeco.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextPreview.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextActive.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextNextHold.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextWhiteborder.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);break}Context.clearRect(0,0,this.CanvasWidth,this.CanvasHeight)};Painter.prototype.eraseBlock=function(e,t){this.ContextPF.clearRect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)};Painter.prototype.eraseDeco=function(e,t){this.ContextDeco.clearRect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)};Painter.prototype.drawComment=function(e){$("#"+this.IDString+"-comment").val(e)};Painter.prototype.drawDuration=function(e){$("#"+this.IDString+"-duration").val(e)};Painter.prototype.drawOpacity=function(e){$("#"+this.IDString+"-active-opacity").val(e)};Painter.prototype.drawProgressbar=function(e,t){if(e<=t&&e>0){this.ContextProgressbar.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextProgressbar.beginPath();this.ContextProgressbar.rect(0,0,parseInt(e/t*100,10),24);this.ContextProgressbar.fillStyle="gray";this.ContextProgressbar.fill();this.ContextProgressbar.closePath()}};Painter.prototype.drawWhiteBorder=function(e){this.eraseLayer("whiteborder");for(var t=0,r=e.length;t<r;t++){for(var a=0,i=e[0].length;a<i;a++){if(e[t][a][0]){this.drawLocalWhiteBorder(e,t,a)}}}};Painter.prototype.drawLocalWhiteBorder=function(e,t,r){this.ContextWhiteborder.beginPath();if(e[t][r][0]){if(t-1>=0){if(!e[t-1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(t+1<e.length){if(!e[t+1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(t+1)*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(t+1)*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r-1>=0){if(!e[t][r-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r+1<e[0].length){if(!e[t][r+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}else{if(t-1>=0){if(e[t-1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);
this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(t+1<e.length){if(e[t+1][r][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(t+1)*this.blockSize-1,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(t+1)*this.blockSize,this.PFOriginY+r*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r-1>=0){if(e[t][r-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+r*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(r+1<e[0].length){if(e[t][r+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+t*this.blockSize,this.PFOriginY+(r+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}};Painter.prototype.drawGrid=function(){this.ContextBackground.beginPath();this.ContextBackground.beginPath();for(var e=1;e<=9;e++){this.ContextBackground.rect(this.PFOriginX+e*this.blockSize,this.PFOriginY,1,20*this.blockSize)}for(var e=1;e<=19;e++){this.ContextBackground.rect(this.PFOriginX,this.PFOriginY+e*this.blockSize,10*this.blockSize,1)}this.ContextBackground.fillStyle="#444";this.ContextBackground.fill();this.ContextBackground.closePath()};Painter.prototype.drawBorder=function(e){var t="#afafaf";var r="#46545f";var a=this.myself;switch(e){case"master":t="#afafaf";r="#46545f";break;case"easy":t="#afafaf";r="#475f46";break;case"death":t="#ac434a";r="#5f0004";break;default:t="#afafaf";r="#46545f";break}var i=this.ContextBorder.createRadialGradient(0,0,this.blockSize,0,0,this.CanvasWidth-2*this.blockSize),s=this.ContextBorder.createRadialGradient(this.CanvasWidth,this.CanvasHeight,this.blockSize,this.CanvasWidth,this.CanvasHeight,this.CanvasWidth-2*this.blockSize);i.addColorStop(0,t);i.addColorStop(1,r);s.addColorStop(0,t);s.addColorStop(1,r);var o=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),n=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),c=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize),l=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize);o.addColorStop(0,t);o.addColorStop(1,r);n.addColorStop(0,r);n.addColorStop(1,t);c.addColorStop(0,t);c.addColorStop(1,r);l.addColorStop(0,r);l.addColorStop(1,t);function h(e,t,r,i,s){a.ContextBorder.beginPath();a.ContextBorder.rect(e,t,r,i);a.ContextBorder.fillStyle=s;a.ContextBorder.fill();a.ContextBorder.closePath()}h(0,0,this.CanvasWidth,this.CanvasHeight,r);h(0,0,this.CanvasWidth,this.CanvasWidth,i);h(0,this.CanvasHeight-this.CanvasWidth,this.CanvasWidth,this.CanvasWidth,s);h(0,0,this.CanvasWidth,1,n);h(0,0,1,this.CanvasHeight,l);h(this.CanvasWidth-1,0,1,this.CanvasHeight,c);h(0,this.CanvasHeight-1,this.CanvasWidth,1,o);h(this.blockSize-1,this.blockSize-1,10*this.blockSize+1,1,n);h(this.blockSize+10*this.blockSize,this.blockSize-1,1,20*this.blockSize+2,c);h(this.blockSize-1,this.blockSize-1,1,20*this.blockSize+1,l);h(this.blockSize-1,this.blockSize+20*this.blockSize,10*this.blockSize+1,1,o);h(1*this.blockSize,1*this.blockSize,10*this.blockSize,20*this.blockSize,"black")};Painter.prototype.drawNextHold=function(e,t,r){matrix=getMatrix(t,"i",r);switch(e){case 0:this.ContextNextHold.clearRect(0,this.blockSize+3,4*this.blockSize,3*this.blockSize);if(!t){return}for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){this.drawBlock(parseInt(-1+i,10),parseInt(2+a,10),t,r,"nextholdmini")}}}break;case 1:this.ContextNextHold.clearRect(4*this.blockSize,this.blockSize,4*this.blockSize,3*this.blockSize+3);if(!t){return}for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){if(r=="SRS"){this.drawBlock(parseInt(3+i,10),parseInt(1+a,10),t,r,"nexthold")}else{this.drawBlock(parseInt(3+i,10),parseInt(0+a,10),t,r,"nexthold")}}}}break;case 2:this.ContextNextHold.clearRect(8*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);if(!t){return}for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){this.drawBlock(parseInt(13+i,10),parseInt(3+a,10),t,r,"nextholdmini")}}}break;case 3:if(!t){return}this.ContextNextHold.clearRect(10*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);for(var a=0;a<4;a++){for(var i=0;i<4;i++){if(matrix[a][i]){this.drawBlock(parseInt(17+i,10),parseInt(3+a,10),t,r,"nextholdmini")}}}break}};Painter.prototype.changeActiveOpacity=function(e){if(e=="Flash"||e=="flash"){this.CanvasActive.attr("style","z-index:4; opacity: 1.0")}else{this.CanvasActive.attr("style","z-index:4; opacity: "+e)}};Painter.prototype.drawDeco=function(e,t,r,a){if(!r){return}var i=this.spritedeco;var s,o;var n;if(a=="preview"){n=this.ContextPreview}else{n=this.ContextDeco}switch(r){case"n1":s=decoration.n1.s;o=decoration.n1.e;break;case"n2":s=decoration.n2.s;o=decoration.n2.e;break;case"n3":s=decoration.n3.s;o=decoration.n3.e;break;case"n4":s=decoration.n4.s;o=decoration.n4.e;break;case"n5":s=decoration.n5.s;o=decoration.n5.e;break;case"n6":s=decoration.n6.s;o=decoration.n6.e;break;case"n7":s=decoration.n7.s;o=decoration.n7.e;break;case"n8":s=decoration.n8.s;o=decoration.n8.e;break;case"n9":s=decoration.n9.s;o=decoration.n9.e;break;case"n0":s=decoration.n0.s;o=decoration.n0.e;break;case"smallcw":s=decoration.smallcw.s;o=decoration.smallcw.e;break;case"smallccw":s=decoration.smallccw.s;o=decoration.smallccw.e;break;case"smalloktick":s=decoration.smalloktick.s;o=decoration.smalloktick.e;break;case"smallokcircle":s=decoration.smallokcircle.s;o=decoration.smallokcircle.e;break;case"smallnocross":s=decoration.smallnocross.s;o=decoration.smallnocross.e;break;case"smallquestion":s=decoration.smallquestion.s;o=decoration.smallquestion.e;break;case"smallexclamation":s=decoration.smallexclamation.s;o=decoration.smallexclamation.e;break;case"nwarrow":s=decoration.nwarrow.s;o=decoration.nwarrow.e;break;case"narrow":s=decoration.narrow.s;o=decoration.narrow.e;break;case"nearrow":s=decoration.nearrow.s;o=decoration.nearrow.e;break;case"earrow":s=decoration.earrow.s;o=decoration.earrow.e;break;case"searrow":s=decoration.searrow.s;o=decoration.searrow.e;break;case"sarrow":s=decoration.sarrow.s;o=decoration.sarrow.e;break;case"swarrow":s=decoration.swarrow.s;o=decoration.swarrow.e;break;case"warrow":s=decoration.warrow.s;o=decoration.warrow.e;break;case"bigcw":s=decoration.bigcw.s;o=decoration.bigcw.e;break;case"bigccw":s=decoration.bigccw.s;o=decoration.bigccw.e;break;case"bigquestion":s=decoration.bigquestion.s;o=decoration.bigquestion.e;break;case"bigexclamation":s=decoration.bigexclamation.s;o=decoration.bigexclamation.e;break;case"bigoktick":s=decoration.bigoktick.s;o=decoration.bigoktick.e;break;case"bigokcircle":s=decoration.bigokcircle.s;o=decoration.bigokcircle.e;break;case"bignocross":s=decoration.bignocross.s;o=decoration.bignocross.e;break;case"overlayyellow":s=decoration.overlayyellow.s;o=decoration.overlayyellow.e;break;case"overlayblue":s=decoration.overlayblue.s;o=decoration.overlayblue.e;break;case"overlaygreen":s=decoration.overlaygreen.s;o=decoration.overlaygreen.e;break;case"overlaypink":s=decoration.overlaypink.s;o=decoration.overlaypink.e;break;case"overlayorange":s=decoration.overlayorange.s;o=decoration.overlayorange.e;break;case"clear1":s=decoration.clear1.s;o=decoration.clear1.e;break;case"clear2":s=decoration.clear2.s;o=decoration.clear2.e;break;case"clear3":s=decoration.clear3.s;o=decoration.clear3.e;break;case"clear4":s=decoration.clear4.s;o=decoration.clear4.e;break;case"clear5":s=decoration.clear5.s;o=decoration.clear5.e;break;case"clear6":s=decoration.clear6.s;o=decoration.clear6.e;break;case"clear7":s=decoration.clear7.s;o=decoration.clear7.e;break}var c=s[0]*this.blockSize;var l=s[1]*this.blockSize;var h=(o[0]-s[0])*this.blockSize;var f=(o[1]-s[1])*this.blockSize;var v=this.PFOriginX+e*this.blockSize;var d=this.PFOriginY+t*this.blockSize;if(a!="eraser"){n.clearRect(v,d,h,f);n.drawImage(i,c,l,h,f,v,d,h,f)}else{n.clearRect(v,d,h,f);this.ContextDecoPin.clearRect(v-this.blockSize/2,d-this.blockSize/2,this.blockSize,this.blockSize)}if(a!="preview"&&a!="eraser"){this.ContextDecoPin.beginPath();this.ContextDecoPin.fillStyle="red";this.ContextDecoPin.strokeStyle="red";this.ContextDecoPin.arc(v,d,this.blockSize/4,2*Math.PI,false);this.ContextDecoPin.fill();this.ContextDecoPin.lineTo(v+4,d+4);this.ContextDecoPin.stroke();this.ContextDecoPin.closePath()}};Painter.prototype.drawBrowserBlock=function(e,t,r,a,i,s){var o;switch(a){case"ARS":switch(r){case"I":o=ARS.I.color;break;case"T":o=ARS.T.color;break;case"L":o=ARS.L.color;break;case"J":o=ARS.J.color;break;case"S":o=ARS.S.color;break;case"Z":o=ARS.Z.color;break;case"O":o=ARS.O.color;break;case"G":o=ARS.G.color;break}break;case"SRS":switch(r){case"I":o=SRS.I.color;break;case"T":o=SRS.T.color;break;case"L":o=SRS.L.color;break;case"J":o=SRS.J.color;break;case"S":o=SRS.S.color;break;case"Z":o=SRS.Z.color;break;case"O":o=SRS.O.color;break;case"G":o=SRS.G.color;break}break;case"GB":switch(r){case"I":o=GB.I.color;break;case"T":o=GB.T.color;break;case"L":o=GB.L.color;break;case"J":o=GB.J.color;break;case"S":o=GB.S.color;break;case"Z":o=GB.Z.color;break;case"O":o=GB.O.color;break;case"G":o=GB.G.color;break}break}if(s=="inactive"){if(r=="E"){$("#pf-"+i+"-row-"+t+"-col-"+e+" .inactive").attr("style","background-color: transparent;")}else{$("#pf-"+i+"-row-"+t+"-col-"+e+" .inactive").attr("style","background-color: "+o+";")}}if(s=="resetactive"){$("table div.active").attr("style","background-color: transparent;")}if(s=="active"){$("#pf-"+i+"-row-"+t+"-col-"+e+" .active").attr("style","background-color: "+o+";")}};Painter.prototype.drawBlock=function(e,t,r,a,i,s){if(r){var o;var n=false;switch(i){case"inactive":o=this.ContextPF;break;case"preview":o=this.ContextPreview;break;case"active":o=this.ContextActive;break;case"flash":o=this.ContextActive;break;case"nexthold":o=this.ContextNextHold;break;case"nextholdmini":o=this.ContextNextHold;n=true;break}o.beginPath();if(n){if(e>=17){o.rect(6+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*this.blockSize/2,this.blockSize/2,this.blockSize/2)}else{o.rect(5+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*this.blockSize/2,this.blockSize/2,this.blockSize/2)}}else{o.rect(this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)}var c;var l;var h;if(n){l=this.spritemini}else{l=this.sprite}switch(a){case"ARS":switch(r){case"I":c=ARS.I.color;h=ARS.I.offset;break;case"T":c=ARS.T.color;h=ARS.T.offset;break;case"L":c=ARS.L.color;h=ARS.L.offset;break;case"J":c=ARS.J.color;h=ARS.J.offset;break;case"S":c=ARS.S.color;h=ARS.S.offset;break;case"Z":c=ARS.Z.color;h=ARS.Z.offset;break;case"O":c=ARS.O.color;h=ARS.O.offset;break;case"G":c=ARS.G.color;h=ARS.G.offset;break}break;case"SRS":switch(r){case"I":c=SRS.I.color;h=SRS.I.offset;break;case"T":c=SRS.T.color;h=SRS.T.offset;break;case"L":c=SRS.L.color;h=SRS.L.offset;break;case"J":c=SRS.J.color;h=SRS.J.offset;break;case"S":c=SRS.S.color;h=SRS.S.offset;break;case"Z":c=SRS.Z.color;h=SRS.Z.offset;break;case"O":c=SRS.O.color;h=SRS.O.offset;break;case"G":c=SRS.G.color;h=SRS.G.offset;break}break;case"GB":switch(r){case"I":c=GB.I.color;h=GB.I.offset;break;case"T":c=GB.T.color;h=GB.T.offset;break;case"L":c=GB.L.color;h=GB.L.offset;break;case"J":c=GB.J.color;h=GB.J.offset;break;case"S":c=GB.S.color;h=GB.S.offset;break;case"Z":c=GB.Z.color;h=GB.Z.offset;break;case"O":c=GB.O.color;h=GB.O.offset;break;case"G":c=GB.G.color;h=GB.G.offset;break}break}if(i=="flash"){if(a=="ARS"){c=ARS.Flash.color;h=ARS.Flash.offset}if(a=="SRS"){c=SRS.Flash.color;h=SRS.Flash.offset}if(a=="GB"){c=GB.Flash.color;h=GB.Flash.offset}}o.fillStyle=c;o.fill();o.closePath();if(l){if(n){if(e>=17){o.drawImage(l,h[0]*(this.blockSize/2),h[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,6+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}else{o.drawImage(l,h[0]*(this.blockSize/2),h[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,5+this.PFOriginX+e*this.blockSize/2,this.PFOriginY+t*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}}else{o.drawImage(l,h[0]*this.blockSize,h[1]*this.blockSize,this.blockSize,this.blockSize,this.PFOriginX+e*this.blockSize,this.PFOriginY+t*this.blockSize,this.blockSize,this.blockSize)}}}};Painter.prototype.highlight=function(e,t){var r=this.PFOriginX+(e+.5)*this.blockSize;var a=this.PFOriginY+(t+.5)*this.blockSize;var i=20;function s(){setTimeout(function(){var e=window.requestAnimationFrame(s);if(i>0){this.myself.ContextPreview.beginPath();this.myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";this.myself.ContextPreview.globalCompositeOperation="destination-out";this.myself.ContextPreview.arc(r,a,i+2,2*Math.PI,false);this.myself.ContextPreview.arc(r,a,i+1,2*Math.PI,false);this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();this.myself.ContextPreview.beginPath();this.myself.ContextPreview.arc(r,a,i,2*Math.PI,false);this.myself.ContextPreview.globalCompositeOperation="source-over";this.myself.ContextPreview.strokeStyle="white";this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();i-=1}else{this.myself.ContextPreview.beginPath();this.myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";this.myself.ContextPreview.globalCompositeOperation="destination-out";this.myself.ContextPreview.arc(r,a,i+2,2*Math.PI,false);this.myself.ContextPreview.arc(r,a,i+1,2*Math.PI,false);this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();window.cancelAnimationFrame(e)}},1e3/60)}};Painter.prototype.resetJoystick=function(){var e=this.CanvasControl.height();this.ContextControl.clearRect(0,0,e,e);this.ContextControl.drawImage(this.joypalette,0,0,e,e,0,0,e,e)};Painter.prototype.drawJoystick=function(e,t){var r;switch(t){case"rest":r=0;break;case"pressed":r=35;break;case"holded":r=70;break}switch(e){case"all":this.ContextControl.drawImage(this.joypalette,0,r,37,37,0,0,37,37);break;case"u":this.ContextControl.drawImage(this.joypalette,12,r,11,12,12,0,11,12);break;case"d":this.ContextControl.drawImage(this.joypalette,12,12+r,11,24,12,12,11,24);break;case"l":this.ContextControl.drawImage(this.joypalette,0,12+r,12,11,0,12,12,11);break;case"r":this.ContextControl.drawImage(this.joypalette,12,12+r,24,11,12,12,24,11);break;case"ul":this.ContextControl.drawImage(this.joypalette,3,3+r,9,9,3,3,9,9);break;case"ur":this.ContextControl.drawImage(this.joypalette,23,3+r,9,9,23,3,9,9);break;case"dl":this.ContextControl.drawImage(this.joypalette,3,23+r,9,9,3,23,9,9);break;case"dr":this.ContextControl.drawImage(this.joypalette,23,23+r,9,9,23,23,9,9);break}};Painter.prototype.drawAllButtons=function(e,t){this.drawButton("A",e);this.drawButton("B",e);this.drawButton("C",e);this.drawButton("D",e)};Painter.prototype.drawButton=function(e,t){var r;switch(t){case"rest":r=0;break;case"pressed":r=35;break;case"holded":r=70;break}switch(e){case"A":this.ContextControl.drawImage(this.joypalette,37,1+r,14,15,37,1,14,15);break;case"B":this.ContextControl.drawImage(this.joypalette,53,1+r,14,15,53,1,14,15);break;case"C":this.ContextControl.drawImage(this.joypalette,69,1+r,14,15,69,1,14,15);break;case"D":this.ContextControl.drawImage(this.joypalette,37,16+r,14,18,37,16,14,18);break}};Painter.prototype.drawButton_old=function(e,t){var r=this.CanvasControl.height();var a=r/5;this.ContextControl.textBaseline="middle";this.ContextControl.font="bold 10px sans-serif";this.ContextControl.beginPath();switch(e){case"A":this.ContextControl.clearRect(r+r/4-a-1,r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4,r/4,a,0,2*Math.PI,false);break;case"B":this.ContextControl.clearRect(r+r/4+2*a+r/16-a-1,r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4+2*a+r/16,r/4,a,0,2*Math.PI,false);break;case"C":this.ContextControl.clearRect(r+r/4+4*a+2*r/16-a-1,r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4+4*a+2*r/16,r/4,a,0,2*Math.PI,false);break;case"D":this.ContextControl.clearRect(r+r/4-a-1,3*r/4-a-1,2*a+2,2*a+2);this.ContextControl.arc(r+r/4,3*r/4,a,0,2*Math.PI,false);break}this.ContextControl.closePath();switch(t){case"pressed":this.ContextControl.fillStyle="#ff0000";break;case"holded":this.ContextControl.fillStyle="#ffa600";break;case"rest":this.ContextControl.fillStyle="#808080";break}this.ContextControl.fill();switch(e){case"A":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("A",r+r/4-r/10,r/4+1);break;case"B":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("B",r+r/4+2*a+r/16-r/10,r/4+1);break;case"C":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("C",r+r/4+4*a+2*r/16-r/10,r/4+1);break;case"D":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("H",r+r/4-r/10,3*r/4+1);break}};Painter.prototype.frameCount=function(e,t){$("#"+this.IDString+"-current-frame").attr("value",e);$("#"+this.IDString+"-total-frame").html(t)};function Diagram(e){var t=this;this.painter=e;this.frames=[];this.current_frame=0;this.playing=false}Diagram.prototype.new_frame=function(){this.current_frame++;this.painter.eraseLayer("all");var e=new Frame(this.painter);this.frames.splice(this.current_frame,0,e);this.update_framecount()};Diagram.prototype.remove_current_frame=function(){if(this.frames.length>1){if(this.current_frame-1>=0){this.current_frame--;this.frames.splice(this.current_frame+1,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}else{this.frames.splice(this.current_frame,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}}else{this.current_frame=0;this.frames[this.current_frame].clear("all")}};Diagram.prototype.init=function(){this.frames.push(new Frame(this.painter))};Diagram.prototype.new_copy_frame=function(){var e=this.frames[this.current_frame].print();this.new_frame();this.frames[this.current_frame].load(e,"blank")};Diagram.prototype.remove_following_frames=function(){console.log(this.current_frame+1);this.frames.splice(this.current_frame+1);this.frames[this.current_frame].draw()};Diagram.prototype.remove_all_playfields=function(){this.current_frame=this.frames.length;while(this.current_frame>0){this.remove_current_frame()}this.frames[0].clear("all");this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.remove_all_playfields2=function(){this.frames.splice(1);this.frames[0].clear("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.goto_frame=function(e){this.painter.eraseLayer("all");this.current_frame=e;if(e==0){this.frames[this.current_frame].draw()}else{var t={border:true};this.frames[this.current_frame].draw(t)}this.update_framecount()};Diagram.prototype.first_frame=function(){this.painter.eraseLayer("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.previous_frame=function(){if(this.current_frame>0){this.painter.eraseLayer("all");this.current_frame--,this.frames[this.current_frame].draw();this.update_framecount()}};Diagram.prototype.next_frame=function(){this.painter.eraseLayer("all");this.current_frame++,this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.last_frame=function(){this.painter.eraseLayer("all");this.current_frame=parseInt(this.frames.length-1,0);this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.update_framecount=function(){this.painter.frameCount(this.current_frame+1,this.frames.length);this.painter.drawProgressbar(this.current_frame+1,this.frames.length)};Diagram.prototype.print=function(){var e="";e+=this.frames[0].print();if(this.frames.length){for(var t=1,r=this.frames.length;t<r;t++){e+="+";e+=this.print_differences(t,t-1)}}return e};Diagram.prototype.print_differences=function(e,t){var r="";var a="";if(this.frames[e].activePieceType!=this.frames[t].activePieceType||this.frames[e].activePieceOrientation!=this.frames[t].activePieceOrientation||this.frames[e].activePiecePositionX!=this.frames[t].activePiecePositionX||this.frames[e].activePiecePositionY!=this.frames[t].activePiecePositionY){if(this.frames[e].activePieceType){r+="A~"+this.frames[e].activePieceType;a=alphanumconvert(this.frames[e].activePiecePositionX);r+=a;a=alphanumconvert(this.frames[e].activePiecePositionY);r+=a+this.frames[e].activePieceOrientation+"_";a=""}else{r+="A~E_"}}var i=[];var s=true;var o=false;var n=[];var c=true;var l=false;for(var h=0;h<10;h++){for(var f=0;f<20;f++){if(this.frames[e].playfield[h][f][0]!=this.frames[t].playfield[h][f][0]){if(s){if(this.frames[e].playfield[h][f][0]){i.push([]);i[0].val=this.frames[e].playfield[h][f][0];i[0].push(alphanumconvert(h)+alphanumconvert(f));s=false}else{i.push([]);i[0].val="";i[0].push(alphanumconvert(h)+alphanumconvert(f));s=false}}else{for(var v=0,d=i.length;v<d;v++){console.log(i);if(this.frames[e].playfield[h][f][0]==i[v].val){if(o){o=false;i[v].push(alphanumconvert(h)+alphanumconvert(f));console.log("ping")}else{i[v].push(alphanumconvert(h)+alphanumconvert(f));break}}else if(v==parseFloat(i.length-1)){i.push([]);i[parseFloat(v+1)].val=this.frames[e].playfield[h][f][0];i[parseFloat(v+1)].push(alphanumconvert(h)+alphanumconvert(f));o=true}}}}if(this.frames[e].playfield[h][f][1]!=this.frames[t].playfield[h][f][1]){if(c){if(this.frames[e].playfield[h][f][1]){n.push([]);n[0].val=this.frames[e].playfield[h][f][1];n[0].push(alphanumconvert(h)+alphanumconvert(f));c=false}else{n.push([]);n[0].val="";n[0].push(alphanumconvert(h)+alphanumconvert(f));c=false}}else{for(var v=0,d=n.length;v<d;v++){if(this.frames[e].playfield[h][f][1]==n[v].val){if(l){l=false;n[v].push(alphanumconvert(h)+alphanumconvert(f))}else{n[v].push(alphanumconvert(h)+alphanumconvert(f));break}}else if(v==parseFloat(n.length-1)){n.push([]);n[parseFloat(v+1)].val=this.frames[e].playfield[h][f][1];n[parseFloat(v+1)].push(alphanumconvert(h)+alphanumconvert(f));l=true}}}}}}if(i){r+="I";a="";for(var h=0,b=i.length;h<b;h++){a+="~";if(i[h].val){a+=i[h].val}else{a+="E"}for(var f=0,u=i[h].length;f<u;f++){a+=i[h][f]}}r+=a+"_"}if(n){r+="D";a="";for(var h=0,b=n.length;h<b;h++){a+="~";if(n[h].val){a+=n[h].val+"*"}else{a+="E*"}for(var f=0,u=n[h].length;f<u;f++){a+=n[h][f]}}r+=a+"_"}a="";if(this.frames[e].RS!=this.frames[t].RS){r+="R~"+this.frames[e].RS+"_"}if(this.frames[e].activePieceOpacity!=this.frames[t].activePieceOpacity){r+="O~"+this.frames[e].activePieceOpacity+"_"}if(this.frames[e].whiteborder!=this.frames[t].whiteborder){if(this.frames[e].whiteborder){r+="W~1_"}else{r+="W~0_"}}if(this.frames[e].border!=this.frames[t].border){r+="B~"+this.frames[e].border+"_"}if(this.frames[e].duration!=this.frames[t].duration){r+="T~"+parseInt(this.frames[e].duration,10)+"_"}if(this.frames[e].joystick_direction!=this.frames[t].joystick_direction||this.frames[e].joystick_state!=this.frames[t].joystick_state){switch(this.frames[e].joystick_state){case"rest":a+="r";break;case"pressed":a+="p";break;case"holded":a+="h";break}switch(this.frames[e].joystick_direction){case"u":a+="8";break;case"r":a+="6";break;case"d":a+="2";break;case"l":a+="4";break;case"c":a+="5";break;case"ul":a+="7";break;case"ur":a+="9";break;case"dr":a+="3";break;case"dl":a+="1";break}r+="J~"+a+"_";a=""}if(!this.frames[e].button_state.compare(this.frames[t].button_state)){for(var h=0,b=this.frames[e].button_state.length;h<b;h++){switch(this.frames[e].button_state[h]){case"rest":a+="r";break;case"pressed":a+="p";break;case"holded":a+="h";break}}r+="C~"+a+"_";a=""}if(!this.frames[e].nexthold.compare(this.frames[t].nexthold)){for(var h=0,b=this.frames[e].nexthold.length;h<b;h++){if(this.frames[e].nexthold[h]){a+=this.frames[e].nexthold[h]}else{a+=0}}r+="N~"+a+"_";a=""}if(this.frames[e].comment.localeCompare(this.frames[t].comment)!==0){r+="S~"+this.frames[e].comment}return r};Diagram.prototype.load=function(e){if(!e){return}this.remove_all_playfields();this.current_frame=0;this.update_framecount();var t=e.split("+");this.frames[0].load(t[0],"blank");for(var r=1,a=t.length;r<a;r++){this.new_copy_frame();this.frames[r].load(t[r],"differences")}this.frames[this.current_frame].draw();this.update_framecount()};var GLOBAL_FRAME_COUNTER=0;function Frame(e){GLOBAL_FRAME_COUNTER++;var t=this;this.sself=this;this.id=GLOBAL_FRAME_COUNTER;this.painter=e;this.height=20;this.width=10;this.RS="ARS";this.border="Master";this.whiteborder=false;this.playfield=[];this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.activePieceOpacity=1;this.duration=15;this.nexthold=["","","",""];this.joystick_direction="c";this.joystick_state="rest";this.button_state=["rest","rest","rest","rest","rest","rest"];this.comment="";for(var r=0,a=this.width;r<a;r++){this.playfield.push(new Array(this.height));for(var i=0,s=this.height;i<s;i++){this.playfield[r][i]=new Array(1);this.playfield[r][i][0]="";this.playfield[r][i][1]=""}}}Frame.prototype.modify=function(e,t,r){if(r=="E"){this.playfield[e][t][0]=""}else{this.playfield[e][t][0]=r}};Frame.prototype.is_in=function(e,t){if(e<0||t<0||e>=this.width||t>=this.height){return false}return true};Frame.prototype.lookup=function(e,t){return this.playfield[e][t][0]};Frame.prototype.piece_is_in=function(e,t,r,a){var i=getMatrix(r,a,this.RS);if(a=="singleton"&&this.is_in(parseInt(e,10),parseInt(t,10))){return true}else{var s=0;for(var o=0;o<4;o++){for(var n=0;n<4;n++){if(i[o][n]&&this.is_in(parseInt(e-1+n,10),parseInt(t-1+o,10))){s++}}}if(s==4){return true}return false}};Frame.prototype.draw=function(e){for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){if(this.playfield[t][a][0]){this.painter.drawBlock(t,a,this.playfield[t][a][0],this.RS,"inactive")}if(this.playfield[t][a][1]){this.painter.drawDeco(t,a,this.playfield[t][a][1],"decoration")}}}if(this.activePieceType){var s=getMatrix(this.activePieceType,this.activePieceOrientation,this.RS);for(var t=0;t<4;t++){for(var a=0;a<4;a++){if(s[t][a]){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+a,10),parseInt(this.activePiecePositionY-1+t,10),this.activePieceType,this.RS,"active");if(this.activePieceOpacity=="Flash"){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+a,10),parseInt(this.activePiecePositionY-1+t,10),this.activePieceType,this.RS,"flash")}}}}}for(var t=0,r=this.nexthold.length;t<r;t++){this.painter.drawNextHold(t,this.nexthold[t],this.RS)}if(!(e&&e["border"])){this.painter.drawBorder(this.border)}if(!(e&&e["joystick"])){this.painter.resetJoystick();this.painter.drawJoystick(this.joystick_direction,this.joystick_state)}if(!(e&&e["buttons"])){this.painter.drawButton("A",this.button_state[0]);this.painter.drawButton("B",this.button_state[1]);this.painter.drawButton("C",this.button_state[2]);this.painter.drawButton("D",this.button_state[3])}this.painter.drawComment(this.comment);this.painter.drawDuration(this.duration);this.painter.drawOpacity(this.activePieceOpacity);this.painter.changeActiveOpacity(this.activePieceOpacity);this.painter.eraseLayer("whiteborder");if(this.whiteborder){this.painter.drawWhiteBorder(this.playfield)}};Frame.prototype.print=function(){var e="";var t="";if(this.activePieceType){e+="A~"+this.activePieceType;t=alphanumconvert(this.activePiecePositionX);e+=t;t=alphanumconvert(this.activePiecePositionY);e+=t+this.activePieceOrientation+"_";t=""}if(this.RS!="ARS"){e+="R~"+this.RS+"_"}if(this.activePieceOpacity!=1){e+="O~"+this.activePieceOpacity+"_"}if(this.border!="Master"){e+="B~"+this.border+"_"}if(this.duration!=15){e+="T~"+this.duration+"_"}switch(this.joystick_state){case"rest":t+="r";break;case"pressed":t+="p";break;case"holded":t+="h";break}switch(this.joystick_direction){case"u":t+="8";break;case"r":t+="6";break;case"d":t+="2";break;case"l":t+="4";break;case"c":t+="5";break;case"ul":t+="7";break;case"ur":t+="9";break;case"dr":t+="3";break;case"dl":t+="1";break}e+="J~"+t+"_";t="";for(var r=0,a=this.button_state.length;r<a;r++){switch(this.button_state[r]){case"rest":t+="r";break;case"pressed":t+="p";break;case"holded":t+="h";break}}e+="C~"+t+"_";t="";if(this.comment){e+="S~"+this.comment+"_"}if(this.whiteborder){e+="W~1_"}if(this.nexthold.length){for(var r=0,a=this.nexthold.length;r<a;r++){if(this.nexthold[r]){t+=this.nexthold[r]}else{t+=0}}e+="N~"+t+"_";t=""}var i=[];var s=[];var o=true;var n=true;for(var r=0;r<10;r++){for(var c=0;c<20;c++){if(this.playfield[r][c][0]){if(o){i.push([]);i[0].val=this.playfield[r][c][0];i[0].push(alphanumconvert(r)+alphanumconvert(c));o=false}else{for(var l=0,h=i.length;l<h;l++){if(this.playfield[r][c][0]==i[l].val){i[l].push(alphanumconvert(r)+alphanumconvert(c));break}else if(l==parseFloat(i.length-1)){i.push([]);i[parseFloat(l+1)].val=this.playfield[r][c][0];i[parseFloat(l+1)].push(alphanumconvert(r)+alphanumconvert(c))}}}}if(this.playfield[r][c][1]){if(n){s.push([]);s[0].val=this.playfield[r][c][1];s[0].push(alphanumconvert(r)+alphanumconvert(c));n=false}else{for(var l=0,h=s.length;l<h;l++){if(this.playfield[r][c][1]==s[l].val){s[l].push(alphanumconvert(r)+alphanumconvert(c));break}else if(l==parseFloat(s.length-1)){s.push([]);s[parseFloat(l+1)].val=this.playfield[r][c][1];s[parseFloat(l+1)].push(alphanumconvert(r)+alphanumconvert(c))}}}}}}if(i.length){e+="I~";for(var r=0,a=i.length;r<a;r++){t+=i[r].val;for(var c=0,f=i[r].length;c<f;c++){t+=i[r][c]}if(r<i.length-1){t+="~"}}e+=t+"_"}t="";if(s.length){e+="D~";for(var r=0,a=s.length;r<a;r++){t+=s[r].val+"*";for(var c=0,f=s[r].length;c<f;c++){t+=s[r][c]}if(r<s.length-1){t+="~"}}e+=t+"_"}t="";return e};Frame.prototype.load=function(e,t){if(t!="differences"){this.clear("all")}if(!e){return}var r=e.split("_");for(var a=0,i=r.length;a<i;a++){var s=r[a].split("~");switch(s[0]){case"A":if(s[1].charAt(0)!=="E"){this.activePieceType=s[1].charAt(0);this.activePieceOrientation=s[1].slice(3);this.activePiecePositionX=alphanumconvert(s[1].charAt(1));this.activePiecePositionY=alphanumconvert(s[1].charAt(2))}else{this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY=""}break;case"I":for(var o=1,n=s.length;o<n;o++){var c=s[o].charAt(0);if(c=="E"){c=""}for(var l=1,h=s[o].length;l<h;l+=2){var f=s[o].charAt(l);var v=s[o].charAt(l+1);this.modify(alphanumconvert(f),alphanumconvert(v),c)}}break;case"D":for(var o=1,n=s.length;o<n;o++){var d=s[o].split("*");var c=d[0];if(c=="E"){c=""}if(s[1]!==""){for(var l=0,h=d[1].length;l<h;l+=2){var b=d[1].charAt(l);var u=d[1].charAt(l+1);this.modify_decoration(alphanumconvert(b),alphanumconvert(u),c)}}}break;case"R":this.RS=s[1];break;case"O":this.activePieceOpacity=s[1];break;case"N":for(var l=0,h=s[1].length;l<h;l++){if(s[1].charAt(l)!="0"){this.nexthold[l]=s[1].charAt(l)}else{this.nexthold[l]=""}}break;case"S":this.comment=s[1];break;case"W":this.whiteborder=s[1];break;case"T":this.duration=s[1];
break;case"B":this.border=s[1];break;case"J":var k,w;switch(s[1].charAt(0)){case"r":k="rest";break;case"p":k="pressed";break;case"h":k="holded";break}switch(s[1].charAt(1)){case"8":w="u";break;case"6":w="r";break;case"2":w="d";break;case"4":w="l";break;case"7":w="ul";break;case"5":w="c";break;case"9":w="ur";break;case"3":w="dr";break;case"1":w="dl";break}this.modify_control(w,k);break;case"C":for(var l=0,h=s[1].length;l<=h;l++){var p;switch(s[1].charAt(l)){case"r":p="rest";break;case"h":p="holded";break;case"p":p="pressed";break}switch(l){case 0:this.modify_button("A",p);break;case 1:this.modify_button("B",p);break;case 2:this.modify_button("C",p);break;case 3:this.modify_button("D",p);break}}break}}};Frame.prototype.clear=function(e){switch(e){case"inactive":this.painter.eraseLayer("inactive");for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){this.playfield[t][a][0]=""}}break;case"active":this.painter.eraseLayer("active");this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";break;case"decoration":this.painter.eraseLayer("decoration");for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){this.playfield[t][a][1]=""}}break;case"all":this.painter.eraseLayer("inactive");this.painter.eraseLayer("active");this.painter.eraseLayer("decoration");for(var t=0,r=this.width;t<r;t++){for(var a=0,i=this.height;a<i;a++){this.playfield[t][a][0]="";this.playfield[t][a][1]=""}}this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.comment="";break}};Frame.prototype.is_piece_colliding=function(e,t,r,a){var i=getMatrix(r,a,this.RS);var s="",o="";for(var n=0;n<4;n++){for(var c=0;c<4;c++){if(i[n][c]){}if(i[n][c]&&!this.is_in(parseInt(e-1+c,10),parseInt(t-1+n,10))){return true}if(i[n][c]&&this.is_in(parseInt(e-1+c,10),parseInt(t-1+n,10))&&this.playfield[parseInt(e-1+c,10)][parseInt(t+n-1,10)][0]){return true}}}return false};Frame.prototype.addPiece=function(e,t,r,a,i,s){var o=getMatrix(r,a,this.RS);var n=true;var c=0;while(s&n){c=0;if(this.is_piece_colliding(parseInt(e),parseInt(t),r,a)){n=false}else{t++}}if(s){t--}if(i=="inactive"||i=="garbage"){this.painter.CanvasPreview.attr("width",this.painter.CanvasPreview.width())}if(i=="active"){this.activePieceType=r;this.activePieceOrientation=a;this.activePiecePositionX=e;this.activePiecePositionY=t;this.painter.CanvasActive.attr("width",this.painter.CanvasPreview.width())}if(i=="decoration-preview"){this.painter.drawDeco(e,t,r,"preview")}else if(i=="decoration"){this.modify_decoration(e,t,r);this.painter.drawDeco(e,t,r,"decoration");this.painter.highlight(e,t)}else{for(var l=0;l<4;l++){for(var h=0;h<4;h++){if(o[l][h]&&this.piece_is_in(e,t,r,a)){switch(i){case"inactive":this.modify(parseInt(e-1+h,10),parseInt(t-1+l,10),r);this.painter.drawBlock(parseInt(e-1+h,10),parseInt(t-1+l,10),r,this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e-1+h,t-1+l)}this.painter.highlight(e-1+h,t-1+l);break;case"garbage":this.modify(parseInt(e-1+h,10),parseInt(t-1+l,10),"G");this.painter.drawBlock(parseInt(e-1+h,10),parseInt(t-1+l,10),"G",this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,e-1+h,t-1+l)}this.painter.highlight(e-1+h,t-1+l);break;case"preview":this.painter.drawBlock(parseInt(e-1+h,10),parseInt(t-1+l,10),r,this.RS,"preview");break;case"active":this.painter.drawBlock(parseInt(e-1+h,10),parseInt(t-1+l,10),r,this.RS,"active");this.painter.highlight(e-1+h,t-1+l);break;case"erase":this.removeBlock(parseInt(e-1+h,10),parseInt(t-1+l,10));this.painter.highlight(e-1+h,t-1+l);break;case"preview-eraser":this.painter.drawBlock(parseInt(e-1+h,10),parseInt(t-1+l,10),"G",this.RS,"preview");break}}}}}};Frame.prototype.modify_decoration=function(e,t,r){this.playfield[e][t][1]=r};Frame.prototype.modify_control=function(e,t){this.joystick_state=t;this.joystick_direction=e};Frame.prototype.modify_button=function(e,t){var r="";switch(e){case"A":r=0;break;case"B":r=1;break;case"C":r=2;break;case"D":r=3;break}this.button_state[r]=t};var ARS={I:{color:"red",offset:[2,1],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],ccw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"cyan",offset:[6,1],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,1],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,1],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"magenta",offset:[8,0],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"green",offset:[5,1],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,1],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var SRS={I:{color:"cyan",offset:[6,2],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,2],i:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,2],i:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],ccw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,2],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"green",offset:[5,2],i:[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"purple",offset:[8,2],i:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"red",offset:[2,2],i:[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var GB={I:{color:"yellowgreen",offset:[6,9],i:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"yellowgreen",offset:[1,9],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],u:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"yellowgreen",offset:[3,9],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellowgreen",offset:[4,9],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"yellowgreen",offset:[5,9],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"yellowgreen",offset:[8,9],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"yellowgreen",offset:[2,9],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var decoration={n1:{s:[0,0],e:[1,1]},n2:{s:[1,0],e:[2,1]},n3:{s:[2,0],e:[3,1]},n4:{s:[3,0],e:[4,1]},n5:{s:[4,0],e:[5,1]},n6:{s:[5,0],e:[6,1]},n7:{s:[6,0],e:[7,1]},n8:{s:[7,0],e:[8,1]},n9:{s:[8,0],e:[9,1]},n0:{s:[9,0],e:[10,1]},smallccw:{s:[0,1],e:[1,2]},smallcw:{s:[1,1],e:[2,2]},smalloktick:{s:[2,1],e:[3,2]},smallokcircle:{s:[3,1],e:[4,2]},smallnocross:{s:[4,1],e:[5,2]},smallquestion:{s:[5,1],e:[6,2]},smallexclamation:{s:[6,1],e:[7,2]},nwarrow:{s:[0,2],e:[1,3]},narrow:{s:[1,2],e:[2,3]},nearrow:{s:[2,2],e:[3,3]},warrow:{s:[0,3],e:[1,4]},earrow:{s:[2,3],e:[3,4]},swarrow:{s:[0,4],e:[1,5]},sarrow:{s:[1,4],e:[2,5]},searrow:{s:[2,4],e:[3,5]},bigcw:{s:[3,2],e:[5,4]},bigccw:{s:[5,2],e:[7,4]},bigquestion:{s:[7,2],e:[9,4]},bigexclamation:{s:[9,2],e:[10,4]},bigoktick:{s:[3,4],e:[5,6]},bigokcircle:{s:[5,4],e:[7,6]},bignocross:{s:[7,4],e:[9,6]},overlayyellow:{s:[1,6],e:[2,7]},overlayblue:{s:[2,6],e:[3,7]},overlaygreen:{s:[3,6],e:[4,7]},overlaypink:{s:[4,6],e:[5,7]},overlayorange:{s:[5,6],e:[6,7]},clear1:{s:[0,7],e:[10,8]},clear2:{s:[0,8],e:[10,9]},clear3:{s:[0,9],e:[10,10]},clear4:{s:[0,10],e:[10,11]},clear5:{s:[0,11],e:[10,12]},clear6:{s:[0,12],e:[10,13]},clear7:{s:[0,13],e:[10,14]}};function getMatrix(e,t,r){var a;switch(r){case"ARS":switch(e){case"I":switch(t){case"i":a=ARS.I.i;break;case"cw":a=ARS.I.cw;break;case"ccw":a=ARS.I.ccw;break;case"u":a=ARS.I.u;break;case"singleton":a=ARS.I.singleton;break}break;case"T":switch(t){case"i":a=ARS.T.i;break;case"cw":a=ARS.T.cw;break;case"ccw":a=ARS.T.ccw;break;case"u":a=ARS.T.u;break;case"singleton":a=ARS.T.singleton;break}break;case"L":switch(t){case"i":a=ARS.L.i;break;case"cw":a=ARS.L.cw;break;case"ccw":a=ARS.L.ccw;break;case"u":a=ARS.L.u;break;case"singleton":a=ARS.L.singleton;break}break;case"J":switch(t){case"i":a=ARS.J.i;break;case"cw":a=ARS.J.cw;break;case"ccw":a=ARS.J.ccw;break;case"u":a=ARS.J.u;break;case"singleton":a=ARS.J.singleton;break}break;case"S":switch(t){case"i":a=ARS.S.i;break;case"cw":a=ARS.S.cw;break;case"ccw":a=ARS.S.ccw;break;case"u":a=ARS.S.u;break;case"singleton":a=ARS.J.singleton;break}break;case"Z":switch(t){case"i":a=ARS.Z.i;break;case"cw":a=ARS.Z.cw;break;case"ccw":a=ARS.Z.ccw;break;case"u":a=ARS.Z.u;break;case"singleton":a=ARS.Z.singleton;break}break;case"O":switch(t){case"i":a=ARS.O.i;break;case"cw":a=ARS.O.cw;break;case"ccw":a=ARS.O.ccw;break;case"u":a=ARS.O.u;break;case"singleton":a=ARS.O.singleton;break}break;case"G":switch(t){case"i":a=ARS.G.i;break;case"cw":a=ARS.G.cw;break;case"ccw":a=ARS.G.ccw;break;case"u":a=ARS.G.u;break;case"singleton":a=ARS.G.singleton;break}break}break;case"SRS":switch(e){case"I":switch(t){case"i":a=SRS.I.i;break;case"cw":a=SRS.I.cw;break;case"ccw":a=SRS.I.ccw;break;case"u":a=SRS.I.u;break;case"singleton":a=SRS.I.singleton;break}break;case"T":switch(t){case"i":a=SRS.T.i;break;case"cw":a=SRS.T.cw;break;case"ccw":a=SRS.T.ccw;break;case"u":a=SRS.T.u;break;case"singleton":a=SRS.T.singleton;break}break;case"L":switch(t){case"i":a=SRS.L.i;break;case"cw":a=SRS.L.cw;break;case"ccw":a=SRS.L.ccw;break;case"u":a=SRS.L.u;break;case"singleton":a=SRS.L.singleton;break}break;case"J":switch(t){case"i":a=SRS.J.i;break;case"cw":a=SRS.J.cw;break;case"ccw":a=SRS.J.ccw;break;case"u":a=SRS.J.u;break;case"singleton":a=SRS.J.singleton;break}break;case"S":switch(t){case"i":a=SRS.S.i;break;case"cw":a=SRS.S.cw;break;case"ccw":a=SRS.S.ccw;break;case"u":a=SRS.S.u;break;case"singleton":a=SRS.S.singleton;break}break;case"Z":switch(t){case"i":a=SRS.Z.i;break;case"cw":a=SRS.Z.cw;break;case"ccw":a=SRS.Z.ccw;break;case"u":a=SRS.Z.u;break;case"singleton":a=SRS.Z.singleton;break}break;case"O":switch(t){case"i":a=SRS.O.i;break;case"cw":a=SRS.O.cw;break;case"ccw":a=SRS.O.ccw;break;case"u":a=SRS.O.u;break;case"singleton":a=SRS.O.singleton;break}break;case"G":switch(t){case"i":a=SRS.G.i;break;case"cw":a=SRS.G.cw;break;case"ccw":a=SRS.G.ccw;break;case"u":a=SRS.G.u;break;case"singleton":a=SRS.G.singleton;break}break}break;case"GB":switch(e){case"I":switch(t){case"i":a=GB.I.i;break;case"cw":a=GB.I.cw;break;case"ccw":a=GB.I.ccw;break;case"u":a=GB.I.u;break;case"singleton":a=GB.I.singleton;break}break;case"T":switch(t){case"i":a=GB.T.i;break;case"cw":a=GB.T.cw;break;case"ccw":a=GB.T.ccw;break;case"u":a=GB.T.u;break;case"singleton":a=GB.T.singleton;break}break;case"L":switch(t){case"i":a=GB.L.i;break;case"cw":a=GB.L.cw;break;case"ccw":a=GB.L.ccw;break;case"u":a=GB.L.u;break;case"singleton":a=GB.L.singleton;break}break;case"J":switch(t){case"i":a=GB.J.i;break;case"cw":a=GB.J.cw;break;case"ccw":a=GB.J.ccw;break;case"u":a=GB.J.u;break;case"singleton":a=GB.J.singleton;break}break;case"S":switch(t){case"i":a=GB.S.i;break;case"cw":a=GB.S.cw;break;case"ccw":a=GB.S.ccw;break;case"u":a=GB.S.u;break;case"singleton":a=GB.S.singleton;break}break;case"Z":switch(t){case"i":a=GB.Z.i;break;case"cw":a=GB.Z.cw;break;case"ccw":a=GB.Z.ccw;break;case"u":a=GB.Z.u;break;case"singleton":a=GB.Z.singleton;break}break;case"O":switch(t){case"i":a=GB.O.i;break;case"cw":a=GB.O.cw;break;case"ccw":a=GB.O.ccw;break;case"u":a=GB.O.u;break;case"singleton":a=GB.O.singleton;break}break;case"G":switch(t){case"i":a=GB.G.i;break;case"cw":a=GB.G.cw;break;case"ccw":a=GB.G.ccw;break;case"u":a=GB.G.u;break;case"singleton":a=GB.G.singleton;break}break}break}return a}function alphanumconvert(e){var t;switch(e){case"a":t=0;break;case"b":t=1;break;case"c":t=2;break;case"d":t=3;break;case"e":t=4;break;case"f":t=5;break;case"g":t=6;break;case"h":t=7;break;case"i":t=8;break;case"j":t=9;break;case"k":t=10;break;case"l":t=11;break;case"m":t=12;break;case"n":t=13;break;case"o":t=14;break;case"p":t=15;break;case"q":t=16;break;case"r":t=17;break;case"s":t=18;break;case"t":t=19;break;case"z":t=-1;break;case-1:t="z";break;case 0:t="a";break;case 1:t="b";break;case 2:t="c";break;case 3:t="d";break;case 4:t="e";break;case 5:t="f";break;case 6:t="g";break;case 7:t="h";break;case 8:t="i";break;case 9:t="j";break;case 10:t="k";break;case 11:t="l";break;case 12:t="m";break;case 13:t="n";break;case 14:t="o";break;case 15:t="p";break;case 16:t="q";break;case 17:t="r";break;case 18:t="s";break;case 19:t="t";break}return t}(function(){var e=0;var t=["ms","moz","webkit","o"];for(var r=0,a=t.length;r<a&&!window.requestAnimationFrame;++r){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(t,r){var a=(new Date).getTime();var i=Math.max(0,16-(a-e));var s=window.setTimeout(function(){t(a+i)},i);e=a+i;return s}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(e){clearTimeout(e)}}})();Array.prototype.compare=function(e){if(this.length!=e.length){return false}for(var t=0,r=e.length;t<r;t++){if(this[t].compare){if(!this[t].compare(e[t])){return false}}if(this[t]!==e[t]){return false}}return true};$(document).ready(function(){$("#tomtom").data("tedigecode",window.location.search)});Diagram.prototype.flate_encode=function(e){return $.base64.encode(RawDeflate.deflate(unescape(encodeURIComponent(e))))};Diagram.prototype.flate_decode=function(e){return decodeURIComponent(escape(RawDeflate.inflate($.base64.decode(e))))};$(document).ready(function(){var e=[];var t=[];$(".tedige-playfield-wrapper").each(function(r){var a=$(this).attr("id");var i=0;var s=[];s[i++]='	<div class="left-pane">';s[i++]='		<div class="nexthold-container">';s[i++]='			<canvas id="'+a+'-nexthold-background"	width="97" height="32" style="z-index:0;"></canvas>';s[i++]='			<canvas id="'+a+'-nexthold"	width="97" height="32" style="z-index:1;"></canvas>';s[i++]="		</div>";s[i++]='		<div class="canvas-container" id="'+a+'-container border-gray">';s[i++]='			<canvas id="'+a+'-border"		width="97" height="177" style="z-index:0;background-color: black"></canvas>';s[i++]='			<canvas id="'+a+'-background"	width="97" height="177" style="z-index:1;//background-color: black"></canvas>';s[i++]='			<canvas id="'+a+'-inactive"	 width="97" height="177" style="z-index:2; border:none; opacity: 0.65"></canvas>';s[i++]='			<canvas id="'+a+'-whiteborder" width="97" height="177" style="z-index:3"></canvas>';s[i++]='			<canvas id="'+a+'-active"		width="97" height="177" style="z-index:4"></canvas>';s[i++]='			<canvas id="'+a+'-deco"			width="97" height="177" style="z-index:5"></canvas>';s[i++]='			<canvas id="'+a+'-decoPin"	 width="97" height="177" style="z-index:6; border:none; opacity: 0.65;display:none"></canvas>';s[i++]='			<canvas id="'+a+'-preview"		width="97" height="177" style="z-index:6"></canvas>';s[i++]="		</div>";s[i++]='		<div class="control-div">';s[i++]='		<canvas class="canvas-control" id="'+a+'-control" width="97" height="35" style=""></canvas>';s[i++]="		</div>";s[i++]="		</div>";s[i++]='		<div class="right-pane">';s[i++]='		<div class="progressbar">';s[i++]="			<p>";s[i++]='				<input class="current-frame" id="'+a+'-current-frame" type="text" style="width: 2.5em; text-align:center" /> / <span id="'+a+'-total-frame">1</span>';s[i++]="			</p>";s[i++]='			<canvas id="'+a+'-progressbar" width="97" height="24" style="border: 1px solid white;" />';s[i++]="		</div>";s[i++]='		<div id="order-control"> ';s[i++]='			<input class="cmd_prev" id="'+a+'-cmd_prev"	value="◄"	type="button" />';s[i++]='			<input class="cmd_next" id="'+a+'-cmd_next"	value="►"	type="button" /><br />';s[i++]='			<input class="cmd_first" id="'+a+'-cmd_first" value="|◄" type="button"/>';s[i++]='			<input class="cmd_last" id="'+a+'-cmd_last" value="►|" type="button"	style="width:2.5em"/><br />';s[i++]='			<input class="cmd_playpause" id="'+a+'-cmd_playpause" value ="▷" type="button" style="width:2.5em" /><br />';s[i++]='			<input class="check-loop" id="'+a+'-loop"type="checkbox"> loop';s[i++]="		</div>";s[i++]='		<div class="links">';s[i++]='			<a class="Link2Editor" href="">[Edit]</a>';s[i++]="		</div>";s[i++]="	</div>";s[i++]='	<div id="under">';s[i++]='		<textarea readonly="" id="'+a+'-comment" class="comment"></textarea>';s[i++]="	</div>";$("#"+a).html(s.join("\n"));t[a]=new Painter(a);e[a]=new Diagram(t[a]);e[a].init();t[a].init()});$(".tedige-playfield-wrapper").each(function(r){var a=$(this).attr("id");var i=setInterval(function(){if(t[a].ready){clearInterval(i);var r=$("#"+a).data("tedigecode");if(r){$("#"+a).find(".Link2Editor").attr("href","http://petitprince.github.io/TeDiGe-2/editor.html?"+r);var s=r.split("-");switch(s[1]){case"all":e[a].load(e[a].flate_decode(s[2]));e[a].frames[e[a].current_frame].draw();break;case"current":e[a].frames[e[a].current_frame].load(e[a].flate_decode(s[2]));e[a].frames[e[a].current_frame].draw();break}e[a].first_frame()}}},10)});$(".cmd_playpause").click(function(){var t=e[$(this).attr("id").split("-")[0]];var r=t.current_frame;var a=t.frames.length;if(t.playing){t.playing=false;$("#pf-cmd_playpause").attr("value","▷")}else{t.playing=true;$("#pf-cmd_playpause").attr("value","||")}var i=0;function s(){if(r<a&&t.playing){if(i<t.frames[t.current_frame].duration){t.goto_frame(r);i++}else{i=0;r++}requestAnimationFrame(s)}else if($("#"+t.painter.IDString+"-loop").is(":checked")){r=0;requestAnimationFrame(s)}}s()});$(".current-frame").blur(function(){if($("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()>0&&$("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()<=e[$(this).attr("id").split("-")[0]].frames.length){e[$(this).attr("id").split("-")[0]].goto_frame($("#tomtom-current-frame").val())}});$(".cmd_first").click(function(){e[$(this).attr("id").split("-")[0]].first_frame()});$(".cmd_prev").click(function(){e[$(this).attr("id").split("-")[0]].previous_frame()});$(".cmd_next").click(function(){if(e[$(this).attr("id").split("-")[0]].current_frame<e[$(this).attr("id").split("-")[0]].frames.length-1){e[$(this).attr("id").split("-")[0]].next_frame()}});$(".cmd_last").click(function(){e[$(this).attr("id").split("-")[0]].last_frame()})});
>>>>>>> table-browser
