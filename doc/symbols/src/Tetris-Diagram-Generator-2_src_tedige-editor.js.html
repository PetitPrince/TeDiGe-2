<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="TOKN">ï»¿</span><span class="COMM">/** @preserve TeDiGe-2 - Editor code, used in the editor page - https://github.com/PetitPrince/TeDiGe-2/  */</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">/** Draw a single palette decoration
<span class='line'>  3</span> 
<span class='line'>  4</span> 	@function
<span class='line'>  5</span> 	@param {string} kind Define the color of the block to be drawn. Possible values: (SZLJTOIG)
<span class='line'>  6</span> 	@param {number} blockSize Size of a typical block
<span class='line'>  7</span> 	@param sprite Sprite object
<span class='line'>  8</span> */</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawPaletteDecoCell</span><span class="PUNC">(</span><span class="NAME">kind</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">sprite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 10</span> 
<span class='line'> 11</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#editor-palette-deco-'</span><span class="PUNC">+</span><span class="NAME">kind</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Canvas</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 13</span> 
<span class='line'> 14</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">spriteOffsetStart</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="WHIT">	</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">kind</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 16</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n1'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n1.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n1.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n2'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n2.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n2.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n3'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n3.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n3.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n4'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n4.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n4.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n5'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n5.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n5.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n6'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n6.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n6.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n7'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n7.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n7.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n8'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n8.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n8.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n9'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n9.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n9.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'n0'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n0.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.n0.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'smallcw'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallcw.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallcw.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'smallccw'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallccw.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallccw.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'smalloktick'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smalloktick.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smalloktick.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'smallokcircle'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallokcircle.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallokcircle.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'smallnocross'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallnocross.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallnocross.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'smallquestion'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallquestion.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallquestion.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'smallexclamation'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallexclamation.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.smallexclamation.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'nwarrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.nwarrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.nwarrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'narrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.narrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.narrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'nearrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.nearrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.nearrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'earrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.earrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.earrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'searrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.searrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.searrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'sarrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.sarrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.sarrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'swarrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.swarrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.swarrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'warrow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.warrow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.warrow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'bigcw'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigcw.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigcw.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'bigccw'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigccw.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigccw.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'bigquestion'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigquestion.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigquestion.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'bigexclamation'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigexclamation.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigexclamation.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'bigoktick'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigoktick.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigoktick.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'bigokcircle'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigokcircle.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bigokcircle.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'bignocross'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bignocross.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.bignocross.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'overlayyellow'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlayyellow.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlayyellow.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'overlayblue'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlayblue.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlayblue.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'overlaygreen'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlaygreen.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlaygreen.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'overlaypink'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlaypink.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlaypink.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'overlayorange'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlayorange.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.overlayorange.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'clear1'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear1.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear1.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'clear2'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear2.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear2.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'clear3'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear3.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear3.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'clear4'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear4.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear4.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'clear5'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear5.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear5.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'clear6'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear6.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear6.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'clear7'</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">spriteOffsetStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear7.s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">spriteOffsetEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decoration.clear7.e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 61</span> 
<span class='line'> 62</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">spriteOffsetStart</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">blockSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">spriteOffsetStart</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">blockSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">spriteOffsetEnd</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">spriteOffsetStart</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">blockSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 65</span> 
<span class='line'> 66</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">spriteOffsetEnd</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">spriteOffsetStart</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">blockSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ny</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 69</span> 
<span class='line'> 70</span> </span><span class="WHIT">	</span><span class="NAME">ctx.drawImage</span><span class="PUNC">(</span><span class="NAME">sprite</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// original image</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">				  </span><span class="NAME">ox</span><span class="PUNC">,</span><span class="NAME">oy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//coordinate on the original image</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">				  </span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// size of the rectangle to will be cut</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">				  </span><span class="NAME">nx</span><span class="PUNC">,</span><span class="NAME">ny</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// destination coordinate</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">				  </span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// destination size</span><span class="WHIT">
<span class='line'> 75</span> 
<span class='line'> 76</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 77</span> 
<span class='line'> 78</span> </span><span class="COMM">/** Draw a single palette piece
<span class='line'> 79</span> 
<span class='line'> 80</span> 	@function
<span class='line'> 81</span> 	@param {string} type Piece type. Possible value: SZLJTOIG
<span class='line'> 82</span> 	@param {string} orientation Piece orientation. Possible value:  i cw ccw u
<span class='line'> 83</span> 	@param {string} RS Define the style of the block. Possible value: 'ARS, 'SRS'
<span class='line'> 84</span> 	@param {number} blockSize Size of a typical block
<span class='line'> 85</span> 	@param sprite Sprite object
<span class='line'> 86</span> */</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawPaletteCell</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="NAME">RS</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">sprite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#editor-palette-'</span><span class="PUNC">+</span><span class="NAME">type</span><span class="PUNC">+</span><span class="NAME">orientation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Canvas</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matrix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getMatrix</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">	</span><span class="NAME">$.data</span><span class="PUNC">(</span><span class="NAME">Canvas</span><span class="PUNC">,</span><span class="STRN">'width'</span><span class="PUNC">,</span><span class="NAME">Canvas.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// data is faster than Canvas.attr('width',Canvas.width()); http://jsperf.com/jquery-data-vs-attr/22</span><span class="WHIT">
<span class='line'> 92</span> 
<span class='line'> 93</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">,</span><span class="NAME">spriteOffset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT">	</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ARS'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'I'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.I.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.I.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'T'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.T.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.T.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'L'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.L.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.L.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'J'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.J.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.J.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.S.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.S.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'Z'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.Z.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.Z.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'O'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.O.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.O.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'G'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.G.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ARS.G.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">		</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'SRS'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'I'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.I.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.I.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'T'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.T.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.T.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'L'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.L.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.L.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'J'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.J.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.J.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'S'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.S.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.S.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'Z'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.Z.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.Z.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'O'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.O.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.O.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'G'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">					</span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.G.color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">					</span><span class="NAME">spriteOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SRS.G.offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">		</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>168</span> 
<span class='line'>169</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">matrix</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">				</span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">				</span><span class="NAME">ctx.rect</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">*</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">				</span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">				</span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">				</span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sprite</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">					</span><span class="NAME">ctx.drawImage</span><span class="PUNC">(</span><span class="NAME">sprite</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// original image</span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">								  </span><span class="NAME">spriteOffset</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">spriteOffset</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//coordinate on the original image</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">								  </span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// size of the rectangle to will be cut</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">								  </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">*</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// destination coordinate</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">								  </span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// destination size</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>184</span> 
<span class='line'>185</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>186</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>187</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>188</span> 
<span class='line'>189</span> </span><span class="PUNC">}</span><span class="COMM">//end drawpalettecell</span><span class="WHIT">
<span class='line'>190</span> 
<span class='line'>191</span> </span><span class="COMM">/** Draw the entire tetramino palette
<span class='line'>192</span> 
<span class='line'>193</span> 	@function
<span class='line'>194</span> 	@param {string} RS Define the style of the block. Possible value: 'ARS, 'SRS'
<span class='line'>195</span> 	@param {number} blockSize Size of a typical block
<span class='line'>196</span> 	@param sprite Sprite object
<span class='line'>197</span> */</span><span class="WHIT">
<span class='line'>198</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawPalette</span><span class="PUNC">(</span><span class="NAME">RS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">sprite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'I'</span><span class="PUNC">,</span><span class="STRN">'T'</span><span class="PUNC">,</span><span class="STRN">'S'</span><span class="PUNC">,</span><span class="STRN">'Z'</span><span class="PUNC">,</span><span class="STRN">'L'</span><span class="PUNC">,</span><span class="STRN">'J'</span><span class="PUNC">,</span><span class="STRN">'O'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'i'</span><span class="PUNC">,</span><span class="STRN">'cw'</span><span class="PUNC">,</span><span class="STRN">'ccw'</span><span class="PUNC">,</span><span class="STRN">'u'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>201</span> 
<span class='line'>202</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">type.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">orientation.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">			</span><span class="NAME">drawPaletteCell</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">RS</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">sprite</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>207</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>208</span> 
<span class='line'>209</span> </span><span class="COMM">/** Draw the entire decoration palette
<span class='line'>210</span> 
<span class='line'>211</span> 	@function
<span class='line'>212</span> 	@param {number} blockSize Size of a typical block
<span class='line'>213</span> 	@param sprite Sprite object
<span class='line'>214</span> */</span><span class="WHIT">
<span class='line'>215</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">drawPaletteDeco</span><span class="PUNC">(</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">sprite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">'n1'</span><span class="PUNC">,</span><span class="STRN">'n2'</span><span class="PUNC">,</span><span class="STRN">'n3'</span><span class="PUNC">,</span><span class="STRN">'n4'</span><span class="PUNC">,</span><span class="STRN">'n5'</span><span class="PUNC">,</span><span class="STRN">'n6'</span><span class="PUNC">,</span><span class="STRN">'n7'</span><span class="PUNC">,</span><span class="STRN">'n8'</span><span class="PUNC">,</span><span class="STRN">'n9'</span><span class="PUNC">,</span><span class="STRN">'n0'</span><span class="PUNC">,</span><span class="STRN">'smallccw'</span><span class="PUNC">,</span><span class="STRN">'smallcw'</span><span class="PUNC">,</span><span class="STRN">'smalloktick'</span><span class="PUNC">,</span><span class="STRN">'smallokcircle'</span><span class="PUNC">,</span><span class="STRN">'smallnocross'</span><span class="PUNC">,</span><span class="STRN">'smallquestion'</span><span class="PUNC">,</span><span class="STRN">'smallexclamation'</span><span class="PUNC">,</span><span class="STRN">'nwarrow'</span><span class="PUNC">,</span><span class="STRN">'narrow'</span><span class="PUNC">,</span><span class="STRN">'nearrow'</span><span class="PUNC">,</span><span class="STRN">'earrow'</span><span class="PUNC">,</span><span class="STRN">'searrow'</span><span class="PUNC">,</span><span class="STRN">'sarrow'</span><span class="PUNC">,</span><span class="STRN">'swarrow'</span><span class="PUNC">,</span><span class="STRN">'warrow'</span><span class="PUNC">,</span><span class="STRN">'bigcw'</span><span class="PUNC">,</span><span class="STRN">'bigccw'</span><span class="PUNC">,</span><span class="STRN">'smallquestion'</span><span class="PUNC">,</span><span class="STRN">'bigquestion'</span><span class="PUNC">,</span><span class="STRN">'bigexclamation'</span><span class="PUNC">,</span><span class="STRN">'bigoktick'</span><span class="PUNC">,</span><span class="STRN">'bigokcircle'</span><span class="PUNC">,</span><span class="STRN">'bignocross'</span><span class="PUNC">,</span><span class="STRN">'overlayyellow'</span><span class="PUNC">,</span><span class="STRN">'overlayblue'</span><span class="PUNC">,</span><span class="STRN">'overlaygreen'</span><span class="PUNC">,</span><span class="STRN">'overlaypink'</span><span class="PUNC">,</span><span class="STRN">'overlaypink'</span><span class="PUNC">,</span><span class="STRN">'clear1'</span><span class="PUNC">,</span><span class="STRN">'clear2'</span><span class="PUNC">,</span><span class="STRN">'clear3'</span><span class="PUNC">,</span><span class="STRN">'clear4'</span><span class="PUNC">,</span><span class="STRN">'clear5'</span><span class="PUNC">,</span><span class="STRN">'clear6'</span><span class="PUNC">,</span><span class="STRN">'clear7'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>217</span> 
<span class='line'>218</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">type.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">			</span><span class="NAME">drawPaletteDecoCell</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">blockSize</span><span class="PUNC">,</span><span class="NAME">sprite</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>221</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>222</span> 
<span class='line'>223</span> 
<span class='line'>224</span> </span><span class="WHIT">	</span><span class="COMM">/** Get the jQuery object of the export canvas.*/</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">	</span><span class="NAME">Painter.prototype.CanvasExport</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">	</span><span class="COMM">/** Get the 2d context of the related canvas*/</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">	</span><span class="NAME">Painter.prototype.ContextExport</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>228</span> 
<span class='line'>229</span> </span><span class="WHIT">		</span><span class="COMM">/** Export the current frame into a png image. TODO: move this to tedige-editor.js
<span class='line'>230</span> 	*/</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">	</span><span class="NAME">Painter.prototype.exportImage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">		</span><span class="NAME">this.ContextExport.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.CanvasWidth</span><span class="PUNC">,</span><span class="NAME">this.CanvasHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">		</span><span class="NAME">this.CanvasExport.attr</span><span class="PUNC">(</span><span class="STRN">'width'</span><span class="PUNC">,</span><span class="NAME">this.CanvasExport.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">buffer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'canvas'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">		</span><span class="NAME">buffer.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.CanvasWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">		</span><span class="NAME">buffer.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.CanvasHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>237</span> 
<span class='line'>238</span> </span><span class="WHIT">		</span><span class="NAME">this.ContextExport.drawImage</span><span class="PUNC">(</span><span class="NAME">this.CanvasBorder</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">		</span><span class="NAME">this.ContextExport.drawImage</span><span class="PUNC">(</span><span class="NAME">this.CanvasBackground</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imgData_PF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.ContextPF.getImageData</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.CanvasWidth</span><span class="PUNC">,</span><span class="NAME">this.CanvasHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">imgData_PF.data.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">			</span><span class="NAME">imgData_PF.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">255</span><span class="PUNC">*</span><span class="NUMB">0.65</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// get 0.65 opacity,</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">imgData_PF.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">imgData_PF.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">imgData_PF.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>246</span> 
<span class='line'>247</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">tmp</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">				</span><span class="NAME">imgData_PF.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// if black pixel -> transparent</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>252</span> 
<span class='line'>253</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">		</span><span class="NAME">buffer.getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">putImageData</span><span class="PUNC">(</span><span class="NAME">imgData_PF</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">		</span><span class="NAME">this.ContextExport.drawImage</span><span class="PUNC">(</span><span class="NAME">buffer</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">		</span><span class="NAME">this.ContextExport.drawImage</span><span class="PUNC">(</span><span class="NAME">this.CanvasActive</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">		</span><span class="NAME">this.ContextExport.drawImage</span><span class="PUNC">(</span><span class="NAME">this.CanvasWhiteborder</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">		</span><span class="NAME">this.ContextExport.drawImage</span><span class="PUNC">(</span><span class="NAME">this.CanvasDeco</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span> 
<span class='line'>261</span> </span><span class="COMM">/* ------------------------------------------- */</span><span class="WHIT">
<span class='line'>262</span> </span><span class="COMM">/* -- Frame:: Frames-wide properties change -- */</span><span class="WHIT">
<span class='line'>263</span> </span><span class="COMM">/* ------------------------------------------- */</span><span class="WHIT">
<span class='line'>264</span> 
<span class='line'>265</span> </span><span class="COMM">/** Changes the border style of the diagram.
<span class='line'>266</span> 
<span class='line'>267</span> 	@param {string} kind Desired border type. Currently supported:
<span class='line'>268</span> 		'master' (gray-bluish), 'easy' (green) and 'death' (red). Defaults to master if
<span class='line'>269</span> 		none is selected
<span class='line'>270</span> */</span><span class="WHIT">
<span class='line'>271</span> </span><span class="NAME">Diagram.prototype.modify_border</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">kind</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.frames.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">		</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">border</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">kind</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">	</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_border</span><span class="PUNC">(</span><span class="NAME">kind</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>278</span> 
<span class='line'>279</span> </span><span class="COMM">/** Change the rotation system for the whole diagram
<span class='line'>280</span> 
<span class='line'>281</span> 	@param {string} system Desired rotation system. Possible value: 'ARS', 'SRS'
<span class='line'>282</span> */</span><span class="WHIT">
<span class='line'>283</span> </span><span class="NAME">Diagram.prototype.modify_RS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">system</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.frames.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">		</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">system</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">	</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_RS</span><span class="PUNC">(</span><span class="NAME">system</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>289</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>290</span> 
<span class='line'>291</span> </span><span class="COMM">/** Change the state of the white border for every frame
<span class='line'>292</span> 
<span class='line'>293</span> 	@param {boolean} Whiteborder status
<span class='line'>294</span> */</span><span class="WHIT">
<span class='line'>295</span> </span><span class="NAME">Diagram.prototype.modify_whiteborder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.frames.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">		</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">whiteborder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">	</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_whiteborder</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>302</span> 
<span class='line'>303</span> </span><span class="COMM">/** Change the duration of each frame of a diagram
<span class='line'>304</span> 
<span class='line'>305</span> 	@param {number} Desired new duration
<span class='line'>306</span> */</span><span class="WHIT">
<span class='line'>307</span> </span><span class="NAME">Diagram.prototype.modify_duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">new_duration</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.frames.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">		</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">new_duration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>312</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span> 
<span class='line'>314</span> </span><span class="COMM">/** Encode a string with deflate
<span class='line'>315</span> 
<span class='line'>316</span> 	@param {string} Input string
<span class='line'>317</span> 	@return {string} Output encoded string
<span class='line'>318</span> */</span><span class="WHIT">
<span class='line'>319</span> </span><span class="NAME">Diagram.prototype.flate_encode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>320</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$.base64.encode</span><span class="PUNC">(</span><span class="NAME">RawDeflate.deflate</span><span class="PUNC">(</span><span class="NAME">unescape</span><span class="PUNC">(</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>321</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span> 
<span class='line'>323</span> </span><span class="COMM">/** Decode a string with deflate
<span class='line'>324</span> 
<span class='line'>325</span> 	@param {string} Input string
<span class='line'>326</span> 	@return {string} Output decoded string
<span class='line'>327</span> */</span><span class="WHIT">
<span class='line'>328</span> </span><span class="NAME">Diagram.prototype.flate_decode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>329</span> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">decodeURIComponent</span><span class="PUNC">(</span><span class="NAME">escape</span><span class="PUNC">(</span><span class="NAME">RawDeflate.inflate</span><span class="PUNC">(</span><span class="NAME">$.base64.decode</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>330</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>331</span> 
<span class='line'>332</span> </span><span class="COMM">/** Generate a gif from the diagram data*/</span><span class="WHIT">
<span class='line'>333</span> </span><span class="NAME">Diagram.prototype.getGIF</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">encoder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">GIFEncoder</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">	</span><span class="NAME">encoder.setRepeat</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// sets an infinite loop</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">	</span><span class="NAME">encoder.setDelay</span><span class="PUNC">(</span><span class="NUMB">500</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// frame rate in ms... maybe I should try to patch this and get a variable rate ?</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">	</span><span class="NAME">encoder.start</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">	</span><span class="NAME">encoder.setQuality</span><span class="PUNC">(</span><span class="NUMB">50</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.frames.length</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">		</span><span class="NAME">this.goto_frame</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">		</span><span class="NAME">this.painter.exportImage</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">		</span><span class="NAME">encoder.addFrame</span><span class="PUNC">(</span><span class="NAME">this.painter.ContextExport</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">	</span><span class="NAME">encoder.finish</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>346</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">binary_gif</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">encoder.stream</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>347</span> </span><span class="WHIT">	</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">'export-gif'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'data:image/gif;base64,'</span><span class="PUNC">+</span><span class="NAME">$.base64.encode</span><span class="PUNC">(</span><span class="NAME">encoder.stream</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>348</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>349</span> 
<span class='line'>350</span> 
<span class='line'>351</span> </span><span class="COMM">/* --------------------------- */</span><span class="WHIT">
<span class='line'>352</span> </span><span class="COMM">/* -- Modifications (basic) -- */</span><span class="WHIT">
<span class='line'>353</span> </span><span class="COMM">/* --------------------------- */</span><span class="WHIT">
<span class='line'>354</span> 
<span class='line'>355</span> </span><span class="COMM">/** Remove a block at the given coordinate.
<span class='line'>356</span> 
<span class='line'>357</span> 	@param {number} x Horizontal coordinate
<span class='line'>358</span> 	@param {number} y Vertical coordinate
<span class='line'>359</span> */</span><span class="WHIT">
<span class='line'>360</span> </span><span class="NAME">Frame.prototype.removeBlock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">	</span><span class="NAME">this.playfield</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">	</span><span class="NAME">this.painter.eraseBlock</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">	</span><span class="COMM">//this.painter.drawBrowserBlock(x,y,'E',this.RS,this.id); // I hope putting this here won't have any nasty side-effect</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.whiteborder</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">		</span><span class="NAME">this.painter.drawLocalWhiteBorder</span><span class="PUNC">(</span><span class="NAME">this.playfield</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="STRN">'inactive'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>368</span> 
<span class='line'>369</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>370</span> 
<span class='line'>371</span> </span><span class="COMM">/** Remove a decoration block at the given coordinate.
<span class='line'>372</span> 
<span class='line'>373</span> 	@param {number} x Horizontal coordinate
<span class='line'>374</span> 	@param {number} y Vertical coordinate
<span class='line'>375</span> */</span><span class="WHIT">
<span class='line'>376</span> </span><span class="NAME">Frame.prototype.removeDeco</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">	</span><span class="NAME">this.painter.drawDeco</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">this.playfield</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">'eraser'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">	</span><span class="NAME">this.playfield</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>379</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>380</span> 
<span class='line'>381</span> </span><span class="COMM">/** Modify the next pieces.
<span class='line'>382</span> 
<span class='line'>383</span> 		@param {number} position Define which position will be modified. 0 is hold, 1 is the next1 piece, 2 is the next2 piece, ...
<span class='line'>384</span> 		@param {string} type Type of the tetraminmo. Possible value: (SZLJTOIG)
<span class='line'>385</span> 	*/</span><span class="WHIT">
<span class='line'>386</span> </span><span class="NAME">Frame.prototype.modify_nexthold</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">position</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">	</span><span class="NAME">this.nexthold</span><span class="PUNC">[</span><span class="NAME">position</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>388</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>389</span> 
<span class='line'>390</span> </span><span class="COMM">/** Modify the active piece.
<span class='line'>391</span> 
<span class='line'>392</span> 	@param {number} level Opacity level, a number between 0 and 1.
<span class='line'>393</span> */</span><span class="WHIT">
<span class='line'>394</span> </span><span class="NAME">Frame.prototype.modify_AP_opacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">level</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">	</span><span class="NAME">this.activePieceOpacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">level</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">	</span><span class="NAME">this.painter.changeActiveOpacity</span><span class="PUNC">(</span><span class="NAME">level</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">level</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'Flash'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">level</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'flash'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">	  </span><span class="NAME">this.addPiece</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">,</span><span class="NAME">this.activePiecePositionY</span><span class="PUNC">,</span><span class="NAME">this.activePieceType</span><span class="PUNC">,</span><span class="NAME">this.activePieceOrientation</span><span class="PUNC">,</span><span class="STRN">'Flash'</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>401</span> 
<span class='line'>402</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> 
<span class='line'>404</span> </span><span class="COMM">/**Changes the rotation system and call a redraw.
<span class='line'>405</span> 
<span class='line'>406</span> 	@param {string} system Desired rotation system
<span class='line'>407</span> */</span><span class="WHIT">
<span class='line'>408</span> </span><span class="NAME">Frame.prototype.modify_RS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">system</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">	</span><span class="NAME">this.RS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">system</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">	</span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>411</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>412</span> </span><span class="COMM">/** Changes the duration of a frame.
<span class='line'>413</span> 
<span class='line'>414</span> 	@param {number} new_duration Desired new duration.
<span class='line'>415</span> */</span><span class="WHIT">
<span class='line'>416</span> </span><span class="NAME">Frame.prototype.modify_duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">new_duration</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">	</span><span class="NAME">this.duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">new_duration</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>418</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>419</span> 
<span class='line'>420</span> </span><span class="COMM">/** Changes the border type.
<span class='line'>421</span> 
<span class='line'>422</span> 	@param {string} kind Desired border type. Currently supported:
<span class='line'>423</span> 		'master' (gray-bluish), 'easy' (green) and 'death' (red). Defaults to master if
<span class='line'>424</span> 		none is selected
<span class='line'>425</span> */</span><span class="WHIT">
<span class='line'>426</span> </span><span class="NAME">Frame.prototype.modify_border</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">new_border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">	</span><span class="NAME">this.border</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">new_border</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">	</span><span class="NAME">this.painter.drawBorder</span><span class="PUNC">(</span><span class="NAME">this.border</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>429</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>430</span> 
<span class='line'>431</span> </span><span class="COMM">/** Change the whiteborder status (on or off)
<span class='line'>432</span> 	@param {boolean} Whiteborder status
<span class='line'>433</span> */</span><span class="WHIT">
<span class='line'>434</span> </span><span class="NAME">Frame.prototype.modify_whiteborder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">new_border</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">	</span><span class="NAME">this.whiteborder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">new_border</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.whiteborder</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">		</span><span class="NAME">this.painter.drawWhiteBorder</span><span class="PUNC">(</span><span class="NAME">this.playfield</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">		</span><span class="NAME">this.painter.eraseLayer</span><span class="PUNC">(</span><span class="STRN">'whiteborder'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>443</span> 
<span class='line'>444</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>445</span> 
<span class='line'>446</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>447</span> 
<span class='line'>448</span> </span><span class="COMM">/* ----------------------------- */</span><span class="WHIT">
<span class='line'>449</span> </span><span class="COMM">/* -- Modifications (advanced)-- */</span><span class="WHIT">
<span class='line'>450</span> </span><span class="COMM">/* ----------------------------- */</span><span class="WHIT">
<span class='line'>451</span> 
<span class='line'>452</span> </span><span class="COMM">/** 	Fill the playfield with a piece type, similar to a 'paint bucket' tool. Thanks DigitalDevil for the original code !
<span class='line'>453</span> 
<span class='line'>454</span> 	@param {number} x Horizontal coordinate
<span class='line'>455</span> 	@param {number} y Vertical coordinate
<span class='line'>456</span> 	@param {string} replaced Possible value: SZLJTOIG
<span class='line'>457</span> 	@param {string} replacer Possible value: SZLJTOIG
<span class='line'>458</span> */</span><span class="WHIT">
<span class='line'>459</span> </span><span class="NAME">Frame.prototype.recursive_fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replaced</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replacer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>460</span> 
<span class='line'>461</span> </span><span class="WHIT">	</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>462</span> </span><span class="WHIT">	</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>463</span> 
<span class='line'>464</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.playfield</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">replaced</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>465</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>466</span> 
<span class='line'>467</span> </span><span class="WHIT">	</span><span class="NAME">this.modify</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replacer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">	</span><span class="NAME">this.painter.drawBlock</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">replacer</span><span class="PUNC">,</span><span class="NAME">this.RS</span><span class="PUNC">,</span><span class="STRN">'inactive'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>469</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.whiteborder</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">this.painter.drawLocalWhiteBorder</span><span class="PUNC">(</span><span class="NAME">this.playfield</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>471</span> 
<span class='line'>472</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>473</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">this.recursive_fill</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replaced</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replacer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>474</span> 
<span class='line'>475</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.height</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">this.recursive_fill</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replaced</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replacer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>477</span> 
<span class='line'>478</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.width</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">this.recursive_fill</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replaced</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replacer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>480</span> 
<span class='line'>481</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">this.recursive_fill</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replaced</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">replacer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>483</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>484</span> 
<span class='line'>485</span> </span><span class="NAME">Frame.prototype.stack_lines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row_empty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jstop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.height</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">jstop</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// start at the top row and go down</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">			</span><span class="NAME">row_empty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">			</span><span class="COMM">// searches the row to find out how many blocks are in it</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.width</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.playfield</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">					</span><span class="NAME">row_empty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">			</span><span class="COMM">// if the line is empty, shift the upwards rows</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row_empty</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">				</span><span class="COMM">// shifts rows down beginning at specified row and going up</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">					</span><span class="COMM">// if not the top row, copy row above</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.width</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">							</span><span class="NAME">this.modify</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.playfield</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">	</span><span class="NAME">this.painter.eraseLayer</span><span class="PUNC">(</span><span class="STRN">'inactive'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">	</span><span class="NAME">this.draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>518</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>519</span> 
<span class='line'>520</span> </span><span class="NAME">Frame.prototype.clear_lines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row_occupation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// to track how many blocks are on a row</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jstop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.height</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">jstop</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// start at the top row and go down</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">			</span><span class="NAME">row_occupation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">			</span><span class="COMM">// searches the row to find out how many blocks are in it</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.width</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">istop</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.playfield</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">					</span><span class="NAME">row_occupation</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">			</span><span class="COMM">// clears line if row is completely occupied</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row_occupation</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.width</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">kstop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.width</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">&lt;</span><span class="NAME">kstop</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">					</span><span class="NAME">this.removeBlock</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>543</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>544</span> </span><span class="COMM">/* ------------------------ */</span><span class="WHIT">
<span class='line'>545</span> </span><span class="COMM">/* -- Active piece stuff -- */</span><span class="WHIT">
<span class='line'>546</span> </span><span class="COMM">/* ------------------------ */</span><span class="WHIT">
<span class='line'>547</span> 
<span class='line'>548</span> </span><span class="COMM">/**'Paint' the active piece into the inactive layer
<span class='line'>549</span> */</span><span class="WHIT">
<span class='line'>550</span> </span><span class="NAME">Frame.prototype.paintActivePiece</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">		</span><span class="NAME">this.addPiece</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">,</span><span class="NAME">this.activePiecePositionY</span><span class="PUNC">,</span><span class="NAME">this.activePieceType</span><span class="PUNC">,</span><span class="NAME">this.activePieceOrientation</span><span class="PUNC">,</span><span class="STRN">'inactive'</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>554</span> 
<span class='line'>555</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>556</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>557</span> 
<span class='line'>558</span> </span><span class="COMM">/** Set the active piece variable to zero, paint the active piece
<span class='line'>559</span> */</span><span class="WHIT">
<span class='line'>560</span> </span><span class="NAME">Frame.prototype.lockActivePiece</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">		</span><span class="NAME">this.paintActivePiece</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">		</span><span class="NAME">this.clear</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">		</span><span class="NAME">this.activePieceOpacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">		</span><span class="NAME">this.painter.eraseLayer</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>568</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>569</span> 
<span class='line'>570</span> </span><span class="COMM">/** Call addPiece at the same coordinate than the current one, only with the drop flag on,
<span class='line'>571</span> effectively dropping the active piece
<span class='line'>572</span> */</span><span class="WHIT">
<span class='line'>573</span> </span><span class="NAME">Frame.prototype.dropActivePiece</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>576</span> 
<span class='line'>577</span> </span><span class="WHIT">		</span><span class="NAME">this.addPiece</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">,</span><span class="NAME">this.activePiecePositionY</span><span class="PUNC">,</span><span class="NAME">this.activePieceType</span><span class="PUNC">,</span><span class="NAME">this.activePieceOrientation</span><span class="PUNC">,</span><span class="STRN">'active'</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>579</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>580</span> 
<span class='line'>581</span> </span><span class="COMM">/** Move the active piece in the given direction by calling addPiece again
<span class='line'>582</span> 
<span class='line'>583</span> 	@param {string} direction Direction in which the piece move. Possible value:'left', 'right', 'up', 'down'
<span class='line'>584</span> 	*/</span><span class="WHIT">
<span class='line'>585</span> </span><span class="NAME">Frame.prototype.moveActivePiece</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">posX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">posY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activePiecePositionY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'left'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">				</span><span class="NAME">posX</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'right'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">				</span><span class="NAME">posX</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'up'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">				</span><span class="NAME">posY</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'down'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">				</span><span class="NAME">posY</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.piece_is_in</span><span class="PUNC">(</span><span class="NAME">posX</span><span class="PUNC">,</span><span class="NAME">posY</span><span class="PUNC">,</span><span class="NAME">this.activePieceType</span><span class="PUNC">,</span><span class="NAME">this.activePieceOrientation</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">		</span><span class="NAME">this.addPiece</span><span class="PUNC">(</span><span class="NAME">posX</span><span class="PUNC">,</span><span class="NAME">posY</span><span class="PUNC">,</span><span class="NAME">this.activePieceType</span><span class="PUNC">,</span><span class="NAME">this.activePieceOrientation</span><span class="PUNC">,</span><span class="STRN">'active'</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>610</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>611</span> 
<span class='line'>612</span> </span><span class="COMM">/** Rotate the active piece in the given direction by calling addPiece again
<span class='line'>613</span> 
<span class='line'>614</span> 	@param {string} direction Direction in which the piece rotate. Possible value:'cw', 'ccw'
<span class='line'>615</span> 	*/</span><span class="WHIT">
<span class='line'>616</span> </span><span class="NAME">Frame.prototype.rotateActivePiece</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>617</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activePieceOrientation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>618</span> 
<span class='line'>619</span> </span><span class="WHIT">	</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'cw'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">ori</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'i'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'cw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'cw'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'u'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'u'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'ccw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ccw'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'i'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">		</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ccw'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">ori</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'i'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'ccw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'ccw'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'u'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>646</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'u'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'cw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'cw'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">					</span><span class="NAME">ori</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'i'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">		</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>655</span> 
<span class='line'>656</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.piece_is_in</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">,</span><span class="NAME">this.activePiecePositionY</span><span class="PUNC">,</span><span class="NAME">this.activePieceType</span><span class="PUNC">,</span><span class="NAME">ori</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">	  </span><span class="NAME">this.addPiece</span><span class="PUNC">(</span><span class="NAME">this.activePiecePositionX</span><span class="PUNC">,</span><span class="NAME">this.activePiecePositionY</span><span class="PUNC">,</span><span class="NAME">this.activePieceType</span><span class="PUNC">,</span><span class="NAME">ori</span><span class="PUNC">,</span><span class="STRN">'active'</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>661</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>662</span> 
<span class='line'>663</span> 
<span class='line'>664</span> 
<span class='line'>665</span> 
<span class='line'>666</span> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">ready</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">	</span><span class="COMM">/* --------------------------- GLOBAL STUFF -------------------------------- */</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>672</span> 
<span class='line'>673</span> </span><span class="WHIT">	</span><span class="COMM">// Default state for the tetramino selection</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[type=radio][name="select"][value=Ii]'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'checked'</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[type=radio][name="editor-tab"][value=inactive]'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'checked'</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">	</span><span class="COMM">// Interface global constant</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">IS_CLICKING</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">	</span><span class="COMM">// current tools:</span><span class="WHIT">
<span class='line'>679</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TOOL_DROP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>680</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TOOL_FILL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>681</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TOOL_RECTANGULAR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>682</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TOOL_PENCIL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>683</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TOOL_ERASER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// todo: use hidden checkbox instead</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TOOL_ERASER_DECO</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">	</span><span class="COMM">// current panel</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT">	</span><span class="NAME">DECORATION_PANEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT">	</span><span class="NAME">TETRAMINO_PANEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">APCONTROL_PANEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>689</span> 
<span class='line'>690</span> </span><span class="WHIT">	</span><span class="COMM">// initialization of the system</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aPainter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Painter</span><span class="PUNC">(</span><span class="STRN">'pf'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aDiag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Diagram</span><span class="PUNC">(</span><span class="NAME">aPainter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">	</span><span class="NAME">aPainter.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>695</span> 
<span class='line'>696</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initiator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setInterval</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aPainter.ready</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">			</span><span class="NAME">clearInterval</span><span class="PUNC">(</span><span class="NAME">initiator</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">			</span><span class="NAME">drawPalette</span><span class="PUNC">(</span><span class="STRN">'ARS'</span><span class="PUNC">,</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NAME">aPainter.sprite</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">			</span><span class="NAME">drawPaletteDeco</span><span class="PUNC">(</span><span class="NUMB">8</span><span class="PUNC">,</span><span class="NAME">aPainter.spritedeco</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">URLsearch</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.search</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">URLsearch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// load if there's something in the url</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">				</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#import'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="NAME">URLsearch</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">				</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#import-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.frames[0].addPiece(2,3,'L','i','inactive');</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.new_copy_frame();</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.frames[1].addPiece(7,8,'T','u','inactive');</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.frames[1].addPiece(5,6,'S','ccw','inactive');</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.frames[0].load('I~Ibdbebfbgbhcedfeefdfefffgfh~Sgdgdgegfggghhdhfhhidihjdjh_');</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.frames[1].load('N~ISZ_J~p8_C~rhhp_I~Tadaeafbfbhcdcecfcgch~Gededeeefegehfdfffh~Shdhdhehfhhidifihjdjfjgjh_');</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.new_frame();</span><span class="WHIT">
<span class='line'>714</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.frames[2].load('N~JJZ_J~p8_C~rhpr_I~Sadaeafbfbhcdcecfcgch~Gededeeefegehfdfffh~Ihdhdhehfhhidifihjdjfjgjh_');</span><span class="WHIT">
<span class='line'>715</span> </span><span class="WHIT">			</span><span class="COMM">//aDiag.frames[2].draw();</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>717</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>718</span> 
<span class='line'>719</span> </span><span class="WHIT">	</span><span class="COMM">/** Get the jQuery object of the export canvas.*/</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">	</span><span class="NAME">aPainter.CanvasExport</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-export'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">	</span><span class="COMM">/** Get the 2d context of the related canvas*/</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">	</span><span class="NAME">aPainter.ContextExport</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aPainter.CanvasExport</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> 
<span class='line'>724</span> 
<span class='line'>725</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">	</span><span class="COMM">/* --------------------------- MOUSE MANAGEMENT  --------------------------- */</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>730</span> 
<span class='line'>731</span> 
<span class='line'>732</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.painter.CanvasPreview.mousemove</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">		</span><span class="COMM">// this.PFOriginX,this.PFOriginY, 10*this.block, 20*this.block</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginYAbsolute</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>738</span> 
<span class='line'>739</span> </span><span class="WHIT">			</span><span class="COMM">// if the mouse is in the playfield</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginYAbsolute</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginYAbsolute</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">20</span><span class="PUNC">*</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pfY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginYAbsolute</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.eraseLayer</span><span class="PUNC">(</span><span class="STRN">'preview'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//erase the preview layer</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">				</span><span class="COMM">// depending on the current active panel...</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TETRAMINO_PANEL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">					</span><span class="COMM">//console.log('['+mouseX+','+mouseY+']');</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">					</span><span class="COMM">//console.log('['+pfX+','+pfY+']');</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[type=radio][name=select]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extract.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extract.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">					</span><span class="COMM">// set the right mode</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#checkbox-active'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">is</span><span class="PUNC">(</span><span class="STRN">':checked'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="STRN">'active'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">					</span><span class="COMM">// set the right mode</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="NAME">mode</span><span class="PUNC">=</span><span class="STRN">'inactive'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#checkbox-garbage'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">is</span><span class="PUNC">(</span><span class="STRN">':checked'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="STRN">'garbage'</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>763</span> 
<span class='line'>764</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">IS_CLICKING</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">							</span><span class="COMM">//aDiag.painter.highlight(pfX,pfY);</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_PENCIL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'singleton'</span><span class="PUNC">,</span><span class="NAME">mode</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_ERASER</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">removeBlock</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="NAME">mode</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_ERASER</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="STRN">'G'</span><span class="PUNC">,</span><span class="STRN">'singleton'</span><span class="PUNC">,</span><span class="STRN">'preview'</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TOOL_FILL</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">TOOL_PENCIL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'singleton'</span><span class="PUNC">,</span><span class="STRN">'preview'</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">							</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'I'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">//offset I so it doesn't look weird on mouseover</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">									</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="STRN">'preview'</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">								</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">									</span><span class="PUNC">{</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="STRN">'preview'</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.eraseLayer</span><span class="PUNC">(</span><span class="STRN">'preview'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//erase the preview layer</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TOOL_ERASER_DECO</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="STRN">'G'</span><span class="PUNC">,</span><span class="STRN">'singleton'</span><span class="PUNC">,</span><span class="STRN">'preview'</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[type=radio][name="select-deco"]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">						</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">extract</span><span class="PUNC">,</span><span class="STRN">'singleton'</span><span class="PUNC">,</span><span class="STRN">'decoration-preview'</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>799</span> 
<span class='line'>800</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>801</span> 
<span class='line'>802</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">	</span><span class="COMM">//var clientCoords = "( " + e.clientX + ", " + e.clientY + " )";</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">	</span><span class="COMM">//console.log("( e.clientX, e.clientY ) : " + clientCoords);</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">// CanvasPreview.mousemove</span><span class="WHIT">
<span class='line'>807</span> 
<span class='line'>808</span> </span><span class="WHIT">	</span><span class="COMM">/*Event: CanvasPreview.click
<span class='line'>809</span> 	Manages the click event on the outermost canvas*/</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.painter.CanvasPreview.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginYAbsolute</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginYAbsolute</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">20</span><span class="PUNC">*</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginXAbsolute</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pfY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.PFOriginYAbsolute</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">					</span><span class="COMM">//aDiag.painter.highlight(pfX,pfY);</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TETRAMINO_PANEL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[type=radio][name="select"]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extract.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extract.slice</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>825</span> 
<span class='line'>826</span> 
<span class='line'>827</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#checkbox-active'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">is</span><span class="PUNC">(</span><span class="STRN">':checked'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">						</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="STRN">'active'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">						</span><span class="NAME">mode</span><span class="PUNC">=</span><span class="STRN">'inactive'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>834</span> 
<span class='line'>835</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#checkbox-garbage'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">is</span><span class="PUNC">(</span><span class="STRN">':checked'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">						</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="STRN">'garbage'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>839</span> 
<span class='line'>840</span> 
<span class='line'>841</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_FILL</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lookup</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">						</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">recursive_fill</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">																			</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">																			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lookup</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">																			</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">						</span><span class="COMM">//addPiece(pfX,pfY,type,orientation,mode,TOOL_DROP);</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">						</span><span class="COMM">//aDiag.frames[aDiag.current_frame].addPiece(pfX,pfY,type,orientation,mode,TOOL_DROP);</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_PENCIL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">							</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="STRN">'singleton'</span><span class="PUNC">,</span><span class="NAME">mode</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_ERASER</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">							</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">removeBlock</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>858</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'I'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">//offset I so it doesn't look weird on mouseover</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lookup</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// erase on occucupied case here</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">									</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="STRN">'erase'</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">								</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">								</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="NAME">mode</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">							</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lookup</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="COMM">// erase on occucupied case here</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">									</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="STRN">'erase'</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">								</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">								</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">								</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="NAME">mode</span><span class="PUNC">,</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>881</span> 
<span class='line'>882</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// aka if(DECORATION_PANEL)</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TOOL_ERASER_DECO</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">removeDeco</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[type=radio][name="select-deco"]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addPiece</span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="PUNC">,</span><span class="NAME">pfY</span><span class="PUNC">,</span><span class="NAME">extract</span><span class="PUNC">,</span><span class="STRN">'singleton'</span><span class="PUNC">,</span><span class="STRN">'decoration'</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">				</span><span class="COMM">//aDiag.frames[aDiag.current_frame].drawDeco(pfX,pfY,extract);</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//end CanvasPreview.mousedown</span><span class="WHIT">
<span class='line'>898</span> 
<span class='line'>899</span> </span><span class="WHIT">	</span><span class="COMM">/*Event: CanvasControl.click
<span class='line'>900</span> 	Manages the click event on the joystick visualisation canvas*/</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.painter.CanvasControl.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>902</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CanvasControl.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// that if separates the joystick and the button</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">				</span><span class="COMM">//ul</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'ul'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>914</span> 
<span class='line'>915</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">				</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">				</span><span class="COMM">//u</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'u'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>922</span> 
<span class='line'>923</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">				</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">				</span><span class="COMM">//ur</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'ur'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>930</span> 
<span class='line'>931</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">				</span><span class="COMM">//l</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'l'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>938</span> 
<span class='line'>939</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">				</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">				</span><span class="COMM">//center</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.resetJoystick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_control</span><span class="PUNC">(</span><span class="STRN">'c'</span><span class="PUNC">,</span><span class="STRN">'rest'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">				</span><span class="NAME">aPainter.drawJoystick</span><span class="PUNC">(</span><span class="STRN">'c'</span><span class="PUNC">,</span><span class="STRN">'rest'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>950</span> 
<span class='line'>951</span> 
<span class='line'>952</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">				</span><span class="COMM">//r</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'r'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>959</span> 
<span class='line'>960</span> 
<span class='line'>961</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">				</span><span class="COMM">//dl</span><span class="WHIT">
<span class='line'>966</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'dl'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>967</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>968</span> 
<span class='line'>969</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">				</span><span class="COMM">//d</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'d'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>976</span> 
<span class='line'>977</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">				</span><span class="COMM">//dr</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">				</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'dr'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">				</span><span class="COMM">//aDiag.painter.drawJoystick('dr','holded')</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>985</span> 
<span class='line'>986</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">joystick_direction</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.resetJoystick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_control</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">				</span><span class="NAME">aPainter.drawJoystick</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">				</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">joystick_state</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'rest'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.painter.resetJoystick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_control</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">					</span><span class="NAME">aPainter.drawJoystick</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1000</span> 
<span class='line'>1001</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'pressed'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.painter.resetJoystick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_control</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'holded'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">					</span><span class="NAME">aPainter.drawJoystick</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'holded'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'holded'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.painter.resetJoystick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_control</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'rest'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">					</span><span class="NAME">aPainter.drawJoystick</span><span class="PUNC">(</span><span class="NAME">direction</span><span class="PUNC">,</span><span class="STRN">'rest'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">				</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1015</span> 
<span class='line'>1016</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">// end joystick</span><span class="WHIT">
<span class='line'>1017</span> 
<span class='line'>1018</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">//buttons</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1023</span> 
<span class='line'>1024</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">				</span><span class="COMM">//A</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">				</span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'A'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">radius</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">16</span><span class="PUNC">-</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">				</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">radius</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">16</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">				</span><span class="COMM">// B</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">				</span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'B'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">radius</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">16</span><span class="PUNC">-</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="PUNC">&</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">				</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">*</span><span class="NAME">radius</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">16</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="PUNC">&</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">				</span><span class="COMM">// C</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">				</span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1044</span> 
<span class='line'>1045</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginX</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">				</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">-</span><span class="NAME">radius</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CntrlOriginY</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">				</span><span class="COMM">// D</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">				</span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'D'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>1052</span> 			if(mouseX > height+height/4+2*radius+height/16-radius + aDiag.painter.CntrlOriginX &&
<span class='line'>1053</span> 				mouseX &lt; height+height/4+2*radius+height/16+radius + aDiag.painter.CntrlOriginX &&
<span class='line'>1054</span> 				mouseY > 3*height/4-radius + aDiag.painter.CntrlOriginY)
<span class='line'>1055</span> 			{
<span class='line'>1056</span> 				// E
<span class='line'>1057</span> 				button = 'E';
<span class='line'>1058</span> 			}
<span class='line'>1059</span> 			if(mouseX > height+height/4+4*radius+2*height/16-radius + aDiag.painter.CntrlOriginX&
<span class='line'>1060</span> 				mouseX &lt; height+height/4+4*radius+2*height/16+radius + aDiag.painter.CntrlOriginX&
<span class='line'>1061</span> 				mouseY > 3*height/4-radius + aDiag.painter.CntrlOriginY)
<span class='line'>1062</span> 			{
<span class='line'>1063</span> 				// F
<span class='line'>1064</span> 				console.log ('F');
<span class='line'>1065</span> 			}
<span class='line'>1066</span> 			*/</span><span class="WHIT">
<span class='line'>1067</span> 
<span class='line'>1068</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'A'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'B'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'C'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'D'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'E'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'F'</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">button_state</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'pressed'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_button</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="STRN">'holded'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">					</span><span class="NAME">aPainter.drawButton</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="STRN">'holded'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'holded'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_button</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="STRN">'rest'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">					</span><span class="NAME">aPainter.drawButton</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="STRN">'rest'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'rest'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">					</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_button</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">					</span><span class="NAME">aPainter.drawButton</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="COMM">//end buttons</span><span class="WHIT">
<span class='line'>1093</span> 
<span class='line'>1094</span> 
<span class='line'>1095</span> 
<span class='line'>1096</span> </span><span class="WHIT">		</span><span class="COMM">// aDiag.painter.CntrlOriginX;</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">		</span><span class="COMM">// aDiag.painter.CntrlOriginY;</span><span class="WHIT">
<span class='line'>1098</span> 
<span class='line'>1099</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//end CanvasControl.click</span><span class="WHIT">
<span class='line'>1100</span> 
<span class='line'>1101</span> 
<span class='line'>1102</span> </span><span class="WHIT">	</span><span class="COMM">/*Event: CanvasNextHold.click
<span class='line'>1103</span> 	Manages the click event on the next & hold canvas*/</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.painter.CanvasNextHold.click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.pageY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">		</span><span class="COMM">//console.log('['+mouseX+','+mouseY+']');</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">		</span><span class="COMM">//var pfX = parseInt(Math.floor((mouseX)/aDiag.painter.blockSize),10);</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">		</span><span class="COMM">//var pfY = parseInt(Math.floor((mouseY)/aDiag.painter.blockSize),10);</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mouseX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CanvasNextHold.offset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pfY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mouseY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">aDiag.painter.CanvasNextHold.offset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">aDiag.painter.blockSize</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extract</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[type=radio][name=select]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">extract.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nexthold</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1125</span> 
<span class='line'>1126</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1127</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nexthold</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nexthold</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pfX</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nexthold</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">type</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_nexthold</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.painter.drawNextHold</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1163</span> 
<span class='line'>1164</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//end CanvasNextHold.click</span><span class="WHIT">
<span class='line'>1165</span> 
<span class='line'>1166</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">	</span><span class="COMM">/* --------------------------- BUTTON MANAGEMENT  -------------------------- */</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">	</span><span class="COMM">/*--- Playfield ---*/</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_first'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.first_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> 
<span class='line'>1173</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1174</span> 
<span class='line'>1175</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_prev'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.previous_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">		</span><span class="NAME">opacity_auto_highlight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1180</span> 
<span class='line'>1181</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_next'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aDiag.current_frame</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.frames.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.next_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">		</span><span class="NAME">opacity_auto_highlight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1192</span> 
<span class='line'>1193</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_last'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.last_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="WHIT">	</span><span class="COMM">// Progressbar</span><span class="WHIT">
<span class='line'>1198</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-current-frame'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-current-frame'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-current-frame'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">aDiag.frames.length</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">aDiag.goto_frame</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-current-frame'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1201</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1202</span> 
<span class='line'>1203</span> </span><span class="WHIT">	</span><span class="COMM">// Comment</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-comment'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1207</span> 
<span class='line'>1208</span> </span><span class="WHIT">	</span><span class="COMM">/*--- Active piece buttons ---*/</span><span class="WHIT">
<span class='line'>1209</span> 
<span class='line'>1210</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_move_up'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-auto-action-frame-increment:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveActivePiece</span><span class="PUNC">(</span><span class="STRN">'up'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_move_down'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-auto-action-frame-increment:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveActivePiece</span><span class="PUNC">(</span><span class="STRN">'down'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_move_left'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-auto-action-frame-increment:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveActivePiece</span><span class="PUNC">(</span><span class="STRN">'left'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_move_right'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-auto-action-frame-increment:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveActivePiece</span><span class="PUNC">(</span><span class="STRN">'right'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1239</span> 
<span class='line'>1240</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_ccw'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-auto-action-frame-increment:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">rotateActivePiece</span><span class="PUNC">(</span><span class="STRN">'ccw'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1247</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_cw'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1248</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-auto-action-frame-increment:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1249</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">rotateActivePiece</span><span class="PUNC">(</span><span class="STRN">'cw'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1254</span> 
<span class='line'>1255</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_paint'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paintActivePiece</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_lock'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lockActivePiece</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">IS_TIMING</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_reset_timer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_drop'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dropActivePiece</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-duration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1273</span> 
<span class='line'>1274</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_AP_opacity</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: var $cmd_opacity_3 = $('#cmd_opacity_3') </span><span class="WHIT">
<span class='line'>1278</span> 
<span class='line'>1279</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$cmd_opacity_none</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_none'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">	</span><span class="NAME">$cmd_opacity_3</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_3'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">	</span><span class="NAME">$cmd_opacity_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_2'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">	</span><span class="NAME">$cmd_opacity_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_1'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">	</span><span class="NAME">$cmd_opacity_lock</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_lock'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">	</span><span class="NAME">$cmd_opacity_flash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_flash'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1285</span> 
<span class='line'>1286</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">		</span><span class="NAME">$cmd_opacity_none.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">		</span><span class="NAME">$cmd_opacity_3.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">		</span><span class="NAME">$cmd_opacity_2.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">		</span><span class="NAME">$cmd_opacity_1.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">		</span><span class="NAME">$cmd_opacity_lock.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="WHIT">		</span><span class="NAME">$cmd_opacity_flash.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1294</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">opacity_auto_highlight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1295</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1296</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'1.0'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_none'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'0.9'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_3'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'0.8'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_2'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'0.7'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_1'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'0.55'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_lock'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'Flash'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_flash'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1316</span> 
<span class='line'>1317</span> </span><span class="WHIT">	</span><span class="COMM">// TODO more cache !</span><span class="WHIT">
<span class='line'>1318</span> 
<span class='line'>1319</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_none'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'1.0'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_3'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'0.9'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1327</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1328</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_2'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'0.8'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_1'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'0.7'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_lock'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'0.55'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_flash'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-active-opacity'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'Flash'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">		</span><span class="NAME">opacity_highlight_remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1349</span> 
<span class='line'>1350</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TIMER</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">TIMER_MODE</span><span class="PUNC">,</span><span class="NAME">IS_TIMING</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_reset_timer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">		</span><span class="NAME">IS_TIMING</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">		</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lock</span><span class="PUNC">-</span><span class="NAME">TIMER</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">' frames left until lock'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_timer_tick'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_reset_timer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1357</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#hr_tick'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1359</span> 
<span class='line'>1360</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_startstop_timer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">IS_TIMING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// -> stop timer</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">,</span><span class="STRN">'Start timer'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">			</span><span class="NAME">IS_TIMING</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_reset_timer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">'display:none'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1368</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_timer_tick'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">'display:none'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#hr_tick'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">'display:none;'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// -> start timer</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">,</span><span class="STRN">'Stop timer'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">			</span><span class="NAME">IS_TIMING</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">			</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lock</span><span class="PUNC">-</span><span class="NAME">TIMER</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">' frames left until lock'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_timer_tick'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_reset_timer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#hr_tick'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1383</span> 
<span class='line'>1384</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">timer_tick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">		</span><span class="NAME">TIMER</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lock</span><span class="PUNC">-</span><span class="NAME">TIMER</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">' frames left until lock'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// 12</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_none'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">			</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">//18</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_3'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">			</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">			</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">//24</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_2'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="WHIT">			</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">			</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">			</span><span class="NAME">TIMER</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// 30</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_1'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT">  </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// 30</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_lock'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="STRN">'Lock'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT">  </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// 30</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_flash'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="STRN">'Flash'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT">  </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">+</span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// 30</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_opacity_flash'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="STRN">'Flash'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">TIMER</span><span class="WHIT">  </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">+</span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation4</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// 30</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#indic'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="STRN">'Locked!'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_lock'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_startstop_timer'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">		</span><span class="NAME">TGM1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 30 -1</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// +12f = 40%</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// +6f = 20%</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// +6f = 20%</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="WHIT"> </span><span class="COMM">// +6f =20%</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">			</span><span class="COMM">// </span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">		</span><span class="NAME">Master000699</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">		</span><span class="NAME">Master700799</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">		</span><span class="NAME">Master800899</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1459</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1460</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1461</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1462</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1463</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">		</span><span class="NAME">Master900999</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">14</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">		</span><span class="NAME">Master10001099</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">14</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">		</span><span class="NAME">Master11001199</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">		</span><span class="NAME">Master12001299</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">		</span><span class="NAME">Death000099</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">		</span><span class="NAME">Death100199</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">26</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">16</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">21</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">26</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">		</span><span class="NAME">Death200299</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">22</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">14</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">22</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">		</span><span class="NAME">Death300399</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">		</span><span class="NAME">Death400499</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">		</span><span class="NAME">Death500999</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">		</span><span class="NAME">Shirase000199</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">18</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">		</span><span class="NAME">Shirase200299</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">14</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">		</span><span class="NAME">Shirase300499</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">15</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">		</span><span class="NAME">Shirase500599</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">11</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">		</span><span class="NAME">Shirase6001099</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1584</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">12</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">		</span><span class="NAME">Shirase11001199</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">		</span><span class="NAME">Shirase12001299</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1598</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1599</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="WHIT">
<span class='line'>1601</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">		</span><span class="NAME">TDSSRS</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">			</span><span class="NAME">ARE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 0 in reality</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">			</span><span class="NAME">lock</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">			</span><span class="NAME">separation1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1606</span> </span><span class="WHIT">			</span><span class="NAME">separation2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">17</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1607</span> </span><span class="WHIT">			</span><span class="NAME">separation3</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1608</span> </span><span class="WHIT">			</span><span class="NAME">separation4</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1611</span> 
<span class='line'>1612</span> </span><span class="WHIT">	</span><span class="COMM">/*--- Frame buttons ---*/</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_clear_lines'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clear_lines</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_stack_lines'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">stack_lines</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_clearstack_lines'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clear_lines</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">stack_lines</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1623</span> 
<span class='line'>1624</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_clear_inactive'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clear</span><span class="PUNC">(</span><span class="STRN">'inactive'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_clear_active'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clear</span><span class="PUNC">(</span><span class="STRN">'active'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_clear_decoration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clear</span><span class="PUNC">(</span><span class="STRN">'decoration'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1633</span> 
<span class='line'>1634</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_clear_all'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">clear</span><span class="PUNC">(</span><span class="STRN">'all'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1637</span> 
<span class='line'>1638</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#activate-white-border'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">	</span><span class="COMM">//change-all-border</span><span class="WHIT">
<span class='line'>1640</span> 
<span class='line'>1641</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#activate-white-border:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_whiteborder</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_whiteborder</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1649</span> 
<span class='line'>1650</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#change-all-whiteborder'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.modify_whiteborder</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#border-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1654</span> 
<span class='line'>1655</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#border-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">change</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_border</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#border-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#change-all-border'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.modify_border</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#border-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1661</span> 
<span class='line'>1662</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#rs-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">change</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify_RS</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#rs-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#change-all-rs'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.modify_RS</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#rs-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1668</span> 
<span class='line'>1669</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#duration-1f'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-duration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'1'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#duration-5f'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-duration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'5'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#duration-15f'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-duration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'15'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#duration-60f'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-duration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="STRN">'60'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#duration-remaining'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">one</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">TIMER</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">two</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">TIMER</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">three</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation3</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">TIMER</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">four</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">TIMER_MODEL</span><span class="PUNC">[</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#timer-select'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">separation4</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">TIMER</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1686</span> 
<span class='line'>1687</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">time_remaining</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">one</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">one</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">two</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">two</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">three</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">three</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">four</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">four</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.modify_duration</span><span class="PUNC">(</span><span class="NAME">time_remaining</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#change-all-duration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.modify_duration</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-duration'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">		</span><span class="COMM">//console.log(parseInt($('#pf-duration').val(),10));</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1694</span> 
<span class='line'>1695</span> </span><span class="WHIT">	</span><span class="COMM">/*--- Diagram buttons ---*/</span><span class="WHIT">
<span class='line'>1696</span> 
<span class='line'>1697</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_new'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.new_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_clone'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.new_copy_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">IS_TIMING</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1706</span> </span><span class="WHIT">			</span><span class="NAME">timer_tick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1709</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_del'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1710</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.remove_current_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.update_framecount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_remove_following'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.remove_following_frames</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.update_framecount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1719</span> 
<span class='line'>1720</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_nuke'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">confirmation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.confirm</span><span class="PUNC">(</span><span class="STRN">'This will reset everything ! Are you sure ?'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">confirmation</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.remove_all_playfields</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1725</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1726</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#cmd_timer_tick'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">		</span><span class="NAME">timer_tick</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">	</span><span class="COMM">/* -------------------------- */</span><span class="WHIT">
<span class='line'>1732</span> 
<span class='line'>1733</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#tetramino-panel table'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#tetramino-panel td'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#tetramino-panel input[type=radio]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1737</span> 
<span class='line'>1738</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#panel-decorations'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#panel-decorations td'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#panel-decorations input:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1742</span> 
<span class='line'>1743</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#fumen_import'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1744</span> 
<span class='line'>1745</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">encstr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#import'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">	</span><span class="COMM">//'7ebhiipqbxqb5qbiqbqqbyqb6qbjqbrqbzqb7qbkqb?sqb0qb8qblqbtqb1qb9qbmqbuqb2qb+qbnqbvqb3qb/qb';// full rotation</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">	</span><span class="COMM">//var encstr = '7eYKHWOA0BeTASIjRASIyQEF2BAABmBUcBviBLjBWe?BAwNyAU9sJEFb0HEvT98AwSVTASY6dD2488AwA2JEnoo2AD?MeGEzXpTASICKEFbEcEP5BAAMQBOGBrRBtXBqHBpPBEOBv4?A9JBJPBnDBO+ALABdHBFgBdgBlfBAAA';</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">	</span><span class="COMM">//var encstr ='/dD3hbH3ibI3gbH3hbI3gbC3pbAoUxAso2TAySzTAS?ITeDZ2vvAuno2A5H5TASY6dD2488AQ+74Dzoo2Azo2TASo/?QEOAAAA7eEh9OEAlsyfCAAAbKBVJBSFBNdE3kbC3mbC3mbC?3mbC3icAwNEA6HXyD7eVtOqyAFreRAyp+5APGVTAyp78Axn?A6AFr+5AxnA6AFreRAyp7CEFStJEFreRAypeRAyZAAAlecF?ectHBtocFocNyc13cdiBt3cl3cF3cNBd1mBjYBZzcBcBGZB?aYBUycchBAAA";</span><span class="WHIT">
<span class='line'>1749</span> </span><span class="WHIT">	</span><span class="COMM">//First, run some actual fumen code, 'cause I (PP) am not a CS genius. Thanks myndzi for the hints about how it works</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="WHIT">	</span><span class="COMM">// I stripped some useless (for my purposes) part of the code. Gomenasai Mihys-san !</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="WHIT">	</span><span class="NAME">enclim</span><span class="PUNC">=</span><span class="NUMB">32768</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">	</span><span class="NAME">enc</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">enclim</span><span class="PUNC">+</span><span class="NUMB">1024</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">	</span><span class="NAME">enctbl</span><span class="PUNC">=</span><span class="STRN">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">	</span><span class="NAME">asctbl</span><span class="PUNC">=</span><span class="STRN">' !"#$%&\'()*+,-./0123456789:;&lt;=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">	</span><span class="NAME">framelim</span><span class="PUNC">=</span><span class="NUMB">2000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">	</span><span class="NAME">f</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NUMB">220</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">encf</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NUMB">220</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">af</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NUMB">220</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">framelim</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">	</span><span class="NAME">p</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">ap</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NUMB">3</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">framelim</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">	</span><span class="NAME">au</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">framelim</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">	</span><span class="NAME">am</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">framelim</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">	</span><span class="NAME">ac</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">framelim</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">	</span><span class="NAME">ad</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">framelim</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">	</span><span class="NAME">ct</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">	</span><span class="NAME">b</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">	</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">	</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">	</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">	</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">	</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">	</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">	</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">	</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">	</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1773</span> 
<span class='line'>1774</span> </span><span class="WHIT">	</span><span class="NAME">enclen</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">encstr.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">		</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">enctbl.indexOf</span><span class="PUNC">(</span><span class="NAME">encstr.charAt</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">enclen</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">enclen</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">enclim</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1779</span> </span><span class="WHIT">	</span><span class="NAME">encc</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1780</span> </span><span class="WHIT">	</span><span class="NAME">fldrepcnt</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">220</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">encc</span><span class="PUNC">&lt;</span><span class="NAME">enclen</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">fldrepcnt</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">220</span><span class="PUNC">;</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">64</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">			</span><span class="NAME">tmp2</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">220</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">220</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">			</span><span class="NAME">tmp1</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">17</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">17</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">tmp2</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">tmp1</span><span class="PUNC">-</span><span class="NUMB">8</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">tmp1</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">tmp2</span><span class="PUNC">==</span><span class="NUMB">1979</span><span class="PUNC">)</span><span class="NAME">fldrepcnt</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1790</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">		</span><span class="NAME">fldrepcnt</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">		</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">64</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">4096</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">		</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">8</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">8</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">		</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">		</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">220</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">220</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">		</span><span class="NAME">au</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">		</span><span class="NAME">am</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ct</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">		</span><span class="NAME">acflg</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">		</span><span class="NAME">ac</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">ac</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1803</span> </span><span class="WHIT">		</span><span class="NAME">cmstrrep</span><span class="PUNC">=</span><span class="NAME">ac</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">		</span><span class="NAME">ac</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">cmstrrep</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">		</span><span class="NAME">ad</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">acflg</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">		</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">		</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">64</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">		</span><span class="NAME">tmplen</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">4096</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">4096</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">		</span><span class="NAME">tmpstr</span><span class="PUNC">=</span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">tmplen</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">64</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">4096</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">262144</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">			</span><span class="NAME">tmp</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">enc</span><span class="PUNC">[</span><span class="NAME">encc</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">16777216</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">			</span><span class="NAME">tmpstr</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">asctbl.charAt</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">			</span><span class="NAME">tmpstr</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">asctbl.charAt</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1819</span> </span><span class="WHIT">			</span><span class="NAME">tmpstr</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">asctbl.charAt</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">			</span><span class="NAME">tmpstr</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">asctbl.charAt</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">%</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">/</span><span class="NUMB">96</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">		</span><span class="NAME">ac</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">unescape</span><span class="PUNC">(</span><span class="NAME">tmpstr.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tmplen</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">220</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">af</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ad</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">32</span><span class="PUNC">+</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">8</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">32</span><span class="PUNC">+</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">8</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">20</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">			</span><span class="NAME">chk</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">chk</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">chk</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">			</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">au</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">210</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">210</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">220</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">am</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">21</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">5</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NUMB">9</span><span class="PUNC">-</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">+</span><span class="NUMB">9</span><span class="PUNC">-</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tmp</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1841</span> 
<span class='line'>1842</span> </span><span class="WHIT">	</span><span class="COMM">// Now for the actual tedige function.</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">	</span><span class="COMM">/* While I'm at it here's the variable that we are interested in:
<span class='line'>1844</span> 	(foreword: fumen always initialize 2000 'frames' even if there's no data in it)
<span class='line'>1845</span> 	= af - playfield =
<span class='line'>1846</span> 		Always contains 440220 elements (2000 * 22 * 10). It stores the playfield matrix (size 22 x 10), each matrix appended to the other. So the first 220 elements is the first matrix, the 220 next the second one, etc. There's an extra line at the top and at the bottom
<span class='line'>1847</span> 
<span class='line'>1848</span> 	= ap - active piece =
<span class='line'>1849</span> 		Always contains 6000 elements. The data is stored in triplet in the 1D array: first is the piece type (0-6, see the translation table), then its orientation (0-3), then its position.
<span class='line'>1850</span> 
<span class='line'>1851</span> 	= ac - comments =
<span class='line'>1852</span> 		2000 elements, one for each playfield. Contains the comment string.
<span class='line'>1853</span> 
<span class='line'>1854</span> 	= e - # of playfield =
<span class='line'>1855</span> 		the amount of playfield, apparently
<span class='line'>1856</span> 
<span class='line'>1857</span> 	=ct - rotation system=
<span class='line'>1858</span> 		0 = ars
<span class='line'>1859</span> 		1 = srs
<span class='line'>1860</span> 	*/</span><span class="WHIT">
<span class='line'>1861</span> 
<span class='line'>1862</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.remove_all_playfields</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// let's nuke everything first</span><span class="WHIT">
<span class='line'>1863</span> 
<span class='line'>1864</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">z</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">z</span><span class="PUNC">&lt;</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">z</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1866</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.new_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// add a new frame for each playfield</span><span class="WHIT">
<span class='line'>1867</span> 
<span class='line'>1868</span> </span><span class="WHIT">		</span><span class="COMM">// rotation system</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ct</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">		  </span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'SRS'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">		  </span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">RS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'ARS'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1877</span> 
<span class='line'>1878</span> </span><span class="WHIT">		</span><span class="COMM">// playfield</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1881</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NUMB">20</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">modify</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">fconvert</span><span class="PUNC">(</span><span class="NAME">af</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">z</span><span class="PUNC">*</span><span class="NUMB">220</span><span class="PUNC">+</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// get the right case in the big array (z: frame; j: line; i: column; we dump the first and last line, hence the j+1 and why we go from 0 to 20 and not to 22)</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1886</span> 
<span class='line'>1887</span> </span><span class="WHIT">		</span><span class="COMM">// active piece</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">		</span><span class="COMM">// fumen models a 3x3 (4x4 for I) bounding box, centered on the coordinate ( for the 4x4 box it's the center upper left case that define the center)</span><span class="WHIT">
<span class='line'>1889</span> 
<span class='line'>1890</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">activePieceType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fconvert</span><span class="PUNC">(</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">activePieceType</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1893</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">activePieceOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oconvert</span><span class="PUNC">(</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">ct</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">activePieceType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activePositions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pconvert</span><span class="PUNC">(</span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">*</span><span class="NAME">z</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">activePieceOrientation</span><span class="PUNC">,</span><span class="NAME">ct</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">activePiecePositionX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">activePositions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">activePiecePositionY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">activePositions</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1898</span> 
<span class='line'>1899</span> </span><span class="WHIT">		</span><span class="COMM">// comments</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">ac</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1901</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1902</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">comment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ac</span><span class="PUNC">[</span><span class="NAME">z</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// todo: maybe a should do a method to change the comment ? (so it can be displayed ?)</span><span class="WHIT">
<span class='line'>1903</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1904</span> 
<span class='line'>1905</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1906</span> 
<span class='line'>1907</span> </span><span class="WHIT">	</span><span class="NAME">aDiag.remove_current_frame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// dunno why it bugs when I try for (z=0;z&lt;e-1;z++), so I do this instead; draw is in remove_current_frame, so I don't need to call it</span><span class="WHIT">
<span class='line'>1908</span> 
<span class='line'>1909</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">pconvert</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="NAME">system</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">			</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input</span><span class="PUNC">%</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">			</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1916</span> 
<span class='line'>1917</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">fconvert</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'I'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'L'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'O'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'Z'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'T'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'J'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">7</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'S'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1944</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">				</span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'G'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1946</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="WHIT">			</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1952</span> 
<span class='line'>1953</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">oconvert</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rs</span><span class="PUNC">,</span><span class="NAME">piecetype</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1955</span> </span><span class="WHIT">	</span><span class="COMM">/* cw i ccw u
<span class='line'>1956</span> 	ars
<span class='line'>1957</span> 	all piece follows: i ccw u cw
<span class='line'>1958</span> 	*/</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">output</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// srs</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// SRS: some manual adjustement are needed because fumen SRS model isn't the same as tedige</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'u'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">piecetype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'I'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">piecetype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'Z'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">			  </span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'i'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1970</span> 
<span class='line'>1971</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'cw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1974</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">piecetype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'S'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">			  </span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'ccw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1978</span> 
<span class='line'>1979</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1981</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'i'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1982</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">piecetype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'Z'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">piecetype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'S'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="WHIT">			  </span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'u'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1985</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1986</span> 
<span class='line'>1987</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'ccw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">piecetype</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'Z'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">			  </span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'ccw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1996</span> 
<span class='line'>1997</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// ars</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'i'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="STRN">'ccw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'u'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">			</span><span class="NAME">output</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'cw'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2016</span> 
<span class='line'>2017</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">output</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2019</span> 
<span class='line'>2020</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> 
<span class='line'>2022</span> 
<span class='line'>2023</span> 
<span class='line'>2024</span> 
<span class='line'>2025</span> </span><span class="WHIT">	</span><span class="COMM">/* ---------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">	</span><span class="COMM">/* --------------------------- ANIMATION MANAGEMENT  -------------------------- */</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="WHIT">	</span><span class="COMM">/* ---------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>2028</span> 
<span class='line'>2029</span> 
<span class='line'>2030</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_frames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">16.6666667</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">	</span><span class="COMM">//aDiag.load('M~MyFoobarIsRich_A~Jgkccw_I~Tadaeafbfbhcdcecfcgch~Gededeeefegehfdfffh~Shdhdhehfhhidifihjdjfjgjh_+A~e_I~Tahagbd~Shgje~Ebfbhif+I~Zaa+I~Zab+I~Zac+I~Zad+I~Zae+I~Zaf+I~Zag+I~Zai+I~Zba+I~Zbb+I~Zbc+I~Zbd+I~Zbe+I~Zbf+I~Zbg+I~Zbi+I~Zda+I~Zdb+I~Zdc+I~Zdd+I~Zde+I~Zdf+I~Zdg+I~Zdi+I~Zea+I~Zeb+I~Zec+I~Zed+I~Zee+I~Zef+I~Zeg+I~Zei+I~Zfa+I~Zfb+I~Zfc+I~Zfd+I~Zfe+I~Zff');</span><span class="WHIT">
<span class='line'>2032</span> 
<span class='line'>2033</span> </span><span class="WHIT">	</span><span class="COMM">// aDiag.painter.drawWhitePixel(aDiag.frames[aDiag.current_frame].playfield);</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">	</span><span class="COMM">//aDiag.painter.drawLocalWhitePixel(aDiag.frames[aDiag.current_frame].playfield,5,6)</span><span class="WHIT">
<span class='line'>2035</span> 
<span class='line'>2036</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_playpause'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">	</span><span class="COMM">//console.log('tick');</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aDiag.current_frame</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aDiag.frames.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">aDiag.playing</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.playing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_playpause'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">,</span><span class="STRN">'â·'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">			</span><span class="NAME">aDiag.playing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">			</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_playpause'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'value'</span><span class="PUNC">,</span><span class="STRN">'â¥'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">		</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">			</span><span class="COMM">// TODO: does not escape properly when we press pause</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">			</span><span class="COMM">//console.log('rendering... @'+i+' - '+counter);</span><span class="WHIT">
<span class='line'>2053</span> 
<span class='line'>2054</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">aDiag.playing</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2056</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">						</span><span class="NAME">aDiag.goto_frame</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">						</span><span class="NAME">counter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">					</span><span class="NAME">counter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">					</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2065</span> 
<span class='line'>2066</span> </span><span class="WHIT">					</span><span class="COMM">//interval = aDiag.frames[aDiag.current_frame].duration;</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">					</span><span class="NAME">requestAnimationFrame</span><span class="PUNC">(</span><span class="NAME">render</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-loop'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">is</span><span class="PUNC">(</span><span class="STRN">':checked'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">					</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">					</span><span class="NAME">requestAnimationFrame</span><span class="PUNC">(</span><span class="NAME">render</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">		</span><span class="NAME">render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">	</span><span class="COMM">/* v2
<span class='line'>2077</span> 		var i = aDiag.current_frame;
<span class='line'>2078</span> 		var len = aDiag.frames.length;
<span class='line'>2079</span> 		var interval = '';
<span class='line'>2080</span> 		if(playpause)
<span class='line'>2081</span> 		{
<span class='line'>2082</span> 			playpause = false;
<span class='line'>2083</span> 		}
<span class='line'>2084</span> 		else{
<span class='line'>2085</span> 			playpause = true;
<span class='line'>2086</span> 		}
<span class='line'>2087</span> 
<span class='line'>2088</span> 		function draw() {
<span class='line'>2089</span> 			setTimeout(function() {
<span class='line'>2090</span> 				var myReq = window.requestAnimationFrame(draw);
<span class='line'>2091</span> 				console.log('req');
<span class='line'>2092</span> 			if (i &lt; len && playpause)
<span class='line'>2093</span> 				{
<span class='line'>2094</span> 					aDiag.goto_frame(i);
<span class='line'>2095</span> 					interval = aDiag.frames[aDiag.current_frame].duration;
<span class='line'>2096</span> 					i++;
<span class='line'>2097</span> 				}
<span class='line'>2098</span> 				else if($('#pf-loop').is(':checked'))
<span class='line'>2099</span> 				{
<span class='line'>2100</span> 					i = 0;
<span class='line'>2101</span> 				}
<span class='line'>2102</span> 
<span class='line'>2103</span> 				else
<span class='line'>2104</span> 				{
<span class='line'>2105</span> 				window.cancelAnimationFrame(myReq);
<span class='line'>2106</span> 				console.log('release');
<span class='line'>2107</span> 				}
<span class='line'>2108</span> 
<span class='line'>2109</span> 			}, interval);
<span class='line'>2110</span> 		}
<span class='line'>2111</span> 		draw();
<span class='line'>2112</span> 	*/</span><span class="WHIT">
<span class='line'>2113</span> 
<span class='line'>2114</span> </span><span class="WHIT">	</span><span class="COMM">/* v1
<span class='line'>2115</span> 		aDiag.first_frame();
<span class='line'>2116</span> 		var i = 0;
<span class='line'>2117</span> 		advance();
<span class='line'>2118</span> 		function advance(){
<span class='line'>2119</span> 			//console.log('Doki '+i);
<span class='line'>2120</span> 			if(i&lt;aDiag.frames.length-1)
<span class='line'>2121</span> 			{
<span class='line'>2122</span> 				aDiag.next_frame();
<span class='line'>2123</span> 				setTimeout(advance,1*_frames);
<span class='line'>2124</span> 				i++;
<span class='line'>2125</span> 			} // change and see http://paulirish.com/2011/requestanimationframe-for-smart-animating/
<span class='line'>2126</span> 			else
<span class='line'>2127</span> 			{
<span class='line'>2128</span> 				console.log('Finished !');
<span class='line'>2129</span> 			}
<span class='line'>2130</span> 		}
<span class='line'>2131</span> 
<span class='line'>2132</span> 		*/</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2134</span> 
<span class='line'>2135</span> 
<span class='line'>2136</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">	</span><span class="COMM">/* --------------------------- PANEL MANAGEMENT  -------------------------- */</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">	</span><span class="COMM">/* ------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>2139</span> 
<span class='line'>2140</span> 
<span class='line'>2141</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$mainutilities</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#main-utilities'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2142</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$tabdeco</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#tab-deco'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$tabtetramino</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#tab-tetramino'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2144</span> 
<span class='line'>2145</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$tetraminopanel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#tetramino-panel'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$decorationspanel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#panel-decorations'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2147</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$tools</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#tools'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2148</span> 
<span class='line'>2149</span> </span><span class="WHIT">	</span><span class="COMM">//var $actionspanel = $("#panel-actions");</span><span class="WHIT">
<span class='line'>2150</span> 
<span class='line'>2151</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'body'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">IS_CLICKING</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">mouseup</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">IS_CLICKING</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2152</span> 
<span class='line'>2153</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setpanelfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="WHIT">		</span><span class="NAME">DECORATION_PANEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">		</span><span class="NAME">TETRAMINO_PANEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2157</span> 
<span class='line'>2158</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">primary_hideallpanelexcept</span><span class="PUNC">(</span><span class="NAME">exception</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exception</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="STRN">'decorationspanel'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="NAME">$decorationspanel.fadeOut</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exception</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="STRN">'tetraminopanel'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="NAME">$tetraminopanel.fadeOut</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2164</span> 
<span class='line'>2165</span> </span><span class="WHIT">	</span><span class="NAME">$tabdeco.click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2166</span> </span><span class="WHIT">		</span><span class="NAME">primary_hideallpanelexcept</span><span class="PUNC">(</span><span class="STRN">'decorationspanel'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">		</span><span class="NAME">setpanelfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">		</span><span class="NAME">DECORATION_PANEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2169</span> </span><span class="WHIT">		</span><span class="NAME">$decorationspanel.delay</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fadeIn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">		</span><span class="NAME">$mainutilities.removeClass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'border-deco'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2172</span> 
<span class='line'>2173</span> </span><span class="WHIT">	</span><span class="NAME">$tabtetramino.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">		</span><span class="NAME">primary_hideallpanelexcept</span><span class="PUNC">(</span><span class="STRN">'tetraminopanel'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="WHIT">		</span><span class="NAME">setpanelfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="WHIT">		</span><span class="NAME">TETRAMINO_PANEL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">		</span><span class="NAME">$tetraminopanel.delay</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fadeIn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2178</span> </span><span class="WHIT">		</span><span class="NAME">$mainutilities.removeClass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">'border-tetramino'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="WHIT">	</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="WHIT">		</span><span class="NAME">TOOL_DROP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">		</span><span class="NAME">TOOL_FILL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2184</span> </span><span class="WHIT">		</span><span class="NAME">TOOL_RECTANGULAR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2185</span> </span><span class="WHIT">		</span><span class="NAME">TOOL_PENCIL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2186</span> </span><span class="WHIT">		</span><span class="NAME">TOOL_ERASER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2187</span> </span><span class="WHIT">		</span><span class="NAME">$drop.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">		</span><span class="NAME">$fill.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">		</span><span class="NAME">$pencil.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2190</span> </span><span class="WHIT">		</span><span class="NAME">$eraser.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2191</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2192</span> 
<span class='line'>2193</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$drop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#button-drop'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2194</span> </span><span class="WHIT">	</span><span class="NAME">$drop.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_DROP</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2196</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2197</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2198</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2200</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2201</span> </span><span class="WHIT">			</span><span class="NAME">TOOL_DROP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2202</span> </span><span class="WHIT">			</span><span class="NAME">$drop.addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2203</span> 
<span class='line'>2204</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2205</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2206</span> 
<span class='line'>2207</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$fill</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#button-paint-bucket'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">	</span><span class="NAME">$fill.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_FILL</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2212</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2215</span> </span><span class="WHIT">			</span><span class="NAME">TOOL_FILL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2216</span> </span><span class="WHIT">			</span><span class="NAME">$fill.addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2217</span> 
<span class='line'>2218</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2219</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2220</span> 
<span class='line'>2221</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$pencil</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#button-pencil'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2222</span> </span><span class="WHIT">	</span><span class="NAME">$pencil.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2223</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_PENCIL</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2225</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2226</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2228</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">			</span><span class="NAME">TOOL_PENCIL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2230</span> </span><span class="WHIT">			</span><span class="NAME">$pencil.addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2231</span> 
<span class='line'>2232</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2234</span> 
<span class='line'>2235</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$eraser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#button-eraser'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">	</span><span class="NAME">$eraser.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_ERASER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">			</span><span class="NAME">settoolfalse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">			</span><span class="NAME">TOOL_ERASER</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">			</span><span class="NAME">$eraser.addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2245</span> 
<span class='line'>2246</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2248</span> 
<span class='line'>2249</span> 
<span class='line'>2250</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$eraserdeco</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#button-eraser-deco'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">	</span><span class="NAME">$eraserdeco.mousedown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2252</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">TOOL_ERASER_DECO</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2253</span> </span><span class="WHIT">			</span><span class="NAME">TOOL_ERASER_DECO</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">			</span><span class="NAME">$eraserdeco.removeClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2257</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2258</span> </span><span class="WHIT">			</span><span class="NAME">TOOL_ERASER_DECO</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">			</span><span class="NAME">$eraserdeco.addClass</span><span class="PUNC">(</span><span class="STRN">'pressed'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2260</span> 
<span class='line'>2261</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2263</span> 
<span class='line'>2264</span> 
<span class='line'>2265</span> </span><span class="COMM">//////// Properties panel////////////</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>2267</span> 	$('#next1-select').change(function(){
<span class='line'>2268</span> 		aDiag.frames[aDiag.current_frame].modify_nexthold(1,$('#next1-select').val());
<span class='line'>2269</span> 	});
<span class='line'>2270</span> 
<span class='line'>2271</span> 	$('#next2-select').change(function(){
<span class='line'>2272</span> 		aDiag.frames[aDiag.current_frame].modify_nexthold(2,$('#next2-select').val());
<span class='line'>2273</span> 	});
<span class='line'>2274</span> 
<span class='line'>2275</span> 	$('#next3-select').change(function(){
<span class='line'>2276</span> 		aDiag.frames[aDiag.current_frame].modify_nexthold(3,$('#next3-select').val());
<span class='line'>2277</span> 	});
<span class='line'>2278</span> 
<span class='line'>2279</span> 	$('#hold-select').change(function(){
<span class='line'>2280</span> 		aDiag.frames[aDiag.current_frame].modify_nexthold(0,$('#hold-select').val());
<span class='line'>2281</span> 	});
<span class='line'>2282</span> 	*/</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2284</span> 
<span class='line'>2285</span> 
<span class='line'>2286</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export-image-frame-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2287</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.painter.exportImage</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2288</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export-gif'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">'display: none'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2289</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-export'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">'display: block'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2290</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2291</span> 
<span class='line'>2292</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export-image-diagram-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">		</span><span class="NAME">aDiag.getGIF</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export-gif'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">'display: block'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">		</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-export'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'style'</span><span class="PUNC">,</span><span class="STRN">'display: none'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2297</span> 
<span class='line'>2298</span> 
<span class='line'>2299</span> </span><span class="WHIT">	</span><span class="COMM">/* ---------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="WHIT">	</span><span class="COMM">/* --------------------------- SAVE/LOAD MANAGEMENT  -------------------------- */</span><span class="WHIT">
<span class='line'>2301</span> </span><span class="WHIT">	</span><span class="COMM">/* ---------------------------------------------------------------------------- */</span><span class="WHIT">
<span class='line'>2302</span> 
<span class='line'>2303</span> 
<span class='line'>2304</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'.export-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2305</span> 
<span class='line'>2306</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">export_string</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">destination</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">attr</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[name=export-type]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'All'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">			</span><span class="NAME">export_string</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'all-'</span><span class="PUNC">+</span><span class="NAME">aDiag.flate_encode</span><span class="PUNC">(</span><span class="NAME">aDiag.print</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// compressed</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">			</span><span class="COMM">//export_string = 'all-'+aDiag.print(); // not compressed</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">			</span><span class="COMM">// export_string = aDiag.print();</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2314</span> 
<span class='line'>2315</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'input[name=export-type]:checked'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'Current'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">			</span><span class="NAME">export_string</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'current-'</span><span class="PUNC">+</span><span class="NAME">aDiag.flate_encode</span><span class="PUNC">(</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">print</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// compressed</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="WHIT">			</span><span class="COMM">//export_string = 'current-'+aDiag.frames[aDiag.current_frame].print(); // not compressed</span><span class="WHIT">
<span class='line'>2319</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2320</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">destination</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'export-forum-button'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">				</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="STRN">'[tedige]v01-'</span><span class="PUNC">+</span><span class="NAME">export_string</span><span class="PUNC">+</span><span class="STRN">'[/tedige]'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'export-editor-button'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">				</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="NAME">window.location.href.split</span><span class="PUNC">(</span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">'?v01-'</span><span class="PUNC">+</span><span class="NAME">export_string</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// the extra split is here to make sure you don't catch a leftover from a previous URL import.</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'export-viewer-button'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">URL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.location.href.split</span><span class="PUNC">(</span><span class="STRN">'?'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">				</span><span class="NAME">URL.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">				</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="NAME">URL.join</span><span class="PUNC">(</span><span class="STRN">'/'</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'/viewer.html?v01-'</span><span class="PUNC">+</span><span class="NAME">export_string</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2332</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2334</span> 
<span class='line'>2335</span> 
<span class='line'>2336</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">	</span><span class="COMM">// textarea selection http://stackoverflow.com/questions/5797539/jquery-select-all-text-from-a-textarea#5797700</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#export'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">focus</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">$this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">		</span><span class="NAME">$this.select</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">		</span><span class="COMM">// Work around Chrome's little problem</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="WHIT">		</span><span class="NAME">$this.mouseup</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="WHIT">			</span><span class="COMM">// Prevent further mouseup intervention</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">			</span><span class="NAME">$this.unbind</span><span class="PUNC">(</span><span class="STRN">'mouseup'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2348</span> 
<span class='line'>2349</span> </span><span class="COMM">/*
<span class='line'>2350</span> 				var output = window.location.protocol+window.location.hostname;
<span class='line'>2351</span> 				var tmp = window.location.pathname.split("/");
<span class='line'>2352</span> 
<span class='line'>2353</span> 				for(var i = 0; i&lt;tmp.length-1;i++)
<span class='line'>2354</span> 				{
<span class='line'>2355</span> 					output += tmp[i]+"/";
<span class='line'>2356</span> 				}
<span class='line'>2357</span> 				output+="tedige.html";
<span class='line'>2358</span> 				$("#export").html(output+"#"+this.print());
<span class='line'>2359</span> 	*/</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">regforum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/\[tedige\](.+)\[\/tedige\]/</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// matches everything between [tedige] and [/tedige]</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">regURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/v01.+/</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// matches everything after v01</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#import-button'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bigstr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#import'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">val</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2364</span> 
<span class='line'>2365</span> </span><span class="WHIT">		</span><span class="NAME">resultforum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regforum.exec</span><span class="PUNC">(</span><span class="NAME">bigstr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// todo: make that work ?</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">		</span><span class="NAME">resultURL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regURL.exec</span><span class="PUNC">(</span><span class="NAME">bigstr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">		</span><span class="COMM">//console.log(resultforum.split('-'));</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">littlestr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resultURL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2370</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2371</span> </span><span class="WHIT">			</span><span class="NAME">littlestr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resultURL</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2372</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2373</span> 
<span class='line'>2374</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">resultforum</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2375</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2376</span> </span><span class="WHIT">			</span><span class="NAME">littlestr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">resultforum</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2377</span> </span><span class="WHIT">			</span><span class="NAME">littlestr</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">littlestr</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'['</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2378</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2379</span> 
<span class='line'>2380</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">littlestr</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2381</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'all'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.load</span><span class="PUNC">(</span><span class="NAME">aDiag.flate_decode</span><span class="PUNC">(</span><span class="NAME">littlestr</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// compressed</span><span class="WHIT">
<span class='line'>2384</span> </span><span class="WHIT">				</span><span class="COMM">//aDiag.load(littlestr[2]); // not compressed</span><span class="WHIT">
<span class='line'>2385</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2387</span> 
<span class='line'>2388</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">'current'</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2389</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">load</span><span class="PUNC">(</span><span class="NAME">aDiag.flate_decode</span><span class="PUNC">(</span><span class="NAME">littlestr</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	 </span><span class="COMM">// compressed</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="WHIT">				</span><span class="COMM">//aDiag.frames[aDiag.current_frame].load(littlestr[2]); //not compressed</span><span class="WHIT">
<span class='line'>2391</span> </span><span class="WHIT">				</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">draw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2392</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2393</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2394</span> 
<span class='line'>2395</span> 
<span class='line'>2396</span> </span><span class="WHIT">		</span><span class="COMM">/*switch($('#import-export-wrapper input[type=radio][name=export-type]:checked').attr('value')){
<span class='line'>2397</span> 
<span class='line'>2398</span> 			case 'All':
<span class='line'>2399</span> 				if(result)
<span class='line'>2400</span> 				{
<span class='line'>2401</span> 					aDiag.load(xflatedecode(result[1]));
<span class='line'>2402</span> 					// aDiag.load(result[1]);
<span class='line'>2403</span> 				}
<span class='line'>2404</span> 				else
<span class='line'>2405</span> 				{
<span class='line'>2406</span> 					aDiag.load(xflatedecode(bigstr));
<span class='line'>2407</span> 					// aDiag.load(bigstr);
<span class='line'>2408</span> 				}
<span class='line'>2409</span> 				break;
<span class='line'>2410</span> 
<span class='line'>2411</span> 			case 'Current':
<span class='line'>2412</span> 				if(result)
<span class='line'>2413</span> 				{
<span class='line'>2414</span> 					aDiag.frames[aDiag.current_frame].load(xflatedecode(result[1]));
<span class='line'>2415</span> 					// aDiag.frames[aDiag.current_frame].load(result[1]);
<span class='line'>2416</span> 				}
<span class='line'>2417</span> 				else
<span class='line'>2418</span> 				{
<span class='line'>2419</span> 					aDiag.frames[aDiag.current_frame].load(xflatedecode(bigstr));
<span class='line'>2420</span> 					// // aDiag.frames[aDiag.current_frame].load(bigstr);
<span class='line'>2421</span> 				}
<span class='line'>2422</span> 				break;
<span class='line'>2423</span> 			break;
<span class='line'>2424</span> 
<span class='line'>2425</span> 		}*/</span><span class="WHIT">
<span class='line'>2426</span> 
<span class='line'>2427</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2428</span> 
<span class='line'>2429</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>2430</span> 	$('.preview-table').click(function(){
<span class='line'>2431</span> 		console.log('barabar');
<span class='line'>2432</span> 		//$(this).parent().parent().parent().parent().parent().addClass('pressed');
<span class='line'>2433</span> 	});
<span class='line'>2434</span> 	*/</span><span class="WHIT">
<span class='line'>2435</span> 
<span class='line'>2436</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">keydown</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2438</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">event.keyCode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">37</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// left arrow</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_prev'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2440</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">event.keyCode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">39</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// right arrow</span><span class="WHIT">
<span class='line'>2441</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#pf-cmd_next'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2442</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="WHIT">	</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">'#foobartest'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">click</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2444</span> </span><span class="WHIT">		</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">aDiag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="WHIT">		</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">aDiag.frames</span><span class="PUNC">[</span><span class="NAME">aDiag.current_frame</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="WHIT">		</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">aDiag.print</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2447</span> </span><span class="WHIT">		</span><span class="COMM">//aDiag.painter.generateNewPreviewTable(1);</span><span class="WHIT">
<span class='line'>2448</span> </span><span class="WHIT">		</span><span class="COMM">//aDiag.frames[aDiag.current_frame].whiteborder = true;</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">		</span><span class="COMM">//aDiag.painter.drawWhiteBorder(aDiag.frames[aDiag.current_frame].playfield);</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">		</span><span class="COMM">//aPainter.highlight(3,4);</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">		</span><span class="COMM">//console.log(aDiag.frames[aDiag.current_frame].comment);</span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">		</span><span class="COMM">//console.log(aDiag.flate_decode('bY6xDsIwDEQ/iJkPAIRQKsHQMHWJkthnN1MVmP3tuBESCz7J2717s53mmM52z6839zRZP6aL9XEpWChUuKBI0coEZvgDIFCLQh4WiIgqKVRXWrVR03QI9syUOcPLWqlyRZWqdh1AIThGfnW7MbHTWVh9AjteeUVDkxRca5dS3VzqYSEu+0D8OxDchL8uGDaOcKMwCFsfhGla0gc='));</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">		</span><span class="COMM">// file:///D:/Hoang/TeDiGe/Tetris-Diagram-Generator-2/tedige.html?v01-all-bY6xDsIwDEQ/iJkPAIRQKsHQMHWJkthnN1MVmP3tuBESCz7J2717s53mmM52z6839zRZP6aL9XEpWChUuKBI0coEZvgDIFCLQh4WiIgqKVRXWrVR03QI9syUOcPLWqlyRZWqdh1AIThGfnW7MbHTWVh9AjteeUVDkxRca5dS3VzqYSEu+0D8OxDchL8uGDaOcKMwCFsfhGla0gc=?v01-all-jcw9DoAgDIbhAzl7AHWi0ZAAE0sjxIEVNW49u3+DXzdhKXl52olJqbAT7zz3Ms3rtlQmqS0PUp/DTXd/ygeb676PAnP+ypjSDrMKBcNXLBCLxAKxikQoEUmEXVGRACUgCbArKEJACAkBIUU8EP+nnA==</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">		</span><span class="COMM">//'all-jcw9DoAgDIbhAzl7AHWi0ZAAE0sjxIEVNW49u3+DXzdhKXl52olJqbAT7zz3Ms3rtlQmqS0PUp/DTXd/ygeb676PAnP+ypjSDrMKBcNXLBCLxAKxikQoEUmEXVGRACUgCbArKEJACAkBIUU8EP+nnA=='</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2456</span> 
<span class='line'>2457</span> 
<span class='line'>2458</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// end jquery.ready</span><span class="WHIT">
<span class='line'>2459</span> 
<span class='line'>2460</span> </span><span class="COMM">/*
<span class='line'>2461</span> 	var TIMER_MODEL = {
<span class='line'>2462</span> 		TGM1: {
<span class='line'>2463</span> 			ARE: 30,
<span class='line'>2464</span> 			lock: 30,
<span class='line'>2465</span> 			separation1: 10,
<span class='line'>2466</span> 			separation2: 6,
<span class='line'>2467</span> 			separation3: 6,
<span class='line'>2468</span> 			separation4: 6
<span class='line'>2469</span> 			// 10+6+6+6 = 28; 28 + 1 + 2 = 31
<span class='line'>2470</span> 			},
<span class='line'>2471</span> 		Master000699:{
<span class='line'>2472</span> 			ARE: 25,
<span class='line'>2473</span> 			lock: 30,
<span class='line'>2474</span> 			separation1: 10,
<span class='line'>2475</span> 			separation2: 6,
<span class='line'>2476</span> 			separation3: 6,
<span class='line'>2477</span> 			separation4: 6
<span class='line'>2478</span> 		},
<span class='line'>2479</span> 		Master700799:{
<span class='line'>2480</span> 			ARE: 16,
<span class='line'>2481</span> 			lock: 30,
<span class='line'>2482</span> 			separation1: 10,
<span class='line'>2483</span> 			separation2: 6,
<span class='line'>2484</span> 			separation3: 6,
<span class='line'>2485</span> 			separation4: 6
<span class='line'>2486</span> 		},
<span class='line'>2487</span> 		Master800899:{
<span class='line'>2488</span> 			ARE: 12,
<span class='line'>2489</span> 			lock: 30,
<span class='line'>2490</span> 			separation1: 10,
<span class='line'>2491</span> 			separation2: 6,
<span class='line'>2492</span> 			separation3: 6,
<span class='line'>2493</span> 			separation4: 6
<span class='line'>2494</span> 		},
<span class='line'>2495</span> 		Master900999:{
<span class='line'>2496</span> 			ARE: 12,
<span class='line'>2497</span> 			lock: 17,
<span class='line'>2498</span> 			separation1: 6,
<span class='line'>2499</span> 			separation2: 4,
<span class='line'>2500</span> 			separation3: 4,
<span class='line'>2501</span> 			separation4: 3
<span class='line'>2502</span> 			// 5 + 4 + 3 + 3 = 14
<span class='line'>2503</span> 		},
<span class='line'>2504</span> 		Master10001099:{
<span class='line'>2505</span> 			ARE: 6,
<span class='line'>2506</span> 			lock: 17,
<span class='line'>2507</span> 			separation1: 6,
<span class='line'>2508</span> 			separation2: 4,
<span class='line'>2509</span> 			separation3: 4,
<span class='line'>2510</span> 			separation4: 3
<span class='line'>2511</span> 			// 5 + 4 + 3 + 3 = 14
<span class='line'>2512</span> 		},
<span class='line'>2513</span> 		Master11001199:{
<span class='line'>2514</span> 			ARE: 5,
<span class='line'>2515</span> 			lock: 15,
<span class='line'>2516</span> 			separation1: 5,
<span class='line'>2517</span> 			separation2: 4,
<span class='line'>2518</span> 			separation3: 4,
<span class='line'>2519</span> 			separation4: 3
<span class='line'>2520</span> 			// 4 + 4 + 3 + 3 = 14
<span class='line'>2521</span> 		},
<span class='line'>2522</span> 		Master12001299:{
<span class='line'>2523</span> 			ARE: 4,
<span class='line'>2524</span> 			lock: 15,
<span class='line'>2525</span> 			separation1: 5,
<span class='line'>2526</span> 			separation2: 4,
<span class='line'>2527</span> 			separation3: 4,
<span class='line'>2528</span> 			separation4: 3
<span class='line'>2529</span> 			// 4 + 4 + 3 + 3 = 14
<span class='line'>2530</span> 		},
<span class='line'>2531</span> 		Death000099:{
<span class='line'>2532</span> 			ARE: 16,
<span class='line'>2533</span> 			lock: 30,
<span class='line'>2534</span> 			separation1: 10,
<span class='line'>2535</span> 			separation2: 6,
<span class='line'>2536</span> 			separation3: 6,
<span class='line'>2537</span> 			separation4: 6
<span class='line'>2538</span> 		},
<span class='line'>2539</span> 		Death100199:{
<span class='line'>2540</span> 			ARE: 12,
<span class='line'>2541</span> 			lock: 26,
<span class='line'>2542</span> 			separation1: 9,
<span class='line'>2543</span> 			separation2: 6,
<span class='line'>2544</span> 			separation3: 6,
<span class='line'>2545</span> 			separation4: 5
<span class='line'>2546</span> 		},
<span class='line'>2547</span> 		Death200299:{
<span class='line'>2548</span> 			ARE: 12,
<span class='line'>2549</span> 			lock: 22,
<span class='line'>2550</span> 			separation1: 7,
<span class='line'>2551</span> 			separation2: 5,
<span class='line'>2552</span> 			separation3: 4,
<span class='line'>2553</span> 			separation4: 4
<span class='line'>2554</span> 		},
<span class='line'>2555</span> 		Death300399:{
<span class='line'>2556</span> 			ARE: 6,
<span class='line'>2557</span> 			lock: 18,
<span class='line'>2558</span> 			separation1: 6,
<span class='line'>2559</span> 			separation2: 4,
<span class='line'>2560</span> 			separation3: 4,
<span class='line'>2561</span> 			separation4: 4
<span class='line'>2562</span> 		},
<span class='line'>2563</span> 		Death400499:{
<span class='line'>2564</span> 			ARE: 5,
<span class='line'>2565</span> 			lock: 15,
<span class='line'>2566</span> 			separation1: 5,
<span class='line'>2567</span> 			separation2: 3,
<span class='line'>2568</span> 			separation3: 3,
<span class='line'>2569</span> 			separation4: 3
<span class='line'>2570</span> 		},
<span class='line'>2571</span> 		Death500999:{
<span class='line'>2572</span> 			ARE: 4,
<span class='line'>2573</span> 			lock: 15,
<span class='line'>2574</span> 			separation1: 5,
<span class='line'>2575</span> 			separation2: 3,
<span class='line'>2576</span> 			separation3: 3,
<span class='line'>2577</span> 			separation4: 3
<span class='line'>2578</span> 		},
<span class='line'>2579</span> 		Shirase000199:{
<span class='line'>2580</span> 			ARE: 10,
<span class='line'>2581</span> 			lock: 18,
<span class='line'>2582</span> 			separation1: 6,
<span class='line'>2583</span> 			separation2: 4,
<span class='line'>2584</span> 			separation3: 4,
<span class='line'>2585</span> 			separation4: 4
<span class='line'>2586</span> 		},
<span class='line'>2587</span> 		Shirase200299:{
<span class='line'>2588</span> 			ARE: 10,
<span class='line'>2589</span> 			lock: 17,
<span class='line'>2590</span> 			separation1: 6,
<span class='line'>2591</span> 			separation2: 4,
<span class='line'>2592</span> 			separation3: 4,
<span class='line'>2593</span> 			separation4: 3
<span class='line'>2594</span> 		},
<span class='line'>2595</span> 		Shirase300499:{
<span class='line'>2596</span> 			ARE: 4,
<span class='line'>2597</span> 			lock: 15,
<span class='line'>2598</span> 			separation1: 5,
<span class='line'>2599</span> 			separation2: 3,
<span class='line'>2600</span> 			separation3: 3,
<span class='line'>2601</span> 			separation4: 3
<span class='line'>2602</span> 		},
<span class='line'>2603</span> 		Shirase500599:{
<span class='line'>2604</span> 			ARE: 4,
<span class='line'>2605</span> 			lock: 13,
<span class='line'>2606</span> 			separation1: 4,
<span class='line'>2607</span> 			separation2: 3,
<span class='line'>2608</span> 			separation3: 3,
<span class='line'>2609</span> 			separation4: 3
<span class='line'>2610</span> 		},
<span class='line'>2611</span> 		Shirase6001099:{
<span class='line'>2612</span> 			ARE: 4,
<span class='line'>2613</span> 			lock: 12,
<span class='line'>2614</span> 			separation1: 4,
<span class='line'>2615</span> 			separation2: 3,
<span class='line'>2616</span> 			separation3: 3,
<span class='line'>2617</span> 			separation4: 2
<span class='line'>2618</span> 		},
<span class='line'>2619</span> 		Shirase11001199:{
<span class='line'>2620</span> 			ARE: 4,
<span class='line'>2621</span> 			lock: 10,
<span class='line'>2622</span> 			separation1: 4,
<span class='line'>2623</span> 			separation2: 2,
<span class='line'>2624</span> 			separation3: 2,
<span class='line'>2625</span> 			separation4: 2
<span class='line'>2626</span> 		},
<span class='line'>2627</span> 		Shirase12001299:{
<span class='line'>2628</span> 			ARE: 4,
<span class='line'>2629</span> 			lock: 8,
<span class='line'>2630</span> 			separation1: 4,
<span class='line'>2631</span> 			separation2: 2,
<span class='line'>2632</span> 			separation3: 1,
<span class='line'>2633</span> 			separation4: 1
<span class='line'>2634</span> 		},
<span class='line'>2635</span> 		TDSSRS:{
<span class='line'>2636</span> 			ARE: 1, // 0 in reality
<span class='line'>2637</span> 			lock: 30,
<span class='line'>2638</span> 			separation1: 10,
<span class='line'>2639</span> 			separation2: 7,
<span class='line'>2640</span> 			separation3: 8,
<span class='line'>2641</span> 			separation4: 6
<span class='line'>2642</span> 		}
<span class='line'>2643</span> 	}
<span class='line'>2644</span> */</span></pre></body></html>