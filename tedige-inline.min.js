(function(){var zip_WSIZE=32768;var zip_STORED_BLOCK=0;var zip_STATIC_TREES=1;var zip_DYN_TREES=2;var zip_lbits=9;var zip_dbits=6;var zip_INBUFSIZ=32768;var zip_INBUF_EXTRA=64;var zip_slide;var zip_wp;var zip_fixed_tl=null;var zip_fixed_td;var zip_fixed_bl,fixed_bd;var zip_bit_buf;var zip_bit_len;var zip_method;var zip_eof;var zip_copy_leng;var zip_copy_dist;var zip_tl,zip_td;var zip_bl,zip_bd;var zip_inflate_data;var zip_inflate_pos;var zip_MASK_BITS=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);var zip_cplens=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0);var zip_cplext=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99);var zip_cpdist=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577);var zip_cpdext=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var zip_border=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var zip_HuftList=function(){this.next=null;this.list=null};var zip_HuftNode=function(){this.e=0;this.b=0;this.n=0;this.t=null};var zip_HuftBuild=function(b,n,s,d,e,mm){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;{var a;var c=new Array(this.BMAX+1);var el;var f;var g;var h;var i;var j;var k;var lx=new Array(this.BMAX+1);var p;var pidx;var q;var r=new zip_HuftNode;var u=new Array(this.BMAX);var v=new Array(this.N_MAX);var w;var x=new Array(this.BMAX+1);var xp;var y;var z;var o;var tail;tail=this.root=null;for(i=0;i<c.length;i++)c[i]=0;for(i=0;i<lx.length;i++)lx[i]=0;for(i=0;i<u.length;i++)u[i]=null;for(i=0;i<v.length;i++)v[i]=0;for(i=0;i<x.length;i++)x[i]=0;el=n>256?b[256]:this.BMAX;p=b;pidx=0;i=n;do{c[p[pidx]]++;pidx++}while(--i>0);if(c[0]==n){this.root=null;this.m=0;this.status=0;return}for(j=1;j<=this.BMAX;j++)if(c[j]!=0)break;k=j;if(mm<j)mm=j;for(i=this.BMAX;i!=0;i--)if(c[i]!=0)break;g=i;if(mm>i)mm=i;for(y=1<<j;j<i;j++,y<<=1)if((y-=c[j])<0){this.status=2;this.m=mm;return}if((y-=c[i])<0){this.status=2;this.m=mm;return}c[i]+=y;x[1]=j=0;p=c;pidx=1;xp=2;while(--i>0)x[xp++]=j+=p[pidx++];p=b;pidx=0;i=0;do{if((j=p[pidx++])!=0)v[x[j]++]=i}while(++i<n);n=x[g];x[0]=i=0;p=v;pidx=0;h=-1;w=lx[0]=0;q=null;z=0;for(;k<=g;k++){a=c[k];while(a-->0){while(k>w+lx[1+h]){w+=lx[1+h];h++;z=(z=g-w)>mm?mm:z;if((f=1<<(j=k-w))>a+1){f-=a+1;xp=k;while(++j<z){if((f<<=1)<=c[++xp])break;f-=c[xp]}}if(w+j>el&&w<el)j=el-w;z=1<<j;lx[1+h]=j;q=new Array(z);for(o=0;o<z;o++){q[o]=new zip_HuftNode}if(tail==null)tail=this.root=new zip_HuftList;else tail=tail.next=new zip_HuftList;tail.next=null;tail.list=q;u[h]=q;if(h>0){x[h]=i;r.b=lx[h];r.e=16+j;r.t=q;j=(i&(1<<w)-1)>>w-lx[h];u[h-1][j].e=r.e;u[h-1][j].b=r.b;u[h-1][j].n=r.n;u[h-1][j].t=r.t}}r.b=k-w;if(pidx>=n)r.e=99;else if(p[pidx]<s){r.e=p[pidx]<256?16:15;r.n=p[pidx++]}else{r.e=e[p[pidx]-s];r.n=d[p[pidx++]-s]}f=1<<k-w;for(j=i>>w;j<z;j+=f){q[j].e=r.e;q[j].b=r.b;q[j].n=r.n;q[j].t=r.t}for(j=1<<k-1;(i&j)!=0;j>>=1)i^=j;i^=j;while((i&(1<<w)-1)!=x[h]){w-=lx[h];h--}}}this.m=lx[1];this.status=y!=0&&g!=1?1:0}};var zip_GET_BYTE=function(){if(zip_inflate_data.length==zip_inflate_pos)return-1;return zip_inflate_data.charCodeAt(zip_inflate_pos++)&255};var zip_NEEDBITS=function(n){while(zip_bit_len<n){zip_bit_buf|=zip_GET_BYTE()<<zip_bit_len;zip_bit_len+=8}};var zip_GETBITS=function(n){return zip_bit_buf&zip_MASK_BITS[n]};var zip_DUMPBITS=function(n){zip_bit_buf>>=n;zip_bit_len-=n};var zip_inflate_codes=function(buff,off,size){var e;var t;var n;if(size==0)return 0;n=0;for(;;){zip_NEEDBITS(zip_bl);t=zip_tl.list[zip_GETBITS(zip_bl)];e=t.e;while(e>16){if(e==99)return-1;zip_DUMPBITS(t.b);e-=16;zip_NEEDBITS(e);t=t.t[zip_GETBITS(e)];e=t.e}zip_DUMPBITS(t.b);if(e==16){zip_wp&=zip_WSIZE-1;buff[off+n++]=zip_slide[zip_wp++]=t.n;if(n==size)return size;continue}if(e==15)break;zip_NEEDBITS(e);zip_copy_leng=t.n+zip_GETBITS(e);zip_DUMPBITS(e);zip_NEEDBITS(zip_bd);t=zip_td.list[zip_GETBITS(zip_bd)];e=t.e;while(e>16){if(e==99)return-1;zip_DUMPBITS(t.b);e-=16;zip_NEEDBITS(e);t=t.t[zip_GETBITS(e)];e=t.e}zip_DUMPBITS(t.b);zip_NEEDBITS(e);zip_copy_dist=zip_wp-t.n-zip_GETBITS(e);zip_DUMPBITS(e);while(zip_copy_leng>0&&n<size){zip_copy_leng--;zip_copy_dist&=zip_WSIZE-1;zip_wp&=zip_WSIZE-1;buff[off+n++]=zip_slide[zip_wp++]=zip_slide[zip_copy_dist++]}if(n==size)return size}zip_method=-1;return n};var zip_inflate_stored=function(buff,off,size){var n;n=zip_bit_len&7;zip_DUMPBITS(n);zip_NEEDBITS(16);n=zip_GETBITS(16);zip_DUMPBITS(16);zip_NEEDBITS(16);if(n!=(~zip_bit_buf&65535))return-1;zip_DUMPBITS(16);zip_copy_leng=n;n=0;while(zip_copy_leng>0&&n<size){zip_copy_leng--;zip_wp&=zip_WSIZE-1;zip_NEEDBITS(8);buff[off+n++]=zip_slide[zip_wp++]=zip_GETBITS(8);zip_DUMPBITS(8)}if(zip_copy_leng==0)zip_method=-1;return n};var zip_inflate_fixed=function(buff,off,size){if(zip_fixed_tl==null){var i;var l=new Array(288);var h;for(i=0;i<144;i++)l[i]=8;for(;i<256;i++)l[i]=9;for(;i<280;i++)l[i]=7;for(;i<288;i++)l[i]=8;zip_fixed_bl=7;h=new zip_HuftBuild(l,288,257,zip_cplens,zip_cplext,zip_fixed_bl);if(h.status!=0){alert("HufBuild error: "+h.status);return-1}zip_fixed_tl=h.root;zip_fixed_bl=h.m;for(i=0;i<30;i++)l[i]=5;zip_fixed_bd=5;h=new zip_HuftBuild(l,30,0,zip_cpdist,zip_cpdext,zip_fixed_bd);if(h.status>1){zip_fixed_tl=null;alert("HufBuild error: "+h.status);return-1}zip_fixed_td=h.root;zip_fixed_bd=h.m}zip_tl=zip_fixed_tl;zip_td=zip_fixed_td;zip_bl=zip_fixed_bl;zip_bd=zip_fixed_bd;return zip_inflate_codes(buff,off,size)};var zip_inflate_dynamic=function(buff,off,size){var i;var j;var l;var n;var t;var nb;var nl;var nd;var ll=new Array(286+30);var h;for(i=0;i<ll.length;i++)ll[i]=0;zip_NEEDBITS(5);nl=257+zip_GETBITS(5);zip_DUMPBITS(5);zip_NEEDBITS(5);nd=1+zip_GETBITS(5);zip_DUMPBITS(5);zip_NEEDBITS(4);nb=4+zip_GETBITS(4);zip_DUMPBITS(4);if(nl>286||nd>30)return-1;for(j=0;j<nb;j++){zip_NEEDBITS(3);ll[zip_border[j]]=zip_GETBITS(3);zip_DUMPBITS(3)}for(;j<19;j++)ll[zip_border[j]]=0;zip_bl=7;h=new zip_HuftBuild(ll,19,19,null,null,zip_bl);if(h.status!=0)return-1;zip_tl=h.root;zip_bl=h.m;n=nl+nd;i=l=0;while(i<n){zip_NEEDBITS(zip_bl);t=zip_tl.list[zip_GETBITS(zip_bl)];j=t.b;zip_DUMPBITS(j);j=t.n;if(j<16)ll[i++]=l=j;else if(j==16){zip_NEEDBITS(2);j=3+zip_GETBITS(2);zip_DUMPBITS(2);if(i+j>n)return-1;while(j-->0)ll[i++]=l}else if(j==17){zip_NEEDBITS(3);j=3+zip_GETBITS(3);zip_DUMPBITS(3);if(i+j>n)return-1;while(j-->0)ll[i++]=0;l=0}else{zip_NEEDBITS(7);j=11+zip_GETBITS(7);zip_DUMPBITS(7);if(i+j>n)return-1;while(j-->0)ll[i++]=0;l=0}}zip_bl=zip_lbits;h=new zip_HuftBuild(ll,nl,257,zip_cplens,zip_cplext,zip_bl);if(zip_bl==0)h.status=1;if(h.status!=0){if(h.status==1);return-1}zip_tl=h.root;zip_bl=h.m;for(i=0;i<nd;i++)ll[i]=ll[i+nl];zip_bd=zip_dbits;h=new zip_HuftBuild(ll,nd,0,zip_cpdist,zip_cpdext,zip_bd);zip_td=h.root;zip_bd=h.m;if(zip_bd==0&&nl>257){return-1}if(h.status==1){}if(h.status!=0)return-1;return zip_inflate_codes(buff,off,size)};var zip_inflate_start=function(){var i;if(zip_slide==null)zip_slide=new Array(2*zip_WSIZE);zip_wp=0;zip_bit_buf=0;zip_bit_len=0;zip_method=-1;zip_eof=false;zip_copy_leng=zip_copy_dist=0;zip_tl=null};var zip_inflate_internal=function(buff,off,size){var n,i;n=0;while(n<size){if(zip_eof&&zip_method==-1)return n;if(zip_copy_leng>0){if(zip_method!=zip_STORED_BLOCK){while(zip_copy_leng>0&&n<size){zip_copy_leng--;zip_copy_dist&=zip_WSIZE-1;zip_wp&=zip_WSIZE-1;buff[off+n++]=zip_slide[zip_wp++]=zip_slide[zip_copy_dist++]}}else{while(zip_copy_leng>0&&n<size){zip_copy_leng--;zip_wp&=zip_WSIZE-1;zip_NEEDBITS(8);buff[off+n++]=zip_slide[zip_wp++]=zip_GETBITS(8);zip_DUMPBITS(8)}if(zip_copy_leng==0)zip_method=-1}if(n==size)return n}if(zip_method==-1){if(zip_eof)break;zip_NEEDBITS(1);if(zip_GETBITS(1)!=0)zip_eof=true;zip_DUMPBITS(1);zip_NEEDBITS(2);zip_method=zip_GETBITS(2);zip_DUMPBITS(2);zip_tl=null;zip_copy_leng=0}switch(zip_method){case 0:i=zip_inflate_stored(buff,off+n,size-n);break;case 1:if(zip_tl!=null)i=zip_inflate_codes(buff,off+n,size-n);else i=zip_inflate_fixed(buff,off+n,size-n);break;case 2:if(zip_tl!=null)i=zip_inflate_codes(buff,off+n,size-n);else i=zip_inflate_dynamic(buff,off+n,size-n);break;default:i=-1;break}if(i==-1){if(zip_eof)return 0;return-1}n+=i}return n};var zip_inflate=function(str){var i,j;zip_inflate_start();zip_inflate_data=str;zip_inflate_pos=0;var buff=new Array(1024);var aout=[];while((i=zip_inflate_internal(buff,0,buff.length))>0){var cbuf=new Array(i);for(j=0;j<i;j++){cbuf[j]=String.fromCharCode(buff[j])}aout[aout.length]=cbuf.join("")}zip_inflate_data=null;return aout.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.inflate=zip_inflate})();(function(){var zip_WSIZE=32768;var zip_STORED_BLOCK=0;var zip_STATIC_TREES=1;var zip_DYN_TREES=2;var zip_DEFAULT_LEVEL=6;var zip_FULL_SEARCH=true;var zip_INBUFSIZ=32768;var zip_INBUF_EXTRA=64;var zip_OUTBUFSIZ=1024*8;var zip_window_size=2*zip_WSIZE;var zip_MIN_MATCH=3;var zip_MAX_MATCH=258;var zip_BITS=16;var zip_LIT_BUFSIZE=8192;var zip_HASH_BITS=13;if(zip_LIT_BUFSIZE>zip_INBUFSIZ)alert("error: zip_INBUFSIZ is too small");if(zip_WSIZE<<1>1<<zip_BITS)alert("error: zip_WSIZE is too large");if(zip_HASH_BITS>zip_BITS-1)alert("error: zip_HASH_BITS is too large");if(zip_HASH_BITS<8||zip_MAX_MATCH!=258)alert("error: Code too clever");var zip_DIST_BUFSIZE=zip_LIT_BUFSIZE;var zip_HASH_SIZE=1<<zip_HASH_BITS;var zip_HASH_MASK=zip_HASH_SIZE-1;var zip_WMASK=zip_WSIZE-1;var zip_NIL=0;var zip_TOO_FAR=4096;var zip_MIN_LOOKAHEAD=zip_MAX_MATCH+zip_MIN_MATCH+1;var zip_MAX_DIST=zip_WSIZE-zip_MIN_LOOKAHEAD;var zip_SMALLEST=1;var zip_MAX_BITS=15;var zip_MAX_BL_BITS=7;var zip_LENGTH_CODES=29;var zip_LITERALS=256;var zip_END_BLOCK=256;var zip_L_CODES=zip_LITERALS+1+zip_LENGTH_CODES;var zip_D_CODES=30;var zip_BL_CODES=19;var zip_REP_3_6=16;var zip_REPZ_3_10=17;var zip_REPZ_11_138=18;var zip_HEAP_SIZE=2*zip_L_CODES+1;var zip_H_SHIFT=parseInt((zip_HASH_BITS+zip_MIN_MATCH-1)/zip_MIN_MATCH);var zip_free_queue;var zip_qhead,zip_qtail;var zip_initflag;var zip_outbuf=null;var zip_outcnt,zip_outoff;var zip_complete;var zip_window;var zip_d_buf;var zip_l_buf;var zip_prev;var zip_bi_buf;var zip_bi_valid;var zip_block_start;var zip_ins_h;var zip_hash_head;var zip_prev_match;var zip_match_available;var zip_match_length;var zip_prev_length;var zip_strstart;var zip_match_start;var zip_eofile;var zip_lookahead;var zip_max_chain_length;var zip_max_lazy_match;var zip_compr_level;var zip_good_match;var zip_nice_match;var zip_dyn_ltree;var zip_dyn_dtree;var zip_static_ltree;var zip_static_dtree;var zip_bl_tree;var zip_l_desc;var zip_d_desc;var zip_bl_desc;var zip_bl_count;var zip_heap;var zip_heap_len;var zip_heap_max;var zip_depth;var zip_length_code;var zip_dist_code;var zip_base_length;var zip_base_dist;var zip_flag_buf;var zip_last_lit;var zip_last_dist;var zip_last_flags;var zip_flags;var zip_flag_bit;var zip_opt_len;var zip_static_len;var zip_deflate_data;var zip_deflate_pos;var zip_DeflateCT=function(){this.fc=0;this.dl=0};var zip_DeflateTreeDesc=function(){this.dyn_tree=null;this.static_tree=null;this.extra_bits=null;this.extra_base=0;this.elems=0;this.max_length=0;this.max_code=0};var zip_DeflateConfiguration=function(a,b,c,d){this.good_length=a;this.max_lazy=b;this.nice_length=c;this.max_chain=d};var zip_DeflateBuffer=function(){this.next=null;this.len=0;this.ptr=new Array(zip_OUTBUFSIZ);this.off=0};var zip_extra_lbits=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0);var zip_extra_dbits=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var zip_extra_blbits=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7);var zip_bl_order=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var zip_configuration_table=new Array(new zip_DeflateConfiguration(0,0,0,0),new zip_DeflateConfiguration(4,4,8,4),new zip_DeflateConfiguration(4,5,16,8),new zip_DeflateConfiguration(4,6,32,32),new zip_DeflateConfiguration(4,4,16,16),new zip_DeflateConfiguration(8,16,32,32),new zip_DeflateConfiguration(8,16,128,128),new zip_DeflateConfiguration(8,32,128,256),new zip_DeflateConfiguration(32,128,258,1024),new zip_DeflateConfiguration(32,258,258,4096));var zip_deflate_start=function(level){var i;if(!level)level=zip_DEFAULT_LEVEL;else if(level<1)level=1;else if(level>9)level=9;zip_compr_level=level;zip_initflag=false;zip_eofile=false;if(zip_outbuf!=null)return;zip_free_queue=zip_qhead=zip_qtail=null;zip_outbuf=new Array(zip_OUTBUFSIZ);zip_window=new Array(zip_window_size);zip_d_buf=new Array(zip_DIST_BUFSIZE);zip_l_buf=new Array(zip_INBUFSIZ+zip_INBUF_EXTRA);zip_prev=new Array(1<<zip_BITS);zip_dyn_ltree=new Array(zip_HEAP_SIZE);for(i=0;i<zip_HEAP_SIZE;i++)zip_dyn_ltree[i]=new zip_DeflateCT;zip_dyn_dtree=new Array(2*zip_D_CODES+1);for(i=0;i<2*zip_D_CODES+1;i++)zip_dyn_dtree[i]=new zip_DeflateCT;zip_static_ltree=new Array(zip_L_CODES+2);for(i=0;i<zip_L_CODES+2;i++)zip_static_ltree[i]=new zip_DeflateCT;zip_static_dtree=new Array(zip_D_CODES);for(i=0;i<zip_D_CODES;i++)zip_static_dtree[i]=new zip_DeflateCT;zip_bl_tree=new Array(2*zip_BL_CODES+1);for(i=0;i<2*zip_BL_CODES+1;i++)zip_bl_tree[i]=new zip_DeflateCT;zip_l_desc=new zip_DeflateTreeDesc;zip_d_desc=new zip_DeflateTreeDesc;zip_bl_desc=new zip_DeflateTreeDesc;zip_bl_count=new Array(zip_MAX_BITS+1);zip_heap=new Array(2*zip_L_CODES+1);zip_depth=new Array(2*zip_L_CODES+1);zip_length_code=new Array(zip_MAX_MATCH-zip_MIN_MATCH+1);zip_dist_code=new Array(512);zip_base_length=new Array(zip_LENGTH_CODES);zip_base_dist=new Array(zip_D_CODES);zip_flag_buf=new Array(parseInt(zip_LIT_BUFSIZE/8))};var zip_deflate_end=function(){zip_free_queue=zip_qhead=zip_qtail=null;zip_outbuf=null;zip_window=null;zip_d_buf=null;zip_l_buf=null;zip_prev=null;zip_dyn_ltree=null;zip_dyn_dtree=null;zip_static_ltree=null;zip_static_dtree=null;zip_bl_tree=null;zip_l_desc=null;zip_d_desc=null;zip_bl_desc=null;zip_bl_count=null;zip_heap=null;zip_depth=null;zip_length_code=null;zip_dist_code=null;zip_base_length=null;zip_base_dist=null;zip_flag_buf=null};var zip_reuse_queue=function(p){p.next=zip_free_queue;zip_free_queue=p};var zip_new_queue=function(){var p;if(zip_free_queue!=null){p=zip_free_queue;zip_free_queue=zip_free_queue.next}else p=new zip_DeflateBuffer;p.next=null;p.len=p.off=0;return p};var zip_head1=function(i){return zip_prev[zip_WSIZE+i]};var zip_head2=function(i,val){return zip_prev[zip_WSIZE+i]=val};var zip_put_byte=function(c){zip_outbuf[zip_outoff+zip_outcnt++]=c;if(zip_outoff+zip_outcnt==zip_OUTBUFSIZ)zip_qoutbuf()};var zip_put_short=function(w){w&=65535;if(zip_outoff+zip_outcnt<zip_OUTBUFSIZ-2){zip_outbuf[zip_outoff+zip_outcnt++]=w&255;zip_outbuf[zip_outoff+zip_outcnt++]=w>>>8}else{zip_put_byte(w&255);zip_put_byte(w>>>8)}};var zip_INSERT_STRING=function(){zip_ins_h=(zip_ins_h<<zip_H_SHIFT^zip_window[zip_strstart+zip_MIN_MATCH-1]&255)&zip_HASH_MASK;zip_hash_head=zip_head1(zip_ins_h);zip_prev[zip_strstart&zip_WMASK]=zip_hash_head;zip_head2(zip_ins_h,zip_strstart)};var zip_SEND_CODE=function(c,tree){zip_send_bits(tree[c].fc,tree[c].dl)};var zip_D_CODE=function(dist){return(dist<256?zip_dist_code[dist]:zip_dist_code[256+(dist>>7)])&255};var zip_SMALLER=function(tree,n,m){return tree[n].fc<tree[m].fc||tree[n].fc==tree[m].fc&&zip_depth[n]<=zip_depth[m]};var zip_read_buff=function(buff,offset,n){var i;for(i=0;i<n&&zip_deflate_pos<zip_deflate_data.length;i++)buff[offset+i]=zip_deflate_data.charCodeAt(zip_deflate_pos++)&255;return i};var zip_lm_init=function(){var j;for(j=0;j<zip_HASH_SIZE;j++)zip_prev[zip_WSIZE+j]=0;zip_max_lazy_match=zip_configuration_table[zip_compr_level].max_lazy;zip_good_match=zip_configuration_table[zip_compr_level].good_length;if(!zip_FULL_SEARCH)zip_nice_match=zip_configuration_table[zip_compr_level].nice_length;zip_max_chain_length=zip_configuration_table[zip_compr_level].max_chain;zip_strstart=0;zip_block_start=0;zip_lookahead=zip_read_buff(zip_window,0,2*zip_WSIZE);if(zip_lookahead<=0){zip_eofile=true;zip_lookahead=0;return}zip_eofile=false;while(zip_lookahead<zip_MIN_LOOKAHEAD&&!zip_eofile)zip_fill_window();zip_ins_h=0;for(j=0;j<zip_MIN_MATCH-1;j++){zip_ins_h=(zip_ins_h<<zip_H_SHIFT^zip_window[j]&255)&zip_HASH_MASK}};var zip_longest_match=function(cur_match){var chain_length=zip_max_chain_length;var scanp=zip_strstart;var matchp;var len;var best_len=zip_prev_length;var limit=zip_strstart>zip_MAX_DIST?zip_strstart-zip_MAX_DIST:zip_NIL;var strendp=zip_strstart+zip_MAX_MATCH;var scan_end1=zip_window[scanp+best_len-1];var scan_end=zip_window[scanp+best_len];if(zip_prev_length>=zip_good_match)chain_length>>=2;do{matchp=cur_match;if(zip_window[matchp+best_len]!=scan_end||zip_window[matchp+best_len-1]!=scan_end1||zip_window[matchp]!=zip_window[scanp]||zip_window[++matchp]!=zip_window[scanp+1]){continue}scanp+=2;matchp++;do{}while(zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&scanp<strendp);len=zip_MAX_MATCH-(strendp-scanp);scanp=strendp-zip_MAX_MATCH;if(len>best_len){zip_match_start=cur_match;best_len=len;if(zip_FULL_SEARCH){if(len>=zip_MAX_MATCH)break}else{if(len>=zip_nice_match)break}scan_end1=zip_window[scanp+best_len-1];scan_end=zip_window[scanp+best_len]}}while((cur_match=zip_prev[cur_match&zip_WMASK])>limit&&--chain_length!=0);return best_len};var zip_fill_window=function(){var n,m;var more=zip_window_size-zip_lookahead-zip_strstart;if(more==-1){more--}else if(zip_strstart>=zip_WSIZE+zip_MAX_DIST){for(n=0;n<zip_WSIZE;n++)zip_window[n]=zip_window[n+zip_WSIZE];zip_match_start-=zip_WSIZE;zip_strstart-=zip_WSIZE;zip_block_start-=zip_WSIZE;for(n=0;n<zip_HASH_SIZE;n++){m=zip_head1(n);zip_head2(n,m>=zip_WSIZE?m-zip_WSIZE:zip_NIL)}for(n=0;n<zip_WSIZE;n++){m=zip_prev[n];zip_prev[n]=m>=zip_WSIZE?m-zip_WSIZE:zip_NIL}more+=zip_WSIZE}if(!zip_eofile){n=zip_read_buff(zip_window,zip_strstart+zip_lookahead,more);if(n<=0)zip_eofile=true;else zip_lookahead+=n}};var zip_deflate_fast=function(){while(zip_lookahead!=0&&zip_qhead==null){var flush;zip_INSERT_STRING();if(zip_hash_head!=zip_NIL&&zip_strstart-zip_hash_head<=zip_MAX_DIST){zip_match_length=zip_longest_match(zip_hash_head);if(zip_match_length>zip_lookahead)zip_match_length=zip_lookahead}if(zip_match_length>=zip_MIN_MATCH){flush=zip_ct_tally(zip_strstart-zip_match_start,zip_match_length-zip_MIN_MATCH);zip_lookahead-=zip_match_length;if(zip_match_length<=zip_max_lazy_match){zip_match_length--;do{zip_strstart++;zip_INSERT_STRING()}while(--zip_match_length!=0);zip_strstart++}else{zip_strstart+=zip_match_length;zip_match_length=0;zip_ins_h=zip_window[zip_strstart]&255;zip_ins_h=(zip_ins_h<<zip_H_SHIFT^zip_window[zip_strstart+1]&255)&zip_HASH_MASK}}else{flush=zip_ct_tally(0,zip_window[zip_strstart]&255);zip_lookahead--;zip_strstart++}if(flush){zip_flush_block(0);zip_block_start=zip_strstart}while(zip_lookahead<zip_MIN_LOOKAHEAD&&!zip_eofile)zip_fill_window()}};var zip_deflate_better=function(){while(zip_lookahead!=0&&zip_qhead==null){zip_INSERT_STRING();zip_prev_length=zip_match_length;zip_prev_match=zip_match_start;zip_match_length=zip_MIN_MATCH-1;if(zip_hash_head!=zip_NIL&&zip_prev_length<zip_max_lazy_match&&zip_strstart-zip_hash_head<=zip_MAX_DIST){zip_match_length=zip_longest_match(zip_hash_head);if(zip_match_length>zip_lookahead)zip_match_length=zip_lookahead;if(zip_match_length==zip_MIN_MATCH&&zip_strstart-zip_match_start>zip_TOO_FAR){zip_match_length--}}if(zip_prev_length>=zip_MIN_MATCH&&zip_match_length<=zip_prev_length){var flush;flush=zip_ct_tally(zip_strstart-1-zip_prev_match,zip_prev_length-zip_MIN_MATCH);zip_lookahead-=zip_prev_length-1;zip_prev_length-=2;do{zip_strstart++;zip_INSERT_STRING()}while(--zip_prev_length!=0);zip_match_available=0;zip_match_length=zip_MIN_MATCH-1;zip_strstart++;if(flush){zip_flush_block(0);zip_block_start=zip_strstart}}else if(zip_match_available!=0){if(zip_ct_tally(0,zip_window[zip_strstart-1]&255)){zip_flush_block(0);zip_block_start=zip_strstart}zip_strstart++;zip_lookahead--}else{zip_match_available=1;zip_strstart++;zip_lookahead--}while(zip_lookahead<zip_MIN_LOOKAHEAD&&!zip_eofile)zip_fill_window()}};var zip_init_deflate=function(){if(zip_eofile)return;zip_bi_buf=0;zip_bi_valid=0;zip_ct_init();zip_lm_init();zip_qhead=null;zip_outcnt=0;zip_outoff=0;if(zip_compr_level<=3){zip_prev_length=zip_MIN_MATCH-1;zip_match_length=0}else{zip_match_length=zip_MIN_MATCH-1;zip_match_available=0}zip_complete=false};var zip_deflate_internal=function(buff,off,buff_size){var n;if(!zip_initflag){zip_init_deflate();zip_initflag=true;if(zip_lookahead==0){zip_complete=true;return 0}}if((n=zip_qcopy(buff,off,buff_size))==buff_size)return buff_size;if(zip_complete)return n;if(zip_compr_level<=3)zip_deflate_fast();else zip_deflate_better();if(zip_lookahead==0){if(zip_match_available!=0)zip_ct_tally(0,zip_window[zip_strstart-1]&255);zip_flush_block(1);zip_complete=true}return n+zip_qcopy(buff,n+off,buff_size-n)};var zip_qcopy=function(buff,off,buff_size){var n,i,j;n=0;while(zip_qhead!=null&&n<buff_size){i=buff_size-n;if(i>zip_qhead.len)i=zip_qhead.len;for(j=0;j<i;j++)buff[off+n+j]=zip_qhead.ptr[zip_qhead.off+j];zip_qhead.off+=i;zip_qhead.len-=i;n+=i;if(zip_qhead.len==0){var p;p=zip_qhead;zip_qhead=zip_qhead.next;zip_reuse_queue(p)}}if(n==buff_size)return n;if(zip_outoff<zip_outcnt){i=buff_size-n;if(i>zip_outcnt-zip_outoff)i=zip_outcnt-zip_outoff;for(j=0;j<i;j++)buff[off+n+j]=zip_outbuf[zip_outoff+j];zip_outoff+=i;n+=i;if(zip_outcnt==zip_outoff)zip_outcnt=zip_outoff=0}return n};var zip_ct_init=function(){var n;var bits;var length;var code;var dist;if(zip_static_dtree[0].dl!=0)return;zip_l_desc.dyn_tree=zip_dyn_ltree;zip_l_desc.static_tree=zip_static_ltree;zip_l_desc.extra_bits=zip_extra_lbits;zip_l_desc.extra_base=zip_LITERALS+1;zip_l_desc.elems=zip_L_CODES;zip_l_desc.max_length=zip_MAX_BITS;zip_l_desc.max_code=0;zip_d_desc.dyn_tree=zip_dyn_dtree;zip_d_desc.static_tree=zip_static_dtree;zip_d_desc.extra_bits=zip_extra_dbits;zip_d_desc.extra_base=0;zip_d_desc.elems=zip_D_CODES;zip_d_desc.max_length=zip_MAX_BITS;zip_d_desc.max_code=0;zip_bl_desc.dyn_tree=zip_bl_tree;zip_bl_desc.static_tree=null;zip_bl_desc.extra_bits=zip_extra_blbits;zip_bl_desc.extra_base=0;zip_bl_desc.elems=zip_BL_CODES;zip_bl_desc.max_length=zip_MAX_BL_BITS;zip_bl_desc.max_code=0;length=0;for(code=0;code<zip_LENGTH_CODES-1;code++){zip_base_length[code]=length;for(n=0;n<1<<zip_extra_lbits[code];n++)zip_length_code[length++]=code}zip_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){zip_base_dist[code]=dist;for(n=0;n<1<<zip_extra_dbits[code];n++){zip_dist_code[dist++]=code}}dist>>=7;for(;code<zip_D_CODES;code++){zip_base_dist[code]=dist<<7;for(n=0;n<1<<zip_extra_dbits[code]-7;n++)zip_dist_code[256+dist++]=code}for(bits=0;bits<=zip_MAX_BITS;bits++)zip_bl_count[bits]=0;n=0;while(n<=143){zip_static_ltree[n++].dl=8;zip_bl_count[8]++}while(n<=255){zip_static_ltree[n++].dl=9;zip_bl_count[9]++}while(n<=279){zip_static_ltree[n++].dl=7;zip_bl_count[7]++}while(n<=287){zip_static_ltree[n++].dl=8;zip_bl_count[8]++}zip_gen_codes(zip_static_ltree,zip_L_CODES+1);for(n=0;n<zip_D_CODES;n++){zip_static_dtree[n].dl=5;zip_static_dtree[n].fc=zip_bi_reverse(n,5)}zip_init_block()};var zip_init_block=function(){var n;for(n=0;n<zip_L_CODES;n++)zip_dyn_ltree[n].fc=0;for(n=0;n<zip_D_CODES;n++)zip_dyn_dtree[n].fc=0;for(n=0;n<zip_BL_CODES;n++)zip_bl_tree[n].fc=0;zip_dyn_ltree[zip_END_BLOCK].fc=1;zip_opt_len=zip_static_len=0;zip_last_lit=zip_last_dist=zip_last_flags=0;zip_flags=0;zip_flag_bit=1};var zip_pqdownheap=function(tree,k){var v=zip_heap[k];var j=k<<1;while(j<=zip_heap_len){if(j<zip_heap_len&&zip_SMALLER(tree,zip_heap[j+1],zip_heap[j]))j++;if(zip_SMALLER(tree,v,zip_heap[j]))break;zip_heap[k]=zip_heap[j];k=j;j<<=1}zip_heap[k]=v};var zip_gen_bitlen=function(desc){var tree=desc.dyn_tree;var extra=desc.extra_bits;var base=desc.extra_base;var max_code=desc.max_code;var max_length=desc.max_length;var stree=desc.static_tree;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=zip_MAX_BITS;bits++)zip_bl_count[bits]=0;tree[zip_heap[zip_heap_max]].dl=0;for(h=zip_heap_max+1;h<zip_HEAP_SIZE;h++){n=zip_heap[h];bits=tree[tree[n].dl].dl+1;if(bits>max_length){bits=max_length;overflow++}tree[n].dl=bits;if(n>max_code)continue;zip_bl_count[bits]++;xbits=0;if(n>=base)xbits=extra[n-base];f=tree[n].fc;zip_opt_len+=f*(bits+xbits);if(stree!=null)zip_static_len+=f*(stree[n].dl+xbits)}if(overflow==0)return;do{bits=max_length-1;while(zip_bl_count[bits]==0)bits--;zip_bl_count[bits]--;zip_bl_count[bits+1]+=2;zip_bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!=0;bits--){n=zip_bl_count[bits];while(n!=0){m=zip_heap[--h];if(m>max_code)continue;if(tree[m].dl!=bits){zip_opt_len+=(bits-tree[m].dl)*tree[m].fc;tree[m].fc=bits}n--}}};var zip_gen_codes=function(tree,max_code){var next_code=new Array(zip_MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=zip_MAX_BITS;bits++){code=code+zip_bl_count[bits-1]<<1;next_code[bits]=code}for(n=0;n<=max_code;n++){var len=tree[n].dl;if(len==0)continue;tree[n].fc=zip_bi_reverse(next_code[len]++,len)}};var zip_build_tree=function(desc){var tree=desc.dyn_tree;var stree=desc.static_tree;var elems=desc.elems;var n,m;var max_code=-1;var node=elems;zip_heap_len=0;zip_heap_max=zip_HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n].fc!=0){zip_heap[++zip_heap_len]=max_code=n;zip_depth[n]=0}else tree[n].dl=0}while(zip_heap_len<2){var xnew=zip_heap[++zip_heap_len]=max_code<2?++max_code:0;tree[xnew].fc=1;zip_depth[xnew]=0;zip_opt_len--;if(stree!=null)zip_static_len-=stree[xnew].dl}desc.max_code=max_code;for(n=zip_heap_len>>1;n>=1;n--)zip_pqdownheap(tree,n);do{n=zip_heap[zip_SMALLEST];zip_heap[zip_SMALLEST]=zip_heap[zip_heap_len--];zip_pqdownheap(tree,zip_SMALLEST);m=zip_heap[zip_SMALLEST];zip_heap[--zip_heap_max]=n;zip_heap[--zip_heap_max]=m;tree[node].fc=tree[n].fc+tree[m].fc;if(zip_depth[n]>zip_depth[m]+1)zip_depth[node]=zip_depth[n];else zip_depth[node]=zip_depth[m]+1;tree[n].dl=tree[m].dl=node;zip_heap[zip_SMALLEST]=node++;zip_pqdownheap(tree,zip_SMALLEST)}while(zip_heap_len>=2);zip_heap[--zip_heap_max]=zip_heap[zip_SMALLEST];zip_gen_bitlen(desc);zip_gen_codes(tree,max_code)};var zip_scan_tree=function(tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0].dl;var count=0;var max_count=7;var min_count=4;if(nextlen==0){max_count=138;min_count=3}tree[max_code+1].dl=65535;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[n+1].dl;if(++count<max_count&&curlen==nextlen)continue;else if(count<min_count)zip_bl_tree[curlen].fc+=count;else if(curlen!=0){if(curlen!=prevlen)zip_bl_tree[curlen].fc++;zip_bl_tree[zip_REP_3_6].fc++}else if(count<=10)zip_bl_tree[zip_REPZ_3_10].fc++;else zip_bl_tree[zip_REPZ_11_138].fc++;count=0;prevlen=curlen;if(nextlen==0){max_count=138;min_count=3}else if(curlen==nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}};var zip_send_tree=function(tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0].dl;var count=0;var max_count=7;var min_count=4;if(nextlen==0){max_count=138;min_count=3}for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[n+1].dl;if(++count<max_count&&curlen==nextlen){continue}else if(count<min_count){do{zip_SEND_CODE(curlen,zip_bl_tree)}while(--count!=0)}else if(curlen!=0){if(curlen!=prevlen){zip_SEND_CODE(curlen,zip_bl_tree);count--}zip_SEND_CODE(zip_REP_3_6,zip_bl_tree);zip_send_bits(count-3,2)}else if(count<=10){zip_SEND_CODE(zip_REPZ_3_10,zip_bl_tree);zip_send_bits(count-3,3)}else{zip_SEND_CODE(zip_REPZ_11_138,zip_bl_tree);zip_send_bits(count-11,7)}count=0;prevlen=curlen;if(nextlen==0){max_count=138;min_count=3}else if(curlen==nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}};var zip_build_bl_tree=function(){var max_blindex;zip_scan_tree(zip_dyn_ltree,zip_l_desc.max_code);zip_scan_tree(zip_dyn_dtree,zip_d_desc.max_code);zip_build_tree(zip_bl_desc);for(max_blindex=zip_BL_CODES-1;max_blindex>=3;max_blindex--){if(zip_bl_tree[zip_bl_order[max_blindex]].dl!=0)break}zip_opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex};var zip_send_all_trees=function(lcodes,dcodes,blcodes){var rank;zip_send_bits(lcodes-257,5);zip_send_bits(dcodes-1,5);zip_send_bits(blcodes-4,4);for(rank=0;rank<blcodes;rank++){zip_send_bits(zip_bl_tree[zip_bl_order[rank]].dl,3)}zip_send_tree(zip_dyn_ltree,lcodes-1);zip_send_tree(zip_dyn_dtree,dcodes-1)};var zip_flush_block=function(eof){var opt_lenb,static_lenb;var max_blindex;var stored_len;stored_len=zip_strstart-zip_block_start;zip_flag_buf[zip_last_flags]=zip_flags;zip_build_tree(zip_l_desc);zip_build_tree(zip_d_desc);max_blindex=zip_build_bl_tree();opt_lenb=zip_opt_len+3+7>>3;static_lenb=zip_static_len+3+7>>3;if(static_lenb<=opt_lenb)opt_lenb=static_lenb;if(stored_len+4<=opt_lenb&&zip_block_start>=0){var i;zip_send_bits((zip_STORED_BLOCK<<1)+eof,3);zip_bi_windup();zip_put_short(stored_len);zip_put_short(~stored_len);for(i=0;i<stored_len;i++)zip_put_byte(zip_window[zip_block_start+i])}else if(static_lenb==opt_lenb){zip_send_bits((zip_STATIC_TREES<<1)+eof,3);zip_compress_block(zip_static_ltree,zip_static_dtree)}else{zip_send_bits((zip_DYN_TREES<<1)+eof,3);zip_send_all_trees(zip_l_desc.max_code+1,zip_d_desc.max_code+1,max_blindex+1);zip_compress_block(zip_dyn_ltree,zip_dyn_dtree)}zip_init_block();if(eof!=0)zip_bi_windup()};var zip_ct_tally=function(dist,lc){zip_l_buf[zip_last_lit++]=lc;if(dist==0){zip_dyn_ltree[lc].fc++}else{dist--;zip_dyn_ltree[zip_length_code[lc]+zip_LITERALS+1].fc++;zip_dyn_dtree[zip_D_CODE(dist)].fc++;zip_d_buf[zip_last_dist++]=dist;zip_flags|=zip_flag_bit}zip_flag_bit<<=1;if((zip_last_lit&7)==0){zip_flag_buf[zip_last_flags++]=zip_flags;zip_flags=0;zip_flag_bit=1}if(zip_compr_level>2&&(zip_last_lit&4095)==0){var out_length=zip_last_lit*8;var in_length=zip_strstart-zip_block_start;var dcode;for(dcode=0;dcode<zip_D_CODES;dcode++){out_length+=zip_dyn_dtree[dcode].fc*(5+zip_extra_dbits[dcode])}out_length>>=3;if(zip_last_dist<parseInt(zip_last_lit/2)&&out_length<parseInt(in_length/2))return true}return zip_last_lit==zip_LIT_BUFSIZE-1||zip_last_dist==zip_DIST_BUFSIZE};var zip_compress_block=function(ltree,dtree){var dist;var lc;var lx=0;var dx=0;var fx=0;var flag=0;var code;var extra;if(zip_last_lit!=0)do{if((lx&7)==0)flag=zip_flag_buf[fx++];lc=zip_l_buf[lx++]&255;if((flag&1)==0){zip_SEND_CODE(lc,ltree)}else{code=zip_length_code[lc];zip_SEND_CODE(code+zip_LITERALS+1,ltree);extra=zip_extra_lbits[code];if(extra!=0){lc-=zip_base_length[code];zip_send_bits(lc,extra)}dist=zip_d_buf[dx++];code=zip_D_CODE(dist);zip_SEND_CODE(code,dtree);extra=zip_extra_dbits[code];if(extra!=0){dist-=zip_base_dist[code];zip_send_bits(dist,extra)}}flag>>=1}while(lx<zip_last_lit);zip_SEND_CODE(zip_END_BLOCK,ltree)};var zip_Buf_size=16;var zip_send_bits=function(value,length){if(zip_bi_valid>zip_Buf_size-length){zip_bi_buf|=value<<zip_bi_valid;zip_put_short(zip_bi_buf);zip_bi_buf=value>>zip_Buf_size-zip_bi_valid;zip_bi_valid+=length-zip_Buf_size}else{zip_bi_buf|=value<<zip_bi_valid;zip_bi_valid+=length}};var zip_bi_reverse=function(code,len){var res=0;do{res|=code&1;code>>=1;res<<=1}while(--len>0);return res>>1};var zip_bi_windup=function(){if(zip_bi_valid>8){zip_put_short(zip_bi_buf)}else if(zip_bi_valid>0){zip_put_byte(zip_bi_buf)}zip_bi_buf=0;zip_bi_valid=0};var zip_qoutbuf=function(){if(zip_outcnt!=0){var q,i;q=zip_new_queue();if(zip_qhead==null)zip_qhead=zip_qtail=q;else zip_qtail=zip_qtail.next=q;q.len=zip_outcnt-zip_outoff;for(i=0;i<q.len;i++)q.ptr[i]=zip_outbuf[zip_outoff+i];zip_outcnt=zip_outoff=0}};var zip_deflate=function(str,level){var i,j;zip_deflate_data=str;zip_deflate_pos=0;if(typeof level=="undefined")level=zip_DEFAULT_LEVEL;zip_deflate_start(level);var buff=new Array(1024);var aout=[];while((i=zip_deflate_internal(buff,0,buff.length))>0){var cbuf=new Array(i);for(j=0;j<i;j++){cbuf[j]=String.fromCharCode(buff[j])}aout[aout.length]=cbuf.join("")
<<<<<<< HEAD
}zip_deflate_data=null;return aout.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.deflate=zip_deflate})();"use strict";jQuery.base64=function($){var _PADCHAR="=",_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_VERSION="1.0";function _getbyte64(s,i){var idx=_ALPHA.indexOf(s.charAt(i));if(idx===-1){throw"Cannot decode base64"}return idx}function _decode(s){var pads=0,i,b10,imax=s.length,x=[];s=String(s);if(imax===0){return s}if(imax%4!==0){throw"Cannot decode base64"}if(s.charAt(imax-1)===_PADCHAR){pads=1;if(s.charAt(imax-2)===_PADCHAR){pads=2}imax-=4}for(i=0;i<imax;i+=4){b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6|_getbyte64(s,i+3);x.push(String.fromCharCode(b10>>16,b10>>8&255,b10&255))}switch(pads){case 1:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6;x.push(String.fromCharCode(b10>>16,b10>>8&255));break;case 2:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12;x.push(String.fromCharCode(b10>>16));break}return x.join("")}function _getbyte(s,i){var x=s.charCodeAt(i);if(x>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return x}function _encode(s){if(arguments.length!==1){throw"SyntaxError: exactly one argument required"}s=String(s);var i,b10,x=[],imax=s.length-s.length%3;if(s.length===0){return s}for(i=0;i<imax;i+=3){b10=_getbyte(s,i)<<16|_getbyte(s,i+1)<<8|_getbyte(s,i+2);x.push(_ALPHA.charAt(b10>>18));x.push(_ALPHA.charAt(b10>>12&63));x.push(_ALPHA.charAt(b10>>6&63));x.push(_ALPHA.charAt(b10&63))}switch(s.length-imax){case 1:b10=_getbyte(s,i)<<16;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_PADCHAR+_PADCHAR);break;case 2:b10=_getbyte(s,i)<<16|_getbyte(s,i+1)<<8;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_ALPHA.charAt(b10>>6&63)+_PADCHAR);break}return x.join("")}return{decode:_decode,encode:_encode,VERSION:_VERSION}}(jQuery);LZWEncoder=function(){var exports={};var EOF=-1;var imgW;var imgH;var pixAry;var initCodeSize;var remaining;var curPixel;var BITS=12;var HSIZE=5003;var n_bits;var maxbits=BITS;var maxcode;var maxmaxcode=1<<BITS;var htab=new Array;var codetab=new Array;var hsize=HSIZE;var free_ent=0;var clear_flg=false;var g_init_bits;var ClearCode;var EOFCode;var cur_accum=0;var cur_bits=0;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var a_count;var accum=[];var LZWEncoder=exports.LZWEncoder=function LZWEncoder(width,height,pixels,color_depth){imgW=width;imgH=height;pixAry=pixels;initCodeSize=Math.max(2,color_depth)};var char_out=function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)};var cl_block=function cl_block(outs){cl_hash(hsize);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)};var cl_hash=function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1};var compress=exports.compress=function compress(init_bits,outs){var fcode;var i;var c;var ent;var disp;var hsize_reg;var hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=hsize;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=hsize;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<maxbits)+ent;i=c<<hshift^ent;if(htab[i]==fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i==0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]==fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<maxmaxcode){codetab[i]=free_ent++;htab[i]=fcode}else cl_block(outs)}output(ent,outs);output(EOFCode,outs)};var encode=exports.encode=function encode(os){os.writeByte(initCodeSize);remaining=imgW*imgH;curPixel=0;compress(initCodeSize+1,os);os.writeByte(0)};var flush_char=function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}};var MAXCODE=function MAXCODE(n_bits){return(1<<n_bits)-1};var nextPixel=function nextPixel(){if(remaining==0)return EOF;--remaining;var pix=pixAry[curPixel++];return pix&255};var output=function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==maxbits)maxcode=maxmaxcode;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}};LZWEncoder.apply(this,arguments);return exports};GIFEncoder=function(){for(var i=0,chr={};i<256;i++)chr[i]=String.fromCharCode(i);function ByteArray(){this.bin=[]}ByteArray.prototype.getData=function(){for(var v="",l=this.bin.length,i=0;i<l;i++)v+=chr[this.bin[i]];return v};ByteArray.prototype.writeByte=function(val){this.bin.push(val)};ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++)this.writeByte(string.charCodeAt(i))};ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++)this.writeByte(array[i])};var exports={};var width;var height;var transparent=null;var transIndex;var repeat=-1;var delay=0;var started=false;var out;var image;var pixels;var indexedPixels;var colorDepth;var colorTab;var usedEntry=new Array;var palSize=7;var dispose=-1;var closeStream=false;var firstFrame=true;var sizeSet=false;var sample=10;var setDelay=exports.setDelay=function setDelay(ms){delay=Math.round(ms/10)};var setDispose=exports.setDispose=function setDispose(code){if(code>=0)dispose=code};var setRepeat=exports.setRepeat=function setRepeat(iter){if(iter>=0)repeat=iter};var setTransparent=exports.setTransparent=function setTransparent(c){transparent=c};var addFrame=exports.addFrame=function addFrame(im,is_imageData){if(im==null||!started||out==null){throw new Error("Please call start method before calling addFrame");return false}var ok=true;try{if(!is_imageData){image=im.getImageData(0,0,im.canvas.width,im.canvas.height).data;if(!sizeSet)setSize(im.canvas.width,im.canvas.height)}else{image=im}getImagePixels();analyzePixels();if(firstFrame){writeLSD();writePalette();if(repeat>=0){writeNetscapeExt()}}writeGraphicCtrlExt();writeImageDesc();if(!firstFrame)writePalette();writePixels();firstFrame=false}catch(e){ok=false}return ok};var finish=exports.finish=function finish(){if(!started)return false;var ok=true;started=false;try{out.writeByte(59)}catch(e){ok=false}return ok};var reset=function reset(){transIndex=0;image=null;pixels=null;indexedPixels=null;colorTab=null;closeStream=false;firstFrame=true};var setFrameRate=exports.setFrameRate=function setFrameRate(fps){if(fps!=15)delay=Math.round(100/fps)};var setQuality=exports.setQuality=function setQuality(quality){if(quality<1)quality=1;sample=quality};var setSize=exports.setSize=function setSize(w,h){if(started&&!firstFrame)return;width=w;height=h;if(width<1)width=320;if(height<1)height=240;sizeSet=true};var start=exports.start=function start(){reset();var ok=true;closeStream=false;out=new ByteArray;try{out.writeUTFBytes("GIF89a")}catch(e){ok=false}return started=ok};var analyzePixels=function analyzePixels(){var len=pixels.length;var nPix=len/3;indexedPixels=[];var nq=new NeuQuant(pixels,len,sample);colorTab=nq.process();var k=0;for(var j=0;j<nPix;j++){var index=nq.map(pixels[k++]&255,pixels[k++]&255,pixels[k++]&255);usedEntry[index]=true;indexedPixels[j]=index}pixels=null;colorDepth=8;palSize=7;if(transparent!=null){transIndex=findClosest(transparent)}};var findClosest=function findClosest(c){if(colorTab==null)return-1;var r=(c&16711680)>>16;var g=(c&65280)>>8;var b=c&255;var minpos=0;var dmin=256*256*256;var len=colorTab.length;for(var i=0;i<len;){var dr=r-(colorTab[i++]&255);var dg=g-(colorTab[i++]&255);var db=b-(colorTab[i]&255);var d=dr*dr+dg*dg+db*db;var index=i/3;if(usedEntry[index]&&d<dmin){dmin=d;minpos=index}i++}return minpos};var getImagePixels=function getImagePixels(){var w=width;var h=height;pixels=[];var data=image;var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){var b=i*w*4+j*4;pixels[count++]=data[b];pixels[count++]=data[b+1];pixels[count++]=data[b+2]}}};var writeGraphicCtrlExt=function writeGraphicCtrlExt(){out.writeByte(33);out.writeByte(249);out.writeByte(4);var transp;var disp;if(transparent==null){transp=0;disp=0}else{transp=1;disp=2}if(dispose>=0){disp=dispose&7}disp<<=2;out.writeByte(0|disp|0|transp);WriteShort(delay);out.writeByte(transIndex);out.writeByte(0)};var writeImageDesc=function writeImageDesc(){out.writeByte(44);WriteShort(0);WriteShort(0);WriteShort(width);WriteShort(height);if(firstFrame){out.writeByte(0)}else{out.writeByte(128|0|0|0|palSize)}};var writeLSD=function writeLSD(){WriteShort(width);WriteShort(height);out.writeByte(128|112|0|palSize);out.writeByte(0);out.writeByte(0)};var writeNetscapeExt=function writeNetscapeExt(){out.writeByte(33);out.writeByte(255);out.writeByte(11);out.writeUTFBytes("NETSCAPE"+"2.0");out.writeByte(3);out.writeByte(1);WriteShort(repeat);out.writeByte(0)};var writePalette=function writePalette(){out.writeBytes(colorTab);var n=3*256-colorTab.length;for(var i=0;i<n;i++)out.writeByte(0)};var WriteShort=function WriteShort(pValue){out.writeByte(pValue&255);out.writeByte(pValue>>8&255)};var writePixels=function writePixels(){var myencoder=new LZWEncoder(width,height,indexedPixels,colorDepth);myencoder.encode(out)};var stream=exports.stream=function stream(){return out};var setProperties=exports.setProperties=function setProperties(has_start,is_first){started=has_start;firstFrame=is_first};return exports};NeuQuant=function(){var exports={};var netsize=256;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;var maxnetpos=netsize-1;var netbiasshift=4;var ncycles=100;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var thepicture;var lengthcount;var samplefac;var network;var netindex=new Array;var bias=new Array;var freq=new Array;var radpower=new Array;var NeuQuant=exports.NeuQuant=function NeuQuant(thepic,len,sample){var i;var p;thepicture=thepic;lengthcount=len;samplefac=sample;network=new Array(netsize);for(i=0;i<netsize;i++){network[i]=new Array(4);p=network[i];p[0]=p[1]=p[2]=(i<<netbiasshift+8)/netsize;freq[i]=intbias/netsize;bias[i]=0}};var colorMap=function colorMap(){var map=[];var index=new Array(netsize);for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map};var inxbuild=function inxbuild(){var i;var j;var smallpos;var smallval;var p;var q;var previouscol;var startpos;previouscol=0;startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos};var learn=function learn(){var i;var j;var b;var g;var r;var radius;var rad;var alpha;var step;var delta;var samplepixels;var p;var pix;var lim;if(lengthcount<minpicturebytes)samplefac=1;alphadec=30+(samplefac-1)/3;p=thepicture;pix=0;lim=lengthcount;samplepixels=lengthcount/(3*samplefac);delta=samplepixels/ncycles|0;alpha=initalpha;radius=initradius;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));if(lengthcount<minpicturebytes)step=3;else if(lengthcount%prime1!=0)step=3*prime1;else{if(lengthcount%prime2!=0)step=3*prime2;else{if(lengthcount%prime3!=0)step=3*prime3;else step=3*prime4}}i=0;while(i<samplepixels){b=(p[pix+0]&255)<<netbiasshift;g=(p[pix+1]&255)<<netbiasshift;r=(p[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!=0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lim)pix-=lengthcount;i++;if(delta==0)delta=1;if(i%delta==0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}};var map=exports.map=function map(b,g,r){var i;var j;var dist;var a;var bestd;var p;var best;bestd=1e3;best=-1;i=netindex[g];j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best};var process=exports.process=function process(){learn();unbiasnet();inxbuild();return colorMap()};var unbiasnet=function unbiasnet(){var i;var j;for(i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}};var alterneigh=function alterneigh(rad,i,b,g,r){var j;var k;var lo;var hi;var a;var m;var p;lo=i-rad;if(lo<-1)lo=-1;hi=i+rad;if(hi>netsize)hi=netsize;j=i+1;k=i-1;m=1;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];try{p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}catch(e){}}if(k>lo){p=network[k--];try{p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}catch(e){}}}};var altersingle=function altersingle(alpha,i,b,g,r){var n=network[i];n[0]-=alpha*(n[0]-b)/initalpha;n[1]-=alpha*(n[1]-g)/initalpha;n[2]-=alpha*(n[2]-r)/initalpha};var contest=function contest(b,g,r){var i;var dist;var a;var biasdist;var betafreq;var bestpos;var bestbiaspos;var bestd;var bestbiasd;var n;bestd=~(1<<31);bestbiasd=bestd;bestpos=-1;bestbiaspos=bestpos;for(i=0;i<netsize;i++){n=network[i];dist=n[0]-b;if(dist<0)dist=-dist;a=n[1]-g;if(a<0)a=-a;dist+=a;a=n[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos};NeuQuant.apply(this,arguments);return exports};function Painter(CanvasIDString){var myself=this;this.CanvasHeight=177;this.CanvasWidth=97;this.blockSize=8;this.IDString=CanvasIDString;this.CanvasPreview=$("#"+CanvasIDString+"-preview");this.ContextPreview=this.CanvasPreview[0].getContext("2d");this.CanvasDeco=$("#"+CanvasIDString+"-deco");this.ContextDeco=this.CanvasDeco[0].getContext("2d");this.CanvasPF=$("#"+CanvasIDString+"-inactive");this.ContextPF=this.CanvasPF[0].getContext("2d");this.CanvasActive=$("#"+CanvasIDString+"-active");this.ContextActive=this.CanvasActive[0].getContext("2d");this.CanvasWhiteborder=$("#"+CanvasIDString+"-whiteborder");this.ContextWhiteborder=this.CanvasWhiteborder[0].getContext("2d");this.CanvasBackground=$("#"+CanvasIDString+"-background");this.ContextBackground=this.CanvasBackground[0].getContext("2d");this.CanvasBorder=$("#"+CanvasIDString+"-border");this.ContextBorder=this.CanvasBorder[0].getContext("2d");this.CanvasDecoPin=$("#"+CanvasIDString+"-decoPin");this.ContextDecoPin=this.CanvasDecoPin[0].getContext("2d");this.CanvasNextHold=$("#"+CanvasIDString+"-nexthold");this.ContextNextHold=this.CanvasNextHold[0].getContext("2d");this.CanvasProgressbar=$("#"+CanvasIDString+"-progressbar");this.ContextProgressbar=this.CanvasProgressbar[0].getContext("2d");this.CanvasControl=$("#"+CanvasIDString+"-control");this.ContextControl=this.CanvasControl[0].getContext("2d");this.PFOriginX=1*this.blockSize;this.PFOriginY=1*this.blockSize;this.PFOriginXAbsolute=this.CanvasPF.offset().left+this.PFOriginX-1;this.PFOriginYAbsolute=this.CanvasPF.offset().top+this.PFOriginY;this.CntrlOriginX=this.CanvasControl.offset().left;this.CntrlOriginY=this.CanvasControl.offset().top;this.CanvasControlheight=this.CanvasControl.height();this.sprite="";this.spritemini="";this.spritedeco="";this.ready=false;this.init=function(){this.spritedeco=new Image;this.sprite=new Image;this.spritemini=new Image;this.spritedeco.src="res/deco-8px.png";this.sprite.src="res/palette-8px.png";this.spritemini.src="res/palette-4px.png";this.sprite.onload=function(){myself.ready=true};this.sprite.onerror=function(){myself.ready=true};this.drawJoystick("all","rest");this.drawAllButtons("rest");this.drawBorder("master");this.drawGrid()};this.eraseLayer=function(layer){var Canvas;switch(layer){case"decoration":Context=this.ContextDeco;break;case"inactive":Context=this.ContextPF;break;case"preview":Context=this.ContextPreview;break;case"active":Context=this.ContextActive;break;case"nexthold":Context=this.ContextNextHold;break;case"whiteborder":Context=this.ContextWhiteborder;break;case"all":Context=this.ContextPF;this.ContextDeco.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextPreview.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextActive.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextNextHold.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextWhiteborder.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);break}Context.clearRect(0,0,this.CanvasWidth,this.CanvasHeight)};this.eraseBlock=function(x,y){this.ContextPF.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)};this.eraseDeco=function(x,y){this.ContextDeco.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)};this.drawComment=function(str){$("#"+this.IDString+"-comment").val(str)};this.drawDuration=function(str){$("#"+this.IDString+"-duration").val(str)};this.drawOpacity=function(str){$("#"+this.IDString+"-active-opacity").val(str)};this.drawProgressbar=function(CurrentFrame,TotalFrame){if(CurrentFrame<=TotalFrame&&CurrentFrame>0){this.ContextProgressbar.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextProgressbar.beginPath();this.ContextProgressbar.rect(0,0,parseInt(CurrentFrame/TotalFrame*100,10),24);this.ContextProgressbar.fillStyle="gray";this.ContextProgressbar.fill();this.ContextProgressbar.closePath()}};this.drawWhiteBorder=function(playfield){this.eraseLayer("whiteborder");for(var i=0,istop=playfield.length;i<istop;i++){for(var j=0,jstop=playfield[0].length;j<jstop;j++){if(playfield[i][j][0]){this.drawLocalWhiteBorder(playfield,i,j)}}}};this.drawLocalWhiteBorder=function(playfield,x,y){this.ContextWhiteborder.beginPath();if(playfield[x][y][0]){if(x-1>=0){if(!playfield[x-1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(x+1<playfield.length){if(!playfield[x+1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(x+1)*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(x+1)*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y-1>=0){if(!playfield[x][y-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y+1<playfield[0].length){if(!playfield[x][y+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}else{if(x-1>=0){if(playfield[x-1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(x+1<playfield.length){if(playfield[x+1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(x+1)*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(x+1)*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y-1>=0){if(playfield[x][y-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y+1<playfield[0].length){if(playfield[x][y+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}};this.drawGrid=function(){this.ContextBackground.beginPath();this.ContextBackground.beginPath();for(var i=1;i<=9;i++){this.ContextBackground.rect(this.PFOriginX+i*this.blockSize,this.PFOriginY,1,20*this.blockSize)}for(var i=1;i<=19;i++){this.ContextBackground.rect(this.PFOriginX,this.PFOriginY+i*this.blockSize,10*this.blockSize,1)}this.ContextBackground.fillStyle="#444";this.ContextBackground.fill();this.ContextBackground.closePath()};this.drawBorder=function(kind){var color1="#afafaf";var color2="#46545f";switch(kind){case"master":color1="#afafaf";color2="#46545f";break;case"easy":color1="#afafaf";color2="#475f46";break;case"death":color1="#ac434a";color2="#5f0004";break;default:color1="#afafaf";color2="#46545f";break}var radgrd1=this.ContextBorder.createRadialGradient(0,0,this.blockSize,0,0,this.CanvasWidth-2*this.blockSize),radgrd2=this.ContextBorder.createRadialGradient(this.CanvasWidth,this.CanvasHeight,this.blockSize,this.CanvasWidth,this.CanvasHeight,this.CanvasWidth-2*this.blockSize);radgrd1.addColorStop(0,color1);radgrd1.addColorStop(1,color2);radgrd2.addColorStop(0,color1);radgrd2.addColorStop(1,color2);var grd_hor=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),grd_hor_rev=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),grd_vert=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize),grd_vert_rev=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize);grd_hor.addColorStop(0,color1);grd_hor.addColorStop(1,color2);grd_hor_rev.addColorStop(0,color2);grd_hor_rev.addColorStop(1,color1);grd_vert.addColorStop(0,color1);grd_vert.addColorStop(1,color2);grd_vert_rev.addColorStop(0,color2);grd_vert_rev.addColorStop(1,color1);function drawrectangle(x_begin,y_begin,width,height,fill){myself.ContextBorder.beginPath();myself.ContextBorder.rect(x_begin,y_begin,width,height);myself.ContextBorder.fillStyle=fill;myself.ContextBorder.fill();myself.ContextBorder.closePath()}drawrectangle(0,0,this.CanvasWidth,this.CanvasHeight,color2);drawrectangle(0,0,this.CanvasWidth,this.CanvasWidth,radgrd1);drawrectangle(0,this.CanvasHeight-this.CanvasWidth,this.CanvasWidth,this.CanvasWidth,radgrd2);drawrectangle(0,0,this.CanvasWidth,1,grd_hor_rev);drawrectangle(0,0,1,this.CanvasHeight,grd_vert_rev);drawrectangle(this.CanvasWidth-1,0,1,this.CanvasHeight,grd_vert);drawrectangle(0,this.CanvasHeight-1,this.CanvasWidth,1,grd_hor);drawrectangle(this.blockSize-1,this.blockSize-1,10*this.blockSize+1,1,grd_hor_rev);drawrectangle(this.blockSize+10*this.blockSize,this.blockSize-1,1,20*this.blockSize+2,grd_vert);drawrectangle(this.blockSize-1,this.blockSize-1,1,20*this.blockSize+1,grd_vert_rev);drawrectangle(this.blockSize-1,this.blockSize+20*this.blockSize,10*this.blockSize+1,1,grd_hor);drawrectangle(1*this.blockSize,1*this.blockSize,10*this.blockSize,20*this.blockSize,"black")};this.drawNextHold=function(position,type,RS){matrix=getMatrix(type,"i",RS);switch(position){case 0:this.ContextNextHold.clearRect(0,this.blockSize+3,4*this.blockSize,3*this.blockSize);if(!type){return}for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.drawBlock(parseInt(-1+j,10),parseInt(2+i,10),type,RS,"nextholdmini")}}}break;case 1:this.ContextNextHold.clearRect(4*this.blockSize,this.blockSize,4*this.blockSize,3*this.blockSize+3);if(!type){return}for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){if(RS=="SRS"){this.drawBlock(parseInt(3+j,10),parseInt(1+i,10),type,RS,"nexthold")}else{this.drawBlock(parseInt(3+j,10),parseInt(0+i,10),type,RS,"nexthold")}}}}break;case 2:this.ContextNextHold.clearRect(8*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);if(!type){return}for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.drawBlock(parseInt(13+j,10),parseInt(3+i,10),type,RS,"nextholdmini")}}}break;case 3:if(!type){return}this.ContextNextHold.clearRect(10*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.drawBlock(parseInt(17+j,10),parseInt(3+i,10),type,RS,"nextholdmini")}}}break}};this.changeActiveOpacity=function(level){if(level=="Flash"||level=="flash"){this.CanvasActive.attr("style","z-index:4; opacity: 1.0")}else{this.CanvasActive.attr("style","z-index:4; opacity: "+level)}};this.drawDeco=function(x,y,kind,layer){if(!kind){return}var sprite=this.spritedeco;var spriteOffsetStart,spriteOffsetEnd;var ctx;if(layer=="preview"){ctx=this.ContextPreview}else{ctx=this.ContextDeco}switch(kind){case"n1":spriteOffsetStart=decoration.n1.s;spriteOffsetEnd=decoration.n1.e;break;case"n2":spriteOffsetStart=decoration.n2.s;spriteOffsetEnd=decoration.n2.e;break;case"n3":spriteOffsetStart=decoration.n3.s;spriteOffsetEnd=decoration.n3.e;break;case"n4":spriteOffsetStart=decoration.n4.s;spriteOffsetEnd=decoration.n4.e;break;case"n5":spriteOffsetStart=decoration.n5.s;spriteOffsetEnd=decoration.n5.e;break;case"n6":spriteOffsetStart=decoration.n6.s;spriteOffsetEnd=decoration.n6.e;break;case"n7":spriteOffsetStart=decoration.n7.s;spriteOffsetEnd=decoration.n7.e;break;case"n8":spriteOffsetStart=decoration.n8.s;spriteOffsetEnd=decoration.n8.e;break;case"n9":spriteOffsetStart=decoration.n9.s;spriteOffsetEnd=decoration.n9.e;break;case"n0":spriteOffsetStart=decoration.n0.s;spriteOffsetEnd=decoration.n0.e;break;case"smallcw":spriteOffsetStart=decoration.smallcw.s;spriteOffsetEnd=decoration.smallcw.e;break;case"smallccw":spriteOffsetStart=decoration.smallccw.s;spriteOffsetEnd=decoration.smallccw.e;break;case"smalloktick":spriteOffsetStart=decoration.smalloktick.s;spriteOffsetEnd=decoration.smalloktick.e;break;case"smallokcircle":spriteOffsetStart=decoration.smallokcircle.s;spriteOffsetEnd=decoration.smallokcircle.e;break;case"smallnocross":spriteOffsetStart=decoration.smallnocross.s;spriteOffsetEnd=decoration.smallnocross.e;break;case"smallquestion":spriteOffsetStart=decoration.smallquestion.s;spriteOffsetEnd=decoration.smallquestion.e;break;case"smallexclamation":spriteOffsetStart=decoration.smallexclamation.s;spriteOffsetEnd=decoration.smallexclamation.e;break;case"nwarrow":spriteOffsetStart=decoration.nwarrow.s;spriteOffsetEnd=decoration.nwarrow.e;break;case"narrow":spriteOffsetStart=decoration.narrow.s;spriteOffsetEnd=decoration.narrow.e;break;case"nearrow":spriteOffsetStart=decoration.nearrow.s;spriteOffsetEnd=decoration.nearrow.e;break;case"earrow":spriteOffsetStart=decoration.earrow.s;spriteOffsetEnd=decoration.earrow.e;break;case"searrow":spriteOffsetStart=decoration.searrow.s;spriteOffsetEnd=decoration.searrow.e;break;case"sarrow":spriteOffsetStart=decoration.sarrow.s;spriteOffsetEnd=decoration.sarrow.e;break;case"swarrow":spriteOffsetStart=decoration.swarrow.s;spriteOffsetEnd=decoration.swarrow.e;break;case"warrow":spriteOffsetStart=decoration.warrow.s;spriteOffsetEnd=decoration.warrow.e;break;case"bigcw":spriteOffsetStart=decoration.bigcw.s;spriteOffsetEnd=decoration.bigcw.e;break;case"bigccw":spriteOffsetStart=decoration.bigccw.s;spriteOffsetEnd=decoration.bigccw.e;break;case"bigquestion":spriteOffsetStart=decoration.bigquestion.s;spriteOffsetEnd=decoration.bigquestion.e;break;case"bigexclamation":spriteOffsetStart=decoration.bigexclamation.s;spriteOffsetEnd=decoration.bigexclamation.e;break;case"bigoktick":spriteOffsetStart=decoration.bigoktick.s;spriteOffsetEnd=decoration.bigoktick.e;break;case"bigokcircle":spriteOffsetStart=decoration.bigokcircle.s;spriteOffsetEnd=decoration.bigokcircle.e;break;case"bignocross":spriteOffsetStart=decoration.bignocross.s;spriteOffsetEnd=decoration.bignocross.e;break;case"overlayyellow":spriteOffsetStart=decoration.overlayyellow.s;spriteOffsetEnd=decoration.overlayyellow.e;break;case"overlayblue":spriteOffsetStart=decoration.overlayblue.s;spriteOffsetEnd=decoration.overlayblue.e;break;case"overlaygreen":spriteOffsetStart=decoration.overlaygreen.s;spriteOffsetEnd=decoration.overlaygreen.e;break;case"overlaypink":spriteOffsetStart=decoration.overlaypink.s;spriteOffsetEnd=decoration.overlaypink.e;break;case"overlayorange":spriteOffsetStart=decoration.overlayorange.s;spriteOffsetEnd=decoration.overlayorange.e;break;case"clear1":spriteOffsetStart=decoration.clear1.s;
spriteOffsetEnd=decoration.clear1.e;break;case"clear2":spriteOffsetStart=decoration.clear2.s;spriteOffsetEnd=decoration.clear2.e;break;case"clear3":spriteOffsetStart=decoration.clear3.s;spriteOffsetEnd=decoration.clear3.e;break;case"clear4":spriteOffsetStart=decoration.clear4.s;spriteOffsetEnd=decoration.clear4.e;break;case"clear5":spriteOffsetStart=decoration.clear5.s;spriteOffsetEnd=decoration.clear5.e;break;case"clear6":spriteOffsetStart=decoration.clear6.s;spriteOffsetEnd=decoration.clear6.e;break;case"clear7":spriteOffsetStart=decoration.clear7.s;spriteOffsetEnd=decoration.clear7.e;break}var ox=spriteOffsetStart[0]*this.blockSize;var oy=spriteOffsetStart[1]*this.blockSize;var w=(spriteOffsetEnd[0]-spriteOffsetStart[0])*this.blockSize;var h=(spriteOffsetEnd[1]-spriteOffsetStart[1])*this.blockSize;var nx=this.PFOriginX+x*this.blockSize;var ny=this.PFOriginY+y*this.blockSize;if(layer!="eraser"){ctx.clearRect(nx,ny,w,h);ctx.drawImage(sprite,ox,oy,w,h,nx,ny,w,h)}else{ctx.clearRect(nx,ny,w,h);this.ContextDecoPin.clearRect(nx-this.blockSize/2,ny-this.blockSize/2,this.blockSize,this.blockSize)}if(layer!="preview"&&layer!="eraser"){this.ContextDecoPin.beginPath();this.ContextDecoPin.fillStyle="red";this.ContextDecoPin.strokeStyle="red";this.ContextDecoPin.arc(nx,ny,this.blockSize/4,2*Math.PI,false);this.ContextDecoPin.fill();this.ContextDecoPin.lineTo(nx+4,ny+4);this.ContextDecoPin.stroke();this.ContextDecoPin.closePath()}};this.drawBrowserBlock=function(x,y,type,RS,id,context){var color;switch(RS){case"ARS":switch(type){case"I":color=ARS.I.color;spriteOffset=ARS.I.offset;break;case"T":color=ARS.T.color;spriteOffset=ARS.T.offset;break;case"L":color=ARS.L.color;spriteOffset=ARS.L.offset;break;case"J":color=ARS.J.color;spriteOffset=ARS.J.offset;break;case"S":color=ARS.S.color;spriteOffset=ARS.S.offset;break;case"Z":color=ARS.Z.color;spriteOffset=ARS.Z.offset;break;case"O":color=ARS.O.color;spriteOffset=ARS.O.offset;break;case"G":color=ARS.G.color;spriteOffset=ARS.G.offset;break}break;case"SRS":switch(type){case"I":color=SRS.I.color;spriteOffset=SRS.I.offset;break;case"T":color=SRS.T.color;spriteOffset=SRS.T.offset;break;case"L":color=SRS.L.color;spriteOffset=SRS.L.offset;break;case"J":color=SRS.J.color;spriteOffset=SRS.J.offset;break;case"S":color=SRS.S.color;spriteOffset=SRS.S.offset;break;case"Z":color=SRS.Z.color;spriteOffset=SRS.Z.offset;break;case"O":color=SRS.O.color;spriteOffset=SRS.O.offset;break;case"G":color=SRS.G.color;spriteOffset=SRS.G.offset;break}break;case"GB":switch(type){case"I":color=GB.I.color;spriteOffset=GB.I.offset;break;case"T":color=GB.T.color;spriteOffset=GB.T.offset;break;case"L":color=GB.L.color;spriteOffset=GB.L.offset;break;case"J":color=GB.J.color;spriteOffset=GB.J.offset;break;case"S":color=GB.S.color;spriteOffset=GB.S.offset;break;case"Z":color=GB.Z.color;spriteOffset=GB.Z.offset;break;case"O":color=GB.O.color;spriteOffset=GB.O.offset;break;case"G":color=GB.G.color;spriteOffset=GB.G.offset;break}break}if(context=="inactive"){if(type=="E"){$("#pf-"+id+"-row-"+y+"-col-"+x+" .inactive").attr("style","background-color: transparent;")}else{$("#pf-"+id+"-row-"+y+"-col-"+x+" .inactive").attr("style","background-color: "+color+";")}}if(context=="resetactive"){$("table div.active").attr("style","background-color: transparent;")}if(context=="active"){$("#pf-"+id+"-row-"+y+"-col-"+x+" .active").attr("style","background-color: "+color+";")}};this.drawBlock=function(x,y,type,RS,context,highlight){if(type){var ctx;var mini=false;switch(context){case"inactive":ctx=this.ContextPF;break;case"preview":ctx=this.ContextPreview;break;case"active":ctx=this.ContextActive;break;case"flash":ctx=this.ContextActive;break;case"nexthold":ctx=this.ContextNextHold;break;case"nextholdmini":ctx=this.ContextNextHold;mini=true;break}ctx.beginPath();if(mini){if(x>=17){ctx.rect(6+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*this.blockSize/2,this.blockSize/2,this.blockSize/2)}else{ctx.rect(5+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*this.blockSize/2,this.blockSize/2,this.blockSize/2)}}else{ctx.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)}var color;var sprite;var spriteOffset;if(mini){sprite=this.spritemini}else{sprite=this.sprite}switch(RS){case"ARS":switch(type){case"I":color=ARS.I.color;spriteOffset=ARS.I.offset;break;case"T":color=ARS.T.color;spriteOffset=ARS.T.offset;break;case"L":color=ARS.L.color;spriteOffset=ARS.L.offset;break;case"J":color=ARS.J.color;spriteOffset=ARS.J.offset;break;case"S":color=ARS.S.color;spriteOffset=ARS.S.offset;break;case"Z":color=ARS.Z.color;spriteOffset=ARS.Z.offset;break;case"O":color=ARS.O.color;spriteOffset=ARS.O.offset;break;case"G":color=ARS.G.color;spriteOffset=ARS.G.offset;break}break;case"SRS":switch(type){case"I":color=SRS.I.color;spriteOffset=SRS.I.offset;break;case"T":color=SRS.T.color;spriteOffset=SRS.T.offset;break;case"L":color=SRS.L.color;spriteOffset=SRS.L.offset;break;case"J":color=SRS.J.color;spriteOffset=SRS.J.offset;break;case"S":color=SRS.S.color;spriteOffset=SRS.S.offset;break;case"Z":color=SRS.Z.color;spriteOffset=SRS.Z.offset;break;case"O":color=SRS.O.color;spriteOffset=SRS.O.offset;break;case"G":color=SRS.G.color;spriteOffset=SRS.G.offset;break}break;case"GB":switch(type){case"I":color=GB.I.color;spriteOffset=GB.I.offset;break;case"T":color=GB.T.color;spriteOffset=GB.T.offset;break;case"L":color=GB.L.color;spriteOffset=GB.L.offset;break;case"J":color=GB.J.color;spriteOffset=GB.J.offset;break;case"S":color=GB.S.color;spriteOffset=GB.S.offset;break;case"Z":color=GB.Z.color;spriteOffset=GB.Z.offset;break;case"O":color=GB.O.color;spriteOffset=GB.O.offset;break;case"G":color=GB.G.color;spriteOffset=GB.G.offset;break}break}if(context=="flash"){if(RS=="ARS"){color=ARS.Flash.color;spriteOffset=ARS.Flash.offset}if(RS=="SRS"){color=SRS.Flash.color;spriteOffset=SRS.Flash.offset}if(RS=="GB"){color=GB.Flash.color;spriteOffset=GB.Flash.offset}}ctx.fillStyle=color;ctx.fill();ctx.closePath();if(sprite){if(mini){if(x>=17){ctx.drawImage(sprite,spriteOffset[0]*(this.blockSize/2),spriteOffset[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,6+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}else{ctx.drawImage(sprite,spriteOffset[0]*(this.blockSize/2),spriteOffset[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,5+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}}else{ctx.drawImage(sprite,spriteOffset[0]*this.blockSize,spriteOffset[1]*this.blockSize,this.blockSize,this.blockSize,this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)}}}};this.highlight=function(x,y){var coordx=this.PFOriginX+(x+.5)*this.blockSize;var coordy=this.PFOriginY+(y+.5)*this.blockSize;var counter=20;function draw(){setTimeout(function(){var myReq=window.requestAnimationFrame(draw);if(counter>0){myself.ContextPreview.beginPath();myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";myself.ContextPreview.globalCompositeOperation="destination-out";myself.ContextPreview.arc(coordx,coordy,counter+2,2*Math.PI,false);myself.ContextPreview.arc(coordx,coordy,counter+1,2*Math.PI,false);myself.ContextPreview.stroke();myself.ContextPreview.closePath();myself.ContextPreview.beginPath();myself.ContextPreview.arc(coordx,coordy,counter,2*Math.PI,false);myself.ContextPreview.globalCompositeOperation="source-over";myself.ContextPreview.strokeStyle="white";myself.ContextPreview.stroke();myself.ContextPreview.closePath();counter-=1}else{myself.ContextPreview.beginPath();myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";myself.ContextPreview.globalCompositeOperation="destination-out";myself.ContextPreview.arc(coordx,coordy,counter+2,2*Math.PI,false);myself.ContextPreview.arc(coordx,coordy,counter+1,2*Math.PI,false);myself.ContextPreview.stroke();myself.ContextPreview.closePath();window.cancelAnimationFrame(myReq)}},1e3/60)}};this.resetJoystick=function(){var height=this.CanvasControl.height();this.ContextControl.clearRect(0,0,height,height);this.drawJoystick("all","rest")};this.drawJoystick=function(direction,state){if(direction=="all"){myself.drawJoystick("u","rest");myself.drawJoystick("r","rest");myself.drawJoystick("l","rest");myself.drawJoystick("d","rest");myself.drawJoystick("ul","rest");myself.drawJoystick("ur","rest");myself.drawJoystick("dl","rest");myself.drawJoystick("dr","rest")}else{switch(direction){case"u":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(2*this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/2,0);this.ContextControl.closePath();break;case"r":this.ContextControl.beginPath();this.ContextControl.moveTo(2*this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(2*this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight,this.CanvasControlheight/2);this.ContextControl.closePath();break;case"d":this.ContextControl.beginPath();this.ContextControl.moveTo(2*this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/2,this.CanvasControlheight);this.ContextControl.closePath();break;case"l":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight/3,2*this.CanvasControlheight/3);this.ContextControl.lineTo(this.CanvasControlheight/3,this.CanvasControlheight/3);this.ContextControl.lineTo(0,this.CanvasControlheight/2);this.ContextControl.closePath();break;case"ul":this.ContextControl.beginPath();this.ContextControl.moveTo(0+this.CanvasControlheight/8,0+this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight/4+this.CanvasControlheight/8,0+this.CanvasControlheight/8);this.ContextControl.lineTo(0+this.CanvasControlheight/8,this.CanvasControlheight/4+this.CanvasControlheight/8);this.ContextControl.closePath();break;case"ur":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight/4+this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8,0+this.CanvasControlheight/8);this.ContextControl.closePath();break;case"dr":this.ContextControl.beginPath();this.ContextControl.moveTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.closePath();break;case"dl":this.ContextControl.beginPath();this.ContextControl.moveTo(0+this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.lineTo(0+this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/4-this.CanvasControlheight/8);this.ContextControl.lineTo(this.CanvasControlheight/4+this.CanvasControlheight/8,this.CanvasControlheight-this.CanvasControlheight/8);this.ContextControl.closePath();break}switch(state){case"rest":this.ContextControl.fillStyle="#808080";break;case"pressed":this.ContextControl.fillStyle="#ff0000";break;case"holded":this.ContextControl.fillStyle="#ffa600";break}this.ContextControl.fill()}};this.drawAllButtons=function(state,layout){this.drawButton("A",state);this.drawButton("B",state);this.drawButton("C",state);this.drawButton("D",state)};this.drawButton=function(button,state){var height=this.CanvasControl.height();var radius=height/5;this.ContextControl.textBaseline="middle";this.ContextControl.font="bold 10px sans-serif";this.ContextControl.beginPath();switch(button){case"A":this.ContextControl.clearRect(height+height/4-radius-1,height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4,height/4,radius,0,2*Math.PI,false);break;case"B":this.ContextControl.clearRect(height+height/4+2*radius+height/16-radius-1,height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4+2*radius+height/16,height/4,radius,0,2*Math.PI,false);break;case"C":this.ContextControl.clearRect(height+height/4+4*radius+2*height/16-radius-1,height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4+4*radius+2*height/16,height/4,radius,0,2*Math.PI,false);break;case"D":this.ContextControl.clearRect(height+height/4-radius-1,3*height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4,3*height/4,radius,0,2*Math.PI,false);break}this.ContextControl.closePath();switch(state){case"pressed":this.ContextControl.fillStyle="#ff0000";break;case"holded":this.ContextControl.fillStyle="#ffa600";break;case"rest":this.ContextControl.fillStyle="#808080";break}this.ContextControl.fill();switch(button){case"A":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("A",height+height/4-height/10,height/4+1);break;case"B":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("B",height+height/4+2*radius+height/16-height/10,height/4+1);break;case"C":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("C",height+height/4+4*radius+2*height/16-height/10,height/4+1);break;case"D":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("H",height+height/4-height/10,3*height/4+1);break}};this.frameCount=function(cur,tot){$("#"+CanvasIDString+"-current-frame").attr("value",cur);$("#"+CanvasIDString+"-total-frame").html(tot)};this.generateNewPreviewTable=function(id,position){var output="";var code1='$(this).parent().addClass("pressed");';var code2='console.log("fooooo")';output+='<td "id="preview-block-'+this.IDString+"-"+id+'" class="preview-block"><table onclick="'+code1+'" ondblclick="'+code2+'" class="preview-table" id="'+this.IDString+"-"+id+'">';for(var i=0;i<20;i++){output+='<tr class="preview-row" id="'+this.IDString+"-"+id+"-row-"+i+'">';for(var j=0;j<10;j++){output+='<td class="preview-cell" id="'+this.IDString+"-"+id+"-row-"+i+"-col-"+j+'"><div class="active"><div class="inactive"></div></div></td>'}}output+="</table><!--"+GLOBAL_FRAME_COUNTER+' --> <input type="checkbox" class="select"> <input type="button" value="" class="delete actions-button" /> </div></td>';if(position){$("#browser #preview-container > td:nth-child("+parseInt(position+1,10)+")").before(output)}else{$("#browser #preview-container > td:nth-child("+parseInt(position+1,10)+")").before(output)}};this.deletePreviewTable=function(id,position){$("#browser #preview-container > td:nth-child("+parseInt(position+1,10)+")").remove()}}function Diagram(painter){var myself=this;this.painter=painter;this.frames=[];this.current_frame=0;this.playing=false;this.init=function(){this.frames.push(new Frame(this.painter));this.painter.generateNewPreviewTable(this.frames[this.current_frame].id,this.current_frame)};this.new_frame=function(){this.current_frame++;this.painter.eraseLayer("all");this.frames.splice(this.current_frame,0,new Frame(this.painter));this.update_framecount()};this.new_copy_frame=function(){var saved_frame=this.frames[this.current_frame].print();this.new_frame();this.frames[this.current_frame].load(saved_frame,"blank")};this.remove_current_frame=function(){if(this.frames.length>1){if(this.current_frame-1>=0){this.current_frame--;this.frames.splice(this.current_frame+1,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}else{this.frames.splice(this.current_frame,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}}else{this.current_frame=0;this.frames[this.current_frame].clear("all")}};this.remove_following_frames=function(){this.frames.splice(this.current_frame+1);this.frames[this.current_frame].draw()};this.remove_all_playfields=function(){this.current_frame=this.frames.length;while(this.current_frame>0){this.remove_current_frame()}this.frames[0].clear("all");this.frames[this.current_frame].draw();this.update_framecount()};this.remove_all_playfields2=function(){this.frames.splice(1);this.frames[0].clear("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};this.goto_frame=function(frame_number){this.painter.eraseLayer("all");this.current_frame=frame_number;if(frame_number==0){this.frames[this.current_frame].draw()}else{var exception={border:true};this.frames[this.current_frame].draw(exception)}this.update_framecount()};this.first_frame=function(){this.painter.eraseLayer("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};this.previous_frame=function(){if(this.current_frame>0){this.painter.eraseLayer("all");this.current_frame--,this.frames[this.current_frame].draw();this.update_framecount()}};this.next_frame=function(){this.painter.eraseLayer("all");this.current_frame++,this.frames[this.current_frame].draw();this.update_framecount()};this.last_frame=function(){this.painter.eraseLayer("all");this.current_frame=parseInt(this.frames.length-1,0);this.frames[this.current_frame].draw();this.update_framecount()};this.update_framecount=function(){this.painter.frameCount(this.current_frame+1,this.frames.length);this.painter.drawProgressbar(this.current_frame+1,this.frames.length)};this.print=function(){var output="";output+=this.frames[0].print();if(this.frames.length){for(var i=1,istop=this.frames.length;i<istop;i++){output+="+";output+=this.print_differences(i,i-1)}}return output};this.print_differences=function(final_frame,reference_frame){var output="";var tmp="";if(this.frames[final_frame].activePieceType!=this.frames[reference_frame].activePieceType||this.frames[final_frame].activePieceOrientation!=this.frames[reference_frame].activePieceOrientation||this.frames[final_frame].activePiecePositionX!=this.frames[reference_frame].activePiecePositionX||this.frames[final_frame].activePiecePositionY!=this.frames[reference_frame].activePiecePositionY){if(this.frames[final_frame].activePieceType){output+="A~"+this.frames[final_frame].activePieceType;tmp=alphanumconvert(this.frames[final_frame].activePiecePositionX);output+=tmp;tmp=alphanumconvert(this.frames[final_frame].activePiecePositionY);output+=tmp+this.frames[final_frame].activePieceOrientation+"_";tmp=""}else{output+="A~E_"}}var candidate_case=[];var first_candidate=true;var newly_added=false;var candidate_case_deco=[];var first_candidate_deco=true;var newly_added_deco=false;for(var i=0;i<10;i++){for(var j=0;j<20;j++){if(this.frames[final_frame].playfield[i][j][0]!=this.frames[reference_frame].playfield[i][j][0]){if(first_candidate){if(this.frames[final_frame].playfield[i][j][0]){candidate_case.push([]);candidate_case[0].val=this.frames[final_frame].playfield[i][j][0];candidate_case[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate=false}else{candidate_case.push([]);candidate_case[0].val="";candidate_case[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate=false}}else{for(var k=0,kstop=candidate_case.length;k<kstop;k++){if(this.frames[final_frame].playfield[i][j][0]==candidate_case[k].val){if(newly_added){newly_added=false}else{candidate_case[k].push(alphanumconvert(i)+alphanumconvert(j));break}}else if(k==parseFloat(candidate_case.length-1)){candidate_case.push([]);candidate_case[parseFloat(k+1)].val=this.frames[final_frame].playfield[i][j][0];candidate_case[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j));newly_added=true}}}}if(this.frames[final_frame].playfield[i][j][1]!=this.frames[reference_frame].playfield[i][j][1]){if(first_candidate_deco){if(this.frames[final_frame].playfield[i][j][1]){candidate_case_deco.push([]);candidate_case_deco[0].val=this.frames[final_frame].playfield[i][j][1];candidate_case_deco[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate_deco=false}else{candidate_case_deco.push([]);candidate_case_deco[0].val="";candidate_case_deco[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate_deco=false}}else{for(var k=0,kstop=candidate_case_deco.length;k<kstop;k++){if(this.frames[final_frame].playfield[i][j][1]==candidate_case_deco[k].val){if(newly_added_deco){newly_added_deco=false}else{candidate_case_deco[k].push(alphanumconvert(i)+alphanumconvert(j));break}}else if(k==parseFloat(candidate_case_deco.length-1)){candidate_case_deco.push([]);candidate_case_deco[parseFloat(k+1)].val=this.frames[final_frame].playfield[i][j][1];candidate_case_deco[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j));newly_added_deco=true}}}}}}if(candidate_case){output+="I";tmp="";for(var i=0,istop=candidate_case.length;i<istop;i++){tmp+="~";if(candidate_case[i].val){tmp+=candidate_case[i].val}else{tmp+="E"}for(var j=0,jstop=candidate_case[i].length;j<jstop;j++){tmp+=candidate_case[i][j]}}output+=tmp+"_"}if(candidate_case_deco){output+="D";tmp="";for(var i=0,istop=candidate_case_deco.length;i<istop;i++){tmp+="~";if(candidate_case_deco[i].val){tmp+=candidate_case_deco[i].val+"*"}else{tmp+="E*"}for(var j=0,jstop=candidate_case_deco[i].length;j<jstop;j++){tmp+=candidate_case_deco[i][j]}}output+=tmp+"_"}tmp="";if(this.frames[final_frame].RS!=this.frames[reference_frame].RS){output+="R~"+this.frames[final_frame].RS+"_"}if(this.frames[final_frame].activePieceOpacity!=this.frames[reference_frame].activePieceOpacity){output+="O~"+this.frames[final_frame].activePieceOpacity+"_"}if(this.frames[final_frame].whiteborder!=this.frames[reference_frame].whiteborder){if(this.frames[final_frame].whiteborder){output+="W~1_"}else{output+="W~0_"}}if(this.frames[final_frame].border!=this.frames[reference_frame].border){output+="B~"+this.frames[final_frame].border+"_"}if(this.frames[final_frame].duration!=this.frames[reference_frame].duration){output+="T~"+parseInt(this.frames[final_frame].duration,10)+"_"}if(this.frames[final_frame].joystick_direction!=this.frames[reference_frame].joystick_direction||this.frames[final_frame].joystick_state!=this.frames[reference_frame].joystick_state){switch(this.frames[final_frame].joystick_state){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}switch(this.frames[final_frame].joystick_direction){case"u":tmp+="8";break;case"r":tmp+="6";break;case"d":tmp+="2";break;case"l":tmp+="4";break;case"c":tmp+="5";break;case"ul":tmp+="7";break;case"ur":tmp+="9";break;case"dr":tmp+="3";break;case"dl":tmp+="1";break}output+="J~"+tmp+"_";tmp=""}if(!this.frames[final_frame].button_state.compare(this.frames[reference_frame].button_state)){for(var i=0,istop=this.frames[final_frame].button_state.length;i<istop;i++){switch(this.frames[final_frame].button_state[i]){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}}output+="C~"+tmp+"_";tmp=""}if(!this.frames[final_frame].nexthold.compare(this.frames[reference_frame].nexthold)){for(var i=0,istop=this.frames[final_frame].nexthold.length;i<istop;i++){if(this.frames[final_frame].nexthold[i]){tmp+=this.frames[final_frame].nexthold[i]}else{tmp+=0}}output+="N~"+tmp+"_";tmp=""}if(this.frames[final_frame].comment.localeCompare(this.frames[reference_frame].comment)!==0){output+="S~"+this.frames[final_frame].comment}return output};this.load=function(str){if(!str){return}this.remove_all_playfields();this.current_frame=0;this.update_framecount();var stringframe=str.split("+");this.frames[0].load(stringframe[0],"blank");for(var i=1,istop=stringframe.length;i<istop;i++){this.new_copy_frame();this.frames[i].load(stringframe[i],"differences")}this.frames[this.current_frame].draw();this.update_framecount()}}var GLOBAL_FRAME_COUNTER=0;function Frame(painter){GLOBAL_FRAME_COUNTER++;var myself=this;this.sself=this;this.id=GLOBAL_FRAME_COUNTER;this.painter=painter;this.height=20;this.width=10;this.RS="ARS";this.border="Master";this.whiteborder=false;this.playfield=[];this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.activePieceOpacity=1;this.duration=15;this.nexthold=["","","",""];this.joystick_direction="c";this.joystick_state="rest";this.button_state=["rest","rest","rest","rest","rest","rest"];this.comment="";for(var oi=0,oistop=this.width;oi<oistop;oi++){this.playfield.push(new Array(this.height));for(var oj=0,ojstop=this.height;oj<ojstop;oj++){this.playfield[oi][oj]=new Array(1);this.playfield[oi][oj][0]="";this.playfield[oi][oj][1]=""}}this.is_in=function(x,y){if(x<0||y<0||x>=this.width||y>=this.height){return false}return true};this.lookup=function(x,y){return this.playfield[x][y][0]};this.piece_is_in=function(x,y,type,orientation){var matrix=getMatrix(type,orientation,this.RS);if(orientation=="singleton"&&this.is_in(parseInt(x,10),parseInt(y,10))){return true}else{var counter=0;for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]&&this.is_in(parseInt(x-1+j,10),parseInt(y-1+i,10))){counter++}}}if(counter==4){return true}return false}};this.draw=function(exception){for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){if(this.playfield[i][j][0]){this.painter.drawBlock(i,j,this.playfield[i][j][0],this.RS,"inactive")}if(this.playfield[i][j][1]){this.painter.drawDeco(i,j,this.playfield[i][j][1],"decoration")}}}if(this.activePieceType){var matrix=getMatrix(this.activePieceType,this.activePieceOrientation,this.RS);for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+j,10),parseInt(this.activePiecePositionY-1+i,10),this.activePieceType,this.RS,"active");if(this.activePieceOpacity=="Flash"){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+j,10),parseInt(this.activePiecePositionY-1+i,10),this.activePieceType,this.RS,"flash")}}}}}for(var i=0,istop=this.nexthold.length;i<istop;i++){this.painter.drawNextHold(i,this.nexthold[i],this.RS)}if(!(exception&&exception["border"])){this.painter.drawBorder(this.border)}if(!(exception&&exception["joystick"])){this.painter.resetJoystick();this.painter.drawJoystick(this.joystick_direction,this.joystick_state)}if(!(exception&&exception["buttons"])){this.painter.drawButton("A",this.button_state[0]);this.painter.drawButton("B",this.button_state[1]);this.painter.drawButton("C",this.button_state[2]);this.painter.drawButton("D",this.button_state[3])}this.painter.drawComment(this.comment);this.painter.drawDuration(this.duration);this.painter.drawOpacity(this.activePieceOpacity);this.painter.changeActiveOpacity(this.activePieceOpacity);this.painter.eraseLayer("whiteborder");if(this.whiteborder){this.painter.drawWhiteBorder(this.playfield)}};this.print=function(){var output="";var tmp="";if(this.activePieceType){output+="A~"+this.activePieceType;tmp=alphanumconvert(this.activePiecePositionX);output+=tmp;tmp=alphanumconvert(this.activePiecePositionY);output+=tmp+this.activePieceOrientation+"_";tmp=""}if(this.RS!="ARS"){output+="R~"+this.RS+"_"}if(this.activePieceOpacity!=1){output+="O~"+this.activePieceOpacity+"_"}if(this.border!="Master"){output+="B~"+this.border+"_"}if(this.duration!=15){output+="T~"+this.duration+"_"}switch(this.joystick_state){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}switch(this.joystick_direction){case"u":tmp+="8";break;case"r":tmp+="6";break;case"d":tmp+="2";break;case"l":tmp+="4";break;case"c":tmp+="5";break;case"ul":tmp+="7";break;case"ur":tmp+="9";break;case"dr":tmp+="3";break;case"dl":tmp+="1";break}output+="J~"+tmp+"_";tmp="";for(var i=0,istop=this.button_state.length;i<istop;i++){switch(this.button_state[i]){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}}output+="C~"+tmp+"_";tmp="";if(this.comment){output+="S~"+this.comment+"_"}if(this.whiteborder){output+="W~1_"}if(this.nexthold.length){for(var i=0,istop=this.nexthold.length;i<istop;i++){if(this.nexthold[i]){tmp+=this.nexthold[i]}else{tmp+=0}}output+="N~"+tmp+"_";tmp=""}var candidate_case=[];var candidate_case_deco=[];var first_candidate=true;var first_candidate_deco=true;for(var i=0;i<10;i++){for(var j=0;j<20;j++){if(this.playfield[i][j][0]){if(first_candidate){candidate_case.push([]);candidate_case[0].val=this.playfield[i][j][0];candidate_case[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate=false}else{for(var k=0,kstop=candidate_case.length;k<kstop;k++){if(this.playfield[i][j][0]==candidate_case[k].val){candidate_case[k].push(alphanumconvert(i)+alphanumconvert(j));break}else if(k==parseFloat(candidate_case.length-1)){candidate_case.push([]);candidate_case[parseFloat(k+1)].val=this.playfield[i][j][0];candidate_case[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j))}}}}if(this.playfield[i][j][1]){if(first_candidate_deco){candidate_case_deco.push([]);candidate_case_deco[0].val=this.playfield[i][j][1];candidate_case_deco[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate_deco=false}else{for(var k=0,kstop=candidate_case_deco.length;k<kstop;k++){if(this.playfield[i][j][1]==candidate_case_deco[k].val){candidate_case_deco[k].push(alphanumconvert(i)+alphanumconvert(j));break}else if(k==parseFloat(candidate_case_deco.length-1)){candidate_case_deco.push([]);candidate_case_deco[parseFloat(k+1)].val=this.playfield[i][j][1];candidate_case_deco[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j))}}}}}}if(candidate_case.length){output+="I~";for(var i=0,istop=candidate_case.length;i<istop;i++){tmp+=candidate_case[i].val;for(var j=0,jstop=candidate_case[i].length;j<jstop;j++){tmp+=candidate_case[i][j]}if(i<candidate_case.length-1){tmp+="~"}}output+=tmp+"_"}tmp="";if(candidate_case_deco.length){output+="D~";for(var i=0,istop=candidate_case_deco.length;i<istop;i++){tmp+=candidate_case_deco[i].val+"*";for(var j=0,jstop=candidate_case_deco[i].length;j<jstop;j++){tmp+=candidate_case_deco[i][j]}if(i<candidate_case_deco.length-1){tmp+="~"}}output+=tmp+"_"}tmp="";return output};this.load=function(str,format){if(format!="differences"){this.clear("all")}if(!str){return}var properties=str.split("_");for(var i=0,istop=properties.length;i<istop;i++){var subproperties=properties[i].split("~");switch(subproperties[0]){case"A":if(subproperties[1].charAt(0)!=="E"){this.activePieceType=subproperties[1].charAt(0);this.activePieceOrientation=subproperties[1].slice(3);this.activePiecePositionX=alphanumconvert(subproperties[1].charAt(1));this.activePiecePositionY=alphanumconvert(subproperties[1].charAt(2))}else{this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY=""}break;case"I":for(var j=1,jstop=subproperties.length;j<jstop;j++){var type=subproperties[j].charAt(0);if(type=="E"){type=""}for(var k=1,kstop=subproperties[j].length;k<kstop;k+=2){var inact_x=subproperties[j].charAt(k);var inact_y=subproperties[j].charAt(k+1);this.modify(alphanumconvert(inact_x),alphanumconvert(inact_y),type)}}break;case"D":for(var j=1,jstop=subproperties.length;j<jstop;j++){var subsubproperties=subproperties[j].split("*");var type=subsubproperties[0];if(type=="E"){type=""}if(subproperties[1]!==""){for(var k=0,kstop=subsubproperties[1].length;k<kstop;k+=2){var deco_x=subsubproperties[1].charAt(k);var deco_y=subsubproperties[1].charAt(k+1);this.modify_decoration(alphanumconvert(deco_x),alphanumconvert(deco_y),type)}}}break;case"R":this.RS=subproperties[1];break;case"O":this.activePieceOpacity=subproperties[1];break;case"N":for(var k=0,kstop=subproperties[1].length;k<kstop;k++){if(subproperties[1].charAt(k)!="0"){this.nexthold[k]=subproperties[1].charAt(k)}else{this.nexthold[k]=""}}break;case"S":this.comment=subproperties[1];break;case"W":this.whiteborder=subproperties[1];break;case"T":this.duration=subproperties[1];break;case"B":this.border=subproperties[1];
break;case"J":var tmp1,tmp2;switch(subproperties[1].charAt(0)){case"r":tmp1="rest";break;case"p":tmp1="pressed";break;case"h":tmp1="holded";break}switch(subproperties[1].charAt(1)){case"8":tmp2="u";break;case"6":tmp2="r";break;case"2":tmp2="d";break;case"4":tmp2="l";break;case"7":tmp2="ul";break;case"5":tmp2="c";break;case"9":tmp2="ur";break;case"3":tmp2="dr";break;case"1":tmp2="dl";break}this.modify_control(tmp2,tmp1);break;case"C":for(var k=0,kstop=subproperties[1].length;k<=kstop;k++){var tmp;switch(subproperties[1].charAt(k)){case"r":tmp="rest";break;case"h":tmp="holded";break;case"p":tmp="pressed";break}switch(k){case 0:this.modify_button("A",tmp);break;case 1:this.modify_button("B",tmp);break;case 2:this.modify_button("C",tmp);break;case 3:this.modify_button("D",tmp);break}}break}}};this.clear=function(mode){switch(mode){case"inactive":this.painter.eraseLayer("inactive");for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){this.playfield[i][j][0]=""}}break;case"active":this.painter.eraseLayer("active");this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";break;case"decoration":this.painter.eraseLayer("decoration");for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){this.playfield[i][j][1]=""}}break;case"all":this.painter.eraseLayer("inactive");this.painter.eraseLayer("active");this.painter.eraseLayer("decoration");for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){this.playfield[i][j][0]="";this.playfield[i][j][1]=""}}this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.comment="";break}};this.is_piece_colliding=function(x,y,type,orientation){var matrix=getMatrix(type,orientation,this.RS);var tmp="",tmp2="";for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){}if(matrix[i][j]&&!this.is_in(parseInt(x-1+j,10),parseInt(y-1+i,10))){return true}if(matrix[i][j]&&this.is_in(parseInt(x-1+j,10),parseInt(y-1+i,10))&&this.playfield[parseInt(x-1+j,10)][parseInt(y+i-1,10)][0]){return true}}}return false};this.addPiece=function(x,y,type,orientation,mode,drop){var matrix=getMatrix(type,orientation,this.RS);var still_droping=true;var counter=0;while(drop&still_droping){counter=0;if(this.is_piece_colliding(parseInt(x),parseInt(y),type,orientation)){still_droping=false}else{y++}}if(drop){y--}if(mode=="inactive"||mode=="garbage"){this.painter.CanvasPreview.attr("width",this.painter.CanvasPreview.width())}if(mode=="active"){this.activePieceType=type;this.activePieceOrientation=orientation;this.activePiecePositionX=x;this.activePiecePositionY=y;this.painter.CanvasActive.attr("width",this.painter.CanvasPreview.width());this.painter.drawBrowserBlock(parseInt(x,10),parseInt(y,10),type,this.RS,this.id,"resetactive")}if(mode=="decoration-preview"){this.painter.drawDeco(x,y,type,"preview")}else if(mode=="decoration"){this.modify_decoration(x,y,type);this.painter.drawDeco(x,y,type,"decoration");this.painter.highlight(x,y)}else{for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]&&this.piece_is_in(x,y,type,orientation)){switch(mode){case"inactive":this.modify(parseInt(x-1+j,10),parseInt(y-1+i,10),type);this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),type,this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,x-1+j,y-1+i)}this.painter.highlight(x-1+j,y-1+i);break;case"garbage":this.modify(parseInt(x-1+j,10),parseInt(y-1+i,10),"G");this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),"G",this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,x-1+j,y-1+i)}this.painter.highlight(x-1+j,y-1+i);break;case"preview":this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),type,this.RS,"preview");break;case"active":this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),type,this.RS,"active");this.painter.highlight(x-1+j,y-1+i);this.painter.drawBrowserBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),type,this.RS,this.id,"active");break;case"erase":this.removeBlock(parseInt(x-1+j,10),parseInt(y-1+i,10));this.painter.highlight(x-1+j,y-1+i);this.painter.drawBrowserBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),"E",this.RS,this.id,"inactive");break;case"preview-eraser":this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),"G",this.RS,"preview");break}}}}}};this.modify=function(x,y,type){if(type=="E"){this.playfield[x][y][0]=""}else{this.playfield[x][y][0]=type}};Frame.prototype.modify_decoration=function(x,y,type){this.playfield[x][y][1]=type};this.modify_control=function(direction,state){this.joystick_state=state;this.joystick_direction=direction};this.modify_button=function(button,state){var index="";switch(button){case"A":index=0;break;case"B":index=1;break;case"C":index=2;break;case"D":index=3;break}this.button_state[index]=state}}var ARS={I:{color:"red",offset:[2,1],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],ccw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"cyan",offset:[6,1],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,1],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,1],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"magenta",offset:[8,0],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"green",offset:[5,1],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,1],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var SRS={I:{color:"cyan",offset:[6,2],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,2],i:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,2],i:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],ccw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,2],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"green",offset:[5,2],i:[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"purple",offset:[8,2],i:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"red",offset:[2,2],i:[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var GB={I:{color:"yellowgreen",offset:[6,9],i:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"yellowgreen",offset:[1,9],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],u:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"yellowgreen",offset:[3,9],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellowgreen",offset:[4,9],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"yellowgreen",offset:[5,9],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"yellowgreen",offset:[8,9],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"yellowgreen",offset:[2,9],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var decoration={n1:{s:[0,0],e:[1,1]},n2:{s:[1,0],e:[2,1]},n3:{s:[2,0],e:[3,1]},n4:{s:[3,0],e:[4,1]},n5:{s:[4,0],e:[5,1]},n6:{s:[5,0],e:[6,1]},n7:{s:[6,0],e:[7,1]},n8:{s:[7,0],e:[8,1]},n9:{s:[8,0],e:[9,1]},n0:{s:[9,0],e:[10,1]},smallccw:{s:[0,1],e:[1,2]},smallcw:{s:[1,1],e:[2,2]},smalloktick:{s:[2,1],e:[3,2]},smallokcircle:{s:[3,1],e:[4,2]},smallnocross:{s:[4,1],e:[5,2]},smallquestion:{s:[5,1],e:[6,2]},smallexclamation:{s:[6,1],e:[7,2]},nwarrow:{s:[0,2],e:[1,3]},narrow:{s:[1,2],e:[2,3]},nearrow:{s:[2,2],e:[3,3]},warrow:{s:[0,3],e:[1,4]},earrow:{s:[2,3],e:[3,4]},swarrow:{s:[0,4],e:[1,5]},sarrow:{s:[1,4],e:[2,5]},searrow:{s:[2,4],e:[3,5]},bigcw:{s:[3,2],e:[5,4]},bigccw:{s:[5,2],e:[7,4]},bigquestion:{s:[7,2],e:[9,4]},bigexclamation:{s:[9,2],e:[10,4]},bigoktick:{s:[3,4],e:[5,6]},bigokcircle:{s:[5,4],e:[7,6]},bignocross:{s:[7,4],e:[9,6]},overlayyellow:{s:[1,6],e:[2,7]},overlayblue:{s:[2,6],e:[3,7]},overlaygreen:{s:[3,6],e:[4,7]},overlaypink:{s:[4,6],e:[5,7]},overlayorange:{s:[5,6],e:[6,7]},clear1:{s:[0,7],e:[10,8]},clear2:{s:[0,8],e:[10,9]},clear3:{s:[0,9],e:[10,10]},clear4:{s:[0,10],e:[10,11]},clear5:{s:[0,11],e:[10,12]},clear6:{s:[0,12],e:[10,13]},clear7:{s:[0,13],e:[10,14]}};function getMatrix(type,orientation,RS){var matrix;switch(RS){case"ARS":switch(type){case"I":switch(orientation){case"i":matrix=ARS.I.i;break;case"cw":matrix=ARS.I.cw;break;case"ccw":matrix=ARS.I.ccw;break;case"u":matrix=ARS.I.u;break;case"singleton":matrix=ARS.I.singleton;break}break;case"T":switch(orientation){case"i":matrix=ARS.T.i;break;case"cw":matrix=ARS.T.cw;break;case"ccw":matrix=ARS.T.ccw;break;case"u":matrix=ARS.T.u;break;case"singleton":matrix=ARS.T.singleton;break}break;case"L":switch(orientation){case"i":matrix=ARS.L.i;break;case"cw":matrix=ARS.L.cw;break;case"ccw":matrix=ARS.L.ccw;break;case"u":matrix=ARS.L.u;break;case"singleton":matrix=ARS.L.singleton;break}break;case"J":switch(orientation){case"i":matrix=ARS.J.i;break;case"cw":matrix=ARS.J.cw;break;case"ccw":matrix=ARS.J.ccw;break;case"u":matrix=ARS.J.u;break;case"singleton":matrix=ARS.J.singleton;break}break;case"S":switch(orientation){case"i":matrix=ARS.S.i;break;case"cw":matrix=ARS.S.cw;break;case"ccw":matrix=ARS.S.ccw;break;case"u":matrix=ARS.S.u;break;case"singleton":matrix=ARS.J.singleton;break}break;case"Z":switch(orientation){case"i":matrix=ARS.Z.i;break;case"cw":matrix=ARS.Z.cw;break;case"ccw":matrix=ARS.Z.ccw;break;case"u":matrix=ARS.Z.u;break;case"singleton":matrix=ARS.Z.singleton;break}break;case"O":switch(orientation){case"i":matrix=ARS.O.i;break;case"cw":matrix=ARS.O.cw;break;case"ccw":matrix=ARS.O.ccw;break;case"u":matrix=ARS.O.u;break;case"singleton":matrix=ARS.O.singleton;break}break;case"G":switch(orientation){case"i":matrix=ARS.G.i;break;case"cw":matrix=ARS.G.cw;break;case"ccw":matrix=ARS.G.ccw;break;case"u":matrix=ARS.G.u;break;case"singleton":matrix=ARS.G.singleton;break}break}break;case"SRS":switch(type){case"I":switch(orientation){case"i":matrix=SRS.I.i;break;case"cw":matrix=SRS.I.cw;break;case"ccw":matrix=SRS.I.ccw;break;case"u":matrix=SRS.I.u;break;case"singleton":matrix=SRS.I.singleton;break}break;case"T":switch(orientation){case"i":matrix=SRS.T.i;break;case"cw":matrix=SRS.T.cw;break;case"ccw":matrix=SRS.T.ccw;break;case"u":matrix=SRS.T.u;break;case"singleton":matrix=SRS.T.singleton;break}break;case"L":switch(orientation){case"i":matrix=SRS.L.i;break;case"cw":matrix=SRS.L.cw;break;case"ccw":matrix=SRS.L.ccw;break;case"u":matrix=SRS.L.u;break;case"singleton":matrix=SRS.L.singleton;break}break;case"J":switch(orientation){case"i":matrix=SRS.J.i;break;case"cw":matrix=SRS.J.cw;break;case"ccw":matrix=SRS.J.ccw;break;case"u":matrix=SRS.J.u;break;case"singleton":matrix=SRS.J.singleton;break}break;case"S":switch(orientation){case"i":matrix=SRS.S.i;break;case"cw":matrix=SRS.S.cw;break;case"ccw":matrix=SRS.S.ccw;break;case"u":matrix=SRS.S.u;break;case"singleton":matrix=SRS.S.singleton;break}break;case"Z":switch(orientation){case"i":matrix=SRS.Z.i;break;case"cw":matrix=SRS.Z.cw;break;case"ccw":matrix=SRS.Z.ccw;break;case"u":matrix=SRS.Z.u;break;case"singleton":matrix=SRS.Z.singleton;break}break;case"O":switch(orientation){case"i":matrix=SRS.O.i;break;case"cw":matrix=SRS.O.cw;break;case"ccw":matrix=SRS.O.ccw;break;case"u":matrix=SRS.O.u;break;case"singleton":matrix=SRS.O.singleton;break}break;case"G":switch(orientation){case"i":matrix=SRS.G.i;break;case"cw":matrix=SRS.G.cw;break;case"ccw":matrix=SRS.G.ccw;break;case"u":matrix=SRS.G.u;break;case"singleton":matrix=SRS.G.singleton;break}break}break;case"GB":switch(type){case"I":switch(orientation){case"i":matrix=GB.I.i;break;case"cw":matrix=GB.I.cw;break;case"ccw":matrix=GB.I.ccw;break;case"u":matrix=GB.I.u;break;case"singleton":matrix=GB.I.singleton;break}break;case"T":switch(orientation){case"i":matrix=GB.T.i;break;case"cw":matrix=GB.T.cw;break;case"ccw":matrix=GB.T.ccw;break;case"u":matrix=GB.T.u;break;case"singleton":matrix=GB.T.singleton;break}break;case"L":switch(orientation){case"i":matrix=GB.L.i;break;case"cw":matrix=GB.L.cw;break;case"ccw":matrix=GB.L.ccw;break;case"u":matrix=GB.L.u;break;case"singleton":matrix=GB.L.singleton;break}break;case"J":switch(orientation){case"i":matrix=GB.J.i;break;case"cw":matrix=GB.J.cw;break;case"ccw":matrix=GB.J.ccw;break;case"u":matrix=GB.J.u;break;case"singleton":matrix=GB.J.singleton;break}break;case"S":switch(orientation){case"i":matrix=GB.S.i;break;case"cw":matrix=GB.S.cw;break;case"ccw":matrix=GB.S.ccw;break;case"u":matrix=GB.S.u;break;case"singleton":matrix=GB.S.singleton;break}break;case"Z":switch(orientation){case"i":matrix=GB.Z.i;break;case"cw":matrix=GB.Z.cw;break;case"ccw":matrix=GB.Z.ccw;break;case"u":matrix=GB.Z.u;break;case"singleton":matrix=GB.Z.singleton;break}break;case"O":switch(orientation){case"i":matrix=GB.O.i;break;case"cw":matrix=GB.O.cw;break;case"ccw":matrix=GB.O.ccw;break;case"u":matrix=GB.O.u;break;case"singleton":matrix=GB.O.singleton;break}break;case"G":switch(orientation){case"i":matrix=GB.G.i;break;case"cw":matrix=GB.G.cw;break;case"ccw":matrix=GB.G.ccw;break;case"u":matrix=GB.G.u;break;case"singleton":matrix=GB.G.singleton;break}break}break}return matrix}function alphanumconvert(input){var output;switch(input){case"a":output=0;break;case"b":output=1;break;case"c":output=2;break;case"d":output=3;break;case"e":output=4;break;case"f":output=5;break;case"g":output=6;break;case"h":output=7;break;case"i":output=8;break;case"j":output=9;break;case"k":output=10;break;case"l":output=11;break;case"m":output=12;break;case"n":output=13;break;case"o":output=14;break;case"p":output=15;break;case"q":output=16;break;case"r":output=17;break;case"s":output=18;break;case"t":output=19;break;case"z":output=-1;break;case-1:output="z";break;case 0:output="a";break;case 1:output="b";break;case 2:output="c";break;case 3:output="d";break;case 4:output="e";break;case 5:output="f";break;case 6:output="g";break;case 7:output="h";break;case 8:output="i";break;case 9:output="j";break;case 10:output="k";break;case 11:output="l";break;case 12:output="m";break;case 13:output="n";break;case 14:output="o";break;case 15:output="p";break;case 16:output="q";break;case 17:output="r";break;case 18:output="s";break;case 19:output="t";break}return output}(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0,xstop=vendors.length;x<xstop&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}})();Array.prototype.compare=function(testArr){if(this.length!=testArr.length){return false}for(var i=0,istop=testArr.length;i<istop;i++){if(this[i].compare){if(!this[i].compare(testArr[i])){return false}}if(this[i]!==testArr[i]){return false}}return true};Diagram.prototype.flate_encode=function(str){return $.base64.encode(RawDeflate.deflate(unescape(encodeURIComponent(str))))};Diagram.prototype.flate_decode=function(str){return decodeURIComponent(escape(RawDeflate.inflate($.base64.decode(str))))};$(document).ready(function(){var diagrams=[];var painters=[];$(".tedige-playfield-wrapper").each(function(index){var newID=$(this).attr("id");var i=0;var insert=[];insert[i++]='	<div class="left-pane">';insert[i++]='		<div class="nexthold-container">';insert[i++]='			<canvas id="'+newID+'-nexthold-background"	width="97" height="32" style="z-index:0;"></canvas>';insert[i++]='			<canvas id="'+newID+'-nexthold"	width="97" height="32" style="z-index:1;"></canvas>';insert[i++]="		</div>";insert[i++]='		<div class="canvas-container" id="'+newID+'-container border-gray">';insert[i++]='			<canvas id="'+newID+'-border"		width="97" height="177" style="z-index:0;background-color: black"></canvas>';insert[i++]='			<canvas id="'+newID+'-background"	width="97" height="177" style="z-index:1;//background-color: black"></canvas>';insert[i++]='			<canvas id="'+newID+'-inactive"	 width="97" height="177" style="z-index:2; border:none; opacity: 0.65"></canvas>';insert[i++]='			<canvas id="'+newID+'-whiteborder" width="97" height="177" style="z-index:3"></canvas>';insert[i++]='			<canvas id="'+newID+'-active"		width="97" height="177" style="z-index:4"></canvas>';insert[i++]='			<canvas id="'+newID+'-deco"			width="97" height="177" style="z-index:5"></canvas>';insert[i++]='			<canvas id="'+newID+'-decoPin"	 width="97" height="177" style="z-index:6; border:none; opacity: 0.65;display:none"></canvas>';insert[i++]='			<canvas id="'+newID+'-preview"		width="97" height="177" style="z-index:6"></canvas>';insert[i++]="		</div>";insert[i++]='		<div class="control-div">';insert[i++]='		<canvas class="canvas-control" id="'+newID+'-control" width="97" height="35" style=""></canvas>';insert[i++]="		</div>";insert[i++]="		</div>";insert[i++]='		<div class="right-pane">';insert[i++]='		<div class="progressbar">';insert[i++]="			<p>";insert[i++]='				<input class="current-frame" id="'+newID+'-current-frame" type="text" style="width: 2.5em; text-align:center" /> / <span id="'+newID+'-total-frame">1</span>';insert[i++]="			</p>";insert[i++]='			<canvas id="'+newID+'-progressbar" width="97" height="24" style="border: 1px solid white;" />';insert[i++]="		</div>";insert[i++]='		<div id="order-control"> ';insert[i++]='			<input class="cmd_prev" id="'+newID+'-cmd_prev"	value=""	type="button" />';insert[i++]='			<input class="cmd_next" id="'+newID+'-cmd_next"	value=""	type="button" /><br />';insert[i++]='			<input class="cmd_first" id="'+newID+'-cmd_first" value="|" type="button"/>';insert[i++]='			<input class="cmd_last" id="'+newID+'-cmd_last" value="|" type="button"	style="width:2.5em"/><br />';insert[i++]='			<input class="cmd_playpause" id="'+newID+'-cmd_playpause" value ="" type="button" style="width:2.5em" /><br />';insert[i++]='			<input class="check-loop" id="'+newID+'-loop"type="checkbox"> loop';insert[i++]="		</div>";insert[i++]='		<div class="links">';insert[i++]='			<a class="Link2Editor" href="">[Edit]</a>';insert[i++]="		</div>";insert[i++]="	</div>";insert[i++]='	<div id="under">';insert[i++]='		<textarea readonly="" id="'+newID+'-comment" class="comment"></textarea>';insert[i++]="	</div>";$("#"+newID).html(insert.join("\n"));painters[newID]=new Painter(newID);diagrams[newID]=new Diagram(painters[newID]);diagrams[newID].init();painters[newID].init()});$(".tedige-playfield-wrapper").each(function(index){var newID=$(this).attr("id");var initiator=setInterval(function(){if(painters[newID].ready){clearInterval(initiator);var titlesearch=$("#"+newID).data("tedigecode");if(titlesearch){console.log($("#"+newID).find(".Link2Editor"));$("#"+newID).find(".Link2Editor").attr("href","http://petitprince.github.com/TeDiGe-2/editor.html?"+titlesearch);var littlestr=titlesearch.split("-");switch(littlestr[1]){case"all":diagrams[newID].load(diagrams[newID].flate_decode(littlestr[2]));diagrams[newID].frames[diagrams[newID].current_frame].draw();break;case"current":diagrams[newID].frames[diagrams[newID].current_frame].load(diagrams[newID].flate_decode(littlestr[2]));diagrams[newID].frames[diagrams[newID].current_frame].draw();break}diagrams[newID].first_frame()}}},10)});$(".cmd_playpause").click(function(){var aDiag=diagrams[$(this).attr("id").split("-")[0]];var i=aDiag.current_frame;var len=aDiag.frames.length;if(aDiag.playing){aDiag.playing=false;$("#pf-cmd_playpause").attr("value","")}else{aDiag.playing=true;$("#pf-cmd_playpause").attr("value","||")}var counter=0;function render(){if(i<len&&aDiag.playing){if(counter<aDiag.frames[aDiag.current_frame].duration){aDiag.goto_frame(i);counter++}else{counter=0;i++}requestAnimationFrame(render)}else if($("#"+aDiag.painter.IDString+"-loop").is(":checked")){i=0;requestAnimationFrame(render)}}render()});$(".current-frame").blur(function(){if($("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()>0&&$("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()<=diagrams[$(this).attr("id").split("-")[0]].frames.length){diagrams[$(this).attr("id").split("-")[0]].goto_frame($("#tomtom-current-frame").val())}});$(".cmd_first").click(function(){diagrams[$(this).attr("id").split("-")[0]].first_frame()});$(".cmd_prev").click(function(){diagrams[$(this).attr("id").split("-")[0]].previous_frame()});$(".cmd_next").click(function(){if(diagrams[$(this).attr("id").split("-")[0]].current_frame<diagrams[$(this).attr("id").split("-")[0]].frames.length-1){diagrams[$(this).attr("id").split("-")[0]].next_frame()}});$(".cmd_last").click(function(){diagrams[$(this).attr("id").split("-")[0]].last_frame()})});
=======
}zip_deflate_data=null;return aout.join("")};if(!window.RawDeflate)RawDeflate={};RawDeflate.deflate=zip_deflate})();"use strict";jQuery.base64=function($){var _PADCHAR="=",_ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_VERSION="1.0";function _getbyte64(s,i){var idx=_ALPHA.indexOf(s.charAt(i));if(idx===-1){throw"Cannot decode base64"}return idx}function _decode(s){var pads=0,i,b10,imax=s.length,x=[];s=String(s);if(imax===0){return s}if(imax%4!==0){throw"Cannot decode base64"}if(s.charAt(imax-1)===_PADCHAR){pads=1;if(s.charAt(imax-2)===_PADCHAR){pads=2}imax-=4}for(i=0;i<imax;i+=4){b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6|_getbyte64(s,i+3);x.push(String.fromCharCode(b10>>16,b10>>8&255,b10&255))}switch(pads){case 1:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12|_getbyte64(s,i+2)<<6;x.push(String.fromCharCode(b10>>16,b10>>8&255));break;case 2:b10=_getbyte64(s,i)<<18|_getbyte64(s,i+1)<<12;x.push(String.fromCharCode(b10>>16));break}return x.join("")}function _getbyte(s,i){var x=s.charCodeAt(i);if(x>255){throw"INVALID_CHARACTER_ERR: DOM Exception 5"}return x}function _encode(s){if(arguments.length!==1){throw"SyntaxError: exactly one argument required"}s=String(s);var i,b10,x=[],imax=s.length-s.length%3;if(s.length===0){return s}for(i=0;i<imax;i+=3){b10=_getbyte(s,i)<<16|_getbyte(s,i+1)<<8|_getbyte(s,i+2);x.push(_ALPHA.charAt(b10>>18));x.push(_ALPHA.charAt(b10>>12&63));x.push(_ALPHA.charAt(b10>>6&63));x.push(_ALPHA.charAt(b10&63))}switch(s.length-imax){case 1:b10=_getbyte(s,i)<<16;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_PADCHAR+_PADCHAR);break;case 2:b10=_getbyte(s,i)<<16|_getbyte(s,i+1)<<8;x.push(_ALPHA.charAt(b10>>18)+_ALPHA.charAt(b10>>12&63)+_ALPHA.charAt(b10>>6&63)+_PADCHAR);break}return x.join("")}return{decode:_decode,encode:_encode,VERSION:_VERSION}}(jQuery);LZWEncoder=function(){var exports={};var EOF=-1;var imgW;var imgH;var pixAry;var initCodeSize;var remaining;var curPixel;var BITS=12;var HSIZE=5003;var n_bits;var maxbits=BITS;var maxcode;var maxmaxcode=1<<BITS;var htab=new Array;var codetab=new Array;var hsize=HSIZE;var free_ent=0;var clear_flg=false;var g_init_bits;var ClearCode;var EOFCode;var cur_accum=0;var cur_bits=0;var masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];var a_count;var accum=[];var LZWEncoder=exports.LZWEncoder=function LZWEncoder(width,height,pixels,color_depth){imgW=width;imgH=height;pixAry=pixels;initCodeSize=Math.max(2,color_depth)};var char_out=function char_out(c,outs){accum[a_count++]=c;if(a_count>=254)flush_char(outs)};var cl_block=function cl_block(outs){cl_hash(hsize);free_ent=ClearCode+2;clear_flg=true;output(ClearCode,outs)};var cl_hash=function cl_hash(hsize){for(var i=0;i<hsize;++i)htab[i]=-1};var compress=exports.compress=function compress(init_bits,outs){var fcode;var i;var c;var ent;var disp;var hsize_reg;var hshift;g_init_bits=init_bits;clear_flg=false;n_bits=g_init_bits;maxcode=MAXCODE(n_bits);ClearCode=1<<init_bits-1;EOFCode=ClearCode+1;free_ent=ClearCode+2;a_count=0;ent=nextPixel();hshift=0;for(fcode=hsize;fcode<65536;fcode*=2)++hshift;hshift=8-hshift;hsize_reg=hsize;cl_hash(hsize_reg);output(ClearCode,outs);outer_loop:while((c=nextPixel())!=EOF){fcode=(c<<maxbits)+ent;i=c<<hshift^ent;if(htab[i]==fcode){ent=codetab[i];continue}else if(htab[i]>=0){disp=hsize_reg-i;if(i==0)disp=1;do{if((i-=disp)<0)i+=hsize_reg;if(htab[i]==fcode){ent=codetab[i];continue outer_loop}}while(htab[i]>=0)}output(ent,outs);ent=c;if(free_ent<maxmaxcode){codetab[i]=free_ent++;htab[i]=fcode}else cl_block(outs)}output(ent,outs);output(EOFCode,outs)};var encode=exports.encode=function encode(os){os.writeByte(initCodeSize);remaining=imgW*imgH;curPixel=0;compress(initCodeSize+1,os);os.writeByte(0)};var flush_char=function flush_char(outs){if(a_count>0){outs.writeByte(a_count);outs.writeBytes(accum,0,a_count);a_count=0}};var MAXCODE=function MAXCODE(n_bits){return(1<<n_bits)-1};var nextPixel=function nextPixel(){if(remaining==0)return EOF;--remaining;var pix=pixAry[curPixel++];return pix&255};var output=function output(code,outs){cur_accum&=masks[cur_bits];if(cur_bits>0)cur_accum|=code<<cur_bits;else cur_accum=code;cur_bits+=n_bits;while(cur_bits>=8){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}if(free_ent>maxcode||clear_flg){if(clear_flg){maxcode=MAXCODE(n_bits=g_init_bits);clear_flg=false}else{++n_bits;if(n_bits==maxbits)maxcode=maxmaxcode;else maxcode=MAXCODE(n_bits)}}if(code==EOFCode){while(cur_bits>0){char_out(cur_accum&255,outs);cur_accum>>=8;cur_bits-=8}flush_char(outs)}};LZWEncoder.apply(this,arguments);return exports};GIFEncoder=function(){for(var i=0,chr={};i<256;i++)chr[i]=String.fromCharCode(i);function ByteArray(){this.bin=[]}ByteArray.prototype.getData=function(){for(var v="",l=this.bin.length,i=0;i<l;i++)v+=chr[this.bin[i]];return v};ByteArray.prototype.writeByte=function(val){this.bin.push(val)};ByteArray.prototype.writeUTFBytes=function(string){for(var l=string.length,i=0;i<l;i++)this.writeByte(string.charCodeAt(i))};ByteArray.prototype.writeBytes=function(array,offset,length){for(var l=length||array.length,i=offset||0;i<l;i++)this.writeByte(array[i])};var exports={};var width;var height;var transparent=null;var transIndex;var repeat=-1;var delay=0;var started=false;var out;var image;var pixels;var indexedPixels;var colorDepth;var colorTab;var usedEntry=new Array;var palSize=7;var dispose=-1;var closeStream=false;var firstFrame=true;var sizeSet=false;var sample=10;var setDelay=exports.setDelay=function setDelay(ms){delay=Math.round(ms/10)};var setDispose=exports.setDispose=function setDispose(code){if(code>=0)dispose=code};var setRepeat=exports.setRepeat=function setRepeat(iter){if(iter>=0)repeat=iter};var setTransparent=exports.setTransparent=function setTransparent(c){transparent=c};var addFrame=exports.addFrame=function addFrame(im,is_imageData){if(im==null||!started||out==null){throw new Error("Please call start method before calling addFrame");return false}var ok=true;try{if(!is_imageData){image=im.getImageData(0,0,im.canvas.width,im.canvas.height).data;if(!sizeSet)setSize(im.canvas.width,im.canvas.height)}else{image=im}getImagePixels();analyzePixels();if(firstFrame){writeLSD();writePalette();if(repeat>=0){writeNetscapeExt()}}writeGraphicCtrlExt();writeImageDesc();if(!firstFrame)writePalette();writePixels();firstFrame=false}catch(e){ok=false}return ok};var finish=exports.finish=function finish(){if(!started)return false;var ok=true;started=false;try{out.writeByte(59)}catch(e){ok=false}return ok};var reset=function reset(){transIndex=0;image=null;pixels=null;indexedPixels=null;colorTab=null;closeStream=false;firstFrame=true};var setFrameRate=exports.setFrameRate=function setFrameRate(fps){if(fps!=15)delay=Math.round(100/fps)};var setQuality=exports.setQuality=function setQuality(quality){if(quality<1)quality=1;sample=quality};var setSize=exports.setSize=function setSize(w,h){if(started&&!firstFrame)return;width=w;height=h;if(width<1)width=320;if(height<1)height=240;sizeSet=true};var start=exports.start=function start(){reset();var ok=true;closeStream=false;out=new ByteArray;try{out.writeUTFBytes("GIF89a")}catch(e){ok=false}return started=ok};var analyzePixels=function analyzePixels(){var len=pixels.length;var nPix=len/3;indexedPixels=[];var nq=new NeuQuant(pixels,len,sample);colorTab=nq.process();var k=0;for(var j=0;j<nPix;j++){var index=nq.map(pixels[k++]&255,pixels[k++]&255,pixels[k++]&255);usedEntry[index]=true;indexedPixels[j]=index}pixels=null;colorDepth=8;palSize=7;if(transparent!=null){transIndex=findClosest(transparent)}};var findClosest=function findClosest(c){if(colorTab==null)return-1;var r=(c&16711680)>>16;var g=(c&65280)>>8;var b=c&255;var minpos=0;var dmin=256*256*256;var len=colorTab.length;for(var i=0;i<len;){var dr=r-(colorTab[i++]&255);var dg=g-(colorTab[i++]&255);var db=b-(colorTab[i]&255);var d=dr*dr+dg*dg+db*db;var index=i/3;if(usedEntry[index]&&d<dmin){dmin=d;minpos=index}i++}return minpos};var getImagePixels=function getImagePixels(){var w=width;var h=height;pixels=[];var data=image;var count=0;for(var i=0;i<h;i++){for(var j=0;j<w;j++){var b=i*w*4+j*4;pixels[count++]=data[b];pixels[count++]=data[b+1];pixels[count++]=data[b+2]}}};var writeGraphicCtrlExt=function writeGraphicCtrlExt(){out.writeByte(33);out.writeByte(249);out.writeByte(4);var transp;var disp;if(transparent==null){transp=0;disp=0}else{transp=1;disp=2}if(dispose>=0){disp=dispose&7}disp<<=2;out.writeByte(0|disp|0|transp);WriteShort(delay);out.writeByte(transIndex);out.writeByte(0)};var writeImageDesc=function writeImageDesc(){out.writeByte(44);WriteShort(0);WriteShort(0);WriteShort(width);WriteShort(height);if(firstFrame){out.writeByte(0)}else{out.writeByte(128|0|0|0|palSize)}};var writeLSD=function writeLSD(){WriteShort(width);WriteShort(height);out.writeByte(128|112|0|palSize);out.writeByte(0);out.writeByte(0)};var writeNetscapeExt=function writeNetscapeExt(){out.writeByte(33);out.writeByte(255);out.writeByte(11);out.writeUTFBytes("NETSCAPE"+"2.0");out.writeByte(3);out.writeByte(1);WriteShort(repeat);out.writeByte(0)};var writePalette=function writePalette(){out.writeBytes(colorTab);var n=3*256-colorTab.length;for(var i=0;i<n;i++)out.writeByte(0)};var WriteShort=function WriteShort(pValue){out.writeByte(pValue&255);out.writeByte(pValue>>8&255)};var writePixels=function writePixels(){var myencoder=new LZWEncoder(width,height,indexedPixels,colorDepth);myencoder.encode(out)};var stream=exports.stream=function stream(){return out};var setProperties=exports.setProperties=function setProperties(has_start,is_first){started=has_start;firstFrame=is_first};return exports};NeuQuant=function(){var exports={};var netsize=256;var prime1=499;var prime2=491;var prime3=487;var prime4=503;var minpicturebytes=3*prime4;var maxnetpos=netsize-1;var netbiasshift=4;var ncycles=100;var intbiasshift=16;var intbias=1<<intbiasshift;var gammashift=10;var gamma=1<<gammashift;var betashift=10;var beta=intbias>>betashift;var betagamma=intbias<<gammashift-betashift;var initrad=netsize>>3;var radiusbiasshift=6;var radiusbias=1<<radiusbiasshift;var initradius=initrad*radiusbias;var radiusdec=30;var alphabiasshift=10;var initalpha=1<<alphabiasshift;var alphadec;var radbiasshift=8;var radbias=1<<radbiasshift;var alpharadbshift=alphabiasshift+radbiasshift;var alpharadbias=1<<alpharadbshift;var thepicture;var lengthcount;var samplefac;var network;var netindex=new Array;var bias=new Array;var freq=new Array;var radpower=new Array;var NeuQuant=exports.NeuQuant=function NeuQuant(thepic,len,sample){var i;var p;thepicture=thepic;lengthcount=len;samplefac=sample;network=new Array(netsize);for(i=0;i<netsize;i++){network[i]=new Array(4);p=network[i];p[0]=p[1]=p[2]=(i<<netbiasshift+8)/netsize;freq[i]=intbias/netsize;bias[i]=0}};var colorMap=function colorMap(){var map=[];var index=new Array(netsize);for(var i=0;i<netsize;i++)index[network[i][3]]=i;var k=0;for(var l=0;l<netsize;l++){var j=index[l];map[k++]=network[j][0];map[k++]=network[j][1];map[k++]=network[j][2]}return map};var inxbuild=function inxbuild(){var i;var j;var smallpos;var smallval;var p;var q;var previouscol;var startpos;previouscol=0;startpos=0;for(i=0;i<netsize;i++){p=network[i];smallpos=i;smallval=p[1];for(j=i+1;j<netsize;j++){q=network[j];if(q[1]<smallval){smallpos=j;smallval=q[1]}}q=network[smallpos];if(i!=smallpos){j=q[0];q[0]=p[0];p[0]=j;j=q[1];q[1]=p[1];p[1]=j;j=q[2];q[2]=p[2];p[2]=j;j=q[3];q[3]=p[3];p[3]=j}if(smallval!=previouscol){netindex[previouscol]=startpos+i>>1;for(j=previouscol+1;j<smallval;j++)netindex[j]=i;previouscol=smallval;startpos=i}}netindex[previouscol]=startpos+maxnetpos>>1;for(j=previouscol+1;j<256;j++)netindex[j]=maxnetpos};var learn=function learn(){var i;var j;var b;var g;var r;var radius;var rad;var alpha;var step;var delta;var samplepixels;var p;var pix;var lim;if(lengthcount<minpicturebytes)samplefac=1;alphadec=30+(samplefac-1)/3;p=thepicture;pix=0;lim=lengthcount;samplepixels=lengthcount/(3*samplefac);delta=samplepixels/ncycles|0;alpha=initalpha;radius=initradius;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(i=0;i<rad;i++)radpower[i]=alpha*((rad*rad-i*i)*radbias/(rad*rad));if(lengthcount<minpicturebytes)step=3;else if(lengthcount%prime1!=0)step=3*prime1;else{if(lengthcount%prime2!=0)step=3*prime2;else{if(lengthcount%prime3!=0)step=3*prime3;else step=3*prime4}}i=0;while(i<samplepixels){b=(p[pix+0]&255)<<netbiasshift;g=(p[pix+1]&255)<<netbiasshift;r=(p[pix+2]&255)<<netbiasshift;j=contest(b,g,r);altersingle(alpha,j,b,g,r);if(rad!=0)alterneigh(rad,j,b,g,r);pix+=step;if(pix>=lim)pix-=lengthcount;i++;if(delta==0)delta=1;if(i%delta==0){alpha-=alpha/alphadec;radius-=radius/radiusdec;rad=radius>>radiusbiasshift;if(rad<=1)rad=0;for(j=0;j<rad;j++)radpower[j]=alpha*((rad*rad-j*j)*radbias/(rad*rad))}}};var map=exports.map=function map(b,g,r){var i;var j;var dist;var a;var bestd;var p;var best;bestd=1e3;best=-1;i=netindex[g];j=i-1;while(i<netsize||j>=0){if(i<netsize){p=network[i];dist=p[1]-g;if(dist>=bestd)i=netsize;else{i++;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}if(j>=0){p=network[j];dist=g-p[1];if(dist>=bestd)j=-1;else{j--;if(dist<0)dist=-dist;a=p[0]-b;if(a<0)a=-a;dist+=a;if(dist<bestd){a=p[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;best=p[3]}}}}}return best};var process=exports.process=function process(){learn();unbiasnet();inxbuild();return colorMap()};var unbiasnet=function unbiasnet(){var i;var j;for(i=0;i<netsize;i++){network[i][0]>>=netbiasshift;network[i][1]>>=netbiasshift;network[i][2]>>=netbiasshift;network[i][3]=i}};var alterneigh=function alterneigh(rad,i,b,g,r){var j;var k;var lo;var hi;var a;var m;var p;lo=i-rad;if(lo<-1)lo=-1;hi=i+rad;if(hi>netsize)hi=netsize;j=i+1;k=i-1;m=1;while(j<hi||k>lo){a=radpower[m++];if(j<hi){p=network[j++];try{p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}catch(e){}}if(k>lo){p=network[k--];try{p[0]-=a*(p[0]-b)/alpharadbias;p[1]-=a*(p[1]-g)/alpharadbias;p[2]-=a*(p[2]-r)/alpharadbias}catch(e){}}}};var altersingle=function altersingle(alpha,i,b,g,r){var n=network[i];n[0]-=alpha*(n[0]-b)/initalpha;n[1]-=alpha*(n[1]-g)/initalpha;n[2]-=alpha*(n[2]-r)/initalpha};var contest=function contest(b,g,r){var i;var dist;var a;var biasdist;var betafreq;var bestpos;var bestbiaspos;var bestd;var bestbiasd;var n;bestd=~(1<<31);bestbiasd=bestd;bestpos=-1;bestbiaspos=bestpos;for(i=0;i<netsize;i++){n=network[i];dist=n[0]-b;if(dist<0)dist=-dist;a=n[1]-g;if(a<0)a=-a;dist+=a;a=n[2]-r;if(a<0)a=-a;dist+=a;if(dist<bestd){bestd=dist;bestpos=i}biasdist=dist-(bias[i]>>intbiasshift-netbiasshift);if(biasdist<bestbiasd){bestbiasd=biasdist;bestbiaspos=i}betafreq=freq[i]>>betashift;freq[i]-=betafreq;bias[i]+=betafreq<<gammashift}freq[bestpos]+=beta;bias[bestpos]-=betagamma;return bestbiaspos};NeuQuant.apply(this,arguments);return exports};function Painter(CanvasIDString){this.myself=this;this.CanvasHeight=177;this.CanvasWidth=97;this.blockSize=8;this.IDString=CanvasIDString;this.CanvasPreview=$("#"+this.IDString+"-preview");this.ContextPreview=this.CanvasPreview[0].getContext("2d");this.CanvasDeco=$("#"+this.IDString+"-deco");this.ContextDeco=this.CanvasDeco[0].getContext("2d");this.CanvasPF=$("#"+this.IDString+"-inactive");this.ContextPF=this.CanvasPF[0].getContext("2d");this.CanvasActive=$("#"+this.IDString+"-active");this.ContextActive=this.CanvasActive[0].getContext("2d");this.CanvasWhiteborder=$("#"+this.IDString+"-whiteborder");this.ContextWhiteborder=this.CanvasWhiteborder[0].getContext("2d");this.CanvasBackground=$("#"+this.IDString+"-background");this.ContextBackground=this.CanvasBackground[0].getContext("2d");this.CanvasBorder=$("#"+this.IDString+"-border");this.ContextBorder=this.CanvasBorder[0].getContext("2d");this.CanvasDecoPin=$("#"+this.IDString+"-decoPin");this.ContextDecoPin=this.CanvasDecoPin[0].getContext("2d");this.CanvasNextHold=$("#"+this.IDString+"-nexthold");this.ContextNextHold=this.CanvasNextHold[0].getContext("2d");this.CanvasProgressbar=$("#"+this.IDString+"-progressbar");this.ContextProgressbar=this.CanvasProgressbar[0].getContext("2d");this.CanvasControl=$("#"+this.IDString+"-control");this.ContextControl=this.CanvasControl[0].getContext("2d");this.PFOriginX=1*this.blockSize;this.PFOriginY=1*this.blockSize;this.PFOriginXAbsolute=this.CanvasPF.offset().left+this.PFOriginX-1;this.PFOriginYAbsolute=this.CanvasPF.offset().top+this.PFOriginY;this.CntrlOriginX=this.CanvasControl.offset().left;this.CntrlOriginY=this.CanvasControl.offset().top;this.CanvasControlheight=this.CanvasControl.height();this.sprite="";this.spritemini="";this.spritedeco="";this.joypalette="";this.ready=false}Painter.prototype.init=function(){var mymyself=this.myself;this.spritedeco=new Image;this.sprite=new Image;this.spritemini=new Image;this.joypalette=new Image;this.spritedeco.src="res/deco-8px.png";this.sprite.src="res/palette-8px.png";this.spritemini.src="res/palette-4px.png";this.joypalette.src="res/control-palette.png";this.sprite.onload=function(){mymyself.ready=true};this.sprite.onerror=function(){mymyself.ready=true};this.drawJoystick("all","rest");this.drawAllButtons("rest");this.drawBorder("master");this.drawGrid()};Painter.prototype.eraseLayer=function(layer){var Canvas;switch(layer){case"decoration":Context=this.ContextDeco;break;case"inactive":Context=this.ContextPF;break;case"preview":Context=this.ContextPreview;break;case"active":Context=this.ContextActive;break;case"nexthold":Context=this.ContextNextHold;break;case"whiteborder":Context=this.ContextWhiteborder;break;case"all":Context=this.ContextPF;this.ContextDeco.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextPreview.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextActive.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextNextHold.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextWhiteborder.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);break}Context.clearRect(0,0,this.CanvasWidth,this.CanvasHeight)};Painter.prototype.eraseBlock=function(x,y){this.ContextPF.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)};Painter.prototype.eraseDeco=function(x,y){this.ContextDeco.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)};Painter.prototype.drawComment=function(str){$("#"+this.IDString+"-comment").val(str)};Painter.prototype.drawDuration=function(str){$("#"+this.IDString+"-duration").val(str)};Painter.prototype.drawOpacity=function(str){$("#"+this.IDString+"-active-opacity").val(str)};Painter.prototype.drawProgressbar=function(CurrentFrame,TotalFrame){if(CurrentFrame<=TotalFrame&&CurrentFrame>0){this.ContextProgressbar.clearRect(0,0,this.CanvasWidth,this.CanvasHeight);this.ContextProgressbar.beginPath();this.ContextProgressbar.rect(0,0,parseInt(CurrentFrame/TotalFrame*100,10),24);this.ContextProgressbar.fillStyle="gray";this.ContextProgressbar.fill();this.ContextProgressbar.closePath()}};Painter.prototype.drawWhiteBorder=function(playfield){this.eraseLayer("whiteborder");for(var i=0,istop=playfield.length;i<istop;i++){for(var j=0,jstop=playfield[0].length;j<jstop;j++){if(playfield[i][j][0]){this.drawLocalWhiteBorder(playfield,i,j)}}}};Painter.prototype.drawLocalWhiteBorder=function(playfield,x,y){this.ContextWhiteborder.beginPath();if(playfield[x][y][0]){if(x-1>=0){if(!playfield[x-1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(x+1<playfield.length){if(!playfield[x+1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(x+1)*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(x+1)*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y-1>=0){if(!playfield[x][y-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y+1<playfield[0].length){if(!playfield[x][y+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}else{if(x-1>=0){if(playfield[x-1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(x+1<playfield.length){if(playfield[x+1][y][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+(x+1)*this.blockSize-1,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+(x+1)*this.blockSize,this.PFOriginY+y*this.blockSize,1,this.blockSize);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y-1>=0){if(playfield[x][y-1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}if(y+1<playfield[0].length){if(playfield[x][y+1][0]){this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="white";this.ContextWhiteborder.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize-1,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}else{this.ContextWhiteborder.beginPath();this.ContextWhiteborder.fillStyle="pink";this.ContextWhiteborder.clearRect(this.PFOriginX+x*this.blockSize,this.PFOriginY+(y+1)*this.blockSize,this.blockSize,1);this.ContextWhiteborder.closePath();this.ContextWhiteborder.fill()}}}};Painter.prototype.drawGrid=function(){this.ContextBackground.beginPath();this.ContextBackground.beginPath();for(var i=1;i<=9;i++){this.ContextBackground.rect(this.PFOriginX+i*this.blockSize,this.PFOriginY,1,20*this.blockSize)}for(var i=1;i<=19;i++){this.ContextBackground.rect(this.PFOriginX,this.PFOriginY+i*this.blockSize,10*this.blockSize,1)}this.ContextBackground.fillStyle="#444";this.ContextBackground.fill();this.ContextBackground.closePath()};Painter.prototype.drawBorder=function(kind){var color1="#afafaf";var color2="#46545f";var mymyself=this.myself;switch(kind){case"master":color1="#afafaf";color2="#46545f";break;case"easy":color1="#afafaf";color2="#475f46";break;case"death":color1="#ac434a";color2="#5f0004";break;default:color1="#afafaf";color2="#46545f";break}var radgrd1=this.ContextBorder.createRadialGradient(0,0,this.blockSize,0,0,this.CanvasWidth-2*this.blockSize),radgrd2=this.ContextBorder.createRadialGradient(this.CanvasWidth,this.CanvasHeight,this.blockSize,this.CanvasWidth,this.CanvasHeight,this.CanvasWidth-2*this.blockSize);radgrd1.addColorStop(0,color1);radgrd1.addColorStop(1,color2);radgrd2.addColorStop(0,color1);radgrd2.addColorStop(1,color2);var grd_hor=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),grd_hor_rev=this.ContextBorder.createLinearGradient(0,0,this.CanvasWidth-2*this.blockSize,0),grd_vert=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize),grd_vert_rev=this.ContextBorder.createLinearGradient(0,0,0,this.CanvasWidth-2*this.blockSize);grd_hor.addColorStop(0,color1);grd_hor.addColorStop(1,color2);grd_hor_rev.addColorStop(0,color2);grd_hor_rev.addColorStop(1,color1);grd_vert.addColorStop(0,color1);grd_vert.addColorStop(1,color2);grd_vert_rev.addColorStop(0,color2);grd_vert_rev.addColorStop(1,color1);function drawrectangle(x_begin,y_begin,width,height,fill){mymyself.ContextBorder.beginPath();mymyself.ContextBorder.rect(x_begin,y_begin,width,height);mymyself.ContextBorder.fillStyle=fill;mymyself.ContextBorder.fill();mymyself.ContextBorder.closePath()}drawrectangle(0,0,this.CanvasWidth,this.CanvasHeight,color2);drawrectangle(0,0,this.CanvasWidth,this.CanvasWidth,radgrd1);drawrectangle(0,this.CanvasHeight-this.CanvasWidth,this.CanvasWidth,this.CanvasWidth,radgrd2);drawrectangle(0,0,this.CanvasWidth,1,grd_hor_rev);drawrectangle(0,0,1,this.CanvasHeight,grd_vert_rev);drawrectangle(this.CanvasWidth-1,0,1,this.CanvasHeight,grd_vert);drawrectangle(0,this.CanvasHeight-1,this.CanvasWidth,1,grd_hor);drawrectangle(this.blockSize-1,this.blockSize-1,10*this.blockSize+1,1,grd_hor_rev);drawrectangle(this.blockSize+10*this.blockSize,this.blockSize-1,1,20*this.blockSize+2,grd_vert);drawrectangle(this.blockSize-1,this.blockSize-1,1,20*this.blockSize+1,grd_vert_rev);drawrectangle(this.blockSize-1,this.blockSize+20*this.blockSize,10*this.blockSize+1,1,grd_hor);drawrectangle(1*this.blockSize,1*this.blockSize,10*this.blockSize,20*this.blockSize,"black")};Painter.prototype.drawNextHold=function(position,type,RS){matrix=getMatrix(type,"i",RS);switch(position){case 0:this.ContextNextHold.clearRect(0,this.blockSize+3,4*this.blockSize,3*this.blockSize);if(!type){return}for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.drawBlock(parseInt(-1+j,10),parseInt(2+i,10),type,RS,"nextholdmini")}}}break;case 1:this.ContextNextHold.clearRect(4*this.blockSize,this.blockSize,4*this.blockSize,3*this.blockSize+3);if(!type){return}for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){if(RS=="SRS"){this.drawBlock(parseInt(3+j,10),parseInt(1+i,10),type,RS,"nexthold")}else{this.drawBlock(parseInt(3+j,10),parseInt(0+i,10),type,RS,"nexthold")}}}}break;case 2:this.ContextNextHold.clearRect(8*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);if(!type){return}for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.drawBlock(parseInt(13+j,10),parseInt(3+i,10),type,RS,"nextholdmini")}}}break;case 3:if(!type){return}this.ContextNextHold.clearRect(10*this.blockSize,this.blockSize+3,2*this.blockSize+1,3*this.blockSize);for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.drawBlock(parseInt(17+j,10),parseInt(3+i,10),type,RS,"nextholdmini")}}}break}};Painter.prototype.changeActiveOpacity=function(level){if(level=="Flash"||level=="flash"){this.CanvasActive.attr("style","z-index:4; opacity: 1.0")}else{this.CanvasActive.attr("style","z-index:4; opacity: "+level)}};Painter.prototype.drawDeco=function(x,y,kind,layer){if(!kind){return}var sprite=this.spritedeco;var spriteOffsetStart,spriteOffsetEnd;var ctx;if(layer=="preview"){ctx=this.ContextPreview}else{ctx=this.ContextDeco}switch(kind){case"n1":spriteOffsetStart=decoration.n1.s;spriteOffsetEnd=decoration.n1.e;break;case"n2":spriteOffsetStart=decoration.n2.s;spriteOffsetEnd=decoration.n2.e;break;case"n3":spriteOffsetStart=decoration.n3.s;spriteOffsetEnd=decoration.n3.e;break;case"n4":spriteOffsetStart=decoration.n4.s;spriteOffsetEnd=decoration.n4.e;break;case"n5":spriteOffsetStart=decoration.n5.s;spriteOffsetEnd=decoration.n5.e;break;case"n6":spriteOffsetStart=decoration.n6.s;spriteOffsetEnd=decoration.n6.e;break;case"n7":spriteOffsetStart=decoration.n7.s;spriteOffsetEnd=decoration.n7.e;break;case"n8":spriteOffsetStart=decoration.n8.s;spriteOffsetEnd=decoration.n8.e;break;case"n9":spriteOffsetStart=decoration.n9.s;spriteOffsetEnd=decoration.n9.e;break;case"n0":spriteOffsetStart=decoration.n0.s;spriteOffsetEnd=decoration.n0.e;break;case"smallcw":spriteOffsetStart=decoration.smallcw.s;spriteOffsetEnd=decoration.smallcw.e;break;case"smallccw":spriteOffsetStart=decoration.smallccw.s;spriteOffsetEnd=decoration.smallccw.e;break;case"smalloktick":spriteOffsetStart=decoration.smalloktick.s;spriteOffsetEnd=decoration.smalloktick.e;break;case"smallokcircle":spriteOffsetStart=decoration.smallokcircle.s;spriteOffsetEnd=decoration.smallokcircle.e;break;case"smallnocross":spriteOffsetStart=decoration.smallnocross.s;spriteOffsetEnd=decoration.smallnocross.e;break;case"smallquestion":spriteOffsetStart=decoration.smallquestion.s;spriteOffsetEnd=decoration.smallquestion.e;break;case"smallexclamation":spriteOffsetStart=decoration.smallexclamation.s;spriteOffsetEnd=decoration.smallexclamation.e;break;case"nwarrow":spriteOffsetStart=decoration.nwarrow.s;spriteOffsetEnd=decoration.nwarrow.e;break;case"narrow":spriteOffsetStart=decoration.narrow.s;spriteOffsetEnd=decoration.narrow.e;break;case"nearrow":spriteOffsetStart=decoration.nearrow.s;spriteOffsetEnd=decoration.nearrow.e;break;case"earrow":spriteOffsetStart=decoration.earrow.s;spriteOffsetEnd=decoration.earrow.e;break;case"searrow":spriteOffsetStart=decoration.searrow.s;spriteOffsetEnd=decoration.searrow.e;break;case"sarrow":spriteOffsetStart=decoration.sarrow.s;spriteOffsetEnd=decoration.sarrow.e;break;case"swarrow":spriteOffsetStart=decoration.swarrow.s;spriteOffsetEnd=decoration.swarrow.e;break;case"warrow":spriteOffsetStart=decoration.warrow.s;spriteOffsetEnd=decoration.warrow.e;break;case"bigcw":spriteOffsetStart=decoration.bigcw.s;spriteOffsetEnd=decoration.bigcw.e;break;case"bigccw":spriteOffsetStart=decoration.bigccw.s;spriteOffsetEnd=decoration.bigccw.e;break;case"bigquestion":spriteOffsetStart=decoration.bigquestion.s;spriteOffsetEnd=decoration.bigquestion.e;break;case"bigexclamation":spriteOffsetStart=decoration.bigexclamation.s;spriteOffsetEnd=decoration.bigexclamation.e;break;case"bigoktick":spriteOffsetStart=decoration.bigoktick.s;spriteOffsetEnd=decoration.bigoktick.e;break;case"bigokcircle":spriteOffsetStart=decoration.bigokcircle.s;spriteOffsetEnd=decoration.bigokcircle.e;break;case"bignocross":spriteOffsetStart=decoration.bignocross.s;spriteOffsetEnd=decoration.bignocross.e;break;case"overlayyellow":spriteOffsetStart=decoration.overlayyellow.s;spriteOffsetEnd=decoration.overlayyellow.e;break;case"overlayblue":spriteOffsetStart=decoration.overlayblue.s;spriteOffsetEnd=decoration.overlayblue.e;break;case"overlaygreen":spriteOffsetStart=decoration.overlaygreen.s;
spriteOffsetEnd=decoration.overlaygreen.e;break;case"overlaypink":spriteOffsetStart=decoration.overlaypink.s;spriteOffsetEnd=decoration.overlaypink.e;break;case"overlayorange":spriteOffsetStart=decoration.overlayorange.s;spriteOffsetEnd=decoration.overlayorange.e;break;case"clear1":spriteOffsetStart=decoration.clear1.s;spriteOffsetEnd=decoration.clear1.e;break;case"clear2":spriteOffsetStart=decoration.clear2.s;spriteOffsetEnd=decoration.clear2.e;break;case"clear3":spriteOffsetStart=decoration.clear3.s;spriteOffsetEnd=decoration.clear3.e;break;case"clear4":spriteOffsetStart=decoration.clear4.s;spriteOffsetEnd=decoration.clear4.e;break;case"clear5":spriteOffsetStart=decoration.clear5.s;spriteOffsetEnd=decoration.clear5.e;break;case"clear6":spriteOffsetStart=decoration.clear6.s;spriteOffsetEnd=decoration.clear6.e;break;case"clear7":spriteOffsetStart=decoration.clear7.s;spriteOffsetEnd=decoration.clear7.e;break}var ox=spriteOffsetStart[0]*this.blockSize;var oy=spriteOffsetStart[1]*this.blockSize;var w=(spriteOffsetEnd[0]-spriteOffsetStart[0])*this.blockSize;var h=(spriteOffsetEnd[1]-spriteOffsetStart[1])*this.blockSize;var nx=this.PFOriginX+x*this.blockSize;var ny=this.PFOriginY+y*this.blockSize;if(layer!="eraser"){ctx.clearRect(nx,ny,w,h);ctx.drawImage(sprite,ox,oy,w,h,nx,ny,w,h)}else{ctx.clearRect(nx,ny,w,h);this.ContextDecoPin.clearRect(nx-this.blockSize/2,ny-this.blockSize/2,this.blockSize,this.blockSize)}if(layer!="preview"&&layer!="eraser"){this.ContextDecoPin.beginPath();this.ContextDecoPin.fillStyle="red";this.ContextDecoPin.strokeStyle="red";this.ContextDecoPin.arc(nx,ny,this.blockSize/4,2*Math.PI,false);this.ContextDecoPin.fill();this.ContextDecoPin.lineTo(nx+4,ny+4);this.ContextDecoPin.stroke();this.ContextDecoPin.closePath()}};Painter.prototype.drawBrowserBlock=function(x,y,type,RS,id,context){var color;switch(RS){case"ARS":switch(type){case"I":color=ARS.I.color;break;case"T":color=ARS.T.color;break;case"L":color=ARS.L.color;break;case"J":color=ARS.J.color;break;case"S":color=ARS.S.color;break;case"Z":color=ARS.Z.color;break;case"O":color=ARS.O.color;break;case"G":color=ARS.G.color;break}break;case"SRS":switch(type){case"I":color=SRS.I.color;break;case"T":color=SRS.T.color;break;case"L":color=SRS.L.color;break;case"J":color=SRS.J.color;break;case"S":color=SRS.S.color;break;case"Z":color=SRS.Z.color;break;case"O":color=SRS.O.color;break;case"G":color=SRS.G.color;break}break;case"GB":switch(type){case"I":color=GB.I.color;break;case"T":color=GB.T.color;break;case"L":color=GB.L.color;break;case"J":color=GB.J.color;break;case"S":color=GB.S.color;break;case"Z":color=GB.Z.color;break;case"O":color=GB.O.color;break;case"G":color=GB.G.color;break}break}if(context=="inactive"){if(type=="E"){$("#pf-"+id+"-row-"+y+"-col-"+x+" .inactive").attr("style","background-color: transparent;")}else{$("#pf-"+id+"-row-"+y+"-col-"+x+" .inactive").attr("style","background-color: "+color+";")}}if(context=="resetactive"){$("table div.active").attr("style","background-color: transparent;")}if(context=="active"){$("#pf-"+id+"-row-"+y+"-col-"+x+" .active").attr("style","background-color: "+color+";")}};Painter.prototype.drawBlock=function(x,y,type,RS,context,highlight){if(type){var ctx;var mini=false;switch(context){case"inactive":ctx=this.ContextPF;break;case"preview":ctx=this.ContextPreview;break;case"active":ctx=this.ContextActive;break;case"flash":ctx=this.ContextActive;break;case"nexthold":ctx=this.ContextNextHold;break;case"nextholdmini":ctx=this.ContextNextHold;mini=true;break}ctx.beginPath();if(mini){if(x>=17){ctx.rect(6+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*this.blockSize/2,this.blockSize/2,this.blockSize/2)}else{ctx.rect(5+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*this.blockSize/2,this.blockSize/2,this.blockSize/2)}}else{ctx.rect(this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)}var color;var sprite;var spriteOffset;if(mini){sprite=this.spritemini}else{sprite=this.sprite}switch(RS){case"ARS":switch(type){case"I":color=ARS.I.color;spriteOffset=ARS.I.offset;break;case"T":color=ARS.T.color;spriteOffset=ARS.T.offset;break;case"L":color=ARS.L.color;spriteOffset=ARS.L.offset;break;case"J":color=ARS.J.color;spriteOffset=ARS.J.offset;break;case"S":color=ARS.S.color;spriteOffset=ARS.S.offset;break;case"Z":color=ARS.Z.color;spriteOffset=ARS.Z.offset;break;case"O":color=ARS.O.color;spriteOffset=ARS.O.offset;break;case"G":color=ARS.G.color;spriteOffset=ARS.G.offset;break}break;case"SRS":switch(type){case"I":color=SRS.I.color;spriteOffset=SRS.I.offset;break;case"T":color=SRS.T.color;spriteOffset=SRS.T.offset;break;case"L":color=SRS.L.color;spriteOffset=SRS.L.offset;break;case"J":color=SRS.J.color;spriteOffset=SRS.J.offset;break;case"S":color=SRS.S.color;spriteOffset=SRS.S.offset;break;case"Z":color=SRS.Z.color;spriteOffset=SRS.Z.offset;break;case"O":color=SRS.O.color;spriteOffset=SRS.O.offset;break;case"G":color=SRS.G.color;spriteOffset=SRS.G.offset;break}break;case"GB":switch(type){case"I":color=GB.I.color;spriteOffset=GB.I.offset;break;case"T":color=GB.T.color;spriteOffset=GB.T.offset;break;case"L":color=GB.L.color;spriteOffset=GB.L.offset;break;case"J":color=GB.J.color;spriteOffset=GB.J.offset;break;case"S":color=GB.S.color;spriteOffset=GB.S.offset;break;case"Z":color=GB.Z.color;spriteOffset=GB.Z.offset;break;case"O":color=GB.O.color;spriteOffset=GB.O.offset;break;case"G":color=GB.G.color;spriteOffset=GB.G.offset;break}break}if(context=="flash"){if(RS=="ARS"){color=ARS.Flash.color;spriteOffset=ARS.Flash.offset}if(RS=="SRS"){color=SRS.Flash.color;spriteOffset=SRS.Flash.offset}if(RS=="GB"){color=GB.Flash.color;spriteOffset=GB.Flash.offset}}ctx.fillStyle=color;ctx.fill();ctx.closePath();if(sprite){if(mini){if(x>=17){ctx.drawImage(sprite,spriteOffset[0]*(this.blockSize/2),spriteOffset[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,6+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}else{ctx.drawImage(sprite,spriteOffset[0]*(this.blockSize/2),spriteOffset[1]*(this.blockSize/2),this.blockSize/2,this.blockSize/2,5+this.PFOriginX+x*this.blockSize/2,this.PFOriginY+y*(this.blockSize/2),this.blockSize/2,this.blockSize/2)}}else{ctx.drawImage(sprite,spriteOffset[0]*this.blockSize,spriteOffset[1]*this.blockSize,this.blockSize,this.blockSize,this.PFOriginX+x*this.blockSize,this.PFOriginY+y*this.blockSize,this.blockSize,this.blockSize)}}}};Painter.prototype.highlight=function(x,y){var coordx=this.PFOriginX+(x+.5)*this.blockSize;var coordy=this.PFOriginY+(y+.5)*this.blockSize;var counter=20;function draw(){setTimeout(function(){var myReq=window.requestAnimationFrame(draw);if(counter>0){this.myself.ContextPreview.beginPath();this.myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";this.myself.ContextPreview.globalCompositeOperation="destination-out";this.myself.ContextPreview.arc(coordx,coordy,counter+2,2*Math.PI,false);this.myself.ContextPreview.arc(coordx,coordy,counter+1,2*Math.PI,false);this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();this.myself.ContextPreview.beginPath();this.myself.ContextPreview.arc(coordx,coordy,counter,2*Math.PI,false);this.myself.ContextPreview.globalCompositeOperation="source-over";this.myself.ContextPreview.strokeStyle="white";this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();counter-=1}else{this.myself.ContextPreview.beginPath();this.myself.ContextPreview.strokeStyle="rgba(255,255,255,255)";this.myself.ContextPreview.globalCompositeOperation="destination-out";this.myself.ContextPreview.arc(coordx,coordy,counter+2,2*Math.PI,false);this.myself.ContextPreview.arc(coordx,coordy,counter+1,2*Math.PI,false);this.myself.ContextPreview.stroke();this.myself.ContextPreview.closePath();window.cancelAnimationFrame(myReq)}},1e3/60)}};Painter.prototype.resetJoystick=function(){var height=this.CanvasControl.height();this.ContextControl.clearRect(0,0,height,height);this.ContextControl.drawImage(this.joypalette,0,0,height,height,0,0,height,height)};Painter.prototype.drawJoystick=function(direction,state){var state_modifier;switch(state){case"rest":state_modifier=0;break;case"pressed":state_modifier=35;break;case"holded":state_modifier=70;break}switch(direction){case"all":this.ContextControl.drawImage(this.joypalette,0,state_modifier,37,37,0,0,37,37);break;case"u":this.ContextControl.drawImage(this.joypalette,12,state_modifier,11,12,12,0,11,12);break;case"d":this.ContextControl.drawImage(this.joypalette,12,12+state_modifier,11,24,12,12,11,24);break;case"l":this.ContextControl.drawImage(this.joypalette,0,12+state_modifier,12,11,0,12,12,11);break;case"r":this.ContextControl.drawImage(this.joypalette,12,12+state_modifier,24,11,12,12,24,11);break;case"ul":this.ContextControl.drawImage(this.joypalette,3,3+state_modifier,9,9,3,3,9,9);break;case"ur":this.ContextControl.drawImage(this.joypalette,23,3+state_modifier,9,9,23,3,9,9);break;case"dl":this.ContextControl.drawImage(this.joypalette,3,23+state_modifier,9,9,3,23,9,9);break;case"dr":this.ContextControl.drawImage(this.joypalette,23,23+state_modifier,9,9,23,23,9,9);break}};Painter.prototype.drawAllButtons=function(state,layout){this.drawButton("A",state);this.drawButton("B",state);this.drawButton("C",state);this.drawButton("D",state)};Painter.prototype.drawButton=function(button,state){var state_modifier;switch(state){case"rest":state_modifier=0;break;case"pressed":state_modifier=35;break;case"holded":state_modifier=70;break}switch(button){case"A":this.ContextControl.drawImage(this.joypalette,37,1+state_modifier,14,15,37,1,14,15);break;case"B":this.ContextControl.drawImage(this.joypalette,53,1+state_modifier,14,15,53,1,14,15);break;case"C":this.ContextControl.drawImage(this.joypalette,69,1+state_modifier,14,15,69,1,14,15);break;case"D":this.ContextControl.drawImage(this.joypalette,37,16+state_modifier,14,18,37,16,14,18);break}};Painter.prototype.drawButton_old=function(button,state){var height=this.CanvasControl.height();var radius=height/5;this.ContextControl.textBaseline="middle";this.ContextControl.font="bold 10px sans-serif";this.ContextControl.beginPath();switch(button){case"A":this.ContextControl.clearRect(height+height/4-radius-1,height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4,height/4,radius,0,2*Math.PI,false);break;case"B":this.ContextControl.clearRect(height+height/4+2*radius+height/16-radius-1,height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4+2*radius+height/16,height/4,radius,0,2*Math.PI,false);break;case"C":this.ContextControl.clearRect(height+height/4+4*radius+2*height/16-radius-1,height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4+4*radius+2*height/16,height/4,radius,0,2*Math.PI,false);break;case"D":this.ContextControl.clearRect(height+height/4-radius-1,3*height/4-radius-1,2*radius+2,2*radius+2);this.ContextControl.arc(height+height/4,3*height/4,radius,0,2*Math.PI,false);break}this.ContextControl.closePath();switch(state){case"pressed":this.ContextControl.fillStyle="#ff0000";break;case"holded":this.ContextControl.fillStyle="#ffa600";break;case"rest":this.ContextControl.fillStyle="#808080";break}this.ContextControl.fill();switch(button){case"A":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("A",height+height/4-height/10,height/4+1);break;case"B":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("B",height+height/4+2*radius+height/16-height/10,height/4+1);break;case"C":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("C",height+height/4+4*radius+2*height/16-height/10,height/4+1);break;case"D":this.ContextControl.fillStyle="#000000";this.ContextControl.fillText("H",height+height/4-height/10,3*height/4+1);break}};Painter.prototype.frameCount=function(cur,tot){$("#"+this.IDString+"-current-frame").attr("value",cur);$("#"+this.IDString+"-total-frame").html(tot)};function Diagram(painter){var myself=this;this.painter=painter;this.frames=[];this.current_frame=0;this.playing=false}Diagram.prototype.new_frame=function(){this.current_frame++;this.painter.eraseLayer("all");var newFrame=new Frame(this.painter);this.frames.splice(this.current_frame,0,newFrame);this.update_framecount()};Diagram.prototype.remove_current_frame=function(){if(this.frames.length>1){if(this.current_frame-1>=0){this.current_frame--;this.frames.splice(this.current_frame+1,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}else{this.frames.splice(this.current_frame,1);this.painter.eraseLayer("all");this.frames[this.current_frame].draw()}}else{this.current_frame=0;this.frames[this.current_frame].clear("all")}};Diagram.prototype.init=function(){this.frames.push(new Frame(this.painter))};Diagram.prototype.new_copy_frame=function(){var saved_frame=this.frames[this.current_frame].print();this.new_frame();this.frames[this.current_frame].load(saved_frame,"blank")};Diagram.prototype.remove_following_frames=function(){console.log(this.current_frame+1);this.frames.splice(this.current_frame+1);this.frames[this.current_frame].draw()};Diagram.prototype.remove_all_playfields=function(){this.current_frame=this.frames.length;while(this.current_frame>0){this.remove_current_frame()}this.frames[0].clear("all");this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.remove_all_playfields2=function(){this.frames.splice(1);this.frames[0].clear("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.goto_frame=function(frame_number){this.painter.eraseLayer("all");this.current_frame=frame_number;if(frame_number==0){this.frames[this.current_frame].draw()}else{var exception={border:true};this.frames[this.current_frame].draw(exception)}this.update_framecount()};Diagram.prototype.first_frame=function(){this.painter.eraseLayer("all");this.current_frame=0;this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.previous_frame=function(){if(this.current_frame>0){this.painter.eraseLayer("all");this.current_frame--,this.frames[this.current_frame].draw();this.update_framecount()}};Diagram.prototype.next_frame=function(){this.painter.eraseLayer("all");this.current_frame++,this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.last_frame=function(){this.painter.eraseLayer("all");this.current_frame=parseInt(this.frames.length-1,0);this.frames[this.current_frame].draw();this.update_framecount()};Diagram.prototype.update_framecount=function(){this.painter.frameCount(this.current_frame+1,this.frames.length);this.painter.drawProgressbar(this.current_frame+1,this.frames.length)};Diagram.prototype.print=function(){var output="";output+=this.frames[0].print();if(this.frames.length){for(var i=1,istop=this.frames.length;i<istop;i++){output+="+";output+=this.print_differences(i,i-1)}}return output};Diagram.prototype.print_differences=function(final_frame,reference_frame){var output="";var tmp="";if(this.frames[final_frame].activePieceType!=this.frames[reference_frame].activePieceType||this.frames[final_frame].activePieceOrientation!=this.frames[reference_frame].activePieceOrientation||this.frames[final_frame].activePiecePositionX!=this.frames[reference_frame].activePiecePositionX||this.frames[final_frame].activePiecePositionY!=this.frames[reference_frame].activePiecePositionY){if(this.frames[final_frame].activePieceType){output+="A~"+this.frames[final_frame].activePieceType;tmp=alphanumconvert(this.frames[final_frame].activePiecePositionX);output+=tmp;tmp=alphanumconvert(this.frames[final_frame].activePiecePositionY);output+=tmp+this.frames[final_frame].activePieceOrientation+"_";tmp=""}else{output+="A~E_"}}var candidate_case=[];var first_candidate=true;var newly_added=false;var candidate_case_deco=[];var first_candidate_deco=true;var newly_added_deco=false;for(var i=0;i<10;i++){for(var j=0;j<20;j++){if(this.frames[final_frame].playfield[i][j][0]!=this.frames[reference_frame].playfield[i][j][0]){if(first_candidate){if(this.frames[final_frame].playfield[i][j][0]){candidate_case.push([]);candidate_case[0].val=this.frames[final_frame].playfield[i][j][0];candidate_case[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate=false}else{candidate_case.push([]);candidate_case[0].val="";candidate_case[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate=false}}else{for(var k=0,kstop=candidate_case.length;k<kstop;k++){console.log(candidate_case);if(this.frames[final_frame].playfield[i][j][0]==candidate_case[k].val){if(newly_added){newly_added=false;candidate_case[k].push(alphanumconvert(i)+alphanumconvert(j));console.log("ping")}else{candidate_case[k].push(alphanumconvert(i)+alphanumconvert(j));break}}else if(k==parseFloat(candidate_case.length-1)){candidate_case.push([]);candidate_case[parseFloat(k+1)].val=this.frames[final_frame].playfield[i][j][0];candidate_case[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j));newly_added=true}}}}if(this.frames[final_frame].playfield[i][j][1]!=this.frames[reference_frame].playfield[i][j][1]){if(first_candidate_deco){if(this.frames[final_frame].playfield[i][j][1]){candidate_case_deco.push([]);candidate_case_deco[0].val=this.frames[final_frame].playfield[i][j][1];candidate_case_deco[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate_deco=false}else{candidate_case_deco.push([]);candidate_case_deco[0].val="";candidate_case_deco[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate_deco=false}}else{for(var k=0,kstop=candidate_case_deco.length;k<kstop;k++){if(this.frames[final_frame].playfield[i][j][1]==candidate_case_deco[k].val){if(newly_added_deco){newly_added_deco=false;candidate_case_deco[k].push(alphanumconvert(i)+alphanumconvert(j))}else{candidate_case_deco[k].push(alphanumconvert(i)+alphanumconvert(j));break}}else if(k==parseFloat(candidate_case_deco.length-1)){candidate_case_deco.push([]);candidate_case_deco[parseFloat(k+1)].val=this.frames[final_frame].playfield[i][j][1];candidate_case_deco[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j));newly_added_deco=true}}}}}}if(candidate_case){output+="I";tmp="";for(var i=0,istop=candidate_case.length;i<istop;i++){tmp+="~";if(candidate_case[i].val){tmp+=candidate_case[i].val}else{tmp+="E"}for(var j=0,jstop=candidate_case[i].length;j<jstop;j++){tmp+=candidate_case[i][j]}}output+=tmp+"_"}if(candidate_case_deco){output+="D";tmp="";for(var i=0,istop=candidate_case_deco.length;i<istop;i++){tmp+="~";if(candidate_case_deco[i].val){tmp+=candidate_case_deco[i].val+"*"}else{tmp+="E*"}for(var j=0,jstop=candidate_case_deco[i].length;j<jstop;j++){tmp+=candidate_case_deco[i][j]}}output+=tmp+"_"}tmp="";if(this.frames[final_frame].RS!=this.frames[reference_frame].RS){output+="R~"+this.frames[final_frame].RS+"_"}if(this.frames[final_frame].activePieceOpacity!=this.frames[reference_frame].activePieceOpacity){output+="O~"+this.frames[final_frame].activePieceOpacity+"_"}if(this.frames[final_frame].whiteborder!=this.frames[reference_frame].whiteborder){if(this.frames[final_frame].whiteborder){output+="W~1_"}else{output+="W~0_"}}if(this.frames[final_frame].border!=this.frames[reference_frame].border){output+="B~"+this.frames[final_frame].border+"_"}if(this.frames[final_frame].duration!=this.frames[reference_frame].duration){output+="T~"+parseInt(this.frames[final_frame].duration,10)+"_"}if(this.frames[final_frame].joystick_direction!=this.frames[reference_frame].joystick_direction||this.frames[final_frame].joystick_state!=this.frames[reference_frame].joystick_state){switch(this.frames[final_frame].joystick_state){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}switch(this.frames[final_frame].joystick_direction){case"u":tmp+="8";break;case"r":tmp+="6";break;case"d":tmp+="2";break;case"l":tmp+="4";break;case"c":tmp+="5";break;case"ul":tmp+="7";break;case"ur":tmp+="9";break;case"dr":tmp+="3";break;case"dl":tmp+="1";break}output+="J~"+tmp+"_";tmp=""}if(!this.frames[final_frame].button_state.compare(this.frames[reference_frame].button_state)){for(var i=0,istop=this.frames[final_frame].button_state.length;i<istop;i++){switch(this.frames[final_frame].button_state[i]){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}}output+="C~"+tmp+"_";tmp=""}if(!this.frames[final_frame].nexthold.compare(this.frames[reference_frame].nexthold)){for(var i=0,istop=this.frames[final_frame].nexthold.length;i<istop;i++){if(this.frames[final_frame].nexthold[i]){tmp+=this.frames[final_frame].nexthold[i]}else{tmp+=0}}output+="N~"+tmp+"_";tmp=""}if(this.frames[final_frame].comment.localeCompare(this.frames[reference_frame].comment)!==0){output+="S~"+this.frames[final_frame].comment}return output};Diagram.prototype.load=function(str){if(!str){return}this.remove_all_playfields();this.current_frame=0;this.update_framecount();var stringframe=str.split("+");this.frames[0].load(stringframe[0],"blank");for(var i=1,istop=stringframe.length;i<istop;i++){this.new_copy_frame();this.frames[i].load(stringframe[i],"differences")}this.frames[this.current_frame].draw();this.update_framecount()};var GLOBAL_FRAME_COUNTER=0;function Frame(painter){GLOBAL_FRAME_COUNTER++;var myself=this;this.sself=this;this.id=GLOBAL_FRAME_COUNTER;this.painter=painter;this.height=20;this.width=10;this.RS="ARS";this.border="Master";this.whiteborder=false;this.playfield=[];this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.activePieceOpacity=1;this.duration=15;this.nexthold=["","","",""];this.joystick_direction="c";this.joystick_state="rest";this.button_state=["rest","rest","rest","rest","rest","rest"];this.comment="";for(var oi=0,oistop=this.width;oi<oistop;oi++){this.playfield.push(new Array(this.height));for(var oj=0,ojstop=this.height;oj<ojstop;oj++){this.playfield[oi][oj]=new Array(1);this.playfield[oi][oj][0]="";this.playfield[oi][oj][1]=""}}}Frame.prototype.modify=function(x,y,type){if(type=="E"){this.playfield[x][y][0]=""}else{this.playfield[x][y][0]=type}};Frame.prototype.is_in=function(x,y){if(x<0||y<0||x>=this.width||y>=this.height){return false}return true};Frame.prototype.lookup=function(x,y){return this.playfield[x][y][0]};Frame.prototype.piece_is_in=function(x,y,type,orientation){var matrix=getMatrix(type,orientation,this.RS);if(orientation=="singleton"&&this.is_in(parseInt(x,10),parseInt(y,10))){return true}else{var counter=0;for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]&&this.is_in(parseInt(x-1+j,10),parseInt(y-1+i,10))){counter++}}}if(counter==4){return true}return false}};Frame.prototype.draw=function(exception){for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){if(this.playfield[i][j][0]){this.painter.drawBlock(i,j,this.playfield[i][j][0],this.RS,"inactive")}if(this.playfield[i][j][1]){this.painter.drawDeco(i,j,this.playfield[i][j][1],"decoration")}}}if(this.activePieceType){var matrix=getMatrix(this.activePieceType,this.activePieceOrientation,this.RS);for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+j,10),parseInt(this.activePiecePositionY-1+i,10),this.activePieceType,this.RS,"active");if(this.activePieceOpacity=="Flash"){this.painter.drawBlock(parseInt(this.activePiecePositionX-1+j,10),parseInt(this.activePiecePositionY-1+i,10),this.activePieceType,this.RS,"flash")}}}}}for(var i=0,istop=this.nexthold.length;i<istop;i++){this.painter.drawNextHold(i,this.nexthold[i],this.RS)}if(!(exception&&exception["border"])){this.painter.drawBorder(this.border)}if(!(exception&&exception["joystick"])){this.painter.resetJoystick();this.painter.drawJoystick(this.joystick_direction,this.joystick_state)}if(!(exception&&exception["buttons"])){this.painter.drawButton("A",this.button_state[0]);this.painter.drawButton("B",this.button_state[1]);this.painter.drawButton("C",this.button_state[2]);this.painter.drawButton("D",this.button_state[3])}this.painter.drawComment(this.comment);this.painter.drawDuration(this.duration);this.painter.drawOpacity(this.activePieceOpacity);this.painter.changeActiveOpacity(this.activePieceOpacity);this.painter.eraseLayer("whiteborder");if(this.whiteborder){this.painter.drawWhiteBorder(this.playfield)}};Frame.prototype.print=function(){var output="";var tmp="";if(this.activePieceType){output+="A~"+this.activePieceType;tmp=alphanumconvert(this.activePiecePositionX);output+=tmp;tmp=alphanumconvert(this.activePiecePositionY);output+=tmp+this.activePieceOrientation+"_";tmp=""}if(this.RS!="ARS"){output+="R~"+this.RS+"_"}if(this.activePieceOpacity!=1){output+="O~"+this.activePieceOpacity+"_"}if(this.border!="Master"){output+="B~"+this.border+"_"}if(this.duration!=15){output+="T~"+this.duration+"_"}switch(this.joystick_state){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}switch(this.joystick_direction){case"u":tmp+="8";break;case"r":tmp+="6";break;case"d":tmp+="2";break;case"l":tmp+="4";break;case"c":tmp+="5";break;case"ul":tmp+="7";break;case"ur":tmp+="9";break;case"dr":tmp+="3";break;case"dl":tmp+="1";break}output+="J~"+tmp+"_";tmp="";for(var i=0,istop=this.button_state.length;i<istop;i++){switch(this.button_state[i]){case"rest":tmp+="r";break;case"pressed":tmp+="p";break;case"holded":tmp+="h";break}}output+="C~"+tmp+"_";tmp="";if(this.comment){output+="S~"+this.comment+"_"}if(this.whiteborder){output+="W~1_"}if(this.nexthold.length){for(var i=0,istop=this.nexthold.length;i<istop;i++){if(this.nexthold[i]){tmp+=this.nexthold[i]}else{tmp+=0}}output+="N~"+tmp+"_";tmp=""}var candidate_case=[];var candidate_case_deco=[];var first_candidate=true;var first_candidate_deco=true;for(var i=0;i<10;i++){for(var j=0;j<20;j++){if(this.playfield[i][j][0]){if(first_candidate){candidate_case.push([]);candidate_case[0].val=this.playfield[i][j][0];candidate_case[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate=false}else{for(var k=0,kstop=candidate_case.length;k<kstop;k++){if(this.playfield[i][j][0]==candidate_case[k].val){candidate_case[k].push(alphanumconvert(i)+alphanumconvert(j));break}else if(k==parseFloat(candidate_case.length-1)){candidate_case.push([]);candidate_case[parseFloat(k+1)].val=this.playfield[i][j][0];candidate_case[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j))}}}}if(this.playfield[i][j][1]){if(first_candidate_deco){candidate_case_deco.push([]);candidate_case_deco[0].val=this.playfield[i][j][1];candidate_case_deco[0].push(alphanumconvert(i)+alphanumconvert(j));first_candidate_deco=false}else{for(var k=0,kstop=candidate_case_deco.length;k<kstop;k++){if(this.playfield[i][j][1]==candidate_case_deco[k].val){candidate_case_deco[k].push(alphanumconvert(i)+alphanumconvert(j));break}else if(k==parseFloat(candidate_case_deco.length-1)){candidate_case_deco.push([]);candidate_case_deco[parseFloat(k+1)].val=this.playfield[i][j][1];candidate_case_deco[parseFloat(k+1)].push(alphanumconvert(i)+alphanumconvert(j))}}}}}}if(candidate_case.length){output+="I~";for(var i=0,istop=candidate_case.length;i<istop;i++){tmp+=candidate_case[i].val;for(var j=0,jstop=candidate_case[i].length;j<jstop;j++){tmp+=candidate_case[i][j]}if(i<candidate_case.length-1){tmp+="~"}}output+=tmp+"_"}tmp="";if(candidate_case_deco.length){output+="D~";for(var i=0,istop=candidate_case_deco.length;i<istop;i++){tmp+=candidate_case_deco[i].val+"*";for(var j=0,jstop=candidate_case_deco[i].length;j<jstop;j++){tmp+=candidate_case_deco[i][j]}if(i<candidate_case_deco.length-1){tmp+="~"}}output+=tmp+"_"}tmp="";return output};Frame.prototype.load=function(str,format){if(format!="differences"){this.clear("all")}if(!str){return}var properties=str.split("_");for(var i=0,istop=properties.length;i<istop;i++){var subproperties=properties[i].split("~");switch(subproperties[0]){case"A":if(subproperties[1].charAt(0)!=="E"){this.activePieceType=subproperties[1].charAt(0);this.activePieceOrientation=subproperties[1].slice(3);this.activePiecePositionX=alphanumconvert(subproperties[1].charAt(1));this.activePiecePositionY=alphanumconvert(subproperties[1].charAt(2))}else{this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY=""}break;case"I":for(var j=1,jstop=subproperties.length;j<jstop;j++){var type=subproperties[j].charAt(0);if(type=="E"){type=""}for(var k=1,kstop=subproperties[j].length;k<kstop;k+=2){var inact_x=subproperties[j].charAt(k);var inact_y=subproperties[j].charAt(k+1);this.modify(alphanumconvert(inact_x),alphanumconvert(inact_y),type)}}break;case"D":for(var j=1,jstop=subproperties.length;j<jstop;j++){var subsubproperties=subproperties[j].split("*");var type=subsubproperties[0];if(type=="E"){type=""}if(subproperties[1]!==""){for(var k=0,kstop=subsubproperties[1].length;k<kstop;k+=2){var deco_x=subsubproperties[1].charAt(k);var deco_y=subsubproperties[1].charAt(k+1);this.modify_decoration(alphanumconvert(deco_x),alphanumconvert(deco_y),type)}}}break;case"R":this.RS=subproperties[1];break;case"O":this.activePieceOpacity=subproperties[1];break;case"N":for(var k=0,kstop=subproperties[1].length;k<kstop;k++){if(subproperties[1].charAt(k)!="0"){this.nexthold[k]=subproperties[1].charAt(k)}else{this.nexthold[k]=""}}break;case"S":this.comment=subproperties[1];break;case"W":this.whiteborder=subproperties[1];break;case"T":this.duration=subproperties[1];break;case"B":this.border=subproperties[1];break;case"J":var tmp1,tmp2;switch(subproperties[1].charAt(0)){case"r":tmp1="rest";break;case"p":tmp1="pressed";break;case"h":tmp1="holded";break}switch(subproperties[1].charAt(1)){case"8":tmp2="u";break;case"6":tmp2="r";break;case"2":tmp2="d";break;case"4":tmp2="l";break;case"7":tmp2="ul";break;case"5":tmp2="c";break;case"9":tmp2="ur";break;case"3":tmp2="dr";break;case"1":tmp2="dl";break}this.modify_control(tmp2,tmp1);break;case"C":for(var k=0,kstop=subproperties[1].length;k<=kstop;k++){var tmp;switch(subproperties[1].charAt(k)){case"r":tmp="rest";break;case"h":tmp="holded";break;case"p":tmp="pressed";break}switch(k){case 0:this.modify_button("A",tmp);break;case 1:this.modify_button("B",tmp);break;case 2:this.modify_button("C",tmp);break;case 3:this.modify_button("D",tmp);break}}break}}};Frame.prototype.clear=function(mode){switch(mode){case"inactive":this.painter.eraseLayer("inactive");for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){this.playfield[i][j][0]=""}}break;case"active":this.painter.eraseLayer("active");this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";break;case"decoration":this.painter.eraseLayer("decoration");for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){this.playfield[i][j][1]=""}}break;case"all":this.painter.eraseLayer("inactive");this.painter.eraseLayer("active");this.painter.eraseLayer("decoration");for(var i=0,istop=this.width;i<istop;i++){for(var j=0,jstop=this.height;j<jstop;j++){this.playfield[i][j][0]="";this.playfield[i][j][1]=""}}this.activePieceType="";this.activePieceOrientation="";this.activePiecePositionX="";this.activePiecePositionY="";this.comment="";break}};Frame.prototype.is_piece_colliding=function(x,y,type,orientation){var matrix=getMatrix(type,orientation,this.RS);var tmp="",tmp2="";for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]){}if(matrix[i][j]&&!this.is_in(parseInt(x-1+j,10),parseInt(y-1+i,10))){return true}if(matrix[i][j]&&this.is_in(parseInt(x-1+j,10),parseInt(y-1+i,10))&&this.playfield[parseInt(x-1+j,10)][parseInt(y+i-1,10)][0]){return true}}}return false};Frame.prototype.addPiece=function(x,y,type,orientation,mode,drop){var matrix=getMatrix(type,orientation,this.RS);var still_droping=true;var counter=0;while(drop&still_droping){counter=0;if(this.is_piece_colliding(parseInt(x),parseInt(y),type,orientation)){still_droping=false}else{y++}}if(drop){y--}if(mode=="inactive"||mode=="garbage"){this.painter.CanvasPreview.attr("width",this.painter.CanvasPreview.width())
}if(mode=="active"){this.activePieceType=type;this.activePieceOrientation=orientation;this.activePiecePositionX=x;this.activePiecePositionY=y;this.painter.CanvasActive.attr("width",this.painter.CanvasPreview.width())}if(mode=="decoration-preview"){this.painter.drawDeco(x,y,type,"preview")}else if(mode=="decoration"){this.modify_decoration(x,y,type);this.painter.drawDeco(x,y,type,"decoration");this.painter.highlight(x,y)}else{for(var i=0;i<4;i++){for(var j=0;j<4;j++){if(matrix[i][j]&&this.piece_is_in(x,y,type,orientation)){switch(mode){case"inactive":this.modify(parseInt(x-1+j,10),parseInt(y-1+i,10),type);this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),type,this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,x-1+j,y-1+i)}this.painter.highlight(x-1+j,y-1+i);break;case"garbage":this.modify(parseInt(x-1+j,10),parseInt(y-1+i,10),"G");this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),"G",this.RS,"inactive");if(this.whiteborder){this.painter.drawLocalWhiteBorder(this.playfield,x-1+j,y-1+i)}this.painter.highlight(x-1+j,y-1+i);break;case"preview":this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),type,this.RS,"preview");break;case"active":this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),type,this.RS,"active");this.painter.highlight(x-1+j,y-1+i);break;case"erase":this.removeBlock(parseInt(x-1+j,10),parseInt(y-1+i,10));this.painter.highlight(x-1+j,y-1+i);break;case"preview-eraser":this.painter.drawBlock(parseInt(x-1+j,10),parseInt(y-1+i,10),"G",this.RS,"preview");break}}}}}};Frame.prototype.modify_decoration=function(x,y,type){this.playfield[x][y][1]=type};Frame.prototype.modify_control=function(direction,state){this.joystick_state=state;this.joystick_direction=direction};Frame.prototype.modify_button=function(button,state){var index="";switch(button){case"A":index=0;break;case"B":index=1;break;case"C":index=2;break;case"D":index=3;break}this.button_state[index]=state};var ARS={I:{color:"red",offset:[2,1],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],ccw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"cyan",offset:[6,1],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,1],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,1],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"magenta",offset:[8,0],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"green",offset:[5,1],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,1],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,1],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var SRS={I:{color:"cyan",offset:[6,2],i:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"blue",offset:[7,2],i:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"orange",offset:[3,2],i:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],ccw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellow",offset:[4,2],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"green",offset:[5,2],i:[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"purple",offset:[8,2],i:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"red",offset:[2,2],i:[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[1,2],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var GB={I:{color:"yellowgreen",offset:[6,9],i:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],u:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},J:{color:"yellowgreen",offset:[1,9],i:[[0,0,0,0],[1,1,1,0],[0,0,1,0],[0,0,0,0]],cw:[[0,1,0,0],[0,1,0,0],[1,1,0,0],[0,0,0,0]],u:[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},L:{color:"yellowgreen",offset:[3,9],i:[[0,0,0,0],[1,1,1,0],[1,0,0,0],[0,0,0,0]],cw:[[1,1,0,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},O:{color:"yellowgreen",offset:[4,9],i:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},S:{color:"yellowgreen",offset:[5,9],i:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],cw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[0,1,1,0],[1,1,0,0],[0,0,0,0]],ccw:[[1,0,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},T:{color:"yellowgreen",offset:[8,9],i:[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],cw:[[0,1,0,0],[1,1,0,0],[0,1,0,0],[0,0,0,0]],u:[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]],ccw:[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Z:{color:"yellowgreen",offset:[2,9],i:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],cw:[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],u:[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],ccw:[[0,1,0,0],[1,1,0,0],[1,0,0,0],[0,0,0,0]],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},G:{color:"gray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]},Flash:{color:"lightgray",offset:[0,9],singleton:[[0,0,0,0],[0,1,0,0],[0,0,0,0],[0,0,0,0]]}};var decoration={n1:{s:[0,0],e:[1,1]},n2:{s:[1,0],e:[2,1]},n3:{s:[2,0],e:[3,1]},n4:{s:[3,0],e:[4,1]},n5:{s:[4,0],e:[5,1]},n6:{s:[5,0],e:[6,1]},n7:{s:[6,0],e:[7,1]},n8:{s:[7,0],e:[8,1]},n9:{s:[8,0],e:[9,1]},n0:{s:[9,0],e:[10,1]},smallccw:{s:[0,1],e:[1,2]},smallcw:{s:[1,1],e:[2,2]},smalloktick:{s:[2,1],e:[3,2]},smallokcircle:{s:[3,1],e:[4,2]},smallnocross:{s:[4,1],e:[5,2]},smallquestion:{s:[5,1],e:[6,2]},smallexclamation:{s:[6,1],e:[7,2]},nwarrow:{s:[0,2],e:[1,3]},narrow:{s:[1,2],e:[2,3]},nearrow:{s:[2,2],e:[3,3]},warrow:{s:[0,3],e:[1,4]},earrow:{s:[2,3],e:[3,4]},swarrow:{s:[0,4],e:[1,5]},sarrow:{s:[1,4],e:[2,5]},searrow:{s:[2,4],e:[3,5]},bigcw:{s:[3,2],e:[5,4]},bigccw:{s:[5,2],e:[7,4]},bigquestion:{s:[7,2],e:[9,4]},bigexclamation:{s:[9,2],e:[10,4]},bigoktick:{s:[3,4],e:[5,6]},bigokcircle:{s:[5,4],e:[7,6]},bignocross:{s:[7,4],e:[9,6]},overlayyellow:{s:[1,6],e:[2,7]},overlayblue:{s:[2,6],e:[3,7]},overlaygreen:{s:[3,6],e:[4,7]},overlaypink:{s:[4,6],e:[5,7]},overlayorange:{s:[5,6],e:[6,7]},clear1:{s:[0,7],e:[10,8]},clear2:{s:[0,8],e:[10,9]},clear3:{s:[0,9],e:[10,10]},clear4:{s:[0,10],e:[10,11]},clear5:{s:[0,11],e:[10,12]},clear6:{s:[0,12],e:[10,13]},clear7:{s:[0,13],e:[10,14]}};function getMatrix(type,orientation,RS){var matrix;switch(RS){case"ARS":switch(type){case"I":switch(orientation){case"i":matrix=ARS.I.i;break;case"cw":matrix=ARS.I.cw;break;case"ccw":matrix=ARS.I.ccw;break;case"u":matrix=ARS.I.u;break;case"singleton":matrix=ARS.I.singleton;break}break;case"T":switch(orientation){case"i":matrix=ARS.T.i;break;case"cw":matrix=ARS.T.cw;break;case"ccw":matrix=ARS.T.ccw;break;case"u":matrix=ARS.T.u;break;case"singleton":matrix=ARS.T.singleton;break}break;case"L":switch(orientation){case"i":matrix=ARS.L.i;break;case"cw":matrix=ARS.L.cw;break;case"ccw":matrix=ARS.L.ccw;break;case"u":matrix=ARS.L.u;break;case"singleton":matrix=ARS.L.singleton;break}break;case"J":switch(orientation){case"i":matrix=ARS.J.i;break;case"cw":matrix=ARS.J.cw;break;case"ccw":matrix=ARS.J.ccw;break;case"u":matrix=ARS.J.u;break;case"singleton":matrix=ARS.J.singleton;break}break;case"S":switch(orientation){case"i":matrix=ARS.S.i;break;case"cw":matrix=ARS.S.cw;break;case"ccw":matrix=ARS.S.ccw;break;case"u":matrix=ARS.S.u;break;case"singleton":matrix=ARS.J.singleton;break}break;case"Z":switch(orientation){case"i":matrix=ARS.Z.i;break;case"cw":matrix=ARS.Z.cw;break;case"ccw":matrix=ARS.Z.ccw;break;case"u":matrix=ARS.Z.u;break;case"singleton":matrix=ARS.Z.singleton;break}break;case"O":switch(orientation){case"i":matrix=ARS.O.i;break;case"cw":matrix=ARS.O.cw;break;case"ccw":matrix=ARS.O.ccw;break;case"u":matrix=ARS.O.u;break;case"singleton":matrix=ARS.O.singleton;break}break;case"G":switch(orientation){case"i":matrix=ARS.G.i;break;case"cw":matrix=ARS.G.cw;break;case"ccw":matrix=ARS.G.ccw;break;case"u":matrix=ARS.G.u;break;case"singleton":matrix=ARS.G.singleton;break}break}break;case"SRS":switch(type){case"I":switch(orientation){case"i":matrix=SRS.I.i;break;case"cw":matrix=SRS.I.cw;break;case"ccw":matrix=SRS.I.ccw;break;case"u":matrix=SRS.I.u;break;case"singleton":matrix=SRS.I.singleton;break}break;case"T":switch(orientation){case"i":matrix=SRS.T.i;break;case"cw":matrix=SRS.T.cw;break;case"ccw":matrix=SRS.T.ccw;break;case"u":matrix=SRS.T.u;break;case"singleton":matrix=SRS.T.singleton;break}break;case"L":switch(orientation){case"i":matrix=SRS.L.i;break;case"cw":matrix=SRS.L.cw;break;case"ccw":matrix=SRS.L.ccw;break;case"u":matrix=SRS.L.u;break;case"singleton":matrix=SRS.L.singleton;break}break;case"J":switch(orientation){case"i":matrix=SRS.J.i;break;case"cw":matrix=SRS.J.cw;break;case"ccw":matrix=SRS.J.ccw;break;case"u":matrix=SRS.J.u;break;case"singleton":matrix=SRS.J.singleton;break}break;case"S":switch(orientation){case"i":matrix=SRS.S.i;break;case"cw":matrix=SRS.S.cw;break;case"ccw":matrix=SRS.S.ccw;break;case"u":matrix=SRS.S.u;break;case"singleton":matrix=SRS.S.singleton;break}break;case"Z":switch(orientation){case"i":matrix=SRS.Z.i;break;case"cw":matrix=SRS.Z.cw;break;case"ccw":matrix=SRS.Z.ccw;break;case"u":matrix=SRS.Z.u;break;case"singleton":matrix=SRS.Z.singleton;break}break;case"O":switch(orientation){case"i":matrix=SRS.O.i;break;case"cw":matrix=SRS.O.cw;break;case"ccw":matrix=SRS.O.ccw;break;case"u":matrix=SRS.O.u;break;case"singleton":matrix=SRS.O.singleton;break}break;case"G":switch(orientation){case"i":matrix=SRS.G.i;break;case"cw":matrix=SRS.G.cw;break;case"ccw":matrix=SRS.G.ccw;break;case"u":matrix=SRS.G.u;break;case"singleton":matrix=SRS.G.singleton;break}break}break;case"GB":switch(type){case"I":switch(orientation){case"i":matrix=GB.I.i;break;case"cw":matrix=GB.I.cw;break;case"ccw":matrix=GB.I.ccw;break;case"u":matrix=GB.I.u;break;case"singleton":matrix=GB.I.singleton;break}break;case"T":switch(orientation){case"i":matrix=GB.T.i;break;case"cw":matrix=GB.T.cw;break;case"ccw":matrix=GB.T.ccw;break;case"u":matrix=GB.T.u;break;case"singleton":matrix=GB.T.singleton;break}break;case"L":switch(orientation){case"i":matrix=GB.L.i;break;case"cw":matrix=GB.L.cw;break;case"ccw":matrix=GB.L.ccw;break;case"u":matrix=GB.L.u;break;case"singleton":matrix=GB.L.singleton;break}break;case"J":switch(orientation){case"i":matrix=GB.J.i;break;case"cw":matrix=GB.J.cw;break;case"ccw":matrix=GB.J.ccw;break;case"u":matrix=GB.J.u;break;case"singleton":matrix=GB.J.singleton;break}break;case"S":switch(orientation){case"i":matrix=GB.S.i;break;case"cw":matrix=GB.S.cw;break;case"ccw":matrix=GB.S.ccw;break;case"u":matrix=GB.S.u;break;case"singleton":matrix=GB.S.singleton;break}break;case"Z":switch(orientation){case"i":matrix=GB.Z.i;break;case"cw":matrix=GB.Z.cw;break;case"ccw":matrix=GB.Z.ccw;break;case"u":matrix=GB.Z.u;break;case"singleton":matrix=GB.Z.singleton;break}break;case"O":switch(orientation){case"i":matrix=GB.O.i;break;case"cw":matrix=GB.O.cw;break;case"ccw":matrix=GB.O.ccw;break;case"u":matrix=GB.O.u;break;case"singleton":matrix=GB.O.singleton;break}break;case"G":switch(orientation){case"i":matrix=GB.G.i;break;case"cw":matrix=GB.G.cw;break;case"ccw":matrix=GB.G.ccw;break;case"u":matrix=GB.G.u;break;case"singleton":matrix=GB.G.singleton;break}break}break}return matrix}function alphanumconvert(input){var output;switch(input){case"a":output=0;break;case"b":output=1;break;case"c":output=2;break;case"d":output=3;break;case"e":output=4;break;case"f":output=5;break;case"g":output=6;break;case"h":output=7;break;case"i":output=8;break;case"j":output=9;break;case"k":output=10;break;case"l":output=11;break;case"m":output=12;break;case"n":output=13;break;case"o":output=14;break;case"p":output=15;break;case"q":output=16;break;case"r":output=17;break;case"s":output=18;break;case"t":output=19;break;case"z":output=-1;break;case-1:output="z";break;case 0:output="a";break;case 1:output="b";break;case 2:output="c";break;case 3:output="d";break;case 4:output="e";break;case 5:output="f";break;case 6:output="g";break;case 7:output="h";break;case 8:output="i";break;case 9:output="j";break;case 10:output="k";break;case 11:output="l";break;case 12:output="m";break;case 13:output="n";break;case 14:output="o";break;case 15:output="p";break;case 16:output="q";break;case 17:output="r";break;case 18:output="s";break;case 19:output="t";break}return output}(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0,xstop=vendors.length;x<xstop&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}})();Array.prototype.compare=function(testArr){if(this.length!=testArr.length){return false}for(var i=0,istop=testArr.length;i<istop;i++){if(this[i].compare){if(!this[i].compare(testArr[i])){return false}}if(this[i]!==testArr[i]){return false}}return true};Diagram.prototype.flate_encode=function(str){return $.base64.encode(RawDeflate.deflate(unescape(encodeURIComponent(str))))};Diagram.prototype.flate_decode=function(str){return decodeURIComponent(escape(RawDeflate.inflate($.base64.decode(str))))};$(document).ready(function(){var diagrams=[];var painters=[];$(".tedige-playfield-wrapper").each(function(index){var newID=$(this).attr("id");var i=0;var insert=[];insert[i++]='	<div class="left-pane">';insert[i++]='		<div class="nexthold-container">';insert[i++]='			<canvas id="'+newID+'-nexthold-background"	width="97" height="32" style="z-index:0;"></canvas>';insert[i++]='			<canvas id="'+newID+'-nexthold"	width="97" height="32" style="z-index:1;"></canvas>';insert[i++]="		</div>";insert[i++]='		<div class="canvas-container" id="'+newID+'-container border-gray">';insert[i++]='			<canvas id="'+newID+'-border"		width="97" height="177" style="z-index:0;background-color: black"></canvas>';insert[i++]='			<canvas id="'+newID+'-background"	width="97" height="177" style="z-index:1;//background-color: black"></canvas>';insert[i++]='			<canvas id="'+newID+'-inactive"	 width="97" height="177" style="z-index:2; border:none; opacity: 0.65"></canvas>';insert[i++]='			<canvas id="'+newID+'-whiteborder" width="97" height="177" style="z-index:3"></canvas>';insert[i++]='			<canvas id="'+newID+'-active"		width="97" height="177" style="z-index:4"></canvas>';insert[i++]='			<canvas id="'+newID+'-deco"			width="97" height="177" style="z-index:5"></canvas>';insert[i++]='			<canvas id="'+newID+'-decoPin"	 width="97" height="177" style="z-index:6; border:none; opacity: 0.65;display:none"></canvas>';insert[i++]='			<canvas id="'+newID+'-preview"		width="97" height="177" style="z-index:6"></canvas>';insert[i++]="		</div>";insert[i++]='		<div class="control-div">';insert[i++]='		<canvas class="canvas-control" id="'+newID+'-control" width="97" height="35" style=""></canvas>';insert[i++]="		</div>";insert[i++]="		</div>";insert[i++]='		<div class="right-pane">';insert[i++]='		<div class="progressbar">';insert[i++]="			<p>";insert[i++]='				<input class="current-frame" id="'+newID+'-current-frame" type="text" style="width: 2.5em; text-align:center" /> / <span id="'+newID+'-total-frame">1</span>';insert[i++]="			</p>";insert[i++]='			<canvas id="'+newID+'-progressbar" width="97" height="24" style="border: 1px solid white;" />';insert[i++]="		</div>";insert[i++]='		<div id="order-control"> ';insert[i++]='			<input class="cmd_prev" id="'+newID+'-cmd_prev"	value=""	type="button" />';insert[i++]='			<input class="cmd_next" id="'+newID+'-cmd_next"	value=""	type="button" /><br />';insert[i++]='			<input class="cmd_first" id="'+newID+'-cmd_first" value="|" type="button"/>';insert[i++]='			<input class="cmd_last" id="'+newID+'-cmd_last" value="|" type="button"	style="width:2.5em"/><br />';insert[i++]='			<input class="cmd_playpause" id="'+newID+'-cmd_playpause" value ="" type="button" style="width:2.5em" /><br />';insert[i++]='			<input class="check-loop" id="'+newID+'-loop"type="checkbox"> loop';insert[i++]="		</div>";insert[i++]='		<div class="links">';insert[i++]='			<a class="Link2Editor" href="">[Edit]</a>';insert[i++]="		</div>";insert[i++]="	</div>";insert[i++]='	<div id="under">';insert[i++]='		<textarea readonly="" id="'+newID+'-comment" class="comment"></textarea>';insert[i++]="	</div>";$("#"+newID).html(insert.join("\n"));painters[newID]=new Painter(newID);diagrams[newID]=new Diagram(painters[newID]);diagrams[newID].init();painters[newID].init()});$(".tedige-playfield-wrapper").each(function(index){var newID=$(this).attr("id");var initiator=setInterval(function(){if(painters[newID].ready){clearInterval(initiator);var titlesearch=$("#"+newID).data("tedigecode");if(titlesearch){$("#"+newID).find(".Link2Editor").attr("href","http://petitprince.github.io/TeDiGe-2/editor.html?"+titlesearch);var littlestr=titlesearch.split("-");switch(littlestr[1]){case"all":diagrams[newID].load(diagrams[newID].flate_decode(littlestr[2]));diagrams[newID].frames[diagrams[newID].current_frame].draw();break;case"current":diagrams[newID].frames[diagrams[newID].current_frame].load(diagrams[newID].flate_decode(littlestr[2]));diagrams[newID].frames[diagrams[newID].current_frame].draw();break}diagrams[newID].first_frame()}}},10)});$(".cmd_playpause").click(function(){var aDiag=diagrams[$(this).attr("id").split("-")[0]];var i=aDiag.current_frame;var len=aDiag.frames.length;if(aDiag.playing){aDiag.playing=false;$("#pf-cmd_playpause").attr("value","")}else{aDiag.playing=true;$("#pf-cmd_playpause").attr("value","||")}var counter=0;function render(){if(i<len&&aDiag.playing){if(counter<aDiag.frames[aDiag.current_frame].duration){aDiag.goto_frame(i);counter++}else{counter=0;i++}requestAnimationFrame(render)}else if($("#"+aDiag.painter.IDString+"-loop").is(":checked")){i=0;requestAnimationFrame(render)}}render()});$(".current-frame").blur(function(){if($("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()>0&&$("#"+$(this).attr("id").split("-")[0]+"-current-frame").val()<=diagrams[$(this).attr("id").split("-")[0]].frames.length){diagrams[$(this).attr("id").split("-")[0]].goto_frame($("#tomtom-current-frame").val())}});$(".cmd_first").click(function(){diagrams[$(this).attr("id").split("-")[0]].first_frame()});$(".cmd_prev").click(function(){diagrams[$(this).attr("id").split("-")[0]].previous_frame()});$(".cmd_next").click(function(){if(diagrams[$(this).attr("id").split("-")[0]].current_frame<diagrams[$(this).attr("id").split("-")[0]].frames.length-1){diagrams[$(this).attr("id").split("-")[0]].next_frame()}});$(".cmd_last").click(function(){diagrams[$(this).attr("id").split("-")[0]].last_frame()})});
>>>>>>> table-browser
